window.TILE_VERSION={"ditu":{"normal":{"version":"088","updateDate":"20200120"},"satellite":{"version":"009","updateDate":"20200120"},"normalTraffic":{"version":"081","updateDate":"20200120"},"satelliteTraffic":{"version":"083","updateDate":"20200120"},"mapJS":{"version":"104","updateDate":"20200120"},"satelliteStreet":{"version":"083","updateDate":"20200120"},"earthVector":{"version":"001","updateDate":"20200120"}},"webapp":{"high_normal":{"version":"001","updateDate":"20200120"},"lower_normal":{"version":"002","updateDate":"20200120"}},"api_for_mobile":{"vector":{"version":"002","updateDate":"20200120"},"vectorIcon":{"version":"002","updateDate":"20200120"}}};window.MSV={"mapstyle":{"updateDate":"20200116","version":"001"}};window.BMAP_AUTHENTIC_KEY="ijImA55u3R2IXjsm6wmWnN8E6QRMxOYH";window.BMapGL=window.BMapGL||{};(function(aI,cZ){var x=x||{version:"20150702",emptyFn:function(){}};(function(){x._log=[];var i=0;var fm={};x.BaseClass=function(fn){fm[(this.hashCode=(fn||x.BaseClass.guid()))]=this};x.BaseClass.guid=function(){return"mz_"+(i++).toString(36)};x.BaseClass.create=function(){var fn=new x.BaseClass();fn.decontrol();return fn};var e=x.instance=x.I=function(fn){return fm[fn]};x.BaseClass.prototype.dispose=function(){if(this.hashCode){delete fm[this.hashCode]}for(var fn in this){if(typeof this[fn]!="function"){delete this[fn]}}};x.BaseClass.prototype.getHashCode=function(){if(!this.hashCode){fm[(this.hashCode=x.BaseClass.guid())]=this}return this.hashCode};x.BaseClass.prototype.decontrol=function(){delete fm[this.hashCode]};x.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};x.BaseClass.prototype._wlog=function(fo,fp){var fn=x._log;if(fn.length>100){fn.reverse().length=50;fn.reverse()}fn[fn.length]="["+fo+"]["+(this._className||"Object")+" "+this.hashCode+"] "+fp}})();Function.prototype.inherits=function(fn,fm){var e,fo,fq=this.prototype,fp=function(){};fp.prototype=fn.prototype;fo=this.prototype=new fp();if(typeof(fm)=="string"){fo._className=fm}for(e in fq){fo[e]=fq[e]}this.prototype.constructor=fq.constructor;fq=fp=null;return fo};x.BaseEvent=function(e,i){this.type=e;this.returnValue=true;this.target=i||null;this.currentTarget=this.srcElement=null;this.cancelBubble=false;this.domEvent=null};x.BaseClass.prototype.on=x.BaseClass.prototype.addEventListener=function(fm,i){if(typeof i!=="function"){return this._wlog("error","addEventListener:"+i+" is not a function")}if(!this._listeners){this._listeners={}}var e=this._listeners;if(fm.indexOf("on")!==0){fm="on"+fm}if(typeof e[fm]!=="object"){e[fm]={}}var fn=i.hashCode||x.BaseClass.guid();i.hashCode=fn;if(e[fm][fn]){this._wlog("warning","repeat key:"+fn)}e[fm][fn]=i};x.BaseClass.prototype.off=x.BaseClass.prototype.removeEventListener=function(fm,i){if(typeof i=="function"){i=i.hashCode}else{if(typeof i!="string"){return}}if(!this._listeners){this._listeners={}}if(fm.indexOf("on")!=0){fm="on"+fm}var e=this._listeners;if(!e[fm]){return}if(e[fm][i]){delete e[fm][i]}};x.BaseClass.prototype.fire=x.BaseClass.prototype.dispatchEvent=function(fn){if(!this._listeners){this._listeners={}}var fm,e=this._listeners,fo=fn.type;fn.target=fn.srcElement=fn.target||fn.srcElement||this;fn.currentTarget=this;if(typeof this[fo]=="function"){this[fo](fn)}if(typeof e[fo]=="object"){for(fm in e[fo]){if(typeof e[fo][fm]=="function"){e[fo][fm].call(this,fn)}}}return fn.returnValue};x.BaseEvent.prototype.inherit=function(fm){var i=this;this.domEvent=fm=window.event||fm;i.clientX=fm.clientX||fm.pageX;i.clientY=fm.clientY||fm.pageY;i.offsetX=fm.offsetX||fm.layerX;i.offsetY=fm.offsetY||fm.layerY;i.screenX=fm.screenX;i.screenY=fm.screenY;i.ctrlKey=fm.ctrlKey||fm.metaKey;i.shiftKey=fm.shiftKey;i.altKey=fm.altKey;return i};x.Browser=(function(){var fm=navigator.userAgent;var fo=0;var e=0;var fp=0;var i=0;var ft=0;var fr=0;var fs=0;var fq=0;var fn=0;var fu=0;if(typeof window.opera==="object"&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(fm)){fp=parseFloat(RegExp.$2)}else{if(/OPR(\/(\d+)(\..?)?)/.test(fm)){fp=parseInt(RegExp.$2,10)}else{if(/Edge\/((\d+)\.\d+)/.test(fm)){fo=parseInt(RegExp.$2,10)}else{if(/MSIE (\d+(\.\d+)?)/.test(fm)){e=parseFloat(RegExp.$1)}else{if(fm.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(fm)){e=parseInt(RegExp.$1,10)}else{if(/Firefox(\s|\/)(\d+(\.\d+)?)/.test(fm)){ft=parseFloat(RegExp.$2)}else{if(navigator.vendor==="Netscape"&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(fm)){fs=parseFloat(RegExp.$2)}else{if(fm.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(fm)){i=parseFloat(RegExp.$1)}}}}}}}}if(fm.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(fm)){fq=parseInt(RegExp.$1,10)}else{if(!e&&!fo&&fm.indexOf("Gecko")>-1&&fm.indexOf("KHTML")===-1&&/rv\:(\d+(\.\d+)?)/.test(fm)){fn=parseFloat(RegExp.$1)}else{if(!fo&&/chrome\/(\d+(\.\d+)?)/i.test(fm)){fr=parseFloat(RegExp.$1)}else{if(!fo&&/AppleWebKit\/(\d+(\.\d+)?)/.test(fm)){fu=parseInt(RegExp.$1,10)}}}}var fv={edge:fo,ie:e,firefox:ft,netscape:fs,opera:fp,safari:i,chrome:fr,gecko:fn,trident:fq,webkit:fu};return fv})();window.FeBrowser=x.Browser;x.Dom={};x.Dom.createDom=function(i,e){if(x.isIE&&e&&e.name){i="<"+i+' name="'+x.String.escapeHTML(e.name)+'">'}var fm=document.createElement(i);if(e){x.Dom.setProperties(fm,e)}return fm};x.Dom.getOffset=function(fn){var fq=x.Dom.getOwnerDocument(fn);var fp=x.isGecko>0&&fq.getBoxObjectFor&&x.Dom.getStyle(fn,"position")=="absolute"&&(fn.style.top===""||fn.style.left==="");var fr={left:0,top:0};var i=(x.isIE&&!x.isStrict)?fq.body:fq.documentElement;if(fn==i){return fr}var fm=null;var fo;if(fn.getBoundingClientRect){fo=fn.getBoundingClientRect();fr.left=fo.left+Math.max(fq.documentElement.scrollLeft,fq.body.scrollLeft);fr.top=fo.top+Math.max(fq.documentElement.scrollTop,fq.body.scrollTop);fr.left-=fq.documentElement.clientLeft;fr.top-=fq.documentElement.clientTop;if(x.isIE&&!x.isStrict){fr.left-=2;fr.top-=2}}else{if(fq.getBoxObjectFor&&!fp){fo=fq.getBoxObjectFor(fn);var e=fq.getBoxObjectFor(i);fr.left=fo.screenX-e.screenX;fr.top=fo.screenY-e.screenY}else{fm=fn;do{fr.left+=fm.offsetLeft;fr.top+=fm.offsetTop;if(x.isWebkit>0&&x.Dom.getStyle(fm,"position")=="fixed"){fr.left+=fq.body.scrollLeft;fr.top+=fq.body.scrollTop;break}fm=fm.offsetParent}while(fm&&fm!=fn);if(x.isOpera>0||(x.isWebkit>0&&x.Dom.getStyle(fn,"position")=="absolute")){fr.top-=fq.body.offsetTop}fm=fn.offsetParent;while(fm&&fm!=fq.body){fr.left-=fm.scrollLeft;if(!x.isOpera||fm.tagName!="TR"){fr.top-=fm.scrollTop}fm=fm.offsetParent}}}return fr};x.Dom.getOwnerDocument=function(e){return e.nodeType==9?e:e.ownerDocument||e.document};x.Dom.setProperties=function(i,e){x.each(e,function(fn,fm){x.Dom._setProperty(i,fm,fn)})};x.Dom._setProperty=function(i,e,fm){if(e=="style"){i.style.cssText=fm}else{if(e=="class"){i.className=fm}else{if(e=="for"){i.htmlFor=fm}else{if(e in x.Dom._DIRECT_ATTRIBUTE_MAP){i.setAttribute(x.Dom._DIRECT_ATTRIBUTE_MAP[e],fm)}else{i[e]=fm}}}}};x.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"};x.G=function(){for(var fm=[],fn=arguments.length-1;fn>-1;fn--){var fo=arguments[fn];fm[fn]=null;if(typeof fo=="object"&&fo&&fo.dom){fm[fn]=fo.dom}else{if((typeof fo=="object"&&fo&&fo.tagName)||fo==window||fo==document){fm[fn]=fo}else{if(typeof fo=="string"&&(fo=document.getElementById(fo))){fm[fn]=fo}}}}return fm.length<2?fm[0]:fm};x.ac=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);if(!new RegExp("(^| )"+i.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)){e.className=e.className.split(/\s+/).concat(i).join(" ")}};x.addClassName=x.ac;x.each=function(fp,e){if(typeof e!="function"){return fp}if(fp){if(fp.length===undefined){for(var fm in fp){e.call(fp[fm],fp[fm],fm)}}else{for(var fn=0,fo=fp.length;fn<fo;fn++){e.call(fp[fn],fp[fn],fn)}}}return fp};x.extend=function(fp,fn){if(fp&&fn&&typeof(fn)=="object"){for(var fo in fn){fp[fo]=fn[fo]}var fm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];for(var e=0,i;e<fm.length;e++){i=fm[e];if(Object.prototype.hasOwnProperty.call(fn,i)){fp[i]=fn[i]}}}return fp};x.hide=function(){x.each(arguments,function(e){if(e=x.G(e)){e.style.display="none"}})};x.inherit=function(fr,fn,fm){var fq=fr.prototype;var fp=function(){};fp.prototype=fn.prototype;var fo=fr.prototype=new fp();if(typeof fm=="string"){fo._className=fm}for(var e in fq){fo[e]=fq[e]}fr.prototype.constructor=fq.constructor;fq=null;return fo};x.isIE=0;(function(){if(navigator.userAgent.indexOf("MSIE")>0&&!window.opera){/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent);x.isIE=parseFloat(RegExp.$1)}})();x.rc=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);var fm=e.className.replace(new RegExp("(^| +)"+i.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");if(e.className!=fm){e.className=fm}};x.removeClassName=x.rc;x.show=function(){this.each(arguments,function(e){if(e=x.G(e)){e.style.display=""}})};x.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};if(typeof HTMLElement!="undefined"&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera){try{HTMLElement.prototype.__defineGetter__("children",function(){for(var fm=[],fn=0,fp,fo=0,e=this.childNodes.length;fo<e;fo++){fp=this.childNodes[fo];if(fp.nodeType==1){fm[fn++]=fp;if(fp.name){if(!fm[fp.name]){fm[fp.name]=[]}fm[fp.name][fm[fp.name].length]=fp}if(fp.id){fm[fp.id]=fp}}}return fm})}catch(et){}}if(typeof(HTMLElement)!="undefined"&&!window.opera&&HTMLElement.prototype&&!HTMLElement.prototype.insertAdjacentHTML){HTMLElement.prototype.insertAdjacentHTML=function(i,fm){var fn=this.ownerDocument.createRange();fn.setStartBefore(this);fn=fn.createContextualFragment(fm);switch(i){case"beforeBegin":this.parentNode.insertBefore(fn,this);break;case"afterBegin":this.insertBefore(fn,this.firstChild);break;case"beforeEnd":this.appendChild(fn);break;case"afterEnd":if(!this.nextSibling){this.parentNode.appendChild(fn)}else{this.parentNode.insertBefore(fn,this.nextSibling)}break}}}if(typeof HTMLElement!="undefined"&&!window.opera){HTMLElement.prototype.contains=function(e){if(e==this){return true}while(e=e.parentNode){if(e==this){return true}}return false}}if(!x.Browser.ie&&typeof Event!="undefined"&&!window.opera){Event.prototype.__defineSetter__("returnValue",function(e){if(!e){this.preventDefault()}return e});Event.prototype.__defineSetter__("cancelBubble",function(e){if(e){this.stopPropagation()}return e})}x.each=function(fo,fn){if(a7(fn)){for(var fm=0,e=fo.length;fm<e;fm++){if(fn.call(fo,fo[fm],fm)===false){break}}}return fo};x.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var eo in x.Platform){if(x.Platform.hasOwnProperty(eo)){x.Platform[eo]=new RegExp(eo,"i").test(window.navigator.userAgent)?1:0}}if(typeof(x.Dom)==="undefined"){x.Dom={}}x.Dom.getComputedStyle=function(i,e){var fn=i.nodeType==9?i:i.ownerDocument||i.document,fm;if(fn.defaultView&&fn.defaultView.getComputedStyle){fm=fn.defaultView.getComputedStyle(i,null);if(fm){return fm[e]||fm.getPropertyValue(e)}}else{if(i.currentStyle){return i.currentStyle[e]||""}}return""};var aB=x.BaseEvent;var cJ=x.BaseClass;cJ.prototype.toString=function(){return this._className||""};x.on=function(fm,i,e){if(!(fm=x.G(fm))){return fm}i=i.replace(/^on/,"");if(fm.addEventListener){fm.addEventListener(i,e,false)}else{if(fm.attachEvent){fm.attachEvent("on"+i,e)}}return fm};x.un=function(fm,i,e){if(!(fm=x.G(fm))){return fm}i=i.replace(/^on/,"");if(fm.removeEventListener){fm.removeEventListener(i,e,false)}else{if(fm.detachEvent){fm.detachEvent("on"+i,e)}}return fm};x.hc=function(fn,fm){if(!fn||!fn.className||typeof fn.className!="string"){return false}var i=-1;try{i=fn.className==fm||fn.className.search(new RegExp("(\\s|^)"+fm+"(\\s|$)"))}catch(fo){return false}return i>-1};x.isEmptyObject=function(fm){if(Object.prototype.toString.call(fm)==="[object Object]"){for(var e in fm){return false}return true}else{return false}};var dg={mapStyleNameIdPair:{"default":0,"grayed-out":1},mapHost:"https://map.baidu.com",apiHost:"https://api.map.baidu.com",staticHost:"//webmap0.bdimg.com",imgPath:"//webmap0.bdimg.com/image/api/",tileDomain:["https://maponline0.bdimg.com","https://maponline1.bdimg.com","https://maponline2.bdimg.com","https://maponline3.bdimg.com"],optDomain:"http://10.120.25.45:8017",rasterTilePath:"/tile/",vectorTilePath:"/pvd/",originTilePath:["https://pcor.baidu.com"],getIconSetPath:function(e){var i="map_icons2x/";if(typeof e==="string"&&this.mapStyleNameIdPair[e]>0){i="map_icons2x_"+(this.mapStyleNameIdPair[e]-1)+"/"}return"https://maponline0.bdimg.com/sty/"+i},getMapStyleFiles:function(fm){var fo=true;if(typeof fm==="string"&&fm!=="default"){fo=false}var fp=fo?"":"_"+(this.mapStyleNameIdPair[fm]-1);var i=dJ();var fn="udt="+i.udt+"&v="+i.ver;var e="https://maponline0.bdimg.com/sty/";return[e+"icons_2x"+fp+".js?"+fn,e+"fs"+fp+".js?"+fn,e+"indoor_fs.js?"+fn]},tvc:{ditu:{normal:{version:"088",updateDate:"20190618"},satellite:{version:"009",updateDate:"20190618"},normalTraffic:{version:"081",updateDate:"20190618"},satelliteTraffic:{version:"083",updateDate:"20190618"},mapJS:{version:"104",updateDate:"20190618"},satelliteStreet:{version:"083",updateDate:"20190618"},panoClick:{version:"1033",updateDate:"20180108"},panoUdt:{version:"20180108",updateDate:"20180108"},panoSwfAPI:{version:"20150123",updateDate:"20150123"},panoSwfPlace:{version:"20141112",updateDate:"20141112"},earthVector:{version:"001",updateDate:"20190618"}}},msv:{mapstyle:{updateDate:"20190108",version:"001"}}};dg.imgResources={blankGIF:dg.staticHost+"/res/litemapapi/v1d1/images/blank.gif?20170501",markerPng:dg.staticHost+"/res/litemapapi/v1d1/images/marker.png?20170501",locPng:dg.staticHost+"/res/litemapapi/v1d1/images/loc.png?20180918",locNewPng:dg.staticHost+"/res/litemapapi/v1d1/images/loc_new.png?20190314",zoomPng:dg.staticHost+"/res/litemapapi/v1d1/images/zoombtn.png?20180918",mapLogoPng:dg.staticHost+"/res/litemapapi/v1d1/images/logo-2x.png?20190226"};var dn=dg;var av="ruler.cur";if(x.Browser.ie||x.Browser.edge){x.extend(dn,{distCursor:"url("+dn.imgPath+av+"),crosshair",defaultCursor:"url("+dn.imgPath+"openhand.cur),default",draggingCursor:"url("+dn.imgPath+"closedhand.cur),move"})}else{if(x.Browser.firefox){x.extend(dn,{distCursor:"url("+dn.imgPath+av+"),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"})}else{if(x.Browser.chrome||x.Browser.safari){x.extend(dn,{distCursor:"url("+dn.imgPath+av+") 2 6,crosshair",defaultCursor:"url("+dn.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+dn.imgPath+"closedhand.cur) 8 8,move"});if(x.Platform.macintosh){dn.defaultCursor="-webkit-grab";dn.draggingCursor="-webkit-grabbing"}}else{x.extend(dn,{distCursor:"url("+dn.imgPath+av+"),crosshair",defaultCursor:"url("+dn.imgPath+"openhand.cur),default",draggingCursor:"url("+dn.imgPath+"closedhand.cur),move"})}}}aI=aI||{};aI.version="3.0";aI._register=[];aI.register=function(e){this._register[this._register.length]=e};aI.guid=1;aI.getGUID=function(e){return(e||"")+aI.guid++};var ef=window.BMAP_AUTHENTIC_KEY||"";aI.bmapVerifyCbk=function(e){if(e&&e.error!==0){if(typeof map!=="undefined"){map.getContainer().innerHTML="";map.__listeners={}}aI=null;var i="百度未授权使用地图API，可能是因为您提供的密钥不是有效的百度LBS开放平台密钥，或此密钥未对本应用的百度地图JavaScriptAPI授权。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";switch(e.error){case 101:i="开发者禁用了该ak的jsapi服务权限。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";break;case 102:i="开发者Referer不正确。您可以访问如下网址了解如何获取有效的密钥：http://lbsyun.baidu.com/apiconsole/key#。";break}alert(i)}};aI.verify=function(){var e=dn.apiHost+"/?qt=verify&ak="+ef+"&callback="+cZ+".bmapVerifyCbk";eZ.load(e)};aI.apiLoad=aI.apiLoad||function(){};function dS(i,e){this._size=i;this._cache=[];this._totalGetTimes=0;this._totalHitTimes=0;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var fm in e){if(e.hasOwnProperty(fm)){this._options[fm]=e[fm]}}}dS.prototype.setData=function(fm,fn){var e=this._cache;var i=this._size;if(i===0){return}if(e.length>i){this._removeOld()}if(!e[fm]){e.push(fn)}e[fm]=fn;fn._key_=fm};dS.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1000)/1000};dS.prototype.getData=function(i){var e=this._cache[i];if(e){this._totalHitTimes++}this._totalGetTimes++;return e};dS.prototype.removeData=function(fo){if(this._options.clearCallback){this._options.clearCallback(this._cache[fo])}var fm=this._cache;var fp=fm[fo];for(var fn=0,e=fm.length;fn<e;fn++){if(fm[fn]===fp){fm.splice(fn,1);break}}delete fm[fo]};dS.prototype._removeOld=function(){var e=this._cache;var fo=Math.round(this._size*0.6);for(var fn=0;fn<fo;fn++){var fm=e[fn]._key_;if(this._options.clearCallback){this._options.clearCallback(e[fm])}delete e[fm]}e.splice(0,fo);if(this._options.removeOldCallback){this._options.removeOldCallback()}};dS.prototype.clear=function(){var fm=this._cache;for(var fo=0,e=fm.length;fo<e;fo++){var fn=fm[fo]._key_;if(this._options.clearCallback){this._options.clearCallback(fm[fn])}delete fm[fn]}this._cache=fm=[]};dS.prototype.forEach=function(fn){var fm=this._cache;for(var fp=0,e=fm.length;fp<e;fp++){var fo=fm[fp]._key_;fn(fm[fo])}};dS.prototype.getBatch=function(fo){var e=[];for(var fn=0,fm=fo.length;fn<fm;fn++){if(this.getData(fo[fn])){e[e.length]=this.getData(fo[fn])}}return e};dS.prototype.clearExcept=function(fp){var fm=this._cache;for(var e=fm.length,fo=e-1;fo>=0;fo--){var fn=this._cache[fo]._key_;if(!fp[fn]){fm.splice(fo,1);if(this._options.clearCallback){this._options.clearCallback(fm[fn])}delete fm[fn]}}};dS.prototype.getDataCount=function(){return this._cache.length};function V(){}x.extend(V.prototype,{centerAndZoomIn:function(fs,fm,ft){var fq=this;if(!fs&&!fm){return}fs=fs||this.centerPoint;fm=fm||this.zoomLevel;fm=this._getProperZoom(fm).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAP_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function fr(){fq._earth=new aI.Earth(fq,{showRealSunlight:fq.config.showRealSunlight,showMilkyway:fq.config.showMilkyway,earthBackground:fq.config.earthBackground});fq._proxyEarthEvents();fq._changeEarthMapType(BMAP_EARTH_MAP);x.extend(fq,aI.EarthView.prototype);if(!fq._navigationCtrl&&fq.config.showControls){fq._navigationCtrl=new aI.NavigationControl3D(fq)}delete fq.temp.originMapType}cH.load("earth",function(){if(aI["FeatureStyle"+fq.config.style]){fr()}else{fq.loadMapStyleFiles(function(){fr()})}})}}this.lastLevel=this.zoomLevel||fm;this.zoomLevel=fm;var fo=new aB("onload");fo.point=fs;fo.zoom=fm;this.centerPoint=this.restrictCenter(new e4(fs.lng,fs.lat));if(this.centerPoint.zoom){this.zoomLevel=this.centerPoint.zoom}this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var fp=new bT(i,"baidu",this.mapType);var fn=new bI({mapType:this.mapType,copyright:fp,customLayer:false,baseLayer:true,tileTypeName:"web"});fn._isInnerLayer=true;this.addTileLayer(fn);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}}this.dispatchEvent(fo);this.loaded=true;ft=ft||{};ft.callback&&ft.callback()},_setPlatformPosition:function(ft,fs,fw){fw=fw||{};if(ft===0&&fs===0&&!fw.point){return}if(isNaN(fw.initMapOffsetX)){fw.initMapOffsetX=this.offsetX}if(isNaN(fw.initMapOffsetY)){fw.initMapOffsetY=this.offsetY}var fu=ft+fw.initMapOffsetX;var fr=fs+fw.initMapOffsetY;if(fw.point){var i=this.restrictCenter(fw.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new aB("oncenter_changed"))}}else{var fn=this.offsetX-fu;var e=this.offsetY-fr;var fm=this.getZoomUnits();var fq=this.centerPoint.lng;var fp=this.centerPoint.lat;var fo=new e4(fq,fp);this.centerPoint=this.restrictCenter(new e4(fo.lng+fn*fm,fo.lat-e*fm),fm);this.fire(new aB("oncenter_changed"));if(this.zoomLevel<10){fu=this.offsetX-(this.centerPoint.lng-fo.lng)/fm;fr=this.offsetY+(this.centerPoint.lat-fo.lat)/fm}}this.offsetX=fu;this.offsetY=fr;var fv=this.platform.style;fv.left=fu+"px";fv.top=fr+"px";this.maskLayer.style.left=-fu+"px";this.maskLayer.style.top=-fr+"px";if(fw.dispatchEvent!==false){this.dispatchEvent(new aB("onmoving"))}},zoomTo:function(e,fq,fu){fu=fu||{};fu.zoomCenter=fq;if(fu.noAnimation!==true){this.deepZoomTo(e,fu);return}if(typeof e!=="number"){return}var fo=be[this.mapType];if(!fo){return}var fm=e;e=this._getProperZoom(e).zoom;if(e===this.zoomLevel){var fr=new aB("onzoomexceeded");fr.targetZoom=fm;this.dispatchEvent(fr);fu.callback&&fu.callback();return}this.lastLevel=this.zoomLevel;if(fq){this.temp._cPoint=fq;this.temp._cPixel=this.pointToPixelIn(fq)}else{if(this.getInfoWindow()){var ft=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixelIn(ft);this.temp._cPoint=ft}}if(this.config.zoomCenter){fq=this.config.zoomCenter;this.temp._cPoint=fq;this.temp._cPixel=this.pointToPixelIn(fq)}if(fq||this.temp.infoWin&&this.temp.infoWin.isOpen()){var i=this.temp._cPoint;var fs=this.temp._cPixel;var fn=this.getZoomUnits(e);var fp=new e4(i.lng+fn*(this.width/2-fs.x),i.lat-fn*(this.height/2-fs.y));this.centerPoint=this.restrictCenter(fp,fn,e);if(this.centerPoint.zoom){e=this.centerPoint.zoom}}if(fu.fireEvent!==false){this.dispatchEvent(new aB("onzoomstart"))}if(e!==this.zoomLevel){this.zoomLevel=e;this.dispatchEvent(new aB("onzooming"));this.dispatchEvent(new aB("onzoomstartcode"))}if(fu.fireEvent!==false){this.dispatchEvent(new aB("onzoomend"))}if(fu.callback){fu.callback()}},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(fr,fn){fn=fn||{};var fp=fr-this.zoomLevel;var fo=this._getProperZoom(fr);if(fo.exceeded){var e=new aB("onzoomexceeded");e.targetZoom=fr;this.dispatchEvent(e);return}var i;if(fn.zoomCenter){i=this.pointToPixelIn(fn.zoomCenter)}else{if(this.getInfoWindow()){i=this.pointToPixelIn(this.getInfoWindow().getPoint(),{zoom:this.lastLevel})}else{var i=new cO(this.width/2,this.height/2)}}this.lastLevel=this.zoomLevel;var fq=this.deepZoom||new aV(this);var fm=fp>0?1:-1;fq.zoomMap(i,fp,fm,null,fn)},flyToIn:function(fs,e){if(e===this.zoomLevel){this.panToIn(fs);return}var fp=this._getProperZoom(e);if(fp.exceeded){var ft=new aB("onzoomexceeded");ft.targetZoom=e;this.dispatchEvent(ft);return}var fr=e-this.zoomLevel;var fm=new cO(this.width/2,this.height/2);var i=this.pointToPixelIn(fs);var fq=new cG(i.x-fm.x,i.y-fm.y);this.lastLevel=this.zoomLevel;if(Math.abs(fr)>=4||Math.abs(fq.width)>this.width||Math.abs(fq.height)>this.height){this.centerAndZoomIn(fs,e);return}var fo=this.deepZoom||new aV(this);var fn=fr>0?1:-1;fo.zoomMap(i,fr,fn,fq)},panToIn:function(i,fm){fm=fm||{};if(!i||i.equals(this.centerPoint)){fm.callback&&fm.callback();return}var fn=this.pointToPixelIn(i);var e=Math.round(this.width/2);var fo=Math.round(this.height/2);if(Math.abs(e-fn.x)>this.width||Math.abs(fo-fn.y)>this.height||fm.noAnimation===true){this._panToIn(e-fn.x,fo-fn.y,i);fm.callback&&fm.callback()}else{this._panBy(e-fn.x,fo-fn.y,fm)}},_panToIn:function(i,e,fn){var fm=this.temp;if(fm.operating===true){return}if(fm.dragAni){fm.dragAni.stop();fm.dragAni=null;this.dispatchEvent(new aB("onmoveend"))}this.dispatchEvent(new aB("onmovestart"));this._setPlatformPosition(i,e,{point:fn});this.dispatchEvent(new aB("onmoveend"))},panBy:function(i,e,fm){fm=fm||{};i=Math.round(i)||0;e=Math.round(e)||0;if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&fm.noAnimation!==true){this._panBy(i,e,fm)}else{this._panToIn(i,e);fm.callback&&fm.callback()}},_panBy:function(i,e,fo){if(this.temp.operating===true){return}fo=fo||{};this.dispatchEvent(new aB("onmovestart"));var fn=this;var fm=fn.temp;fm.pl=fn.offsetX;fm.pt=fn.offsetY;if(fm.tlPan){fm.tlPan.cancel()}if(fm.dragAni){fm.dragAni.stop();fm.dragAni=null;this.dispatchEvent(new aB("onmoveend"))}fm.tlPan=new l({fps:fo.fps||fn.config.fps,duration:fo.duration||fn.config.actionDuration,transition:fo.transition||bq.easeInOutQuad,render:function(fp){this.terminative=fn.temp.operating;if(fn.temp.operating){return}fn._setPlatformPosition(Math.ceil(i*fp),Math.ceil(e*fp),{initMapOffsetX:fm.pl,initMapOffsetY:fm.pt})},finish:function(fp){fn.dispatchEvent(new aB("onmoveend"));fn.temp.tlPan=false;if(fn.temp.stopArrow===true){fn.temp.stopArrow=false;if(fn.temp.arrow!==0){fn._arrow()}}fo.callback&&fo.callback()}})},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(fr,fo,fs){this.isRestrict=false;fo=fo||this.getZoomUnits();fs=fs||this.zoomLevel;var fm=this.pixelToPointIn(new cO(0,0),{center:fr,zoom:fs});var fp=this.pixelToPointIn(new cO(0,this.height),{center:fr,zoom:fs});if(this.zoomLevel<5){if(fm.lat>bV.MAX_LAT&&fp.lat<bV.MIN_LAT){this.isRestrict=true;var i=bV.MAX_LAT-fr.lat;var e=fr.lat-bV.MIN_LAT;var fq;if(i<e){fq=i/(this.height/2)}else{fq=e/(this.height/2)}var fn=18-c1(fq);this.zoomLevel=Math.ceil(fn);fr.zoom=Math.ceil(fn);return fr}}if(fm.lat>bV.MAX_LAT){this.isRestrict=true;fr.lat=bV.MAX_LAT-this.height/2*fo}else{if(fp.lat<bV.MIN_LAT){this.isRestrict=true;fr.lat=bV.MIN_LAT+this.height/2*fo}}return fr}});function bV(e,fm){if(typeof e==="string"){e=document.getElementById(e)}cJ.call(this);this.container=e;this.width=e.clientWidth;this.height=e.clientHeight;this.offsetX=0;this.offsetY=0;this._setStyle(e);e.unselectable="on";e.innerHTML="";x.ac(e,"bmap-container");e.appendChild(this.render());this._initDate=new Date();this.platform=e.children[0];this.maskLayer=this.platform.children[0];this._panes={};this.centerPoint=new e4(0,0);this.zoomLevel=0;this._heading=0;this._tilt=0;this._bounds=new cv();this.lastLevel=0;this._lock=false;this._enableTiltZoom=7;this._enableHeadingZoom=7;this.defaultZoomLevel=null;this.defaultCenter=null;this.zoomEventStatus="idle";this.currentOperation=cx.idle;this._setConfig(fm);this._initMapRenderType();this._animationInfo={};this._animationInfoUnstopable={};this.suspendLoad=false;this._customTileLabels=[];if(this._renderType==="webgl"){this._workerMgr=new ec(this);this._featureMgr=new bZ();x.extend(this,bU.prototype);this.jobScheduler=new dU(this);this.benchmark=new M();this._setupWebGLMap();this.deviceInfo={hardwareInfo:{renderer:"",vendor:""}};if(aA.ifSupportWebGL._renderer){this.deviceInfo.hardwareInfo.renderer=aA.ifSupportWebGL._renderer;this.deviceInfo.hardwareInfo.vendor=aA.ifSupportWebGL._vendor}}else{x.extend(this,V.prototype)}if(!be[this.config.mapType]){this.config.mapType=BMAP_NORMAL_MAP}if(this.config.mapType===BMAP_EARTH_MAP&&!this.config.enableEarth){if(this.forceEnableEarth()===false){this.config.mapType=BMAP_NORMAL_MAP}}this.mapType=this.config.mapType;this.preMapType=null;if(this.config.enableEarth){var fp=this.maskLayer.style;fp.opacity=0;fp.background="#000";if(this.config.mapType===BMAP_EARTH_MAP){fp.opacity=1}setTimeout(function(){fp.WebkitTransition=fp.transition="opacity .4s"},100)}this._isHybridShow=this.config.showStreetLayer;this.temp={operating:false,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:false,I:function(i){return x.I(i)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:false};window.InstanceCore=this.temp.I;this.platform.style.cursor=this.config.defaultCursor;this._bind();for(var fn=0;fn<aI._register.length;fn++){aI._register[fn](this)}this.temp.registerIndex=fn;var fo=this;if(this._renderType==="webgl"){cH.load("oppcgl",function(){fo._asyncRegister()})}else{cH.load("oppc",function(){fo._asyncRegister()})}if(this.config.mapType==="B_EARTH_MAP"){if(!aI.Earth){cH.load("earth",function(){})}else{fo._syncAndChangeMapType("B_EARTH_MAP")}}}bV.MAX_TILT=87;bV.MAX_DRAG_TILT=73;bV.MAX_DRAG_TILT_L2=50;bV.MIN_TILT=0;bV.MAX_LAT=19431424;bV.MIN_LAT=-16023552;bV.WORLD_SIZE_MC_HALF=20037726.372307256;bV.WORLD_SIZE_MC=bV.WORLD_SIZE_MC_HALF*2;bV.RIGHT_EDGE_POINT=new e4(bV.WORLD_SIZE_MC_HALF,0);bV.LEFT_EDGE_POINT=new e4(-bV.WORLD_SIZE_MC_HALF,0);bV.inherits(cJ,"Map");x.extend(bV.prototype,{render:function(){var e=H("div",{id:"platform"});var fn=e.style;fn.overflow="visible";fn.position="absolute";fn.zIndex=5;fn.top=fn.left="0px";var i=H("div",{id:"mask","class":"BMap_mask"});var fm=i.style;fm.position="absolute";fm.top=fm.left="0px";fm.zIndex="9";fm.overflow="hidden";fm.WebkitUserSelect="none";fm.width=this.width+"px";fm.height=this.height+"px";e.appendChild(i);return e},_initMapRenderType:function(){var e=this.config.forceRenderType;if(e==="dom"){this._renderType="dom";return}else{if(e==="canvas"){if(aA.isModernBrowser){this._renderType="canvas";return}}else{if(e==="webgl"){if(aA.ifSupportWebGL()){this._renderType="webgl";return}}}}if(aA.ifSupportWebGL()&&aA.ifEnableWebGLMap()){this._renderType="webgl";return}if(aA.isModernBrowser&&aA.ifEnableCanvas2dMap()){this._renderType="canvas";return}this._renderType="dom"},_setConfig:function(i){i=i||{};this.config={bottomOffset:0,clickInterval:200,enableDragging:true,enableKeyboard:false,enableDblclickZoom:true,enableContinuousZoom:true,enableWheelZoom:false,enablePinchZoom:true,enableRotateGestures:true,enableTiltGestures:true,fixCenterWhenPinch:false,enableAutoResize:true,zoomCenter:null,fps:60,zoomerDuration:240,actionDuration:450,defaultCursor:dn.defaultCursor,draggingCursor:dn.draggingCursor,coordType:BMAP_COORD_MERCATOR,mapType:BMAP_NORMAL_MAP,drawer:BMAP_SYS_DRAWER,enableInertialDragging:true,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:false,enableResizeOnCenter:false,isModernBrowser:aA.isModernBrowser,forceRenderType:"",textRenderType:null,ratio:ay()>=1.5?2:1,enableEarth:aA.ifEnableEarth(),defaultMaxBounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),showControls:false,showRealSunlight:true,showMilkyway:true,earthBackground:null,showStreetLayer:true,minZoom:null,maxZoom:null,style:"default",enableIconClick:false,autoSafeArea:false,ak:null,restrictCenter:true,smaa:true,preserveDrawingBuffer:false};for(var fm in i){if(i.hasOwnProperty(fm)){this.config[fm]=i[fm];if(fm==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[fm]}}}if(i.style){if(i.style["styleId"]&&i.style["styleId"].length<32){this.config.style=i.style["styleId"]}else{this.config.style=i.style}}this._setTextRenderType();this._displayOptions={poi:true,poiText:true,poiIcon:true,overlay:true,layer:true,building:true,indoor:true,street:true,skyColors:["rgb(226, 237, 248)","rgb(186, 211, 252)"],isFlat:false};if(i.displayOptions){for(var e in i.displayOptions){if(i.displayOptions.hasOwnProperty(e)){this._displayOptions[e]=i.displayOptions[e]}}}if(this.config.restrictCenter===false){this._enableTiltZoom=0;this._enableHeadingZoom=0}},getMinZoom:function(){var fm;if(be[this.mapType][this._renderType]){fm=be[this.mapType][this._renderType].minZoom}else{fm=be[this.mapType].minZoom}if(this.config.minZoom!==null&&this.config.minZoom>=fm){fm=this.config.minZoom}if(this.mapType==="B_EARTH_MAP"){return fm}var i=this.getSize();var e=this.worldSize(fm);while(e<i.width){fm++;e=this.worldSize(fm)}return fm},getMaxZoom:function(){var e;if(be[this.mapType][this._renderType]){e=be[this.mapType][this._renderType].maxZoom}else{e=be[this.mapType].maxZoom}if(this.config.maxZoom!==null&&this.config.maxZoom<=e){e=this.config.maxZoom}return e},_drawFrame:function(){this._webglMapScene._painter.draw()},_setupWebGLMap:function(){var e=this;cH.load("mapgl",function(){e._asyncRegister()})},_setStyle:function(i){var e=i.style;e.overflow="hidden";if(d2(i).position!=="absolute"){e.position="relative"}e.backgroundImage="url("+dn.imgPath+"bg.png)";e.textAlign="left";e.touchAction=e.MSTouchAction="none"},_bind:function(){var e=this;if(e._renderType!=="webgl"){e._watchSize=function(){var fm=e.getContainerSize();if(e.width!==fm.width||e.height!==fm.height){var fq=(fm.width-e.width)/2;var fs=(fm.height-e.height)/2;var fn=e.getZoomUnits();var fp=e.centerPoint;if(fp&&!e.config.enableResizeOnCenter){e.centerPoint=new e4(fp.lng+fq*fn,fp.lat-fs*fn)}e.maskLayer.style.width=(e.width=fm.width)+"px";e.maskLayer.style.height=(e.height=fm.height)+"px";var fo=new aB("onresize");fo.size=fm;e.dispatchEvent(fo);e.fire(new aB("onsize_changed"));var i=parseInt(e.platform.style.left,10)||0;var fr=parseInt(e.platform.style.top,10)||0;if(e.currentOperation!=="undefined"&&e.currentOperation!==cx.idle&&(e.offsetX!==i||e.offsetY!==fr)){e._setPlatformPosition(i,fr)}}}}else{e._watchSize=function(){var i=e.getContainerSize();if(e.width!==i.width||e.height!==i.height){var fn=e.getSize();e.maskLayer.style.width=(e.width=i.width)+"px";e.maskLayer.style.height=(e.height=i.height)+"px";if(ay()!==e.config.ratio){e.config.ratio=ay()}var fo=new aB("onresize");fo.size=i;e.dispatchEvent(fo);var fm=new aB("onsize_changed");fm.size=i;fm.oldSize=fn;e.fire(fm)}}}if(e.config.enableAutoResize){e.temp.autoResizeTimer=setInterval(e._watchSize,16)}this.on("size_changed",function(){var i=e.getMinZoom();if(e.zoomLevel<i){e.setZoomIn(i,{noAnimation:true})}});this.on("zoom_changed",function(){this.dispatchEvent(new aB("onzooming"))})},addControl:function(e){if(e&&a7(e._i)){e._i(this);this.dispatchEvent(new aB("onaddcontrol",e))}},removeControl:function(e){if(e&&a7(e.remove)){e.remove();this.dispatchEvent(new aB("onremovecontrol",e))}},addContextMenu:function(e){if(e){e.initialize(this);this.dispatchEvent(new aB("onaddcontextmenu",e))}},removeContextMenu:function(e){if(e){this.dispatchEvent(new aB("onremovecontextmenu",e));e.remove()}},addOverlay:function(i){if(i&&a7(i._i)){var fm=new aB("onbeforeaddoverlay",i);fm.overlay=i;this.dispatchEvent(fm);i._i(this);fm=new aB("onaddoverlay",i);fm.overlay=i;this.dispatchEvent(fm)}},removeOverlay:function(i){if(i&&a7(i.remove)){var fm=new aB("onremoveoverlay",i);fm.overlay=i;i.remove();this.dispatchEvent(fm)}},clearOverlays:function(){this.dispatchEvent(new aB("onclearoverlays"))},addTileLayer:function(fo){if(!fo){return}for(var fn=0,e=this.tileMgr.tileLayers.length;fn<e;fn++){var fm=this.tileMgr.tileLayers[fn];if(fm===fo||fm.getMapType()===fo.getMapType()){return}}fo.initialize(this);this.dispatchEvent(new aB("onaddtilelayer",fo))},removeTileLayer:function(e){if(e){e.remove();this.dispatchEvent(new aB("onremovetilelayer",e))}},getTileLayer:function(e){if(this.tileMgr){return this.tileMgr.getTileLayer(e)}return null},setMapType:function(e){var i=this;if(this.mapType===e||this._mapTypeChanging){return}if(e===BMAP_EARTH_MAP&&!this.config.enableEarth){return}if(this._earth&&this._earth.getLock()){return}this._mapTypeChanging=true;this.preMapType=this.mapType;this._boundsInPreMapType=this.getBoundsIn();if(this.preMapType===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow}if(e===BMAP_EARTH_MAP){if(!aI.Earth){cH.load("earth",function(){i._syncAndChangeMapType(e)});return}i._syncAndChangeMapType(e)}else{if(this.preMapType!==BMAP_EARTH_MAP){this._changeFlatMapType(e);this._mapTypeChanging=false}else{this._setMapTypeStatus(e,function(fm,fn){var fo=i._earth.getEarthCanvas();i._changeFlatMapType(e,this.preMapType);if(i._mapTypeChangAni){i._mapTypeChangAni.stop()}i._mapTypeChangAni=dA.start({el:fo,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){i._mapTypeChangAni=null;i._mapTypeChanging=false}});fm=cQ.convertLL2MC(fm);if(i._renderType==="webgl"){x.extend(i,bU.prototype);i.setCenterIn(fm,{noAnimation:true});i.setZoomIn(fn,{noAnimation:true})}else{x.extend(i,V.prototype);i.centerAndZoomIn(fm,fn)}})}}},_changeFlatMapType:function(fq){if(!fq||!be[fq]){return}var fy=this.preMapType;this.mapType=fq;var fn=this.getTileLayer(fy);if(fn){this.removeTileLayer(fn)}if(fy!==BMAP_EARTH_MAP||this._renderType!=="webgl"||this.baseLayerAdded!==true){var fm=new cv(new e4(-21364736,-10616832),new e4(23855104,15859712));var fv=new bT(fm,"baidu",fq);var fx=this._renderType==="webgl"?2:1;var fo=new bI({mapType:fq,copyright:fv,dataType:fx,customLayer:false,baseLayer:true,tileTypeName:"na"});fo._isInnerLayer=true;this.addTileLayer(fo);if(this._renderType==="webgl"&&!this.baseLayerAdded){this.baseLayerAdded=true}}if(fy===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow;this._removeHybirdMap()}else{if(fq===BMAP_SATELLITE_MAP){if(this._preStreetLayerShow===true||typeof this._preStreetLayerShow==="undefined"){this._addHybirdMap()}}}var fs=this.tileMgr.tileLayers;for(var fr=0,fp=fs.length;fr<fp;fr++){var ft=fs[fr];var fw=ft.tilesDiv;if(!fw){continue}if(!ft._isInnerLayer&&fw.style.visibility==="hidden"){fw.style.visibility=""}}var fu=new aB("onmaptypechange");fu.zoomLevel=this.zoomLevel;fu.mapType=fq;fu.exMapType=fy;this.dispatchEvent(fu)},showStreetLayer:function(e){e?this._addHybirdMap():this._removeHybirdMap()},hideStreetLayer:function(e){this._hideStreetLayerOptions=e;this._removeHybirdMap(e)},_addHybirdMap:function(){this._isHybridShow=true;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.showStreetLayer()}return}if(this._hybridTileLayer){this.addTileLayer(this._hybridTileLayer);var fp=new aB("onstreetlayer_show");this.dispatchEvent(fp);return}var fo=new cv(new e4(-21364736,-10616832),new e4(23855104,15859712));var fm=new bT(fo,"",BMAP_HYBRID_MAP);var i=new bI({copyright:fm,transparentPng:true,tileTypeName:"web"});i._isInnerLayer=true;var fn=this.isCanvasMap();i.getTilesUrl=function(fq,fv){var ft=be.B_STREET_MAP;var fu=ad("ditu","satelliteStreet");var fr=fu.ver;var e=fu.udt;var fs=ft.tileUrls[Math.abs(fq.x+fq.y)%ft.tileUrls.length]+"?qt=vtile&x="+(fq.x+"").replace(/-/gi,"M")+"&y="+(fq.y+"").replace(/-/gi,"M")+"&z="+fv+"&styles=sl&v="+fr+"&udt="+e+"$scaler="+ay()+"&showtext="+(fn?0:1);return fs};this._isHybridShow=true;this.addTileLayer(i);this._hybridTileLayer=i;var fp=new aB("onstreetlayer_show");this.dispatchEvent(fp)},_removeHybirdMap:function(i){this._isHybridShow=false;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.hideStreetLayer(i)}return}if(this._hybridTileLayer){this.removeTileLayer(this._hybridTileLayer);var fm=new aB("onstreetlayer_hide");this.dispatchEvent(fm)}},isStreetLayerShow:function(){return this._isHybridShow},getTileId:function(e,fp){var fn=be[this.mapType];if(typeof fn!=="object"){return null}var fm=fn.baseUnits*Math.pow(2,(fn.zoomLevelBase-fp));var fo=parseInt(e.lng/fm,10);var i=parseInt(e.lat/fm,10);return{row:fo,column:i,level:fp}},reset:function(){this.centerAndZoomIn(this.defaultCenter,this.defaultZoomLevel,true)},setOptions:function(e){e=e||{};for(var fm in e){if(e.hasOwnProperty(fm)){var i=true;if(typeof e[fm]!=="object"){i=e[fm]!==this.config[fm]}this.config[fm]=e[fm];if(fm==="fixCenterWhenResize"){this.config.enableResizeOnCenter=e[fm]}if(!i){continue}switch(fm){case"style":this.fire(new aB("onstyle_willchange"));var fn=this;this.loadMapStyleFiles(function(){fn.fire(new aB("onstyle_changed"))});break;case"enableAutoResize":if(e[fm]===true){this.enableAutoResize()}else{this.disableAutoResize()}break;case"displayOptions":this.setDisplayOptions(e[fm]);break}}}},enableDragging:function(){this.config.enableDragging=true},disableDragging:function(){this.config.enableDragging=false},enableInertialDragging:function(){this.config.enableInertialDragging=true},disableInertialDragging:function(){this.config.enableInertialDragging=false},enableScrollWheelZoom:function(){this.config.enableWheelZoom=true},disableScrollWheelZoom:function(){this.config.enableWheelZoom=false},enableContinuousZoom:function(){this.config.enableContinuousZoom=true},disableContinuousZoom:function(){this.config.enableContinuousZoom=false},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=true},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=false},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=true},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=false},enableKeyboard:function(){this.config.enableKeyboard=true},disableKeyboard:function(){this.config.enableKeyboard=false},getSize:function(){return new cG(this.width,this.height)},enablePinchToZoom:function(){this.config.enablePinchZoom=true},disablePinchToZoom:function(){this.config.enablePinchZoom=false},enableAutoResize:function(){this.config.enableAutoResize=true;this._watchSize();if(!this.temp.autoResizeTimer){this.temp.autoResizeTimer=setInterval(this._watchSize,16)}},disableAutoResize:function(){this.config.enableAutoResize=false;if(this.temp.autoResizeTimer){clearInterval(this.temp.autoResizeTimer);this.temp.autoResizeTimer=null}},checkResize:function(){this._watchSize()},resize:function(){this._watchSize()},getContainerSize:function(){return new cG(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(fm){if(!fm){fm=this.zoomLevel}var i=this.getMinZoom();var e=this.getMaxZoom();var fn=false;if(fm<i){fn=true;fm=i}if(fm>e){fn=true;fm=e}if(this._renderType!=="webgl"){fm=Math.round(fm)}return{zoom:fm,exceeded:fn}},getContainer:function(){return this.container},getZoomUnits:function(fm){if(this.mapType===BMAP_EARTH_MAP){return Math.pow(2,18-this._earth.getImageZoom())}var e=be[this.mapType];if(typeof e!=="object"){return null}var i=fm||this.zoomLevel;return Math.pow(2,(e.zoomLevelBase-i))},pointToPixelIn:function(fw,fy){if(!fw){return}fy=fy||{};if(this.mapType===BMAP_EARTH_MAP){var fn;if(!fw._llPt){fn=cQ.convertMC2LL(fw);fw._llPt=fn}fn=fw._llPt;var fs=null;var fm=null;if(typeof fy.zoom==="number"){var fv=this._earth;var fx=fv._getEarthZoomByImgZoom(fy.zoom);if(fx<=3){fs=fv._generateTmpPMatrix(fx)}fm=fv._generateTmpMVMatrix(fv.getCenter(),fx)}var fo=this._earth.fromLatLngToPixel(fn,{useRound:false,isCalcOnBack:true,matrixInfo:{modelViewMatrix:fm,projectionMatrix:fs}});return fo}if((this._heading%360===0&&this._tilt===0)||!this._webglMapCamera){var fu=this.getZoomUnits(fy.zoom);var fq=fy.center||this.centerPoint;var i=this.width/2;var fp=this.height/2;var ft=(fw.lng-fq.lng)/fu+i;var fr=(fq.lat-fw.lat)/fu+fp;if(fy.useRound!==false){ft=Math.round(ft);fr=Math.round(fr)}return new cO(ft,fr)}var e=this._webglMapCamera.fromMCToScreenPixel(fw.lng,fw.lat,fy);if(fy.useRound===false){return e}e.x=Math.round(e.x);e.y=Math.round(e.y);return e},pixelToPointIn:function(e,fu){if(!e){return}fu=fu||{};if(this.mapType===BMAP_EARTH_MAP){if(typeof fu.zoom==="number"){var fs=this._earth;var fp=null;var fm=null;var ft=fs._getEarthZoomByImgZoom(fu.zoom);if(ft<=3){fp=fs._generateTmpPMatrix(ft)}fm=fs._generateTmpMVMatrix(fs.getCenter(),ft)}var i=this._earth.fromPixelToLatLng(e,{matrixInfo:{modelViewMatrix:fm,projectionMatrix:fp}});if(i===null){return null}return cQ.convertLL2MC(i)}if((this._heading%360!==0||this._tilt>0)&&this._webglMapCamera){return this._webglMapCamera.fromScreenPixelToMC(e.x,e.y,fu)}var fq=fu.center||this.centerPoint;var fr=this.getZoomUnits(fu.zoom);var fo=fq.lng+fr*(e.x-this.width/2);var fn=fq.lat-fr*(e.y-this.height/2);return new e4(fo,fn)},pointToOverlayPixelIn:function(e,fn){fn=fn||{};var fm=this.pointToPixelIn(e,{zoom:fn.zoom,center:fn.center,forLabel:true,frustumTest:true});if(!fm){return}if(fn.fixPosition&&this.mapType!=="B_EARTH_MAP"){var fo=this.getSize();var i=this.worldSize(fn.zoom);if(fm.x>fo.width){while(fm.x>fo.width){fm.x-=i}}else{if(fm.x<0){while(fm.x<0){fm.x+=i}}}}if(this._renderType==="webgl"){return fm}fm.x-=this.offsetX;fm.y-=this.offsetY;return fm},overlayPixelToPointIn:function(i,e){if(!i){return}var fm=i.clone();if(this._renderType!=="webgl"){fm.x+=this.offsetX;fm.y+=this.offsetY}return this.pixelToPointIn(fm,e)},lnglatToMercator:function(e,fn){var i=new e4(e,fn);var fm=cQ.convertLL2MC(i);return[fm.lng,fm.lat]},mercatorToLnglat:function(i,e){if(isNaN(i)||isNaN(e)){return[]}i=parseFloat(i);e=parseFloat(e);var fn=new e4(i,e);var fm=cQ.convertMC2LL(fn);return[fm.lng,fm.lat]},getBoundsIn:function(){var fA=arguments[0];if(this.mapType===BMAP_EARTH_MAP&&this._earth){var fu=this._earth.getCustomBounds();if(!fu){return this.config.defaultMaxBounds}var ft=fu.getSouthWest();var e=fu.getNorthEast();if(ft.lng>e.lng){e.lng=180}var fR=cQ.convertLL2MC(ft);var fH=cQ.convertLL2MC(e);var fx=this.config.defaultMaxBounds;var fG=Math.max(fR.lng,fx.sw.lng);var fF=Math.max(fR.lat,fx.sw.lat);var fz=Math.min(fH.lng,fx.ne.lng);var fy=Math.min(fH.lat,fx.ne.lat);var fC=new cv(new e4(fG,fF),new e4(fz,fy));fC.pointBottomLeft=new e4(fG,fF);fC.pointBottomRight=new e4(fz,fF);fC.pointTopLeft=new e4(fG,fy);fC.pointTopRight=new e4(fz,fy);fC.setMinMax();fC.makeNormalizedPoint(this._earth.getHeading());return fC}fA=fA||{};var fo=fA.margins||[0,0,0,0];var fM=this.pixelToPointIn({x:fo[3],y:this.height-fo[2]},fA);var fQ=this.pixelToPointIn({x:this.width-fo[1],y:fo[0]},fA);var fE=typeof fA.heading==="number"?fA.heading:(this._heading%360);var fm=typeof fA.tilt==="number"?fA.tilt:this._tilt;var fw=this._webglMapCamera;if((fE===0&&fm===0)||!fw){this._bounds.setSouthWest(fM);this._bounds.setNorthEast(fQ);this._bounds.pointBottomLeft=fM;this._bounds.pointBottomRight=new e4(fQ.lng,fM.lat);this._bounds.pointTopRight=fQ;this._bounds.pointTopLeft=new e4(fM.lng,fQ.lat);this._bounds.setMinMax();this._bounds.makeNormalizedPoint(fE);return this._bounds}var fD=this.pixelToPointIn({x:fo[3],y:fo[0]},fA);var fn=fw.getPosition();var fS=Math.sqrt(Math.pow(fD.lng-fn[0],2)+Math.pow(fD.lat-fn[1],2));var fN=this.getZoomUnits();var fU=fS/fN;var fK=fw._frustumSideLen;var fs=fw._fovy;if(fU>fK||(90-fm)<fs/2){var fT=[fD.lng-fn[0],fD.lat-fn[1]];if((90-fm)<fs/2){fT[0]=-fT[0];fT[1]=-fT[1]}var fL=fK*fN;var fr=[fT[0]/fS*fL+fn[0],fT[1]/fS*fL+fn[1]];var fI=[fQ.lng-fn[0],fQ.lat-fn[1]];if((90-fm)<fs/2){fI[0]=-fI[0];fI[1]=-fI[1]}var fp=[fI[0]/fS*fL+fn[0],fI[1]/fS*fL+fn[1]];fD.lng=fr[0];fD.lat=fr[1];fQ.lng=fp[0];fQ.lat=fp[1]}var fB=this.pixelToPointIn({x:this.width-fo[1],y:this.height-fo[2]},fA);var fJ=[fM,fQ,fD,fB];var fP=fJ[0].lng;var fV=fJ[0].lat;var fq=fJ[0].lng;var fv=fJ[0].lat;for(var fO=1;fO<4;fO++){if(fJ[fO].lng<fP){fP=fJ[fO].lng}if(fJ[fO].lng>fq){fq=fJ[fO].lng}if(fJ[fO].lat<fV){fV=fJ[fO].lat}if(fJ[fO].lat>fv){fv=fJ[fO].lat}}this._bounds.setSouthWest(new e4(fP,fV));this._bounds.setNorthEast(new e4(fq,fv));this._bounds.pointTopLeft=fD;this._bounds.pointTopRight=fQ;this._bounds.pointBottomRight=fB;this._bounds.pointBottomLeft=fM;this._bounds.makeNormalizedPoint(fE);this._bounds.setMinMax();return this._bounds},isLoaded:function(){return !!this.loaded},_getBestLevel:function(i,fw){var fp=0;if(this._renderType==="webgl"&&!d8()){fp=100}var fq=fw.margins||[10,10,10,10];var fn=fw.zoomFactor||0;var fr=fq[1]+fq[3];var fo=fq[0]+fq[2];var e=this.getMinZoom();var fv=this.getMaxZoom();var fu=i.toSpan();var ft=fu.width/(this.width-fr-fp);var fs=fu.height/(this.height-fo-fp);var fm=18-c1(Math.max(ft,fs));if(fm<e){fm=e}if(fm>fv){fm=fv}fm+=fn;if(this._renderType!=="webgl"){fm=Math.floor(fm)}return fm},getViewportIn:function(fy,fB){if(this.mapType===BMAP_EARTH_MAP){fy=fy||[];var fx=[];for(var fo=0;fo<fy.length;fo++){if(!fy[fo]){continue}fx.push(cQ.convertMC2LL(fy[fo]))}var fw=this._earth.getViewportIn(fx,fB);var fp=fw.center;var fq=fw.zoom;var fu=cQ.convertLL2MC(fp);return{center:fu,zoom:fq}}var fA={center:this.getCenterIn(),zoom:this.getZoom()};if(!fy||fy.length===0){return fA}fB=fB||{};var fm;if(fy instanceof cv){fm=fy}else{var ft=fy;fm=new cv();for(var fo=ft.length-1;fo>=0;fo--){fm.extend(ft[fo])}if(fm.isEmpty()){return fA}}var e=fm.getCenter();var fz=this._getBestLevel(fm,fB);if(fB.margins){var fs=fB.margins;var fr=(fs[1]-fs[3])/2;var fv=(fs[0]-fs[2])/2;var fn=this.getZoomUnits(fz);e.lng=e.lng+fn*fr;e.lat=e.lat+fn*fv}return{center:e,zoom:fz}},setViewportIn:function(fn,fo){if(this.mapType===BMAP_EARTH_MAP){var fs;if(fn&&fn.center){var fm=cQ.convertMC2LL(fn.center);var fq=this._earth._getEarthZoomByImgZoom(fn.zoom,fm);fs={center:fm,zoom:fq}}else{fs=[];for(var fp=0;fp<fn.length;fp++){var fr=cQ.convertMC2LL(fn[fp]);fs[fp]=new bS(fr.lat,fr.lng)}}this._earth.setViewportIn(fs,fo);return}var e;if(fn&&fn.center){e=fn}else{e=this.getViewportIn(fn,fo)}fo=fo||{};if(this._renderType==="webgl"){this.centerAndZoomIn(e.center,e.zoom,fo);return}if(e.zoom===this.zoomLevel&&fo.enableAnimation!==false){this.panToIn(e.center,{duration:200,callback:fo.callback})}else{this.centerAndZoomIn(e.center,e.zoom,fo)}},addSpots:function(fm,i){if(!fm||fm.length===0){return}i=i||{};var fp=i.zIndex||0;var fo=typeof i.enableMultiResponse==="undefined"?true:!!i.enableMultiResponse;this.spotsPool=this.spotsPool||{};var e="sp"+(this.temp.spotsGuid++);this.spotsPool[e]={spots:fm.slice(0),zIndex:fp,enableMultiResponse:fo};var fn=this;cH.load("hotspot",function(){fn._asyncRegister()});return e},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){if(!e||!this.spotsPool[e]){return}delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},getIconByClickPosition:function(i){if(!this.config.enableIconClick||!this._spotsMgr){return null}var e=this._spotsMgr.getSpotsByScreenPosition(i);if(e[0]&&e[0].userdata){var fm=e[0].userdata;return{name:fm.name,uid:fm.uid,position:fm.iconPoint||e[0].pt}}return null},setBounds:function(e){be[this.mapType].bounds=e.clone()},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){if(this.temp.infoWin&&this.temp.infoWin.isOpen()){return this.temp.infoWin}return null},getDistanceIn:function(fo,e){if(!fo||!e){return}if(this.mapType===BMAP_EARTH_MAP){var fn=cQ.convertMC2LL(fo);var fm=cQ.convertMC2LL(e);return this._earth.getDistance(fn,fm)}var i=cQ.getDistanceByMC(fo,e);return i},getOverlays:function(){var fo=[];var fp=this._overlays;var fn=this._customOverlays;if(fp){for(var fm in fp){if(fp[fm] instanceof bK){fo.push(fp[fm])}}}if(fn){for(var fm=0,e=fn.length;fm<e;fm++){fo.push(fn[fm])}}return fo},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<aI._register.length;e++){aI._register[e](this)}this.temp.registerIndex=e},setDefaultCursor:function(e){this.config.defaultCursor=e;if(this.platform){this.platform.style.cursor=this.config.defaultCursor}},getDefaultCursor:function(){return this.config.defaultCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor},_syncAndChangeMapType:function(e){var i=this;if(i._renderType==="webgl"&&i.getTilt()>bV.MAX_DRAG_TILT_L2){i.setTilt(bV.MAX_DRAG_TILT_L2,{callback:function(){i._changeEarthMapType(e)}})}else{i._changeEarthMapType(e)}},_changeEarthMapType:function(fm){var fn=this;var fq=fn.tileMgr.tileLayers;if(this._mapTypeChangAni){this._mapTypeChangAni.stop()}var fp;if(this._earth){fp=this._earth.getEarthCanvas()}if(!this._earth){this.maskLayer.style.opacity=1;this.maskLayer.style.zIndex=999;this.maskLayer.style.background="#000"}this._mapTypeChangAni=new l({duration:400,render:function(e){if(!fn._earth){return}fp.style.opacity=e},finish:function(){for(var e=fq.length-1,fr=e;fr>=0;fr--){var ft=fq[fr].tilesDiv;if(ft){ft.style.visibility="hidden"}if(fq[fr]._isInnerLayer&&fn._renderType!=="webgl"){fn.removeTileLayer(fq[fr])}}fn._mapTypeChangAni=null;fn._mapTypeChanging=false;function fs(){var fx=fn.getZoom()-2;var fy=fn.getCenterIn();var fv=cQ.convertMC2LL(fy);fn._earth=new aI.Earth(fn,{center:fv,zoom:fx,showRealSunlight:fn.config.showRealSunlight,showMilkyway:fn.config.showMilkyway,earthBackground:fn.config.earthBackground});fn._proxyEarthEvents();var fu=fn.mapType;fn.mapType=fm;var fw=new aB("onmaptypechange");fw.zoomLevel=this.zoomLevel;fw.mapType=fm;fw.exMapType=fu;fn.dispatchEvent(fw);fn._setMapTypeStatus(fm);x.extend(fn,aI.EarthView.prototype);if(!fn._navigationCtrl&&fn.config.showControls){fn._navigationCtrl=new df(fn)}}if(!fn._earth){if(aI["FeatureStyle"+fn.config.style]){fs()}else{fn.loadMapStyleFiles(function(){fs()})}}if(parseInt(fn.maskLayer.style.opacity,10)===1){setTimeout(function(){fn.maskLayer.style.zIndex=9;fn.maskLayer.style.opacity=0},1000)}}});if(!this._earth){return}var i=this.mapType;this.mapType=fm;var fo=new aB("onmaptypechange");fo.zoomLevel=this.zoomLevel;fo.mapType=fm;fo.exMapType=i;this.dispatchEvent(fo);fn._setMapTypeStatus(fm);x.extend(fn,aI.EarthView.prototype)},getMapStyleId:function(){if(typeof this.config.style==="string"){return this.config.style}return this.config.mapStyleId||"custom"},_setMapTypeStatus:function(fm){var fr=arguments[1];if(fm===BMAP_EARTH_MAP){var fp=this._earth.getEarthCanvas();if(fp){fp.style.display=""}var fs={noAnimation:true};this._earth.setCenter(cQ.convertMC2LL(this.centerPoint),fs);this._earth.setImageZoom(this.zoomLevel,fs);this._earth.setTilt(this.getTilt(),fs);this._earth.setHeading(this.getHeading(),fs)}else{if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var fq=this._earth;var fn=fq.getMapZoom();var fo=fq._imageRawZoom||fn;var i=fo-fn;var e=fq.getCenter();if(this._renderType==="webgl"){this._tilt=fq.getTilt();if(this.zoomLevel>7){this._heading=fq.getHeading();fr&&fr(e,fn);return}if(fq.getHeading()!==0){fq.setTilt(this.getTilt());fq.setHeading(this.getHeading(),{callback:function(){fr&&fr(e,fn)}})}else{fr&&fr(e,fn)}return}if(i<0.1&&fq.getTilt()===0&&fq.getHeading()===0){fr&&fr(e,fn);return}fq.setTilt(0);fq.setHeading(0);fq.setZoom(fq.getZoom()-i,{callback:function(){fr&&fr(e,fn)}})}}},_proxyEarthEvents:function(){var fp=this;var fq=this._earth;var e=false;fq.on("tilesload",function(i){fp.fire(i)});fq.on("centerandzoom",function(i){fp.dispatchEvent(new aB("onmoveend"));fp.dispatchEvent(new aB("onzoomend"))});function fo(i){fp.fire(i)}var fm=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"];for(var fn=0;fn<fm.length;fn++){fq.on(fm[fn],fo)}},forceEnableEarth:function(){this.config.forceEnableEarth=true;this.config.enableEarth=aA.ifEnableEarth(true);this.dispatchEvent(new aB("forceenableearth"));return this.config.enableEarth},setLock:function(e){if(this.mapType===BMAP_EARTH_MAP){this._earth.setLock(e)}this._lock=e},getLock:function(){if(this.mapType===BMAP_EARTH_MAP){return this._earth.getLock()}return this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return !!(this._renderType==="canvas"&&this.getMapType()!=="B_EARTH_MAP")},getCanvasMapCoordByUid:function(fo){if(this._renderType==="webgl"){var fp=this.tileMgr.tileLayers;for(var fn=0;fn<fp.length;fn++){if(fp[fn].labelProcessor){return fp[fn].labelProcessor.getLabelByUid(fo,"")}}return null}var e=this.canvas2dMapMgr._labelClick;var fm=e.findLabelByUid(fo);return fm?new e4(fm.iconPos.geoX,fm.iconPos.geoY):null},loadBizData:function(i){var e=new aB("onloadbizdata");e.data=i;this.dispatchEvent(e)},unloadBizData:function(){var e=new aB("onunloadbizdata");this.dispatchEvent(e)},zoomIn:function(e){this.setZoomIn(this.zoomLevel+1,{zoomCenter:e})},zoomOut:function(e){this.setZoomIn(this.zoomLevel-1,{zoomCenter:e})},setCenterIn:function(e,i){this.panToIn(e,i)},getRenderType:function(){return this._renderType},getSolarInfo:function(fn){fn=fn||this._initDate;var fm=aQ(fn);var e=cQ.convertLL2MC(new e4(fm[0],fm[1]));var fv=e.latLng;var fq=aI.Projection.convertMC2LL(this.centerPoint);var fs=fn.getUTCHours();var fu=fs+24*fq.lng/360;var ft=fu-12;var fr=ft*60*0.25;var fp=Math.asin(Math.sin(cr(fq.lat))*Math.sin(cr(fv.lat))+Math.cos(cr(fq.lat))*Math.cos(cr(fv.lat))*Math.cos(cr(fr)));var fo=Math.asin(Math.sin(cr(fr))*Math.cos(cr(fv.lat))/Math.cos(fp));var i="north";if(fq.lat<fv.lat){i="south"}return{zenith:e,solarAltitude:fp,solarAzimuth:fo,centerPosition:i,position:e}},setDisplayOptions:function(fm){if(!fm){return}for(var e in this._displayOptions){if(this._displayOptions.hasOwnProperty(e)){if(typeof fm[e]==="boolean"||(e==="skyColors"&&typeof fm.skyColors==="object")){this._displayOptions[e]=fm[e]}}}var i=this.getMapType();if(i===bX.NORMAL){this.fire(new aB("ondisplayoptions_changed"))}else{if(i===bX.EARTH&&this._earth){this._earth.fire(new aB("ondisplayoptions_changed"))}}},getHorizonPosY:function(e){if(!e||!this._webglMapCamera){return null}var i=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,{heading:0});return i.y},getIndoorInfo:function(){if(!this._indoorMgr){return}return this._indoorMgr.getData()},showIndoor:function(e,fm){var i=new aB("onindoor_status_changed");i.uid=e;i.floor=fm;this.fire(i)},addAreaSpot:function(e,fm){if(!e||e.length===0){return}fm=fm||{};this.areaSpots=this.areaSpots||{};var i=fm.id||("sp"+(this.temp.spotsGuid++));this.areaSpots[i]={spot:e,userData:fm.userData};return i},getAreaSpot:function(e){if(this.areaSpots&&this.areaSpots[e]){return this.areaSpots[e]}return null},removeAreaSpot:function(e){if(!e||!this.areaSpots[e]){return}delete this.areaSpots[e]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new aB("onspot_status_reset"))},hightlightSpotByUid:function(e,fm){var i=new aB("onspot_highlight");i.uid=e;i.tilePosStr=fm;this.fire(i)},setZoomIn:function(i,e){e=e||{};this.zoomTo(i,e.zoomCenter||null,e)},getCurrentMaxTilt:function(){var e=this.zoomLevel;if(this.mapType==="B_EARTH_MAP"){return bV.MAX_DRAG_TILT_L2}if(this.config.restrictCenter===false){return bV.MAX_DRAG_TILT}if(e>=19){return bV.MAX_DRAG_TILT}else{if(e<=18){if(e<this._enableTiltZoom){if(e>=this._enableTiltZoom-2){return(1-(this._enableTiltZoom-e)/2)*bV.MAX_DRAG_TILT_L2}return 0}return bV.MAX_DRAG_TILT_L2}else{return(bV.MAX_DRAG_TILT-bV.MAX_DRAG_TILT_L2)*(e-18)+bV.MAX_DRAG_TILT_L2}}},worldSize:function(i){var e=i||this.zoomLevel;return bV.WORLD_SIZE_MC/Math.pow(2,18-e)},setTrafficOn:function(){this.addTileLayer(bk)},setTrafficOff:function(){this.removeTileLayer(bk)},showOverlayContainer:function(){this.setDisplayOptions({overlay:true})},hideOverlayContainer:function(){this.setDisplayOptions({overlay:false})},addLabelsToMapTile:function(fm){for(var e=0;e<fm.length;e++){if(typeof fm[e].type==="undefined"){fm[e].type="fixed"}if(typeof fm[e].rank!=="number"){fm[e].rank=50000}fm[e].pt=fm[e].position;fm[e].custom=true;fm[e].processedInZoom=0;this._customTileLabels.push(fm[e])}this.dispatchEvent(new aB("onadd_tile_labels"))},removeLabelsFromMapTile:function(fm){for(var fn=0;fn<fm.length;fn++){for(var e=0;e<this._customTileLabels.length;e++){if(this._customTileLabels[e].uid===fm[fn]){this._customTileLabels.splice(e,1)}}}this.dispatchEvent(new aB("onremove_tile_labels"))},clearLabels:function(){this._customTileLabels.length=0;this.dispatchEvent(new aB("onclear_labels"))},loadMapStyleFiles:function(fn){var i=this.config.style;var fm=this;this._setTextRenderType();if(typeof i==="string"){if(aI["FeatureStyle"+i]){fm.fire(new aB("onstyle_loaded"));fn();return}eZ.load(dn.getMapStyleFiles(i),function(){aI["FeatureStyle"+i]=window.FeatureStyle;aI["iconSetInfo"+i]=window.iconSetInfo_high;aI.indoorStyle=window.indoorStyle;fm.fire(new aB("onstyle_loaded"));fn()})}else{var e=i;f.changeCopyright(fm);f.setEnvironment(e);f.resetEventListener();f.getStyleJson(e,function(ft){var fu=ef;var fq=aI.getGUID("custom");fm.config.mapStyleId=fq;var fr={};x.extend(fr,ft);var fp=Math.floor(fm.getZoom());window.styleCbk=function(fv){f.onStyleDataBack(fv,fp,fq,fr,fu);aI.customStyleLoaded=true;fm.fire(new aB("onstyle_loaded"));fn()};aI.customStyleInfo={zoomRegion:{},zoomStyleBody:[],zoomFrontStyle:{}};var fs=f.getStyleUrl(ft,fu,"styleCbk",fp);if(!aI.iconSetInfoCustom){var fo=dn.getMapStyleFiles("default");fo.splice(1,1);eZ.load(fo,function(){aI.iconSetInfoCustom=window.iconSetInfo_high;aI.indoorStyle=window.indoorStyle;eZ.load(fs)})}else{eZ.load(fs)}})}},setCopyrightOffset:function(fn,i){var fm=new aB("oncopyrightoffsetchange",{logo:fn,cpy:i});this.dispatchEvent(fm)},_setTextRenderType:function(){if(this.config.textRenderType!==null){return}if(d8()){this.config.textRenderType="canvas"}else{if(typeof this.config.style==="string"){this.config.textRenderType="image"}else{this.config.textRenderType="canvas"}}},destroy:function(){this.fire(new aB("ondestroy"))},centerAndZoom:function(e,fn,fm){var i=cQ.convertLL2MC(e);this.centerAndZoomIn(i,fn,fm)},pointToPixel:function(e,fm){var i=cQ.convertLL2MC(e);var fn={};x.extend(fn,fm);if(fn&&fn.center){fn.center=cQ.convertLL2MC(fn.center)}return this.pointToPixelIn(i,fn)},pixelToPoint:function(fm,i){var fn={};x.extend(fn,i);if(fn&&fn.center){fn.center=cQ.convertLL2MC(fn.center)}var e=this.pixelToPointIn(fm,fn);return cQ.convertMC2LL(e)},pointToOverlayPixel:function(e,fm){var i=cQ.convertLL2MC(e);var fn={};x.extend(fn,fm);if(fn&&fn.center){fn.center=cQ.convertLL2MC(fn.center)}return this.pointToOverlayPixelIn(i,fn)},overlayPixelToPoint:function(fm,i){var fn={};x.extend(fn,i);if(fn&&fn.center){fn.center=cQ.convertLL2MC(fn.center)}var e=this.overlayPixelToPointIn(fm,fn);return cQ.convertMC2LL(e)},setViewport:function(fm,fn){var e;if(fm&&fm.center){e={};x.extend(e,fm);e.center=cQ.convertLL2MC(e.center)}else{e=[];for(var fo=0;fo<fm.length;fo++){e[fo]=cQ.convertLL2MC(fm[fo])}}this.setViewportIn(e,fn)},getViewport:function(fp,fn){var fm;if(fp&&fp.length){fm=[];for(var fo=0;fo<fp.length;fo++){fm[fo]=cQ.convertLL2MC(fp[fo])}}var e=this.getViewportIn(fm,fn);e.center=cQ.convertMC2LL(e.center);return e},getDistance:function(fo,fm){var i=cQ.convertLL2MC(fo);var fn=cQ.convertLL2MC(fm);var e=this.getDistanceIn(i,fn);return e},setCenter:function(e,fm){var i=cQ.convertLL2MC(e);this.setCenterIn(i,fm)},setZoom:function(fm,e){var i={};x.extend(i,e);if(i&&i.zoomCenter){i.zoomCenter=cQ.convertLL2MC(i.zoomCenter)}this.setZoomIn(fm,i)},flyTo:function(e,fm){var i=cQ.convertLL2MC(e);this.flyToIn(i,fm)},panTo:function(e,fm){var i=cQ.convertLL2MC(e);this.panToIn(i,fm)},getCenter:function(){var e=this.getCenterIn();return cQ.convertMC2LL(e)},getBounds:function(){var e=this.getBoundsIn();var i=new cv(cQ.convertMC2LL(e.getSouthWest()),cQ.convertMC2LL(e.getNorthEast()));return i},setMapStyleV2:function(e){this.setOptions({style:e})},startViewAnimation:function(fm){var e=fm._options.delay;var i=this;setTimeout(function(){fm._start(i)},e)},cancelViewAnimation:function(e){e._cancel(this)},getMapScreenshot:function(){return this._webglMapScene._painter._canvas.toDataURL()}});var bX={NORMAL:"B_NORMAL_MAP",EARTH:"B_EARTH_MAP",SATELLITE:"B_STREET_MAP"};aI.MapTypeId=bX;window.BMAP_NORMAL_MAP="B_NORMAL_MAP";window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP";window.BMAP_HYBRID_MAP="B_STREET_MAP";window.BMAP_EARTH_MAP="B_EARTH_MAP";window.BMAP_COORD_MERCATOR=1;window.BMAP_SYS_DRAWER=0;window.BMAP_SVG_DRAWER=1;window.BMAP_VML_DRAWER=2;window.BMAP_CANVAS_DRAWER=3;var f={environment:"jsapi",map:null,ontilesloaded:false,onstyle_loaded:false,resetEventListener:function(){var e=this;this.ontilesloaded=false;this.onstyle_loaded=false;e.map.addEventListener("ontilesloaded",e.checkLoadedStatus);e.map.addEventListener("onstyle_loaded",e.checkLoadedStatus)},checkLoadedStatus:function(i){f[i.type]=true;if(f.ontilesloaded&&f.onstyle_loaded){this.dispatchEvent(new aB("onstylechangetilesloaded"));this.removeEventListener("ontilesloaded",f.checkLoadedStatus);this.removeEventListener("onstyle_loaded",f.checkLoadedStatus)}},changeCopyright:function(i){var e=this;e.map=i;if(e.cpyCtrl){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new cG(1,1))}}else{e.map.addEventListener("oncopyrightaddend",function(){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new cG(1,1))}})}},setEnvironment:function(e){if(e.customEditor){this.environment="customEditor"}else{if(e.sharing){this.environment="sharing"}else{if(e.preivew){this.environment="preivew"}else{this.environment="jsapi"}}}},getStyleJson:function(fn,fp){var fo=this;if(fn.styleJson){fp&&fp(fn.styleJson)}else{if(fn.styleId){var i=fn.styleId;var e=(Math.random()*100000).toFixed(0);aI["_cbk_si_phpui"+e]=function(fr){var fq=[];if(fr.result&&fr.result["error"]===0&&fr.content&&fr.content["status"]===0){fq=fo.parseJson(fr.content["data"]["json"]);fp&&fp(fq)}else{fp&&fp("default")}};aI["_cbk_si_api"+e]=function(fr){var fq=[];if(fr.status===0){if(fr.info){fq=fo.parseJson(fr.info["json"])}else{fq=fo.parseJson(fr.data["json"])}fp&&fp(fq)}else{fp&&fp("default")}};var fm="";switch(this.environment){case"jsapi":fm=dg.apiHost+"/?qt=custom_map&v=3.0&style_id="+i+"&type=publish&ak="+ef;fm+="&callback="+cZ+"._cbk_si_phpui"+e;break;case"sharing":fm+="/apiconsole/custommap/getSharingJson";fm+="?styleid="+i+"&type=edit";fm+="&ck="+cZ+"._cbk_si_api"+e;break;case"preview":fm+="/apiconsole/custommap/getJson";fm+="?styleid="+i+"&type=edit";fm+="&ck="+cZ+"._cbk_si_api"+e;break}eZ.load(fm)}else{fp&&fp("default")}}},parseJson:function(fm){if(fm===null||fm===""){return[]}var i={t:"featureType",e:"elementType",v:"visibility",c:"color",l:"lightness",s:"saturation",w:"weight",z:"level",h:"hue",f:"fontsize",zri:"curZoomRegionId",zr:"curZoomRegion"};var fo={all:"all",g:"geometry","g.f":"geometry.fill","g.s":"geometry.stroke",l:"labels","l.t.f":"labels.text.fill","l.t.s":"labels.text.stroke","l.t":"labels.text","l.i":"labels.icon","g.tf":"geometry.topfill","g.sf":"geometry.sidefill"};var fn=fm.split(",");var e=fn.map(function(fs){var fr=fs.split("|").map(function(fy){var fw=i[fy.split(":")[0]];var fv=(fo[fy.split(":")[1]]?fo[fy.split(":")[1]]:fy.split(":")[1]);switch(fv){case"poi":fv="poilabel";break;case"districtlabel":fv="districtlabel";break}var fx={};fx[fw]=fv;return fx});var fp=fr[0];var fu=1;if(fr[1]["elementType"]){fu=2;x.extend(fp,fr[1])}var ft={};for(var fq=fu;fq<fr.length;fq++){x.extend(ft,fr[fq])}return x.extend(fp,{stylers:ft})});return e},getStyleUrl:function(fm,fo,fn,e){this.styleJson=fm;var i=dn.apiHost+"/custom/v2/mapstyle?ak="+fo+"&callback="+fn+"&";i+="is_all=true&is_new=1&";i+="styles="+encodeURIComponent(this.styleJson2styleStringV2(fm,e));return i},styleJson2styleStringV2:function(fn,fx){var fy={featureType:"t",elementType:"e",visibility:"v",color:"c",lightness:"l",saturation:"s",weight:"w",level:"z",hue:"h",fontsize:"f"};var fz={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","labels.text":"l.t","labels.icon":"l.i","geometry.topfill":"g.tf","geometry.sidefill":"g.sf"};var fA=[];var fs=false;var fu=false;var fm=false;var ft=false;var e=false;aI.customStyleInfo.zoomFrontStyle[fx]={};for(var fo=0;!!fn[fo];fo++){var fw=fn[fo];if(this.isOnlyZoomStyler(fw)){continue}aI.customStyleInfo.zoomRegion=this.getZoomRegion(fw,aI.customStyleInfo.zoomRegion);if(!this.isSelectZoom(fw,fx)){continue}if((fw.featureType==="land"||fw.featureType==="all"||fw.featureType==="background")&&typeof fw.elementType==="string"&&(fw.elementType==="geometry"||fw.elementType==="geometry.fill"||fw.elementType==="all")&&fw.stylers){if(fw.stylers["color"]){aI.customStyleInfo.zoomFrontStyle[fx]["bmapLandColor"]=fw.stylers["color"];aI.customStyleInfo.zoomFrontStyle[fx].landColor=true;aI.bmapLandColor=fw.stylers["color"];fs=true}if(fw.stylers["visibility"]&&fw.stylers["visibility"]==="off"){aI.customStyleInfo.zoomFrontStyle[fx]["bmapLandColor"]="#00000000";aI.customStyleInfo.zoomFrontStyle[fx].landColor=true;aI.bmapLandColor="#00000000";fs=true}}if(fw.featureType==="roadarrow"&&fw.elementType==="labels.icon"&&fw.stylers){aI.bmapRoadarrowVisibility=fw.stylers["visibility"];aI.customStyleInfo.zoomFrontStyle[fx]["bmapRoadarrowVisibility"]=fw.stylers["visibility"];aI.customStyleInfo.zoomFrontStyle[fx].roadarrowVisibility=true;e=true}var fp={};x.extend(fp,fw);var fr=fp.stylers;delete fp.stylers;x.extend(fp,fr);var fq=[];for(var fv in fy){if(fp[fv]){if(this.isEditorZoomKeys(fv)){continue}if(fv==="elementType"){fq.push(fy[fv]+":"+fz[fp[fv]])}else{switch(fp[fv]){case"poilabel":fp[fv]="poi";break;case"districtlabel":fp[fv]="label";break}fq.push(fy[fv]+":"+fp[fv])}}}if(fq.length>2){fA.push(fq.join("|"))}}if(!aI.customStyleInfo.zoomFrontStyle[fx].landColor&&aI.customStyleInfo.zoomFrontStyle[fx]["bmapLandColor"]){delete aI.customStyleInfo.zoomFrontStyle[fx]["bmapLandColor"]}if(!aI.customStyleInfo.zoomFrontStyle[fx].railwayFillColor&&aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayFillColor"]){delete aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayFillColor"]}if(!aI.customStyleInfo.zoomFrontStyle[fx].railwayStrokeColor&&aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayStrokeColor"]){delete aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayStrokeColor"]}if(!aI.customStyleInfo.zoomFrontStyle[fx].railwayVisibility&&aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayVisibility"]){delete aI.customStyleInfo.zoomFrontStyle[fx]["bmapRailwayVisibility"]}if(!aI.customStyleInfo.zoomFrontStyle[fx].roadarrowVisibility&&aI.customStyleInfo.zoomFrontStyle[fx]["bmapRoadarrowVisibility"]){delete aI.customStyleInfo.zoomFrontStyle[fx]["bmapRoadarrowVisibility"]}return fA.join(",")},isOnlyZoomStyler:function(e){var i={};x.extend(i,e.stylers);delete i.curZoomRegionId;delete i.curZoomRegion;delete i.level;if(x.isEmptyObject(i)){return true}else{return false}},isSelectZoom:function(i,e){var fm=i.stylers["level"];if(fm===undefined){return true}else{if(fm===e+""){return true}else{return false}}},isEditorZoomKeys:function(e){var i={curZoomRegionId:true,curZoomRegion:true};if(i[e]){return true}else{return false}},getZoomRegion:function(e,i){var fn=e.stylers["level"];var fm={};x.extend(fm,i);if(fn===undefined){return fm}else{fm[parseInt(fn,10)]=true;return fm}},onStyleDataBack:function(fo,ft,fs,e,fq){if(fo.status!==0){return}if(fo.data.style.length===3){if(!aI.customStyleInfo.baseFs){aI.customStyleInfo.baseFs=fo.data.style}aI.StyleBody=fo.data.style[2]}else{aI.StyleBody=fo.data.style}var fr=aI.customStyleInfo.baseFs;if(!x.isEmptyObject(aI.customStyleInfo.zoomRegion)){this.updateZoomFeatureStyle(aI.StyleBody,ft);this.updateFrontFeatureStyle(ft);var fm=this.calcuOtherZoomRegion(aI.customStyleInfo.zoomRegion,ft);for(var fp in fm){var fn={};x.extend(fn,e);this.getOtherZoomStyles(fp,fq,fn)}}else{aI["FeatureStyle"+fs]=fr;this.updateFrontFeatureStyle(ft)}},updateZoomFeatureStyle:function(fp,fo){console.log("1:"+fo);aI.customStyleInfo.zoomStyleBody[fo]=fp;if(!aI.customStyleInfo.zoomRegion[fo]){console.log("2:"+fo);var fn=3;var e=21;for(var fm=fn;fm<=e;fm++){if(!aI.customStyleInfo.zoomRegion[fm]){aI.customStyleInfo.zoomStyleBody[fm]=fp}}}},getOtherZoomStyles:function(fp,fq,fn){var fo=this;var fm=fp;var e=(Math.random()*100000).toFixed(0);window["_cbk"+e]=function(fr){if(fr.data.style.length===3){fr=fr.data.style[2]}else{fr=fr.data.style}fo.updateZoomFeatureStyle(fr,fm);fo.updateFrontFeatureStyle(fm);delete window["_cbk"+e]};var i=dn.apiHost+"/custom/v2/mapstyle?ak="+fq+"&callback=_cbk"+e+"&is_all=true&is_new=1&styles="+encodeURIComponent(this.styleJson2styleStringV2(fn,fm));eZ.load(i)},updateFrontFeatureStyle:function(fo){if(!aI.customStyleInfo.zoomRegion[fo]){var fn=3;var e=21;for(var fm=fn;fm<=e;fm++){if(!aI.customStyleInfo.zoomRegion[fm]){if(!aI.customStyleInfo.zoomFrontStyle[fm]){aI.customStyleInfo.zoomFrontStyle[fm]={}}aI.customStyleInfo.zoomFrontStyle[fm]["bmapLandColor"]=aI.customStyleInfo.zoomFrontStyle[fo]["bmapLandColor"];aI.customStyleInfo.zoomFrontStyle[fm]["bmapRailwayFillColor"]=aI.customStyleInfo.zoomFrontStyle[fo]["bmapRailwayFillColor"];aI.customStyleInfo.zoomFrontStyle[fm]["bmapRailwayStrokeColor"]=aI.customStyleInfo.zoomFrontStyle[fo]["bmapRailwayStrokeColor"]}}}},calcuOtherZoomRegion:function(fq,fp){var fm={};x.extend(fm,fq);if(fm[fp]){var fo=3;var e=21;for(var fn=fo;fn<=e;fn++){if(!fm[fn]){fm[fn]=true;break}}delete fm[fp]}else{}return fm}};function a4(i,e,fn,fm){this.cx=3*i;this.bx=3*(fn-i)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*e;this.by=3*(fm-e)-this.cy;this.ay=1-this.cy-this.by;this.p1x=i;this.p1y=fm;this.p2x=fn;this.p2y=fm}a4.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};a4.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};a4.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};a4.prototype.solveCurveX=function(e,fs){if(typeof fs==="undefined"){fs=0.000001}var fr;var fq;var fo;var fm;var fn;for(fo=e,fn=0;fn<8;fn++){fm=this.sampleCurveX(fo)-e;if(Math.abs(fm)<fs){return fo}var fp=this.sampleCurveDerivativeX(fo);if(Math.abs(fp)<0.000001){break}fo=fo-fm/fp}fr=0;fq=1;fo=e;if(fo<fr){return fr}if(fo>fq){return fq}while(fr<fq){fm=this.sampleCurveX(fo);if(Math.abs(fm-e)<fs){return fo}if(e>fm){fr=fo}else{fq=fo}fo=(fq-fr)*0.5+fr}return fo};a4.prototype.solve=function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))};var bq={};function l(fm){var e={duration:1000,fps:30,delay:0,transition:bq.linear,dropLastAnimation:false};if(fm){for(var fn in fm){e[fn]=fm[fn]}}if(fm.beginTime){this._beginTime=fm.beginTime}this._callbacks=[];this._options=e;if(e.delay){var fo=this;setTimeout(function(){fo._doStart()},e.delay)}else{this._doStart()}}l.INFINITE="INFINITE";l.prototype._doStart=function(){if(window.requestAnimationFrame){var e=this;e._timer=window.requestAnimationFrame(function(i){e._loop(i)})}else{this._beginTime=new Date().getTime();if(this._options.duration===l.INFINITE){this._endTime=null}else{this._endTime=this._beginTime+this._options.duration}this._loop()}};l.prototype._loop=function(fn){var fq=this;fn=fn||new Date().getTime();if(!this._beginTime){this._beginTime=fn}if(!this._endTime&&typeof this._options.duration==="number"){this._endTime=this._beginTime+this._options.duration}if(fq._endTime!==null&&fn>=fq._endTime){if(fq._options.dropLastAnimation===false){fq._options.render(fq._options.transition(1),1,fn)}if(typeof fq._options.finish==="function"){fq._options.finish(fn,this)}for(var fp=0,e=fq._callbacks.length;fp<e;fp++){fq._callbacks[fp]()}return}var fo;if(typeof fq._options.duration==="number"){fo=(fn-fq._beginTime)/fq._options.duration;fq.schedule=fq._options.transition(fo)}else{fo=fn-fq._beginTime;fq.schedule=0}fq._options.render(fq.schedule,fo,fn);if(!fq.terminative){if(window.requestAnimationFrame){fq._timer=requestAnimationFrame(function fm(i){fq._loop(i)})}else{fq._timer=setTimeout(function(){fq._loop()},1000/fq._options.fps)}}};l.prototype.stop=function(i,e){this.terminative=true;if(this._timer){if(window.cancelAnimationFrame){cancelAnimationFrame(this._timer)}else{clearTimeout(this._timer)}this._timer=null;if(typeof this._options.onStop==="function"){this._options.onStop(e)}}if(i){this._endTime=this._beginTime;this._loop()}};l.prototype.cancel=function(){this.stop()};l.prototype.append=function(e){this._callbacks.push(e);return this};bq={_p1:1,_p2:1*1.525,linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeInBiquad:function(e){return Math.pow(e,4)},easeInBack:function(e){return e*e*((bq._p1+1)*e-bq._p1)},easeOutQuad:function(e){return -(e*(e-2))},easeOutCubic:function(e){return Math.pow((e-1),3)+1},easeOutBiquad:function(e){return 1-Math.pow((e-1),4)},easeOutBack:function(e){return((e=e-1)*e*((bq._p1+1)*e+bq._p1)+1)},easeInOutQuad:function(e){if(e<0.5){return e*e*2}else{return -2*(e-2)*e-1}},easeInOutCubic:function(e){if(e<0.5){return Math.pow(e,3)*4}else{return Math.pow(e-1,3)*4+1}},easeInOutBiquad:function(e){if(e<0.5){return Math.pow(e,4)*8}else{return 1-(Math.pow(e-1,4)*8)}},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}};bq.ease=(function(){var e=new a4(0.4,0,0.6,1);return function(i){return e.solve(i)}})();bq["ease-in"]=bq.easeInQuad;bq["ease-out"]=bq.easeOutQuad;var dA={start:function(ft){var fn=ft.el;var e=ft.style;var i=ft.startValue;var fq=ft.endValue;var fo=ft.duration||1400;var fp=ft.transition||bq.linear;var fs=ft.callback;var fr=fq-i;var fm=ft.unit||"";return new l({fps:60,duration:fo,transition:fp,render:function(fu){fn.style[e]=i+fr*fu+fm},finish:function(){fs&&fs()}})}};function bG(fo,fm){cJ.call(this);this.keyframes=fo;var e={duration:1000,delay:0,transition:bq.linear,interation:1};if(fm){for(var fn in fm){e[fn]=fm[fn]}}this._options=e}bG.inherits(cJ,"ViewAnimation");bG.prototype._start=function(fp){var fm=this;fm.map=fp;var fo=new aB("onanimationstart");fm.dispatchEvent(fo);this._initStatus(fm.map);var fn=this._options.duration;var i=this._options.interation;var fq=this._options.transition;var fr=0;fm.poiStatus=fm.map._displayOptions.poi;if(fm.poiStatus){fm.map.setDisplayOptions({poi:false})}fm.map.viewAnimationTime=new Date().getTime();this.animation=new l({duration:fn,transition:fq,start:function(e){},render:function(fs,e){if(fs===0){fm._initStatus(fm.map)}else{fm._setViewByRate(fs)}},finish:function(ft,fs){if(++fr<i||i==="INFINITE"){var fu=new aB("onanimationiterations");fm.dispatchEvent(fu);delete fs._beginTime;delete fs._endTime;fs._doStart()}else{var fu=new aB("onanimationend");fm.dispatchEvent(fu);delete fm.map.viewAnimationTime;fm.map.setDisplayOptions({poi:fm.poiStatus})}}})};bG.prototype._getTotalDuration=function(e,i){if(e===l.INFINITE){return l.INFINITE}else{return e*i}};bG.prototype._initStatus=function(e){if(this.keyframes[0]){e.setCenter(this.keyframes[0].center,{noAnimation:true});e.setZoom(this.keyframes[0].zoom,{noAnimation:true});e.setTilt(this.keyframes[0].tilt,{noAnimation:true});e.setHeading(this.keyframes[0].heading,{noAnimation:true})}};bG.prototype._setViewByRate=function(fn){for(var e=0;e<this.keyframes.length-1;e++){var fo=this.keyframes[e];var fm=this.keyframes[e+1];if(fn>=fo.percentage&&fn<fm.percentage){this.map.setHeading(this._getHeadingDelta(fo,fm,fn),{noAnimation:true});this.map.setTilt(this._getTiltDelta(fo,fm,fn),{noAnimation:true});this.map.setCenter(this._getCenterDelta(fo,fm,fn),{noAnimation:true});this.map.setZoom(this._getZoomDelta(fo,fm,fn),{noAnimation:true})}}};bG.prototype._getHeadingDelta=function(fm,i,e){var fo=(e-fm.percentage)/(i.percentage-fm.percentage);var fn=fm.heading+(i.heading-fm.heading)*fo;return fn};bG.prototype._getTiltDelta=function(fm,i,e){var fo=(e-fm.percentage)/(i.percentage-fm.percentage);var fn=fm.tilt+(i.tilt-fm.tilt)*fo;return fn};bG.prototype._getCenterDelta=function(fm,i,e){var fo=(e-fm.percentage)/(i.percentage-fm.percentage);var fn=fm.center.add(i.center.sub(fm.center).mult(fo));return fn};bG.prototype._getZoomDelta=function(fn,fm,i){var fo=(i-fn.percentage)/(fm.percentage-fn.percentage);var e=fn.zoom+(fm.zoom-fn.zoom)*fo;return e};bG.prototype._cancel=function(fm){fm.setDisplayOptions({poi:this.poiStatus});this.animation.cancel();delete fm.viewAnimationTime;var i=new aB("onanimationcancel");this.dispatchEvent(i)};var cW=undefined;var bP={is64Bit:function(){if(/Windows/.test(navigator.userAgent)){if(/Win64; x64/.test(navigator.userAgent)){return true}else{if(/WOW64/.test(navigator.userAgent)){return true}else{return false}}}return true},isIOS112:function bH(e){return/11_2/.test(navigator.userAgent)},canUseWebAssembly:function(i){if(cW!==undefined){i&&i(cW);return}if(window.WebAssembly&&this.is64Bit()){if(!aN()){cW=true;i&&i(cW)}else{if(this.isIOS112()){cW=false;i&&i(cW)}else{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);WebAssembly.instantiate(e).then(function(fm){cW=true;i&&i(cW)},function(fm){cW=false;i&&i(cW)})}}}else{cW=false;i&&i(cW)}}};var ce={};aI.Utils=ce;function b0(e){return e.style}function b6(i){if(x.Browser.ie>0){i.unselectable="on";i.selectstart=function(){return false};i.onmousedown=function(fm){fm.preventDefault();return false}}else{var e=b0(i);e.MozUserSelect="none";e.WebkitUserSelect="none";i.addEventListener("mousedown",function(fm){fm.preventDefault()},false)}}function eS(e){return e&&e.parentNode&&e.parentNode.nodeType!==11}function cq(i,e){i.insertAdjacentHTML("beforeEnd",e);return i.lastChild}function fb(fm,i){var fn=document.createElement("div");fn.innerHTML=i;var e=fn.childNodes[0];return fm.parentNode.insertBefore(e,fm)}function g(i){i=i||window.event;i.stopPropagation?i.stopPropagation():i.cancelBubble=true}function a6(i){i=i||window.event;i.preventDefault?i.preventDefault():i.returnValue=false;return false}function bY(i){g(i);return a6(i)}function dR(){var e=document.documentElement;var i=document.body;if(e&&(e.scrollTop||e.scrollLeft)){return[e.scrollTop,e.scrollLeft]}else{if(i){return[i.scrollTop,i.scrollLeft]}else{return[0,0]}}}function dE(fo){if(!fo){return}fo.onload=fo.onerror=null;var fm=fo.attributes,fn,e,fp;if(fm){e=fm.length;for(fn=0;fn<e;fn+=1){fp=fm[fn].name;if(typeof fo[fp]==="function"){fo[fp]=null}}}fm=fo.children;if(fm){e=fm.length;for(fn=0;fn<e;fn+=1){dE(fo.children[fn])}}}function aX(i,fq,fp){var fo=fq.lng-fp.lng;var fn=fq.lat-fp.lat;if(fo===0){return Math.abs(i.lng-fq.lng)}if(fn===0){return Math.abs(i.lat-fq.lat)}var fm=fn/fo;var e=fq.lat-fm*fq.lng;return Math.abs(fm*i.lng-i.lat+e)/Math.sqrt(fm*fm+1)}function eI(i,e){if(!i||!e){return}return Math.round(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)))}function a2(i,e){if(!i||!e){return 0}return Math.round(Math.sqrt(Math.pow(i.lng-e.lng,2)+Math.pow(i.lat-e.lat,2)))}function bQ(fm,i){var e=Math.round((fm.x+i.x)/2);var fn=Math.round((fm.y+i.y)/2);return new cO(e,fn)}function eX(e,fm){var i=[];fm=fm||function(fo){return fo};for(var fn in e){i.push(fn+"="+fm(e[fn]))}return i.join("&")}function H(fm,i,fp){var fq=document.createElement(fm);if(fp){fq=document.createElementNS(fp,fm)}i=i||{};for(var fn in i){var fo={"for":"htmlFor","class":"cssClass"}[fn]||fn;if(fn==="style"){fq.style.cssText=i[fn];continue}if(fn==="class"){x.ac(fq,i[fn]);continue}if(fq.setAttribute){fq.setAttribute(fo,i[fn])}else{try{fq[fo]=i[fn]}catch(fq){}}}return fq}function d2(e){if(e.currentStyle){return e.currentStyle}else{if(e.ownerDocument&&e.ownerDocument.defaultView){return e.ownerDocument.defaultView.getComputedStyle(e,null)}}}function a7(e){return typeof e==="function"}var e0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function eN(fo){var fm="";var fv;var ft;var fr="";var fu;var fs;var fq;var fp="";var fn=0;var e=/[^A-Za-z0-9+/=]/g;if(!fo||e.exec(fo)){return fo}fo=fo.replace(/[^A-Za-z0-9+/=]/g,"");do{fu=e0.indexOf(fo.charAt(fn++));fs=e0.indexOf(fo.charAt(fn++));fq=e0.indexOf(fo.charAt(fn++));fp=e0.indexOf(fo.charAt(fn++));fv=(fu<<2)|(fs>>4);ft=((fs&15)<<4)|(fq>>2);fr=((fq&3)<<6)|fp;fm=fm+String.fromCharCode(fv);if(fq!==64){fm=fm+String.fromCharCode(ft)}if(fp!==64){fm=fm+String.fromCharCode(fr)}fv=ft=fr="";fu=fs=fq=fp=""}while(fn<fo.length);return fm}(function(e){if(!e.Utils){e.Utils={}}var i=e.Utils;i.format=(function(){function fm(fq,fp,fr){var fo=fr[+fp];return typeof(fo)==="function"?fo(fp):fo}function fn(fq,fp,fr){var ft=fp;var fu=[];var fo=fp.split(":");if(fo.length===2){ft=fo[0];fu.push(fo[1])}var fs=typeof(fr[ft]);if(fs==="function"){return fr[ft].apply(undefined,fu)}else{if(fs==="undefined"){return fq}else{return String(fr[ft])}}}return function(fo,fp){var fr=fp.splice?fm:fn;var fq=fo.splice?fo.join(""):fo;return fq.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(ft,fs){return fr(ft,fs,fp)})}})();i.ErrorMonitor=function(fn,fm,fo){};bP.canUseWebAssembly(function(fm){i.canUseWebAssembly=fm})})(aI);function d8(){return(aN()||c0())}function aN(){var e=navigator.userAgent;if(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1){return true}return false}function c0(){var e=navigator.userAgent;if(e.indexOf("Android")>-1){return true}return false}function cr(e){return e*Math.PI/180}function b1(e){return e/Math.PI*180}function ct(e,fo){var fn=Math.pow(10,fo);if(typeof e==="number"){return Math.round(e*fn)/fn}for(var fm=0;fm<e.length;fm++){e[fm]=ct(e[fm],fo)}return e}function dN(fm,i,e){if(fm<i){fm=i}else{if(fm>e){fm=e}}return fm}function d4(e,i){while(e<0){e+=i}return e%i}function cF(i,e){return(i>=0&&e>=0)||(i<0&&e<0)}function ax(i){if(i._gl){return i._gl}var e={alpha:true,antialias:false,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,stencil:false};var fm=i.getContext("webgl",e)||i.getContext("experimental-webgl",e);i._gl=fm;return fm}function c5(fn,fm){for(var e=0;e<fm.length;e++){x.on(fn,fm[e],g)}}function fl(i,fm,e){fm[e]=i.getUniformLocation(fm,e)}function dl(fo,fp,e,fm,i){var fn="";switch(i){case"mat4":fo.uniformMatrix4fv(fp[e],false,fm);return;case"v3":fn="uniform3fv";break;case"f":fn="uniform1f";break;case"i":fn="uniform1i";break}if(fn===""){throw"error"}fo[fn](fp[e],fm)}function D(fv,e){while(fv<0){fv+=360}fv=fv%360;var fn=e.width;var fu=e.height;var fq=fn;var fm=fu;if(fv<90){var i=Math.sin(cr(fv))*fn;var fs=Math.sin(cr(fv))*fu;var ft=Math.cos(cr(fv))*fn;var fp=Math.cos(cr(fv))*fu;var fq=Math.ceil(ft+fs);var fm=Math.ceil(i+fp)}else{if(fv<180){var fv=fv-90;var i=Math.sin(cr(fv))*fn;var fs=Math.sin(cr(fv))*fu;var ft=Math.cos(cr(fv))*fn;var fp=Math.cos(cr(fv))*fu;var fq=Math.ceil(i+fp);var fm=Math.ceil(ft+fs)}else{if(fv<270){var fv=fv-180;var i=Math.sin(cr(fv))*fn;var fs=Math.sin(cr(fv))*fu;var ft=Math.cos(cr(fv))*fn;var fp=Math.cos(cr(fv))*fu;var fq=Math.ceil(ft+fs);var fm=Math.ceil(i+fp)}else{var fv=fv-270;var i=Math.sin(cr(fv))*fn;var fs=Math.sin(cr(fv))*fu;var ft=Math.cos(cr(fv))*fn;var fp=Math.cos(cr(fv))*fu;var fq=Math.ceil(i+fp);var fm=Math.ceil(ft+fs)}}}var fr=fq-fn;var fo=fm-fu;return[0-fr/2,0-fo/2,fn+fr/2,fu+fo/2]}function ez(e){if(e.toDataURL()===ez._blankData){return true}return false}function es(fo,fn,fm){var i=[fm.lng-fo.lng,fm.lat-fo.lat];var e=[fn.lng-fo.lng,fn.lat-fo.lat];return i[0]*e[1]-i[1]*e[0]}function bm(fp,fo,fm){var e;var fq;var fn;var i;if(fp.lng<fo.lng){e=fp.lng;fn=fo.lng}else{e=fo.lng;fn=fp.lng}if(fp.lat<fo.lat){fq=fp.lat;i=fo.lat}else{fq=fo.lat;i=fp.lat}if(fm.lng<e||fm.lng>fn||fm.lat<fq||fm.lat>i){return false}return true}function eu(fr,fq,fp,fn){var fo=es(fp,fn,fr);var fm=es(fp,fn,fq);var i=es(fr,fq,fp);var e=es(fr,fq,fn);if(fo*fm<0&&i*e<0){return true}else{if(fo===0&&bm(fp,fn,fr)){return true}else{if(fm===0&&bm(fp,fn,fq)){return true}else{if(i===0&&bm(fr,fq,fp)){return true}else{if(e===0&&bm(fr,fq,fn)){return true}else{return false}}}}}}function e9(fm,i){var e=i.parentNode;if(e.lastChild===i){e.appendChild(fm)}else{e.insertBefore(fm,i.nextSibling)}}function fd(ft,fu){if(fu===0){return ft}var fs=0;var fq=0;if(!ft){throw"异常"}if(ft.length===0){return[]}for(var fo=1,fm=ft.length-1;fo<fm;fo++){var fr=aX(ft[fo],ft[0],ft[ft.length-1]);if(fr>fs){fq=fo;fs=fr}}var e=[];if(fs>=fu){var fw=ft.slice(0,fq);var fv=ft.slice(fq,ft.length);var fp=fd(fw,fu);var fn=fd(fv,fu);for(var fo=0,fm=fp.length;fo<fm;fo++){e.push(fp[fo])}for(var fo=0,fm=fn.length;fo<fm;fo++){e.push(fn[fo])}}else{e.push(ft[0]);e.push(ft[ft.length-1])}return e}function c1(e){if(Math.log2){return Math.log2(e)}return Math.log(e)/Math.LN2}function aK(fm,i,e){return Math.min(e,Math.max(i,fm))}function bE(e,i){if(!i){return e}var fp=i[0];var fo=i[1];var fn=i[2];var fm=i[3];var fr=[];var fq=[];fr[0]=fm*e[0]+fn*e[2];fr[1]=e[1];fr[2]=-fn*e[0]+fm*e[2];fq[0]=fr[0];fq[1]=fo*fr[1]-fp*fr[2];fq[2]=fp*fr[1]+fo*fr[2];return fq}var ak=Math.PI/180;var y=180/Math.PI;function aQ(fm){var i=(fm-Date.UTC(2000,0,1,12))/86400000/36525;var e=(d3.utcDay.floor(fm)-fm)/86400000*360-180;return[e-I(i)*y,ew(i)*y]}function I(fn){var fo=ea(fn);var i=cs(fn);var fm=S(fn);var fp=Math.tan(d7(fn)/2);fp*=fp;return fp*Math.sin(2*fm)-2*fo*Math.sin(i)+4*fo*fp*Math.sin(i)*Math.cos(2*fm)-0.5*fp*fp*Math.sin(4*fm)-1.25*fo*fo*Math.sin(2*i)}function ew(e){return Math.asin(Math.sin(d7(e))*Math.sin(eL(e)))}function eL(e){return aD(e)-(0.00569+0.00478*Math.sin((125.04-1934.136*e)*ak))*ak}function aD(e){return S(e)+cu(e)}function cs(e){return(357.52911+e*(35999.05029-0.0001537*e))*ak}function S(i){var e=(280.46646+i*(36000.76983+i*0.0003032))%360;return(e<0?e+360:e)/180*Math.PI}function cu(i){var e=cs(i);return(Math.sin(e)*(1.914602-i*(0.004817+0.000014*i))+Math.sin(e+e)*(0.019993-0.000101*i)+Math.sin(e+e+e)*0.000289)*ak}function d7(e){return du(e)+0.00256*Math.cos((125.04-1934.136*e)*ak)*ak}function du(e){return(23+(26+(21.448-e*(46.815+e*(0.00059-e*0.001813)))/60)/60)*ak}function ea(e){return 0.016708634-e*(0.000042037+1.267e-7*e)}function ay(){return window.devicePixelRatio||1}function ae(fm){var i;var e;var fn;if(fm>=0){fn=Math.floor(fm/65536)*65536;i=fn;e=fm-fn}else{fn=Math.floor(-fm/65536)*65536;i=-fn;e=fm+fn}return[i,e]}function A(e){if(e.lng>=0&&e.lat>=0){return new e4(e.lng-10000000,e.lat-6000000)}if(e.lng>=0&&e.lat<0){return new e4(e.lng-10000000,e.lat+6000000)}if(e.lng<0&&e.lat>=0){return new e4(e.lng+10000000,e.lat-6000000)}if(e.lng<0&&e.lat<0){return new e4(e.lng+10000000,e.lat+6000000)}}var dK=null;if(window.performance&&window.performance.now){dK=function(){return performance.now()}}else{if(Date.now){dK=function(){return Date.now()}}else{dK=function(){return(new Date).getTime()}}}function aZ(fn,e,i){var fm="mouseWheel";if(x.Platform.macintosh){if(!isNaN(fn)&&(fn<10||fn!==120)&&(e%1===0&&e<5)){fm="padScroll"}if(x.Browser.firefox&&(e%1===0&&e<5&&i===0)){fm="padScroll"}}if(x.Browser.safari&&fn===12){fm="mouseWheel"}return fm}function b2(fw,fr){var fv=fw[0];var fu=fw[1];var fn=false;for(var fq=0,fp=fr.length-2;fq<fr.length;fq+=2){var ft=fr[fq];var fo=fr[fq+1];var fs=fr[fp];var fm=fr[fp+1];var e=((fo>fu)!==(fm>fu))&&(fv<(fs-ft)*(fu-fo)/(fm-fo)+ft);if(e){fn=!fn}fp=fq}return fn}function bB(fm,e,i,fn){fn=fn||0.4;if(fm>i){fm=Math.pow(fm-i+1,fn)+i-1}else{if(fm<e){fm=e-Math.pow(e-fm+1,fn)+1}}return fm}function ek(fr){var fp="";for(var fm=0;fm<fr.length;fm++){var fs=fr.charCodeAt(fm)<<1;var e=fs.toString(2);var fo=e.length;var fv=e;if(fo<8){fv="00000000"+e;fv=fv.substr(e.length,8)}fp+=fv}var ft=5-fp.length%5;var fn=[];for(var fm=0;fm<ft;fm++){fn[fm]="0"}fp=fn.join("")+fp;var fu=[];for(var fm=0;fm<fp.length/5;fm++){var fs=fp.substr(fm*5,5);var fq=parseInt(fs,2)+50;fu.push(String.fromCharCode(fq))}return fu.join("")+ft.toString()}function ad(fm,i){var e=aI.TILE_VERSION||window.TILE_VERSION;if(!e||!e[fm]||!e[fm][i]||!e[fm][i].version||!e[fm][i].updateDate){e=dn.tvc}return{ver:e[fm][i].version,udt:e[fm][i].updateDate}}function dJ(){var e=aI.MSV||window.MSV;if(!e||!e.mapstyle||!e.mapstyle.updateDate||!e.mapstyle.version){e=dn.msv}return{ver:e.mapstyle.version,udt:e.mapstyle.updateDate}}function cT(e,fo){var fn=e.slice(0);for(var fm=0;fm<fn.length;fm++){fn[fm]+=fo}return fn}var aw=null;function aP(e){if(aw){return}e.fire(new aB("onloadtile"));aw=setTimeout(function(){aw=null},1000)}function dk(){if(bs("//map.baidu.com")||bs("//maps.baidu.com")||bs("//ditu.baidu.com")){return true}return false}ce.inMapHost=dk();if(typeof window._inMapHost==="boolean"){ce.inMapHost=window._inMapHost}function bs(i){var fm=window.location;var e=document.createElement("a");e.href=i;return e.hostname===fm.hostname&&e.port===fm.port&&e.protocol===fm.protocol}function cH(){}x.extend(cH,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],infowindow:["marker"],groundOverlay:["marker"],simpleInfowindow:["marker"],hotspot:["poly"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"]},MD5Mapping:{control:"eob3t1",marker:"edeydb",poly:"tpg4h3",infowindow:"dc3c2s",simpleInfowindow:"0jfr0f",groundOverlay:"$groundOverlay$",hotspot:"tuqqwn",menu:"1bjwfm",tools:"2fxgj5",oppc:"dwgbac",oppcgl:"q4zfud",mapgl:"masz3u",markeranimation:"vbpjvy",earth:"2p3mrm",glcommon:"lfouax"},Config:{baseUrl:dn.apiHost+"/getmodules?v=1.0&type=webgl",jsModPath:(ce.inMapHost?"":dn.mapHost)+"/res/newui/",timeout:5000},delayFlag:false,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(fp){var fo=[];for(var fr=0,fm=fp.length;fr<fm;fr++){var fq=fp[fr];var e=this.MD5Mapping[fq];var fn="$"+fq+"$";if(e!==fn){fo.push(fq+"_"+e)}}return fo.join(",")},load:function(i,fp,fn){var e=this.getModuleInfo(i);if(e.status===this.Request.COMPLETED){if(fn===true){fp()}}else{if(e.status===this.Request.INITIAL){this.combine(i);this.addToLoadQueue(i);var fm=this;if(fm.delayFlag===false){fm.delayFlag=true;setTimeout(function(){var fq=fm.Config.baseUrl+"&mod="+fm._getMd5ModsStr(fm.Module.modulesNeedToLoad);eZ.load(fq);fm.Module.modulesNeedToLoad.length=0;fm.delayFlag=false},1)}e.status=this.Request.WAITING;function fo(fs){var fr=fm.getModuleInfo(i);if(fr.status!==fm.Request.COMPLETED){if(window.map){var fq=new aB("onmod_timeout");fq.timeout=fs/1000;fq.moduleName=i;window.map.fire(fq)}}}setTimeout(fo,this.Config.timeout,this.Config.timeout);setTimeout(fo,this.Config.timeout*2,this.Config.timeout*2)}e.callbacks.push(fp)}},combine:function(e){if(e&&this.Dependency[e]){var fn=this.Dependency[e];for(var fm=0;fm<fn.length;fm++){this.combine(fn[fm]);if(!this.Module.modules[fn[fm]]){this.addToLoadQueue(fn[fm])}}}},addToLoadQueue:function(e){var i=this.getModuleInfo(e);if(i.status===this.Request.INITIAL){i.status=this.Request.WAITING;this.Module.modulesNeedToLoad.push(e)}},run:function(fm,fn){var fr=this.getModuleInfo(fm);var fu=this.Dependency[fm];if(fu){for(var fp=0;fp<fu.length;fp++){var fq=this.getModuleInfo(fu[fp]);if(fq.status!==this.Request.COMPLETED){fq.modsNeedToRun.push({name:fm,code:fn});return}}}try{eval(fn)}catch(fs){return}fr.status=this.Request.COMPLETED;for(var fp=0,fo=fr.callbacks.length;fp<fo;fp++){fr.callbacks[fp]()}fr.callbacks.length=0;for(fp=0;fp<fr.modsNeedToRun.length;fp++){var ft=fr.modsNeedToRun[fp];this.run(ft.name,ft.code)}fr.modsNeedToRun.length=0},getModuleInfo:function(i){var e;if(!this.Module.modules[i]){this.Module.modules[i]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}}e=this.Module.modules[i];return e}});window._jsload=function(fo,fp){var i=cH.getModuleInfo(fo);i.status=cH.Request.LOADED;if(fp!==""){cH.run(fo,fp)}else{if(window.map){var e=new aB("ongetmodules_fail");e.moduleName=fo;window.map.fire(e)}var fm=document.createElement("script");var fn=cH.MD5Mapping[fo];fm.src=cH.Config.jsModPath+fo+"_"+fn+".js";document.getElementsByTagName("head")[0].appendChild(fm)}};function M(){this._timeData={}}var dt;if(typeof window!=="undefined"){dt=window}else{dt=self}M.prototype.mark=function(e){this._timeData[e]=this._getTime()};M.prototype.getMark=function(e){return this._timeData[e]};M.prototype.getTime=function(i,e){return parseFloat((this._timeData[e]-this._timeData[i]).toFixed(2))};M.prototype.print=function(){};M.prototype.clear=function(){this._timeData={}};if(dt.performance&&dt.performance.now){M.prototype._getTime=function(){return performance.now()}}else{M.prototype._getTime=function(){return Date.now()}}!function(i,fm){fm(i.d3=i.d3||{})}(window,function(fZ){function gh(gp,gq,gn,go){function e(i){return gp(i=new Date(+i)),i}return e.floor=e,e.ceil=function(i){return gp(i=new Date(i-1)),gq(i,1),gp(i),i},e.round=function(i){var gr=e(i),gs=e.ceil(i);return gs-i>i-gr?gr:gs},e.offset=function(i,gr){return gq(i=new Date(+i),null==gr?1:Math.floor(gr)),i},e.range=function(gs,i,gr){var gt=[];if(gs=e.ceil(gs),gr=null==gr?1:Math.floor(gr),!(i>gs&&gr>0)){return gt}do{gt.push(new Date(+gs))}while(gq(gs,gr),gp(gs),i>gs);return gt},e.filter=function(i){return gh(function(gr){for(;gp(gr),!i(gr);){gr.setTime(gr-1)}},function(gr,gs){for(;--gs>=0;){for(;gq(gr,1),!i(gr);){}}})},gn&&(e.count=function(i,gr){return f1.setTime(+i),f5.setTime(+gr),gp(f1),gp(f5),Math.floor(gn(f1,f5))},e.every=function(i){return i=Math.floor(i),isFinite(i)&&i>0?i>1?e.filter(go?function(gr){return go(gr)%i===0}:function(gr){return e.count(0,gr)%i===0}):e:null}),e}function f6(e){return gh(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,gn){i.setDate(i.getDate()+7*gn)},function(i,gn){return(gn-i-(gn.getTimezoneOffset()-i.getTimezoneOffset())*f0)/ge})}function fY(e){return gh(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,gn){i.setUTCDate(i.getUTCDate()+7*gn)},function(i,gn){return(gn-i)/ge})}var f1=new Date,f5=new Date,gc=gh(function(){},function(i,gn){i.setTime(+i+gn)},function(i,gn){return gn-i});gc.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?gh(function(i){i.setTime(Math.floor(i/e)*e)},function(i,gn){i.setTime(+i+gn*e)},function(i,gn){return(gn-i)/e}):gc:null};var gl=gc.range,gj=1000,f0=60000,gg=3600000,f8=86400000,ge=604800000,fs=gh(function(e){e.setTime(Math.floor(e/gj)*gj)},function(i,gn){i.setTime(+i+gn*gj)},function(i,gn){return(gn-i)/gj},function(e){return e.getUTCSeconds()}),gi=fs.range,f7=gh(function(e){e.setTime(Math.floor(e/f0)*f0)},function(i,gn){i.setTime(+i+gn*f0)},function(i,gn){return(gn-i)/f0},function(e){return e.getMinutes()}),fA=f7.range,fU=gh(function(i){var gn=i.getTimezoneOffset()*f0%gg;0>gn&&(gn+=gg),i.setTime(Math.floor((+i-gn)/gg)*gg+gn)},function(i,gn){i.setTime(+i+gn*gg)},function(i,gn){return(gn-i)/gg},function(e){return e.getHours()}),gd=fU.range,fK=gh(function(e){e.setHours(0,0,0,0)},function(i,gn){i.setDate(i.getDate()+gn)},function(i,gn){return(gn-i-(gn.getTimezoneOffset()-i.getTimezoneOffset())*f0)/f8},function(e){return e.getDate()-1}),fr=fK.range,fH=f6(0),fJ=f6(1),fn=f6(2),fF=f6(3),fu=f6(4),fX=f6(5),f4=f6(6),fp=fH.range,fW=fJ.range,fy=fn.range,fT=fF.range,f9=fu.range,fV=fX.range,gk=f4.range,gb=gh(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(i,gn){i.setMonth(i.getMonth()+gn)},function(i,gn){return gn.getMonth()-i.getMonth()+12*(gn.getFullYear()-i.getFullYear())},function(e){return e.getMonth()}),gm=gb.range,fE=gh(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(i,gn){i.setFullYear(i.getFullYear()+gn)},function(i,gn){return gn.getFullYear()-i.getFullYear()},function(e){return e.getFullYear()});fE.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gh(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,gn){i.setFullYear(i.getFullYear()+gn*e)}):null};var fx=fE.range,f2=gh(function(e){e.setUTCSeconds(0,0)},function(i,gn){i.setTime(+i+gn*f0)},function(i,gn){return(gn-i)/f0},function(e){return e.getUTCMinutes()}),fM=f2.range,fL=gh(function(e){e.setUTCMinutes(0,0,0)},function(i,gn){i.setTime(+i+gn*gg)},function(i,gn){return(gn-i)/gg},function(e){return e.getUTCHours()}),fI=fL.range,fG=gh(function(e){e.setUTCHours(0,0,0,0)},function(i,gn){i.setUTCDate(i.getUTCDate()+gn)},function(i,gn){return(gn-i)/f8},function(e){return e.getUTCDate()-1}),fD=fG.range,fC=fY(0),fB=fY(1),fz=fY(2),fw=fY(3),fv=fY(4),fq=fY(5),fo=fY(6),fm=fC.range,fS=fB.range,gf=fz.range,f3=fw.range,ga=fv.range,fR=fq.range,fQ=fo.range,fP=gh(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(i,gn){i.setUTCMonth(i.getUTCMonth()+gn)},function(i,gn){return gn.getUTCMonth()-i.getUTCMonth()+12*(gn.getUTCFullYear()-i.getUTCFullYear())},function(e){return e.getUTCMonth()}),fO=fP.range,ft=gh(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(i,gn){i.setUTCFullYear(i.getUTCFullYear()+gn)},function(i,gn){return gn.getUTCFullYear()-i.getUTCFullYear()},function(e){return e.getUTCFullYear()});ft.every=function(e){return isFinite(e=Math.floor(e))&&e>0?gh(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,gn){i.setUTCFullYear(i.getUTCFullYear()+gn*e)}):null};var fN=ft.range;fZ.timeInterval=gh,fZ.timeMillisecond=gc,fZ.timeMilliseconds=gl,fZ.utcMillisecond=gc,fZ.utcMilliseconds=gl,fZ.timeSecond=fs,fZ.timeSeconds=gi,fZ.utcSecond=fs,fZ.utcSeconds=gi,fZ.timeMinute=f7,fZ.timeMinutes=fA,fZ.timeHour=fU,fZ.timeHours=gd,fZ.timeDay=fK,fZ.timeDays=fr,fZ.timeWeek=fH,fZ.timeWeeks=fp,fZ.timeSunday=fH,fZ.timeSundays=fp,fZ.timeMonday=fJ,fZ.timeMondays=fW,fZ.timeTuesday=fn,fZ.timeTuesdays=fy,fZ.timeWednesday=fF,fZ.timeWednesdays=fT,fZ.timeThursday=fu,fZ.timeThursdays=f9,fZ.timeFriday=fX,fZ.timeFridays=fV,fZ.timeSaturday=f4,fZ.timeSaturdays=gk,fZ.timeMonth=gb,fZ.timeMonths=gm,fZ.timeYear=fE,fZ.timeYears=fx,fZ.utcMinute=f2,fZ.utcMinutes=fM,fZ.utcHour=fL,fZ.utcHours=fI,fZ.utcDay=fG,fZ.utcDays=fD,fZ.utcWeek=fC,fZ.utcWeeks=fm,fZ.utcSunday=fC,fZ.utcSundays=fm,fZ.utcMonday=fB,fZ.utcMondays=fS,fZ.utcTuesday=fz,fZ.utcTuesdays=gf,fZ.utcWednesday=fw,fZ.utcWednesdays=f3,fZ.utcThursday=fv,fZ.utcThursdays=ga,fZ.utcFriday=fq,fZ.utcFridays=fR,fZ.utcSaturday=fo,fZ.utcSaturdays=fQ,fZ.utcMonth=fP,fZ.utcMonths=fO,fZ.utcYear=ft,fZ.utcYears=fN,Object.defineProperty(fZ,"__esModule",{value:!0})});function el(e){this._elemType=e;this._objCollection={}}el.prototype.get=function(){var i=null;for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e]._free===true){this._objCollection[e]._free=false;return this._objCollection[e]}}i=H(this._elemType);e=aI.getGUID("obj_pool_");this._objCollection[e]=i;return i};el.prototype.free=function(e){if(!e){return}e._free=true;if(e.tagName.toLowerCase()==="img"){e.src="";e.crossOrigin=null;e.onload=e.onerror=null}};el.prototype.clear=function(){for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e].tagName.toLowerCase==="img"){this._objCollection[e].onload=this._objCollection[e].onerror=null}}this._objCollection={}};var eZ=(function(e){function i(fp,fm,fo){var fn=H("script",{src:fp,type:"text/javascript",charset:"utf-8"});if(fn.addEventListener){fn.addEventListener("load",function(fr){var fq=fr.target;fq.parentNode.removeChild(fq);fm&&fm()},false);fn.addEventListener("error",function(fq){fo&&fo(null)},false)}else{if(fn.attachEvent){fn.attachEvent("onreadystatechange",function(fr){var fq=window.event.srcElement;if(fq&&(fq.readyState==="loaded"||fq.readyState==="complete")){fq.parentNode.removeChild(fq)}fm&&fm()})}}e.getElementsByTagName("head")[0].appendChild(fn)}return{load:function(fq,fm,fn){if(typeof fq==="string"){i(fq,fm,fn)}else{if(fq.length>0){var fp=fq.length;for(var fo=0;fo<fp;fo++){i(fq[fo],function(){fp--;if(fp===0&&fm){fm()}})}}}}}})(window.document);function bF(){}bF.instances={};bF.getInstance=function(i,fm){if(bF.instances[i]){return bF.instances[i]}var e=new b4(i,fm);bF.instances[i]=e;return e};function b4(e,i){this._name=e;this._baseZoom=18;this._opts={tileSize:256};x.extend(this._opts,i||{})}b4.mapZoomBaseIndex=[0,0,0,8,7,7,6,6,5,5,4,3,3,3,2,2,1,1,0,0,0,0];b4.baseScaleZoom=[19,17,15,12,10,9,7,5,3];b4.baseScaleZoomMercatorSize=[512,2048,4096,32768,65536,262144,1048576,4194304,8388608];b4.mapZoomBaseZoomMapping=[0,0,0,3,5,5,7,7,9,9,10,12,12,12,15,15,17,17,19,19,19,19];b4.mapZoomStartZoomMapping=[0,0,0,3,4,4,6,6,8,8,10,11,11,11,14,14,16,16,18,18,18,18];b4.baseScaleTileSize=[1024,1024,512,512,256,512,512,512,256];b4.mapZoomTileSize=[0,0,0,256,256,512,256,512,256,512,256,256,512,1024,256,512,512,1024,512,1024,2048,4096];b4.baseZoomInfo={"3":[3],"5":[4,5],"7":[6,7],"9":[8,9],"10":[10],"12":[11,12,13],"15":[14,15],"17":[16,17],"19":[18,19,20,21]};b4.prototype={getName:function(){return this._name},getTileSize:function(e){e=Math.floor(e);if(e<3){e=3}if(this._name==="na"){return b4.mapZoomTileSize[e]}return this._opts.tileSize},getBaseTileSize:function(i){i=Math.floor(i);if(this._name==="na"){var e=b4.mapZoomBaseZoomMapping[i];return b4.mapZoomTileSize[e]}return this._opts.tileSize},getDataZoom:function(e){e=Math.floor(e);if(this._name==="na"){return b4.mapZoomBaseZoomMapping[e]}return e},getZoomUnits:function(e){return Math.pow(2,(this._baseZoom-e))},getMercatorSize:function(fm,i){if(this._name==="na"){fm=Math.floor(fm);var e=b4.mapZoomBaseIndex[fm];return b4.baseScaleZoomMercatorSize[e]}return this._opts.tileSize*this.getZoomUnits(i)},getBaseZoom:function(){return this._baseZoom},getParentTile:function(fn,ft,fs,fm,i){if(this._name==="na"){var fo=b4.baseZoomInfo[fs];fm--;if(fo.indexOf(fm)>-1){return{col:fn,row:ft,zoom:fs,useZoom:fm}}else{var fq=b4.mapZoomBaseIndex[fs];var fp=b4.baseScaleZoom[fq+1];if(!fp){return null}var fr=this.getFactorByZooms(fp,fs);var e=b4.baseZoomInfo[fp];return{col:Math.floor(fn/fr),row:Math.floor(ft/fr),zoom:fp,useZoom:e[e.length-1]}}return null}if(fs-1<i){return null}return{col:Math.floor(fn/2),row:Math.floor(ft/2),zoom:fs-1,useZoom:fs-1}},getChildTiles:function(fo,fq,e,fm,fx,fD){if(this._name==="na"){var fn=b4.baseZoomInfo[e];fm+=fD;if(fn.indexOf(fm)>-1){return[{col:fo,row:fq,zoom:e,useZoom:fm}]}else{var fB=0;var fy=e;while(fB<fD){var fC=b4.mapZoomBaseIndex[fy];var fs=b4.baseScaleZoom[fC-1];if(!fs){return null}var ft=b4.baseZoomInfo[fs];if(ft[fD-1]){var fu=[];var fw=this.getFactorByZooms(e,fs);var i=fo*fw;var fv=fq*fw;for(var fA=0;fA<fw;fA++){var fp=i+fA;for(var fz=0;fz<fw;fz++){var fr=fv+fz;fu.push({col:fp,row:fr,zoom:fs,useZoom:ft[fD-1]})}}return fu}fB+=ft.length;if(fD===ft.length){fy=fs}}}return null}var fu=[];if(e+fD>fx){return null}var fw=Math.pow(2,fD);var i=fo*fw;var fv=fq*fw;var fs=e+fD;var fu=[];for(var fA=0;fA<2;fA++){var fp=i+fA;for(var fz=0;fz<2;fz++){var fr=fv+fz;fu.push({col:fp,row:fr,zoom:fs,useZoom:fs})}}return fu},getFactorByZooms:function(i,fn){var fm=b4.mapZoomBaseIndex[i];var fo=b4.mapZoomBaseIndex[fn];var e=b4.baseScaleZoomMercatorSize[fm];var fp=b4.baseScaleZoomMercatorSize[fo];return e/fp}};var aA={};var P=["swiftshader","microsoft basic render driver"];var bp=["intel","nvidia","amd","apple","geforce"];function cd(e){e=e.toLowerCase();if(P.indexOf(e)>=0){return true}if(e.indexOf("mobile")>=0){return true}return false}function dM(fm){fm=fm.toLowerCase();for(var e=0;e<bp.length;e++){if(fm.indexOf(bp[e])>=0){return true}}return false}function cB(e){if(!e){return false}if(cd(e)){return false}if(dM(e)){return true}return false}aA.ifEnableEarth=function(i){var e=aA.ifEnableEarth;if(!i&&typeof e._enable==="boolean"){return e._enable}if(aA.ifSupportWebGL()){e._enable=true;return true}e._enable=false;return false};aA.ifEnableWebGLMap=function(i){var e=aA.ifEnableWebGLMap;if(!i&&typeof e._enable==="boolean"){return e._enable}if(aA.ifSupportWebGL()){if(ce.inMapHost){e._enable=true;return true}else{if(window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder){e._enable=true;return true}else{e._enable=false;return false}}}e._enable=false;return false};aA.params={};aA.ifSupportWebGL=function(){var i=aA.ifSupportWebGL;if(typeof i._supportWebGL==="boolean"){return i._supportWebGL}if(!window.WebGLRenderingContext){i._supportWebGL=false;return false}var fm=document.createElement("canvas");fm.width=300;fm.height=150;var fo=null;var fu={alpha:false,antialias:false,failIfMajorPerformanceCaveat:true,preserveDrawingBuffer:false,stencil:false};try{fo=fm.getContext("webgl",fu)||fm.getContext("experimental-webgl",fu)}catch(fq){i._supportWebGL=false}if(fo===null){i._supportWebGL=false}else{i._supportWebGL=true;var fs=fo.getExtension("WEBGL_debug_renderer_info");if(fs){var fr=fo.getParameter(fs.UNMASKED_RENDERER_WEBGL);if(cB(fr)===true){i._supportWebGL=true}var ft=fo.getParameter(fs.UNMASKED_VENDOR_WEBGL);i._renderer=fr;i._vendor=ft}if(!fs&&x.Browser.firefox){i._supportWebGL=true}if(!fs&&x.Platform.macintosh){i._supportWebGL=true}if(fo.drawingBufferWidth!==fm.width||fo.drawingBufferHeight!==fm.height){i._supportWebGL=false}if(fo.getParameter(fo.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4){i._supportWebGL=false}var fn=fo.getParameter(fo.MAX_TEXTURE_SIZE);aA.params.maxTextureSize=fn;if(fn<4096){i._supportWebGL=false}var fp=fo.getParameter(fo.MAX_TEXTURE_IMAGE_UNITS);if(fp<8){i._supportWebGL=false}if(!fo.getShaderPrecisionFormat||fo.getShaderPrecisionFormat(fo.FRAGMENT_SHADER,fo.HIGH_FLOAT).precision<23){i._supportWebGL=false}}return i._supportWebGL};aA.ifSupportCanvas2d=function(){var fo=aA.ifSupportCanvas2d;if(typeof fo.supportCanvas2d==="boolean"){return fo.supportCanvas2d}var fm=document.createElement("canvas");var i=null;try{i=fm.getContext("2d")}catch(fn){fo.supportCanvas2d=false}if(i===null){fo.supportCanvas2d=false}else{fo.supportCanvas2d=true}return fo.supportCanvas2d};aA.ifEnableCanvas2dMap=function(){var i=navigator.userAgent;var e=0;var fn=0;var fo=0;if(/macintosh/ig.test(i)){var fm=0;if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)){fm=parseInt((RegExp["\x241"]||RegExp["\x242"]),10)}if(fm>0){return false}return true}if(/windows nt (\d+\.\d)/ig.test(i)){fn=parseFloat(RegExp.$1);if(fn>=6.1){if(/chrome\/(\d+\.\d)/i.test(i)){e=parseFloat(RegExp.$1);if(e>=31){return true}}if(/MSIE (\d+(\.\d+)?)/.test(i)){fo=parseFloat(RegExp.$1);if(fo>=10){return true}}if(/Firefox/.test(i)){return true}if(/rv:11.0/ig.test(i)){return true}if(/edge/ig.test(i)){return true}}}return false};aA.ifSupportCSS3=function(fr,i){var fq=document.createElement("div");var fp="Webkit Moz O ms".split(" ");var e=fp.length;var fm="";var fn=fq.style;if(fr in fn){fm=fr}fr=fr.replace(/^[a-z]/,function(fs){return fs.toUpperCase()});while(e--){var fo=fp[e]+fr;if(fo in fn){fm=fo;break}}if(i){return fm}else{return fm.length>0?true:false}};aA.isModernBrowser=aA.ifSupportCanvas2d()&&aA.ifSupportCSS3("transform");function dj(i,e){this._size=i;this._curSize=0;this._cache={};this._least=null;this._most=null;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var fm in e){this._options[fm]=e[fm]}this._getDataTimes=0;this._hitTimes=0}dj.prototype.setData=function(fn,fp){var i=this._cache;var fm=this._size;if(fm===0){return}var e=this._curSize;if(e===fm){this._removeOld()}var fo;if(!i[fn]){fo={key:fn,data:fp,older:null,newwer:null};i[fn]=fo;if(this._least===null){this._least=fo}if(this._most===null){this._most=fo}this._curSize++}else{fo=i[fn];fo.data=fp;if(this._most===fo){return}fo.older&&(fo.older.newer=fo.newer);fo.newer&&(fo.newer.older=fo.older);if(this._least===fo){this._least=fo.newer}}if(this._most&&this._most!==fo){this._most.newer=fo;fo.older=this._most;this._most=fo;fo.newer=null}};dj.prototype.getData=function(e){var i=this._cache[e];this._getDataTimes++;if(i){this._hitTimes++;var fm=i.data;if(this._most===i){return fm}i.older&&(i.older.newer=i.newer);i.newer&&(i.newer.older=i.older);if(this._least===i){this._least=i.newer}this._most.newer=i;i.older=this._most;i.newer=null;this._most=i;return fm}return null};dj.prototype.getAllData=function(){return this._cache};dj.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes};dj.prototype.removeData=function(i){var e=this._cache;var fm=e[i];if(!fm){return}if(this._options.clearCallback){this._options.clearCallback(fm.data,fm.key)}fm.older&&(fm.older.newer=fm.newer);fm.newer&&(fm.newer.older=fm.older);if(this._least===fm){this._least=fm.newer}if(this._most===fm){this._most=fm.older}delete e[i];this._curSize--};dj.prototype._removeOld=function(){var e=this._cache;var fn=Math.round(this._size*0.6);var fm=0;while(this._least&&fm<fn){var i=this._least;this._least=i.newer;i.newer&&(i.newer.older=null);if(this._options.clearCallback){this._options.clearCallback(i.data,i.key)}delete e[i.key];fm++}this._curSize-=fm;if(this._options.removeOldCallback){this._options.removeOldCallback()}};dj.prototype.clear=function(){var e=this._cache;var i=this._least;if(this._options.clearCallback){while(i){this._options.clearCallback(i.data,i.key);i=i.newer}}this._least=this._most=null;this._cache={};this._curSize=0};dj.prototype.forEach=function(e){var i=this._least;while(i){e(i.data);i=i.newer}};dj.prototype.clearExcept=function(i){var e=this._cache;var fm=this._least;while(fm){if(!i[fm.key]){if(this._options.clearCallback){this._options.clearCallback(fm.data,fm.key)}fm.older&&(fm.older.newer=fm.newer);fm.newer&&(fm.newer.older=fm.older);if(this._least===fm){this._least=fm.newer}if(this._most===fm){this._most=fm.older}delete e[fm.key];this._curSize--}fm=fm.newer}};var bA={request:function(fq,fn,i,fs,fm){var fo=(Math.random()*100000).toFixed(0);aI._rd["_cbk"+fo]=function(ft){if(ft.result&&ft.result["error"]&&ft.result["error"]===202){alert("该AK因为恶意行为已经被管理员封禁！");return}i=i||{};fq&&fq(ft,i);delete aI._rd["_cbk"+fo]};fs=fs||"";var fr;if(i&&i.useEncodeURI){fr=eX(fn,encodeURI)}else{fr=eX(fn,encodeURIComponent)}var fp=this;var e=dn.apiHost+"/"+fs+"?"+fr+"&ie=utf-8&oue=1&fromproduct=jsapi";if(!fm){e+="&res=api"}e+="&callback="+cZ+"._rd._cbk"+fo;e+="&ak="+ef;eZ.load(e)}};aI._rd={};function az(){this._map=null;this._container;this._type="control";this.blockInfoWindow=true;this._visible=true}az.inherits(cJ,"Control");x.extend(az.prototype,{initialize:function(e){this._map=e;if(this._container){if(this._opts&&this._opts.container){this._opts.container.appendChild(this._container)}else{e.container.appendChild(this._container)}return this._container}return},_i:function(e){if(!this._container&&this.initialize&&a7(this.initialize)){this._container=this.initialize(e)}this._opts=this._opts||{printable:false};this._setStyle();this._setPosition();if(this._container){this._container._jsobj=this}},_setStyle:function(){var i=this._container;if(i){var e=i.style;e.position="absolute";e.zIndex=this._cZIndex||"10";e.MozUserSelect="none";if(!this._opts.printable){x.ac(i,"BMap_noprint")}x.on(i,"contextmenu",bY)}},remove:function(){this._map=null;if(!this._container){return}this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container._jsobj=null;this._container=null},_render:function(e){if(this._opts&&this._opts.container){this._container=cq(this._opts.container,'<div unselectable="on"></div>')}else{var i='<div unselectable="on"></div>';if(e&&e.config.autoSafeArea&&aN()){this._safeAreaContainer=cq(this._map.container,i);this._safeAreaContainer.style.position="absolute";this._safeAreaContainer.style.bottom="env(safe-area-inset-bottom)";this._container=cq(this._safeAreaContainer,i)}else{this._container=cq(this._map.container,i)}}if(this._visible===false){this._container.style.display="none"}return this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(fn){if(this.anchorFixed||typeof fn!=="number"||isNaN(fn)||fn<BMAP_ANCHOR_TOP_LEFT||fn>BMAP_ANCHOR_BOTTOM_RIGHT){fn=this.defaultAnchor}this._opts.offset=this._opts.offset||this.defaultOffset;var fm=this._opts.anchor;this._opts.anchor=fn;if(!this._container){return}var fp=this._container;var e=this._opts.offset.width;var fo=this._opts.offset.height;fp.style.left=fp.style.top=fp.style.right=fp.style.bottom="auto";switch(fn){case BMAP_ANCHOR_TOP_LEFT:fp.style.top=fo+"px";fp.style.left=e+"px";break;case BMAP_ANCHOR_TOP_RIGHT:fp.style.top=fo+"px";fp.style.right=e+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:fp.style.bottom=fo+"px";fp.style.left=e+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:fp.style.bottom=fo+"px";fp.style.right=e+"px";break;default:break}var i=["TL","TR","BL","BR"];x.rc(this._container,"anchor"+i[fm]);x.ac(this._container,"anchor"+i[fn])},getAnchor:function(){return this._opts.anchor},setOffset:function(e){if(!e){return}this._opts=this._opts||{};this._opts.offset=new cG(e.width,e.height);if(!this._container){return}this.setAnchor(this._opts.anchor)},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){if(this._visible===true){return}this._visible=true;if(this._container){this._container.style.display=""}this.dispatchEvent(new aB("onshow"))},hide:function(){if(this._visible===false){return}this._visible=false;if(this._container){this._container.style.display="none"}this.dispatchEvent(new aB("onhide"))},isPrintable:function(){return !!this._opts.printable},isVisible:function(){if(!this._container&&!this._map){return false}return !!this._visible},_asyncLoadCode:function(){var e=this;cH.load("control",function(){if(e._asyncDraw){e._asyncDraw()}})}});var fc={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3};aI.ControlAnchor=fc;window.BMAP_ANCHOR_TOP_LEFT=0;window.BMAP_ANCHOR_TOP_RIGHT=1;window.BMAP_ANCHOR_BOTTOM_LEFT=2;window.BMAP_ANCHOR_BOTTOM_RIGHT=3;function cp(e){az.call(this);e=e||{};this._opts={printable:false};x.extend(this._opts,e);this._copyrightCollection=[];this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new cG(5,2);this.setAnchor(e.anchor);this._canShow=true;this.sateMapStyle=false;this.blockInfoWindow=false;this._asyncLoadCode()}cp.inherits(az,"CopyrightControl");x.extend(cp.prototype,{initialize:function(e){this._map=e;return this._container},addCopyright:function(fn){var e={minZoom:0,bounds:null,content:"",mapType:""};for(var fm in fn){e[fm]=fn[fm]}if(this._map){var fq=e.minZoom;if(fq===-1||fq<this._map.getMinZoom()||fq>this._map.getMaxZoom()){e.minZoom=this._map.getMinZoom()}if(e.mapType!==""&&!be[e.mapType]){e.mapType=BMAP_NORMAL_MAP}}var fo=this.getCopyright(fn.id);if(fo){for(var fp in e){fo[fp]=e[fp]}}else{this._copyrightCollection.push(e)}},getCopyright:function(fn){for(var fm=0,e=this._copyrightCollection.length;fm<e;fm++){if(this._copyrightCollection[fm].id===fn){return this._copyrightCollection[fm]}}},addSateMapStyle:function(){this.sateMapStyle=true;if(this._container){x.ac(this._container,"BMap_cpyCtrl_w")}},removeSateMapStyle:function(){this.sateMapStyle=false;if(this._container){x.rc(this._container,"BMap_cpyCtrl_w")}}});function eV(e){az.call(this);e=e||{};this._opts={printable:false};this._opts=x.extend(x.extend(this._opts,{unit:"metric"}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new cG(81,18);if(d8()){this.defaultOffset=new cG(75,10)}this.setAnchor(e.anchor);this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}};this.sateMapStyle=false;if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._scaleText=null;this._numberArray={};this._asyncLoadCode()}window.BMAP_UNIT_METRIC="metric";window.BMAP_UNIT_IMPERIAL="us";eV.inherits(az,"ScaleControl");x.extend(eV.prototype,{initialize:function(e){this._map=e;return this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},addSateMapStyle:function(){this.sateMapStyle=true;var e=this._container;if(e){x.ac(e.children[0],"dark")}},removeSateMapStyle:function(){this.sateMapStyle=false;var e=this._container;if(e){x.rc(e.children[0],"dark")}}});window.BMAP_NAVIGATION_CONTROL_LARGE=0;window.BMAP_NAVIGATION_CONTROL_SMALL=1;window.BMAP_NAVIGATION_CONTROL_PAN=2;window.BMAP_NAVIGATION_CONTROL_ZOOM=3;window.BMAP_NAVIGATION_CONTROL_ANIM=4;function cb(e){az.call(this);e=e||{};this._opts={printable:false};x.extend(this._opts,e);this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:(this._opts.forceNew===true)?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:56,zoomHeight:56,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}];this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new cG(10,10);this.setAnchor(e.anchor);this.setType(e.type);this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=10;this._sliderHeight=180;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100";this._asyncLoadCode()}cb.inherits(az,"NavigationControl");x.extend(cb.prototype,{initialize:function(e){this._map=e;return this._container},setType:function(e){if(typeof e=="number"&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&e<=BMAP_NAVIGATION_CONTROL_ANIM){this._opts.type=e}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}},getType:function(){return this._opts.type}});function aT(i){az.call(this);i=i||{};this._opts={printable:false};this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new cG(10,10);this.setAnchor(i.anchor);this._opts=x.extend(x.extend(this._opts,{offset:this.defaultOffset,enableSwitch:true}),i);var e=this;cH.load("control",function(){e._asyncDraw()})}aT.inherits(az,"MapTypeControl");x.extend(aT.prototype,{initialize:function(e){this._map=e;return this._container},showStreetLayer:function(e){this._map.showStreetLayer(e)}});function by(e){az.call(this);e=e||{};this._opts={};this._opts=x.extend(this._opts,e);this._zoomInDisabled=false;this._zoomOutDisabled=false;this._zoomInTapped=false;this._zoomOutTapped=false;this.defaultAnchor=fc.BOTTOM_RIGHT;this.defaultOffset=new cG(10,50);this.setAnchor(e.anchor);this._asyncLoadCode()}by.inherits(az,"ZoomControl");x.extend(by.prototype,{initialize:function(e){this._map=e;return this._container}});function aR(e){az.call(this);e=e||{};this._opts={autoZoom:true,autoViewport:true};this._opts=x.extend(this._opts,e);this.defaultAnchor=fc.BOTTOM_LEFT;this.defaultOffset=new cG(10,50);this.watchPosition=this._opts.watchPosition||false;this.useCompass=this._opts.useCompass||false;this.locMarker=null;this.locLevel=16;this.setAnchor(this._opts.anchor);this.onLocationStart=e.onLocationStart||null;this._asyncLoadCode()}aR.inherits(az,"LocationControl");x.extend(aR.prototype,{initialize:function(e){this._map=e;return this._container},startLocation:function(){this._startLocationCalled=true},stopLocationTrace:function(){},setOptions:function(e){e=e||{};x.extend(this._opts,e)}});function O(e){az.call(this);e=e||{};this._opts={};this._opts=x.extend(this._opts,e);this.defaultAnchor=fc.BOTTOM_LEFT;this.defaultOffset=new cG(1,15);if(d8()){this.defaultOffset=new cG(1,1)}this.setAnchor(e.anchor)}O.inherits(az,"LogoControl");x.extend(O.prototype,{initialize:function(i){this._map=i;var e=this._container=document.createElement("div");e.innerHTML='<img src="'+dn.apiHost+'/images/copyright_logo.png" />';i.getContainer().appendChild(e);return e}});function ev(e,i){this._map=e;this._indoorInfo=i;this._visible=true;this._adjustVisible=true;this._isMobile=d8();this._sizeConfig={FLOOR_BTN_HEIGHT:this._isMobile?35:26,SWITCH_ARROW_HEIGHT:this._isMobile?20:15};this._init()}ev.prototype._init=function(){this._render();this._bindDom();this._bind();this._adjustDisplayHeight();var e=new aB("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};ev.prototype._render=function(){if(!this._indoorInfo){return}var fr=this._isMobile;var e=this._div=H("div");x.ac(e,"floor-select-container");fr&&x.ac(e,"mobile");fr&&x.ac(e,"all-border-radius");var i=this._btnTop=H("button");x.ac(i,"floor-switch-top");x.ac(i,"top-border-radius");var fp=H("div");x.ac(fp,"floor-switch-top-icon");i.appendChild(fp);var fo=this._btnBottom=H("button");var fm=H("div");x.ac(fm,"floor-switch-bottom-icon");fo.appendChild(fm);x.ac(fo,"floor-switch-bottom");x.ac(fo,"bottom-border-radius");var fn=this._floorsContainer=H("div");x.ac(fn,"floors-container");fn.appendChild(this._createFloorsDom());this._div.appendChild(i);this._div.appendChild(fn);this._div.appendChild(fo);var fs=0;if(this._btnTop.style.display===""){fs=2*this._sizeConfig.SWITCH_ARROW_HEIGHT}this._div.style.height=parseInt(this._floorsContainer.style.height,10)+fs+"px";this._map.getContainer().appendChild(this._div);if(!fr){var fq=this;setTimeout(function(){fq._div.style.right="20px"},20)}};ev.prototype._createFloorsDom=function(){if(!this._indoorInfo){return}var fm=this._ol=H("ol");var fp=this._indoorInfo.currentFloor;for(var fo=this._indoorInfo.floors.length-1;fo>=0;fo--){var fq=this._indoorInfo.floors[fo].floorName;var e=H("li");var fn=H("button");x.ac(fn,"btn-select-floor");if(fo===fp){x.ac(fn,"selected")}fn.setAttribute("data-floor",fo);fn.innerHTML=fq;e.appendChild(fn);fm.appendChild(e)}return fm};ev.prototype._updateUI=function(){if(!this._ol){this._render();this._bind();this._adjustDisplayHeight();return}this._ol=null;this._ol=this._createFloorsDom();this._floorsContainer.innerHTML="";this._floorsContainer.appendChild(this._ol);this._adjustDisplayHeight()};ev.prototype._bindDom=function(){var e=this;x.on(this._floorsContainer,"click",function(fn){var fm=fn.target||fn.srcElement;if(fm.tagName.toLowerCase()==="button"){e._map.showIndoor(e._indoorInfo.uid,parseInt(fm.getAttribute("data-floor"),10));var i=new aB("onindoor_bar_click");i.uid=e._indoorInfo.uid;e._map.dispatchEvent(i)}});x.on(this._floorsContainer,"mouseover",function(fm){var i=fm.target;if(i.tagName.toLowerCase()==="button"){x.ac(i,"hover")}});x.on(this._floorsContainer,"mouseout",function(fm){var i=fm.target;if(i.tagName.toLowerCase()==="button"){x.rc(i,"hover")}});x.on(this._floorsContainer,"touchstart",function(fm){var i=fm.target;if(i.tagName.toLowerCase()==="button"){x.ac(i,"onmousedown")}});x.on(this._floorsContainer,"touchend",function(fm){var i=fm.target;if(i.tagName.toLowerCase()==="button"){x.rc(i,"onmousedown")}});x.on(this._btnTop,"mouseover",function(i){if(this._disable){return}x.ac(this,"hover")});x.on(this._btnTop,"mouseout",function(i){x.rc(this,"hover")});x.on(this._btnBottom,"mouseover",function(i){if(this._disable){return}x.ac(this,"hover")});x.on(this._btnBottom,"mouseout",function(i){x.rc(this,"hover")});x.on(this._btnTop,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}x.ac(this,"onmousedown")});x.on(this._btnTop,"touchend",function(i){x.rc(this,"onmousedown")});x.on(this._btnBottom,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}x.ac(this,"onmousedown")});x.on(this._btnBottom,"touchend",function(i){x.rc(this,"onmousedown")});x.on(this._btnTop,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)+26)});x.on(this._btnBottom,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)-26)});x.on(this._div,"mousemove",g);x.on(this._div,"wheel",bY);x.on(this._div,"mousewheel",bY);this._map.addEventListener("resize",function(){e._adjustDisplayHeight()})};ev.prototype._adjustDisplayHeight=function(){if(!this._indoorInfo){return}var fp=this._map.getSize().height;var fq=this._sizeConfig.FLOOR_BTN_HEIGHT;var fr=fp-291-100;if(this._isMobile){fr=fp-12-108-this._map.config.bottomOffset}var e=this._indoorInfo.floors.length;var fm=e*fq;var fn=e;var ft=0;var fu=this._floorsContainer.children[0];if(fm>fr){this._showArrow=true;x.rc(fu.children[0].children[0],"top-border-radius");x.rc(fu.children[e-1].children[0],"bottom-border-radius")}else{this._showArrow=false;x.ac(fu.children[0].children[0],"top-border-radius");x.ac(fu.children[e-1].children[0],"bottom-border-radius")}while(fm>fr){if(fn===0){break}fn--;ft=2*this._sizeConfig.SWITCH_ARROW_HEIGHT;fm=fn*fq+ft}this._currentDisplayHeight=fm;if(fn<3){this._setAdjustVisbile(false)}else{this._setAdjustVisbile(true)}this._floorsContainer.style.height=fn*fq+"px";var fo=this._indoorInfo.currentFloor;var i=e-fo;var fs=fo-1;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+ft+"px";var fv=-(e-(fo+Math.round(fn/2)))*fq;this._setBarSliderTop(fv);if(fn<e){x.show(this._btnTop);x.show(this._btnBottom)}else{x.hide(this._btnTop);x.hide(this._btnBottom);this._setBarSliderTop(0)}if(this._isMobile){this._div.style.bottom=108+this._map.config.bottomOffset+"px"}};ev.prototype._setBarSliderTop=function(fn){var fm=26;var i=this._indoorInfo.floors.length;var e=i*fm;if(this._currentDisplayHeight){if(this._showArrow){e=this._currentDisplayHeight-30}else{e=this._currentDisplayHeight}}if(e-fn>=i*fm){fn=e-i*fm;x.ac(this._btnBottom,"disable");x.rc(this._btnBottom,"hover");this._btnBottom._disable=true}else{x.rc(this._btnBottom,"disable");this._btnBottom._disable=false}if(fn>=0){fn=0;x.ac(this._btnTop,"disable");x.rc(this._btnTop,"hover");this._btnTop._disable=true}else{x.rc(this._btnTop,"disable");this._btnTop._disable=false}this._ol.style.top=fn+"px"};ev.prototype._setAdjustVisbile=function(e){if(this._adjustVisible===e){return}this._adjustVisible=e;if(e&&this._visible){this._div.style.right="20px"}else{this._div.style.right="-30px"}};ev.prototype._bind=function(){var i=this._map;var e=this;i.on("indoor_status_changed",function(fr){if(e._visible===false){return}var fm=e._ol;var fp=fr.uid;if(!fp){return}var fq=fr.floor;for(var fo=0;fo<fm.children.length;fo++){var fn=fm.children[fo].children[0];if(parseInt(fn.getAttribute("data-floor"),10)===fq){x.ac(fn,"selected")}else{x.rc(fn,"selected")}}});i.on("zoomend",function(fm){if(this.getZoom()<17){e._setAdjustVisbile(false)}else{e._setAdjustVisbile(true)}})};ev.prototype.setInfo=function(e){if(this._indoorInfo&&this._indoorInfo.uid===e.uid){return}this._indoorInfo=e;this._updateUI()};ev.prototype.show=function(){if(this._visible===true){return}this._visible=true;if(!this._isMobile){this._div.style.right="20px"}else{this._div.style.display=""}var e=new aB("onindoor_bar_show");e.uid=this._indoorInfo.uid;this._map.dispatchEvent(e)};ev.prototype.hide=function(){if(this._visible===false){return}this._visible=false;if(!this._isMobile){this._div.style.right="-30px"}else{this._div.style.display="none"}};function df(){this._opts={};this.defaultOffset=new cG(0,80);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_RIGHT;this._firstAnimation=true}df.inherits(az,"NavigationControl3D");x.extend(df.prototype,{initialize:function(fm){this._map=fm;this._createDom();this._bindDom();this._bind();if(!d8()){this._headingControl=new fe(this._map,this._div)}this._tiltControl=new cU(this._map,this._div);this._render();var i=this._map.getMapType();var e=this;if(i==="B_EARTH_MAP"||this._map._renderType==="webgl"){e._div.style.opacity="1";e._div.style.visibility="visible"}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}return this._container},_createDom:function(){var i=this._div=document.createElement("div");this._container=i;var e=i.style;e.position="absolute";e.zIndex=5;e.width="52px";e.height="82px";e.right="-3px";e.bottom="79px";e.opacity="0";e.visibility="hidden";e.WebkitTransition=e.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var e=document.getElementById("map-operate");if(e){e.appendChild(this._div)}else{this._map.getContainer().appendChild(this._div)}},_bindDom:function(){this._div.addEventListener("mousemove",g)},_bind:function(){if(this._map._renderType==="webgl"){return}var e=this;this._map.on("maptypechange",function(){if(this.mapType==="B_EARTH_MAP"){if(e._firstAnimation){e._firstAnimation=false;setTimeout(function(){e._div.style.opacity="1";e._div.style.visibility="visible"},300)}else{e._div.style.opacity="1";e._div.style.visibility="visible"}}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}})}});function fe(fm,i){this._map=fm;this._target=fm;var fn=fm.temp.originMapType||fm.mapType;if(fn==="B_EARTH_MAP"&&fm._earth){this._target=fm._earth}this._outContainer=i||fm.getContainer();this._imgRatio=ay()>=1.5?2:1;this._imgPath=dn.imgPath+"earth-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setHeadingOptions={callback:function(){e._target.setLock(false)}};this._init()}x.extend(fe.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._updateUI();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableHeadingZoom){this.enable()}else{this.disable()}},_createDom:function(){var i=this._div=H("div");var e=i.style;e.position="absolute";e.zIndex=5;e.top="0";e.left="0";e.width="52px";e.height="54px";e.background="url("+this._imgPath+") no-repeat";e.backgroundSize="266px auto";this._rotateCCW=this._createButton();this._rotateCCW.title="逆时针转动";e=this._rotateCCW.style;e.left="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";this._rotateCW=this._createButton();this._rotateCW.title="顺时针转动";e=this._rotateCW.style;e.right="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";e.WebkitTransform=e.transform="scaleX(-1)";this._compass=this._createButton();this._compass.title="恢复正北方向";e=this._compass.style;e.left="19px";e.top="4px";e.width="14px";e.height="44px";e.backgroundPosition="-56px -4px";e.WebkitTransform=e.transform="rotate(0deg)";this._div.appendChild(this._rotateCCW);this._div.appendChild(this._compass);this._div.appendChild(this._rotateCW);this._domRendered=true},_createButton:function(){var e=H("button");var i=e.style;i.position="absolute";i.outline="none";i.border="none";i.background="url("+this._imgPath+") no-repeat";i.backgroundSize="266px auto";i.cursor="pointer";return e},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=true;if(this._domRendered){this._rotateCCW.style.cursor="pointer";this._rotateCCW.style.opacity=1;this._rotateCW.style.cursor="pointer";this._rotateCW.style.opacity=1;this._compass.style.cursor="pointer";this._compass.style.opacity=1}},disable:function(){this._enabled=false;if(this._domRendered){this._rotateCCW.style.cursor="";this._rotateCCW.style.opacity=0.4;this._rotateCW.style.cursor="";this._rotateCW.style.opacity=0.4;this._compass.style.cursor="";this._compass.style.opacity=0.4}},_bindDom:function(){c5(this._div,["mousedown","click","dblclick"]);var i=this._map;var e=this;this._rotateCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()+90,e._setHeadingOptions);i.fire(new aB("onrotatecwclick"))},false);this._rotateCCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===-360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()-90,e._setHeadingOptions);i.fire(new aB("onrotateccwclick"))},false);this._rotateCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._rotateCCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._compass.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}e._target.setLock(true);var fm=false;if(e._target.getTilt()!==0){fm=true;e._target.setTilt(0,e._setHeadingOptions)}if(e._target.getHeading()%360!==0){fm=true;e._target.resetHeading(e._setHeadingOptions)}if(!fm){e._target.setLock(false)}i.fire(new aB("oncompassclick"))},false)},_bind:function(){var e=this;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(i){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.addEventListener("heading_changed",function(fm){e._updateUI()});i.addEventListener("animation_start",function(fm){e._isOperating=true});i.addEventListener("animation_end",function(fm){e._isOperating=false});i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var e=this._target.getHeading();var i=this._compass.style;i.WebkitTransform=i.transform="rotate("+e+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function cU(fm,i){this._map=fm;this._target=fm;var fn=fm.temp.originMapType||fm.mapType;if(fn==="B_EARTH_MAP"&&fm._earth){this._target=fm._earth}this._outContainer=i||fm.getContainer();this._imgRatio=ay()>=1.5?2:1;this._imgPath=dn.imgPath+"gl-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setTiltOptions={callback:function(){e._target.setLock(false)}};this._init()}x.extend(cU.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableTiltZoom){this.enable()}else{this.disable()}},_createDom:function(){var e=this._div=H("button");e.title="倾斜";var i=e.style;i.position="absolute";i.zIndex=5;i.outline="none";i.border="none";i.cursor="pointer";i.width="26px";i.height="26px";i.top="56px";i.right="13px";i.background="url("+this._imgPath+") no-repeat #fff";i.backgroundSize="266px auto";i.backgroundPosition="-110px 1px";i.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=true;if(this._div){this._div.style.cursor="pointer"}this._updateUI()},disable:function(){this._enabled=false;if(this._div){this._div.style.cursor=""}this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var e=this;this._div.addEventListener("mousedown",function(fn){if(!e._enabled){return}if(e._target.getLock()){return}var i=e._target.getTilt();var fm;if(i===e._map.getCurrentMaxTilt()){fm="out"}else{if(i===0){fm="in"}else{fm=e._preTrend?e._preTrend:"in"}}e._curTrend=fm;e._clickTimer=setTimeout(function(){e._map.fire(new aB("ontiltmsdown"));e._tiltAni=new l({duration:9999999,render:function(fo){i=e._target.getTilt();if(fm==="in"&&i<e._map.getCurrentMaxTilt()){e._target.setTilt(i+1,{noAnimation:true})}else{if(fm==="out"&&i>0){e._target.setTilt(i-1,{noAnimation:true})}}},finish:function(){e._tiltAni=null}});e._clickTimer=null},200);fn.stopPropagation()},false);this._div.addEventListener("mouseup",function(i){if(!e._enabled){return}if(e._tiltAni){e._tiltAni.stop()}e._preTrend=e._curTrend},false);this._div.addEventListener("click",function(fn){if(!e._enabled){return}if(!e._clickTimer){return}if(e._target.getLock()){return}clearTimeout(e._clickTimer);e._map.fire(new aB("ontiltclick"));var i=e._target.getTilt();e._target.setLock(true);fn.stopPropagation();var fm=e._map.getCurrentMaxTilt();if(e._curTrend==="in"){e._target.setTilt(fm,e._setTiltOptions)}else{if(e._curTrend==="out"){e._target.setTilt(0,e._setTiltOptions)}else{if(i<fm){e._target.setTilt(fm,e._setTiltOptions)}else{e._target.setTilt(0,e._setTiltOptions)}}}},false);this._div.addEventListener("mouseover",function(i){if(!e._enabled){return}e._mouseOver=true;e._updateUI()},false);this._div.addEventListener("mouseout",function(i){if(!e._enabled){return}e._mouseOver=false;e._updateUI()},false);c5(this._div,["mousedown","click","dblclick"])},_bind:function(){var e=this;var i=this._map;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(fm){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});i.on("tilt_changed",function(){e._updateUI()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var fm=this._target.getTilt();var i=0;var fn=0;var e=0;if(fm>0){i=78}if(this._mouseOver){e=52}if(this._enabled===false){fn=26;e=0;i=0}var fo="-"+(110+i+fn+e)+"px 1px";this._div&&(this._div.style.backgroundPosition=fo);if(this._enabled){if(fm>0){this._div&&(this._div.title="恢复")}else{this._div&&(this._div.title="倾斜")}}else{this._div&&(this._div.title="请放大地图后操作")}},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function bl(i){cJ.call(this);this._opts={container:null,cursor:"default"};this._opts=x.extend(this._opts,i);this._type="contextmenu";this._map=null;this._container;this._left=0;this._top=0;this._items=[];this._rItems=[];this._dividers=[];this._enable=true;this.curPixel=null;this.curPoint=null;this._isOpen=false;var e=this;cH.load("menu",function(){e._draw()})}bl.inherits(cJ,"ContextMenu");x.extend(bl.prototype,{initialize:function(e){this._map=e},remove:function(){this._map=null},addItem:function(fo,e){if(!fo||fo._type!="menuitem"||fo._text==""||fo._width<=0){return}for(var fn=0,fm=this._items.length;fn<fm;fn++){if(this._items[fn]===fo){return}}if(e===undefined||e>this._items.length-1){e=-1}fo._insertIndex=e;if(e===-1){this._items.push(fo);this._rItems.push(fo)}else{this._items.splice(e,0,fo);this._rItems.splice(e,0,fo)}},removeItem:function(fn){if(!fn||fn._type!="menuitem"){return}for(var fm=0,e=this._items.length;fm<e;fm++){if(this._items[fm]===fn){this._items[fm].remove();this._items.splice(fm,1);delete fn._insertIndex;e--}}for(var fm=0,e=this._rItems.length;fm<e;fm++){if(this._rItems[fm]===fn){this._rItems[fm].remove();this._rItems.splice(fm,1);delete fn._insertIndex;e--}}},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var i={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(e===-1){this._items.push(i)}else{this._items.splice(e,0,i)}},removeSeparator:function(fm){if(!this._dividers[fm]){return}for(var fn=0,e=this._items.length;fn<e;fn++){if(this._items[fn]&&this._items[fn]._type=="divider"&&this._items[fn]._dIndex==fm){this._items.splice(fn,1);e--}if(this._items[fn]&&this._items[fn]._type=="divider"&&this._items[fn]._dIndex>fm){this._items[fn]._dIndex--}}this._dividers.splice(fm,1)},getDom:function(){return this._container},show:function(){if(this._isOpen==true){return}this._isOpen=true},hide:function(){if(this._isOpen==false){return}this._isOpen=false},setCursor:function(e){if(!e){return}this._opts.cursor=e},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=true},disable:function(){this._enable=false}});function dI(fm,fn,i){if(!fm||!fn||typeof fn!="function"){return}cJ.call(this);this._opts={width:100,id:""};i=i||{};this._opts.width=(i.width*1)?i.width:100;this._opts.id=i.id?i.id:"";this._text=fm+"";this._callback=fn;this._map=null;this._type="menuitem";this._contextmenu=null;this._container=null;this._enabled=true;var e=this;cH.load("menu",function(){e._draw()})}dI.inherits(cJ,"MenuItem");x.extend(dI.prototype,{initialize:function(e,i){this._map=e;this._contextmenu=i},remove:function(){this._contextmenu=null;this._map=null},setText:function(e){if(!e){return}this._text=e+""},getDom:function(){return this._container},enable:function(){this._enabled=true},disable:function(){this._enabled=false}});function cv(e,i){this.setSouthWest(e);this.setNorthEast(i)}x.extend(cv.prototype,{isEmpty:function(){return this.sw===null&&this.ne===null},equals:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return this.sw.equals(e.sw)&&this.ne.equals(e.ne)},containsBounds:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return(e.sw.lng>this.sw.lng&&e.ne.lng<this.ne.lng&&e.sw.lat>this.sw.lat&&e.ne.lat<this.ne.lat)},getCenter:function(){if(this.isEmpty()){return null}return new e4((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)},intersects:function(fm){if(!fm||fm.isEmpty()||this.isEmpty()){return null}if(Math.max(fm.sw.lng,fm.ne.lng)<Math.min(this.sw.lng,this.ne.lng)||Math.min(fm.sw.lng,fm.ne.lng)>Math.max(this.sw.lng,this.ne.lng)||Math.max(fm.sw.lat,fm.ne.lat)<Math.min(this.sw.lat,this.ne.lat)||Math.min(fm.sw.lat,fm.ne.lat)>Math.max(this.sw.lat,this.ne.lat)){return null}var fo=Math.max(this.sw.lng,fm.sw.lng);var i=Math.min(this.ne.lng,fm.ne.lng);var fn=Math.max(this.sw.lat,fm.sw.lat);var e=Math.min(this.ne.lat,fm.ne.lat);return new cv(new e4(fo,fn),new e4(i,e))},setMinMax:function(){this.minX=this.sw?this.sw.lng:null;this.minY=this.sw?this.sw.lat:null;this.maxX=this.ne?this.ne.lng:null;this.maxY=this.ne?this.ne.lat:null},containsPoint:function(e){if(!e){return}return(e.lng>=this.sw.lng&&e.lng<=this.ne.lng&&e.lat>=this.sw.lat&&e.lat<=this.ne.lat)},extend:function(e){if(!e){return}var i=e.lng;var fm=e.lat;if(!this.sw){this.sw=e.clone()}if(!this.ne){this.ne=e.clone()}if(this.sw.lng>i){this.sw.lng=i}if(this.ne.lng<i){this.ne.lng=i}if(this.sw.lat>fm){this.sw.lat=fm}if(this.ne.lat<fm){this.ne.lat=fm}},getMin:function(){return this.sw},getMax:function(){return this.ne},getSouthWest:function(){return this.sw},getNorthEast:function(){return this.ne},setSouthWest:function(e){this.sw=e?e.clone():null},setNorthEast:function(e){this.ne=e?e.clone():null},clone:function(){return new cv(this.sw,this.ne)},toSpan:function(){if(this.isEmpty()){return new cG(0,0)}return new cG(Math.abs(this.ne.lng-this.sw.lng),Math.abs(this.ne.lat-this.sw.lat))},div:function(e){if(!e||e.isEmpty()||this.isEmpty()){return 0}return((this.ne.lng-this.sw.lng)*(this.ne.lat-this.sw.lat))/((e.ne.lng-e.sw.lng)*(e.ne.lat-e.sw.lat))},makeNormalizedPoint:function(e){this.normalizedTopLeft=this.pointTopLeft.clone();this.normalizedTopRight=this.pointTopRight.clone();this.normalizedBottomRight=this.pointBottomRight.clone();this.normalizedBottomLeft=this.pointBottomLeft.clone();while(e<0){e+=360}e=e%360;if(e>=0&&e<90||e>=270&&e<360){if(this.normalizedTopRight.lng<this.normalizedTopLeft.lng){this.normalizedTopRight.lng+=bV.WORLD_SIZE_MC}if(this.normalizedBottomRight.lng<this.normalizedBottomLeft.lng){this.normalizedBottomRight.lng+=bV.WORLD_SIZE_MC}}else{if(this.normalizedTopLeft.lng<this.normalizedTopRight.lng){this.normalizedTopLeft.lng+=bV.WORLD_SIZE_MC}if(this.normalizedBottomLeft.lng<this.normalizedBottomRight.lng){this.normalizedBottomLeft.lng+=bV.WORLD_SIZE_MC}}},toString:function(){return"Bounds"}});function e4(e,i){if(isNaN(e)){e=eN(e);e=isNaN(e)?0:e}if(typeof e==="string"){e=parseFloat(e)}if(isNaN(i)){i=eN(i);i=isNaN(i)?0:i}if(typeof i==="string"){i=parseFloat(i)}this.lng=e;this.lat=i}e4.prototype.equals=function(i){if(!i){return false}var fn=Math.abs(this.lat-i.lat);var fm=Math.abs(this.lng-i.lng);var e=1e-8;if(fn<e&&fm<e){return true}return false};e4.prototype.clone=function(){return new e4(this.lng,this.lat)};e4.prototype.add=function(e){return new e4(this.lng+e.lng,this.lat+e.lat)};e4.prototype.sub=function(e){return new e4(this.lng-e.lng,this.lat-e.lat)};e4.prototype.mult=function(e){return new e4(this.lng*e,this.lat*e)};e4.prototype.div=function(e){return new e4(this.lng/e,this.lat/e)};e4.prototype.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)};e4.prototype.toString=function(){return"Point"};function cQ(){}x.extend(cQ,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[86,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],LL2MC:[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]],getDistanceByMC:function(fp,fn){if(!fp||!fn){return 0}var i;var fo;var e;var fm;fp=this.convertMC2LL(fp);if(!fp){return 0}i=cr(fp.lng);fo=cr(fp.lat);fn=this.convertMC2LL(fn);if(!fn){return 0}e=cr(fn.lng);fm=cr(fn.lat);return this.getDistance(i,e,fo,fm)},getDistanceByLL:function(fp,fn){if(!fp||!fn){return 0}fp.lng=this.getLoop(fp.lng,-180,180);fp.lat=this.getRange(fp.lat,-80,84);fn.lng=this.getLoop(fn.lng,-180,180);fn.lat=this.getRange(fn.lat,-80,84);var i;var e;var fo;var fm;i=cr(fp.lng);fo=cr(fp.lat);e=cr(fn.lng);fm=cr(fn.lat);return this.getDistance(i,e,fo,fm)},convertMC2LL:function(e){if(e===null){return e}if(!e){return new e4(0,0)}var fm;var fo;fm=new e4(Math.abs(e.lng),Math.abs(e.lat));for(var fn=0;fn<this.MCBAND.length;fn++){if(fm.lat>=this.MCBAND[fn]){fo=this.MC2LL[fn];break}}var fp=this.convertor(e,fo);return new bS(fp.lat,fp.lng)},convertLL2MC:function(fq){if(!fq){return new e4(0,0)}var fs=fq.lat;var fn=fq.lng;fn=this.getLoop(fq.lng,-180,180);fs=dN(fs,-85,85);var fp;for(var fo=0;fo<this.LLBAND.length;fo++){if(fs>=this.LLBAND[fo]){fp=this.LL2MC[fo];break}}if(!fp){for(fo=0;fo<this.LLBAND.length;fo++){if(fs<=-this.LLBAND[fo]){fp=this.LL2MC[fo];break}}}var fm=new e4(fn,fs);var fr=this.convertor(fm,fp);var e=new e4(fr.lng,fr.lat);e.latLng=fq.clone();return e},convertor:function(fm,fn){if(!fm||!fn){return}var e=fn[0]+fn[1]*Math.abs(fm.lng);var i=Math.abs(fm.lat)/fn[9];var fo=fn[2]+fn[3]*i+fn[4]*i*i+fn[5]*i*i*i+fn[6]*i*i*i*i+fn[7]*i*i*i*i*i+fn[8]*i*i*i*i*i*i;e*=(fm.lng<0?-1:1);fo*=(fm.lat<0?-1:1);return new e4(e,fo)},getDistance:function(i,e,fn,fm){return this.EARTHRADIUS*Math.acos((Math.sin(fn)*Math.sin(fm)+Math.cos(fn)*Math.cos(fm)*Math.cos(e-i)))},getRange:function(fm,i,e){if(i!=null){fm=Math.max(fm,i)}if(e!=null){fm=Math.min(fm,e)}return fm},getLoop:function(fm,i,e){while(fm>e){fm-=e-i}while(fm<i){fm+=e-i}return fm}});function bS(i,e){if(i<-90){i=-90}else{if(i>90){i=90}}while(e<-180){e+=360}while(e>180){e-=360}this.lat=i||0;this.lng=e||0}x.extend(bS.prototype,{equals:function(e){return(this.lat===e.lat&&this.lng===e.lng)},clone:function(){return new bS(this.lat,this.lng)},getLngSpan:function(e){var i=this.lng;var fm=Math.abs(e-i);if(fm>180){fm=360-fm}return fm},sub:function(e){return new bS(this.lat-e.lat,this.lng-e.lng)},toString:function(){return this.lat+", "+this.lng}});function c3(e,i){if(e&&!i){i=e}this._sw=this._ne=null;this._swLng=this._swLat=null;this._neLng=this._neLat=null;if(e){this._sw=new bS(e.lat,e.lng);this._ne=new bS(i.lat,i.lng);this._swLng=e.lng;this._swLat=e.lat;this._neLng=i.lng;this._neLat=i.lat}}x.extend(c3.prototype,{isEmpty:function(){return !this._sw||!this._ne},equals:function(e){if(this.isEmpty()){return false}return this.getSouthWest().equals(e.getSouthWest())&&this.getNorthEast().equals(e.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(e){if(this.isEmpty()||e.isEmpty()){return false}return(e._swLng>this._swLng&&e._neLng<this._neLng&&e._swLat>this._swLat&&e._neLat<this._neLat)},getCenter:function(){if(this.isEmpty()){return null}return new bS((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(fm){if(Math.max(fm._swLng,fm._neLng)<Math.min(this._swLng,this._neLng)||Math.min(fm._swLng,fm._neLng)>Math.max(this._swLng,this._neLng)||Math.max(fm._swLat,fm._neLat)<Math.min(this._swLat,this._neLat)||Math.min(fm._swLat,fm._neLat)>Math.max(this._swLat,this._neLat)){return false}var fo=Math.max(this._swLng,fm._swLng);var i=Math.min(this._neLng,fm._neLng);var fn=Math.max(this._swLat,fm._swLat);var e=Math.min(this._neLat,fm._neLat);this._sw=new bS(fn,fo);this._ne=new bS(e,i);this._swLng=fo;this._swLat=fn;this._neLng=i;this._neLat=e;return true},containsPoint:function(e){if(this.isEmpty()){return false}return(e.lng>=this._swLng&&e.lng<=this._neLng&&e.lat>=this._swLat&&e.lat<=this._neLat)},extend:function(e){var i=e.lng;var fm=e.lat;if(!this._sw){this._sw=new bS(0,0)}if(!this._ne){this._ne=new bS(0,0)}if(!this._swLng||this._swLng>i){this._sw.lng=this._swLng=i}if(!this._neLng||this._neLng<i){this._ne.lng=this._neLng=i}if(!this._swLat||this._swLat>fm){this._sw.lat=this._swLat=fm}if(!this._neLat||this._neLat<fm){this._ne.lat=this._neLat=fm}},toSpan:function(){if(this.isEmpty()){return new bS(0,0)}return new bS(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(i){if(i.isEmpty()){return false}var e=i.getSouthWest();var fm=i.getNorthEast();if(this._swLat>e.lat){this._swLat=e.lat}if(this._swLng>e.lng){this._swLng=e.lng}if(this._neLat<fm.lat){this._neLat=fm.lat}if(this._neLng<fm.lng){this._neLng=fm.lng}this._sw=new bS(this._swLat,this._swLng);this._ne=new bS(this._neLat,this._neLng);return true},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});var cx={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}};var cN={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:false,show:function(e){if(!this._map){this._map=e}this.inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(i){if(!this._map){this._map=i}if(!this._map){return}var e=this._maskElement=cq(this._map.container,this._html);x.on(e,"mouseup",function(fm){if(fm.button==2){bY(fm)}});x.on(e,"contextmenu",bY);e.style.display="none"},getDrawPoint:function(fn,fq,fo){fn=window.event||fn;var i=fn.offsetX||fn.layerX||0;var fp=parseInt(fn.offsetY)||parseInt(fn.layerY)||0;var fm=fn.target||fn.srcElement;if(fm!=cN.getDom(this._map)&&fq==true){while(fm&&fm!=this._map.container){if(!(fm.clientWidth==0&&fm.clientHeight==0&&fm.offsetParent&&fm.offsetParent.nodeName.toLowerCase()=="td")){i+=fm.offsetLeft;fp+=fm.offsetTop}fm=fm.offsetParent}}if(fm!=cN.getDom(this._map)&&fm!=this._map.container){return}if(typeof i==="undefined"||typeof fp==="undefined"){return}if(isNaN(i)||isNaN(fp)){return}if(fo){i=i+fo.x;fp=fp+fo.y}return this._map.pixelToPointIn(new cO(i,fp))},hide:function(){if(!this._map){return}this.inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function aH(){this._type="overlay"}aH.inherits(x.BaseClass,"Overlay");aH.getZIndex=function(i,e){i=i*1;if(!i){return 0}if(e){i=cQ.convertMC2LL(new e4(0,i)).lat}return(i*-100000)<<1};x.extend(aH.prototype,{_i:function(e){this._map=e;if(!this.domElement&&a7(this.initialize)){this.domElement=this.initialize(e);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}}this.draw()},initialize:function(e){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){this._map=null;if(this.domElement&&this.domElement.parentNode){this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this.dispatchEvent(new aB("onremove"))},hide:function(){this._visible=false;x.hide(this.domElement)},show:function(){this._visible=true;x.show(this.domElement)},getMap:function(){return this._map},dispose:function(){x.BaseClass.prototype.decontrol.call(this)}});function bK(){x.BaseClass.call(this);aH.call(this);this._visible=true;this._visibleInternal=true;this.infoWindow=null;this._dblclickTime=0}bK.inherits(aH,"OverlayInternal");x.extend(bK.prototype,{initialize:function(e){this.map=e;x.BaseClass.call(this,this.hashCode);return null},draw:function(){},remove:function(){this.map=null;this.decontrol();aH.prototype.remove.call(this)},hide:function(){this._visible=false},show:function(){this._visible=true},getDom:function(){return this.domElement},getContainer:function(){return this.domElement},setClassName:function(){},setConfig:function(i){if(!i){return}for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},getPoint:function(fm,fn){if(!fm){return this.point}else{var e=fn?fn.width:0;var fo=fn?fn.height:0;if(this.map){var i=this.map.pointToPixelIn(this.point);if(this._config&&this._config.offset){i.x=i.x+this._config.offset.width+e;i.y=i.y+this._config.offset.height+fo}else{i.x=i.x+e;i.y=i.y+fo}return this.map.pixelToPointIn(i)}}},setZIndex:function(e){this.zIndex=e},isVisible:function(){if(!this.domElement){return false}return !!this._visible},enableMassClear:function(){this._config.enableMassClear=true},disableMassClear:function(){this._config.enableMassClear=false},showInternal:function(){this._visibleInternal=true},hideInternal:function(e){this._visibleInternal=false;this._hideInternalReason=e}});function dh(e){this.map=e;this._overlays={};this._overlayArray=[];this._customOverlays=[];e._overlays=this._overlays;e._overlayArray=this._overlayArray;e._customOverlays=this._customOverlays;this._zoomingOrMoving=false;this._init()}dh.prototype._init=function(){if(this.map._renderType!=="webgl"){this._createOverlayContainers()}else{this._createWebGLOverlayContainers()}this._bind()};dh.prototype._createOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e.temp.overlayDivEx=e.overlayDivEx=this._createOverlayDiv(e.platform,50);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400);if(e.isCanvasMap()){e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDivEx,50)}else{e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDiv,200)}};dh.prototype._createWebGLOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400)};dh.prototype._createOverlayDiv=function(e,fn){var fm=H("div");var i=fm.style;i.position="absolute";i.top=i.left=i.width=i.height="0";i.zIndex=fn;e.appendChild(fm);return fm};dh.prototype._bind=function(){var fo=this.map;var fn=this;function i(fq){fn.draw(fq)}if(fo._renderType!=="webgl"){fo.addEventListener("load",i);fo.addEventListener("moveend",i);fo.addEventListener("resize",i);fo.addEventListener("zoomend",i);fo.addEventListener("zooming_inner",i)}else{fo.on("update",i)}fo.addEventListener("zoomend",function(fq){if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});fo.addEventListener("oncenterandzoom",function(fq){fn.draw(fq);if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});fo.addEventListener("maptypechange",function(fq){if(this.mapType==="B_EARTH_MAP"){if(this._panes.mapPane){this._panes.mapPane.style.display="none"}if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}if(this._panes.markerPane){this._panes.markerPane.style.display="none"}}else{if(this._panes.mapPane){this._panes.mapPane.style.display=""}if(this._panes.markerPane){this._panes.markerPane.style.display=""}if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}fn.draw(fq)});fo.on("earthstatuschange",function fp(fq){fn.draw(fq)});fo.addEventListener("addoverlay",function(fu){var fr=fu.target;if(fr instanceof bK){if(!fn._overlays[fr.hashCode]){fn._overlays[fr.hashCode]=fr;fn._overlayArray.push(fr)}}else{var ft=false;for(var fs=0,fq=fn._customOverlays.length;fs<fq;fs++){if(fn._customOverlays[fs]===fr){ft=true;break}}if(!ft){fn._customOverlays.push(fr)}}});fo.addEventListener("removeoverlay",function(ft){var fr=ft.target;if(fr instanceof bK){delete fn._overlays[fr.hashCode];for(var fs=0;fs<fn._overlayArray.length;fs++){if(fn._overlayArray[fs]===fr){fn._overlayArray.splice(fs,1);break}}}else{for(var fs=0,fq=fn._customOverlays.length;fs<fq;fs++){if(fn._customOverlays[fs]===fr){fn._customOverlays.splice(fs,1);break}}}});fo.addEventListener("clearoverlays",function(fs){this.closeInfoWindow();this.closeSimpleInfoWindow();for(var fr in fn._overlays){if(fn._overlays[fr]._config.enableMassClear){this.removeOverlay(fn._overlays[fr])}}for(var fq=fn._customOverlays.length-1;fq>0;fq--){if(fn._customOverlays[fq].enableMassClear!==false){this.removeOverlay(fn._customOverlays[fq]);fn._customOverlays.splice(fq,1)}}});fo.addEventListener("infowindowopen",function(fr){var fq=this.infoWindow;if(fq){x.hide(fq.popDom);x.hide(fq.shadowDom)}});function fm(){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(fn._zoomingOrMoving===false){this._panes.markerMouseTarget.style.display="none";fn._zoomingOrMoving=true}}}function e(fs){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(fn._zoomingOrMoving===true){this._panes.markerMouseTarget.style.display="";fn._zoomingOrMoving=false;for(var fr=0;fr<fn._overlayArray.length;fr++){var fq=fn._overlayArray[fr];if(fq instanceof b9===true){fq.draw(fs)}}}}}fo.addEventListener("movestart",fm);fo.addEventListener("moveend",e);fo.addEventListener("zoomstart",fm);fo.addEventListener("zoomend",e);fo.addEventListener("animation_start",fm);fo.addEventListener("animation_end",e);fo.addEventListener("displayoptions_changed",function(fq){if(this._displayOptions.overlay===false){this.temp.overlayDiv.style.display="none"}else{this.temp.overlayDiv.style.display=""}})};dh.prototype.draw=function(fq){fq=fq||{};if(this.map.getMapType()==="B_EARTH_MAP"){for(var fo=0;fo<this._overlayArray.length;fo++){var fm=this._overlayArray[fo];if(fm instanceof s===true){continue}if(this._zoomingOrMoving){if(fm instanceof b9===true){continue}}fm.draw(fq)}}else{for(var fo=0,fn=this._overlayArray.length;fo<fn;fo++){var fm=this._overlayArray[fo];if(this._zoomingOrMoving&&fm instanceof b9===true){continue}fm.draw(fq)}}x.each(this._customOverlays,function(e){e.draw(fq)});if(this.map.temp.infoWin){this.map.temp.infoWin.setPosition(fq.center,fq.zoom)}if(this.map.getMapType()!=="B_EARTH_MAP"&&this.map._renderType!=="webgl"){if(aI.DrawerSelector){var fp=aI.DrawerSelector.getDrawer(this.map);fp.setPalette()}}};aI.register(function(e){e._overlayMgr=new dh(e)});function s(e){bK.call(this);this._config={strokeColor:"#000",strokeWeight:2,strokeOpacity:1,strokeStyle:"solid",strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:true,getParseTolerance:null,getParseCacheIndex:null,enableParse:true,enableEditing:false,mouseOverTolerance:15,geodesic:false,clip:true,texture:null};this.setConfig(e);if(this._config.strokeOpacity<0||this._config.strokeOpacity>1){this._config.strokeOpacity=0.65}if(this._config.fillOpacity<0||this._config.fillOpacity>1){this._config.fillOpacity=0.65}if(this._config.strokeStyle!=="solid"&&this._config.strokeStyle!=="dashed"&&this._config.strokeStyle!=="dotted"){this._config.strokeStyle="solid"}this.domElement=null;this._bounds=new cv();this.points=[];this.greatCirclePoints=[];this._parseCache=[];this._holesCache=[];this._parseCacheGL=[];this._parseCacheGLRaw=[];this._areaCacheGL=[];this._strokeStyleInfoForGL=[[]];this._fillStyleInfoForGL="";this.vertexMarkers=[];this._temp={}}s.JOININDEX={miter:0,round:1,bevel:2};s.CAPINDEX={round:0,butt:1,square:2};s.inherits(bK,"Graph");s.getGraphPoints=function(i){var e=[];if(!i||i.length===0){return e}if(typeof i==="string"){var fm=i.split(";");x.each(fm,function(fo){var fn=fo.split(",");e.push(new e4(fn[0],fn[1]))})}if(i.constructor===Array&&i.length>0){e=i}return e};s.parseTolerance={0:[0.09,0.005,0.0001,0.00001],1:[9000,500,20,1]};x.extend(s.prototype,{initialize:function(e){this.map=e;return null},draw:function(){},setPoints:function(e){this._clearCache();this.points=s.getGraphPoints(e).slice(0);this._calcBounds()},setPathIn:function(e){this.setPoints(e)},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds=new cv();if(!this.hasMultipleParts){x.each(this.points,function(i){e._bounds.extend(i)})}else{x.each(this.points,function(i){x.each(i,function(fm){e._bounds.extend(fm)})})}},getPoints:function(){return this.points},getPathIn:function(){return this.points},setPointAt:function(i,e){if(!e||!this.points[i]){return}this._clearCache();this.points[i]=new e4(e.lng,e.lat);this._calcBounds()},setOptions:function(i){i=i||{};for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(e){this._config.strokeLineCap=e},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(e){this._config.strokeLineJoin=e},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e}},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){if(e!=="solid"&&e!=="dashed"&&e!=="dotted"){return}this._config.strokeStyle=e},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBounds:function(){this._bounds.setMinMax();return this._bounds},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent)}bK.prototype.remove.call(this);this._clearCache();var e=new aB("onlineupdate");e.action="remove";e.overlay=this;this.fire(e)},enableEditing:function(){this._config.enableEditing=true},disableEditing:function(){this._config.enableEditing=false},getParsedPoints:function(){var e=this._simplification(this.points);if(this.hasMultipleParts){return e}return[e]},_simplification:function(fr){var e=this.map;var fq=this.getParseCacheIndex(e.getZoom());var ft;if(this._parseCache[fq]){ft=this._parseCache[fq]}else{var fo=fr;if(this.greatCirclePoints.length>0){fo=this.greatCirclePoints}var fp=this.getParseTolerance(e.getZoom(),e.config.coordType);if(!this.hasMultipleParts){var fs=fd(fo,fp)}else{var fs=[];for(var fm=0;fm<fo.length;fm++){var fn=fd(fo[fm],fp);fs.push(fn)}}ft=this._parseCache[fq]=fs}return ft},_clearCache:function(){this._parseCache.length=0;this._parseCacheGL.length=0;this._parseCacheGLRaw.length=0;this._areaCacheGL.length=0}});if(x.Browser.ie&&document.namespaces&&!document.namespaces.olv){document.namespaces.add("olv","urn:schemas-microsoft-com:vml")}function eR(fp,fn,fm){if(!fp||!fn){return}this.imageUrl=null;this.imageDom=null;if(typeof fp==="string"){this.imageUrl=fp}else{this.imageDom=fp;if(!this.imageDom.id){this.imageDom.id=aI.getGUID("icon_dom_")}}this.size=fn;var fo=new cG(Math.floor(fn.width/2),Math.floor(fn.height/2));var i={offset:fo,imageOffset:new cG(0,0)};fm=fm||{};for(var e in fm){i[e]=fm[e]}if(fm.anchor){i.offset=fm.anchor}this.anchor=this.offset=i.offset;this.imageOffset=i.imageOffset;this.infoWindowOffset=fm.infoWindowOffset||this.offset;this.printImageUrl=fm.printImageUrl||"";this.imageSize=fm.imageSize;this.srcSetObject={};this.setImageSrcset(fm.srcset||fm.srcSet)}eR.prototype.setImageUrl=function(e){if(!e){return}this.imageUrl=e;this._renderData=null};eR.prototype.getCurrentImageUrl=function(){if(window.devicePixelRatio>1&&this.srcSetObject["2x"]){return this.srcSetObject["2x"]}return this.imageUrl};eR.prototype.setPrintImageUrl=function(e){if(!e){return}this.printImageUrl=e};eR.prototype.setSize=function(e){if(!e){return}this.size=new cG(e.width,e.height);this._renderData=null};eR.prototype.setOffset=function(e){if(!e){return}this.anchor=this.offset=new cG(e.width,e.height);this._renderData=null};eR.prototype.setAnchor=function(e){this.setOffset(e)};eR.prototype.setImageOffset=function(e){if(!e){return}this.imageOffset=new cG(e.width,e.height);this._renderData=null};eR.prototype.setInfoWindowOffset=function(e){if(!e){return}this.infoWindowOffset=new cG(e.width,e.height)};eR.prototype.setImageSize=function(e){if(!e){return}this.imageSize=new cG(e.width,e.height)};eR.prototype.setImageSrcset=function(fm){var e="";if(!fm){return}for(var i in fm){if(fm.hasOwnProperty(i)){this.srcSetObject[i]=fm[i];e=fm[i]+" "+i+","}}this.srcSet=e};eR.prototype.toString=function(){return"Icon"};eR.prototype.generateRenderData=function(){var i=this.offset;var e=this.size;var fn=this.imageOffset;var fm=[];fm.push(-i.width,i.height-e.height,0);fm.push(e.width-i.width,i.height-e.height,0);fm.push(e.width-i.width,i.height,0);fm.push(-i.width,i.height-e.height,0);fm.push(e.width-i.width,i.height,0);fm.push(-i.width,i.height,0);return{vertex:fm}};eR.prototype.getRenderData=function(){if(!this._renderData){this._renderData=this.generateRenderData()}return this._renderData};function W(fm,i){x.BaseClass.call(this);this.content=fm;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new cG(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width!=0){if(this._config.width<220){this._config.width=220}if(this._config.width>730){this._config.width=730}}if(this._config.height!=0){if(this._config.height<60){this._config.height=60}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!=0){if(this._config.maxWidth<220){this._config.maxWidth=220}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=dn.imgPath;this.overlay=null;var e=this;cH.load("infowindow",function(){e._draw()})}W.inherits(x.BaseClass,"InfoWindow");x.extend(W.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<60){e=60}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<220){e=220}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},getContent:function(){return this.content},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPointIn:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getTitle:function(){return this._config.title||""},getPosition:function(){return this.latLng;var e=this.getPointIn();return cQ.convertMC2LL(e)},getPoint:function(){var e=this.getPointIn();return cQ.convertMC2LL(e)},getOffset:function(){return this._config.offset},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}});bV.prototype.openInfoWindowIn=function(fn,e){if(!fn||fn.toString()!="InfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var fm=new eR(dn.imgPath+"blank.gif",{width:1,height:1});i.marker=new b9(e,{icon:fm,width:1,height:1,offset:new cG(0,0),infoWindowOffset:new cG(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openInfoWindow(fn)};bV.prototype.openInfoWindow=function(fm,e){fm.latLng=new bS(e.lat,e.lng);var i=cQ.convertLL2MC(e);this.openInfoWindowIn(fm,i)};bV.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeInfoWindow()}};bK.prototype.openInfoWindow=function(e){if(this.map){this.map.closeInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;x.BaseClass.call(e,e.hashCode)}};bK.prototype.closeInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function ai(fm,i){bK.call(this);this.content=fm;this.map=null;this.domElement=null;this._config={width:0,offset:new cG(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:true};i=i||{};this.setConfig(i);if(this._config.width<0){this._config.width=0}this.point=this._config.point;var e=this;cH.load("marker",function(){e._draw()})}ai.inherits(bK,"Label");x.extend(ai.prototype,{setPoint:function(e){if(e&&e.toString()==="Point"&&!this.getMarker()){this.point=this._config.point=new e4(e.lng,e.lat)}},setContent:function(e){this.content=e},getContent:function(e){return this.content},setOpacity:function(e){if(e>=0&&e<=1){this._config.opacity=e}},setOffset:function(e){if(!e||e.toString()!=="Size"){return}this._config.offset=new cG(e.width,e.height)},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{};this._config.styles=x.extend(this._config.styles,e)},setStyles:function(e){this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){if(this._marker&&this._marker!==e){this._marker._config.label=null}this._marker=e;if(e){this.point=this._config.point=e.getPoint()}else{this.point=this._config.point=null}},getMarker:function(){return this._marker||null},getPositionIn:function(){return this.getPoint()},});function dV(fm,i){var fn={};for(var e in i){if(i.hasOwnProperty(e)){if(e==="position"){fn.point=cQ.convertLL2MC(i[e]);this.latLng=new bS(i[e]["lat"],i[e]["lng"])}else{fn[e]=i[e]}}}ai.call(this,fm,fn)}dV.inherits(ai,"LabelOut");x.extend(dV.prototype,{toString:function(){return"Label"},setPosition:function(e){this.latLng=new bS(e.lat,e.lng);var i=cQ.convertLL2MC(e);this.setPoint(i)},getPosition:function(){return this.latLng;var e=this.getPositionIn();return cQ.convertMC2LL(e)}});window.BMAP_ANIMATION_DROP=1;window.BMAP_ANIMATION_BOUNCE=2;function b9(e,i){bK.call(this);i=i||{};this.point=e;this._rotation=0;this.map=null;this._animation=null;this.domElement=null;this.iconDom=null;this.infoWindowDom=null;this.siblingElement=null;this.textureCoord=null;this.textureCoordGLMap=null;this.collisionDetectionFailed=false;this._config={offset:new cG(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:true,zIndexFixed:false,isTop:false,enableMassClear:true,enableDragging:false,raiseOnDrag:false,restrictDraggingArea:false,startAnimation:"",enableCollisionDetection:false,rank:0,enableDraggingMap:false};this.setConfig(i);if(!i.icon){this._config.icon=new eR(dn.imgPath+"marker_red.png",new cG(23,25),{offset:new cG(10,25),infoWindowOffset:new cG(10,0)})}this._isDragging=false;var fm=this;cH.load("marker",function(){fm._draw()})}b9.TOP_ZINDEX=aH.getZIndex(-90)+1000000;b9.DRAG_ZINDEX=b9.TOP_ZINDEX+1000000;b9._injectMethond=function(e){x.extend(b9.prototype,e)};b9.inherits(bK,"Marker");x.extend(b9.prototype,{toString:function(){return"Marker"},setIcon:function(e){if(e){this._config.icon=e;this.textureCoord=this.textureCoordGLMap=null}},getIcon:function(){return this._config.icon},setLabel:function(e){if(!e){return}this._config.label=e;e._config.enableMassClear=this._config.enableMassClear;e.setPoint(this.point)},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=true},disableDragging:function(){this._config.enableDragging=false},setPoint:function(e){if(e){this.point=this._config.point=new e4(e.lng,e.lat);this.latLng=cQ.convertMC2LL(e)}},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setTop:function(i,e){this._config.isTop=!!i;if(i){this._addi=e||0}},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setOffset:function(e){if(e){this._config.offset=e}},getOffset:function(){return this._config.offset},setAnimation:function(e){this._animation=e},setRank:function(e){this._config.rank=e},getRank:function(){return this._config.rank},setRotation:function(e){while(e<0){e+=360}this._rotation=e%360},getRotation:function(){return this._rotation}});function ac(e,fm){this.latLng=new bS(e.lat,e.lng);var i=cQ.convertLL2MC(e);b9.call(this,i,fm)}ac.inherits(b9,"MarkerOut");x.extend(ac.prototype,{toString:function(){return"Marker"},setPosition:function(e){this.latLng=new bS(e.lat,e.lng);var i=cQ.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){return this.latLng;var e=this.getPositionIn();return cQ.convertMC2LL(e)}});function a(fm,e){s.call(this,e);this.setPoints(fm);var i=this;cH.load("poly",function(){i._draw()})}a.inherits(s,"Polyline");function T(fo,e){if(!fo||fo.length===0){return}var fn=[];for(var fm=0;fm<fo.length;fm++){fn[fm]=cQ.convertLL2MC(fo[fm])}a.call(this,fn,e)}T.inherits(a,"PolylineOut");x.extend(T.prototype,{toString:function(){return"Polyline"},setPath:function(fn){if(!fn||fn.length===0){return}var fm=[];for(var e=0;e<fn.length;e++){fm[e]=cQ.convertLL2MC(fn[e])}this.setPathIn(fm)},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var fn=[];for(var fm=0;fm<e.length;fm++){fn[fm]=cQ.convertMC2LL(e[fm])}return fn}});function dB(e,fm){s.call(this,fm);this._normalizedBounds=new cv();this.setPoints(e);var i=this;cH.load("poly",function(){i._draw()})}dB.inherits(a,"PolylineMultipart");x.extend(dB.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);this._calcBounds()},_unifyArgs:function(fm){var e=[];var i=[];if(fm.constructor===Array){if(fm[0].constructor===e4){i.push(fm)}else{i=fm}}else{if(typeof fm==="string"){i.push(fm)}}x.each(i,function(fn){e.push(s.getGraphPoints(fn))});return e},setPointAt:function(i,e,fm){fm=fm||0;if(!e||!this.points[fm]||!this.points[fm][i]){return}this._clearCache();this.points[fm][i]=new e4(e.lng,e.lat);this._calcBounds()},getBounds:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){x.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{x.each(e.points,function(i){x.each(i,function(fm){e._bounds.extend(fm)})})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-bV.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>bV.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-bV.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=bV.WORLD_SIZE_MC_HALF}}});function al(fm,e){s.call(this,e);e=e||{};if(typeof e.fillOpacity==="number"){this._config.fillOpacity=e.fillOpacity}else{this._config.fillOpacity=0.6}dN(this._config.fillOpacity,0,1);if(e.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=e.fillColor?e.fillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(fm,e);var i=this;cH.load("poly",function(){i._draw()})}al.inherits(s,"Polygon");x.extend(al.prototype,{setPoints:function(fp){var fn=[];if(typeof fp==="string"||fp[0] instanceof e4||this instanceof eb||fp.length===0){var e=this._processSinglePointArray(fp);this._userPoints=e.userPoints;fn=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var fo=0;fo<fp.length;fo++){var fm=this._processSinglePointArray(fp[fo]);this._userPoints.push(fm.userPoints);fn.push(fm.innerPoints)}this.hasMultipleParts=true}s.prototype.setPoints.call(this,fn)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=s.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new e4(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._userPoints[i]=new e4(e.lng,e.lat);this.points[i]=new e4(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new e4(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function eO(fo,e){if(!fo||fo.length===0){return}var fn=[];for(var fm=0;fm<fo.length;fm++){fn[fm]=cQ.convertLL2MC(fo[fm])}al.call(this,fn,e)}eO.inherits(al,"PolygonOut");x.extend(eO.prototype,{toString:function(){return"Polygon"},setPath:function(fn){if(!fn||fn.length===0){return}var fm=[];for(var e=0;e<fn.length;e++){fm[e]=cQ.convertLL2MC(fn[e])}this.setPathIn(fm)},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var fn=[];for(var fm=0;fm<e.length;fm++){fn[fm]=cQ.convertMC2LL(e[fm])}return fn}});function eb(i,e,fm){this.point=i;this.radius=Math.abs(e);al.call(this,[],fm)}eb.parseTolerance={0:[0.01,0.0001,0.00001,0.000004],1:[1000,10,1,0.4]};eb.inherits(al,"Circle");x.extend(eb.prototype,{initialize:function(e){this.map=e;this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return null},getPoint:function(){return this.point},setPoint:function(e){if(!e){return}this.point=e},setCenterIn:function(e){var i=arguments[1];this.setPoint(e,i)},setRadius:function(e){this.radius=Math.abs(e)},getCenterIn:function(){return this.point},getRadius:function(){return this.radius},_getPerimeterPoints:function(e,fu){if(!e||!fu||!this.map){return[]}var fm=this.map;var fr=e.lng;var fp=e.lat;var fA=cQ.convertMC2LL(e);fr=fA.lng;fp=fA.lat;var fB=[];var fw=fu/cQ.EARTHRADIUS;var ft=(Math.PI/180)*fp;var fz=(Math.PI/180)*fr;for(var fs=0;fs<360;fs+=9){var fq=(Math.PI/180)*fs;var fx=Math.asin(Math.sin(ft)*Math.cos(fw)+Math.cos(ft)*Math.sin(fw)*Math.cos(fq));var fv=Math.atan2(Math.sin(fq)*Math.sin(fw)*Math.cos(ft),Math.cos(fw)-Math.sin(ft)*Math.sin(fx));var fy=((fz-fv+Math.PI)%(2*Math.PI))-Math.PI;var fo=new bS(fx*(180/Math.PI),fy*(180/Math.PI));fB.push(cQ.convertLL2MC(fo))}var fn=fB[0];fB.push(new e4(fn.lng,fn.lat));if(fn){this._radiusMercator=Math.sqrt(Math.pow(fn.lng-this.point.lng,2)+Math.pow(fn.lat-this.point.lat,2))}else{this._radiusMercator=this.radius}return fB}});function cn(i,e,fn){this.latLng=new bS(i.lat,i.lng);var fm=cQ.convertLL2MC(i);eb.call(this,fm,e,fn)}cn.inherits(eb,"CircleOut");x.extend(cn.prototype,{toString:function(){return"Circle"},setCenter:function(e){this.latLng=new bS(e.lat,e.lng);var i=cQ.convertLL2MC(e);this.setCenterIn(i)},getCenter:function(){return this.latLng;var e=this.getCenterIn();return cQ.convertMC2LL(e)}});var aS={};function ff(fm,i){x.BaseClass.call(this);this.content=fm;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new cG(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width<50){this._config.width=50}if(this._config.width>730){this._config.width=730}if(this._config.height!=0){if(this._config.height<50){this._config.height=50}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<50){this._config.maxWidth=50}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=dn.imgPath;this.overlay=null;var e=this;cH.load("simpleInfowindow",function(){e._draw()})}ff.inherits(x.BaseClass,"SimpleInfoWindow");x.extend(ff.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;e-=10;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPoint:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getOffset:function(){return this._config.offset},dispose:function(){x.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}});bV.prototype.openSimpleInfoWindow=function(fn,e){if(!fn||fn.toString()!="SimpleInfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var fm=new eR(dn.imgPath+"blank.gif",{width:1,height:1});i.marker=new b9(e,{icon:fm,width:1,height:1,offset:new cG(0,0),infoWindowOffset:new cG(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openSimpleInfoWindow(fn)};bV.prototype.closeSimpleInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeSimpleInfoWindow()}};bK.prototype.openSimpleInfoWindow=function(e){if(this.map){this.map.closeSimpleInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;x.BaseClass.call(e,e.hashCode)}};bK.prototype.closeSimpleInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function cy(fm,e){if(arguments.length===0){return}bK.apply(this,arguments);e=e||{};this._config={bounds:fm,opacity:e.opacity||1,imageURL:e.imageURL||"",displayOnMinLevel:e.displayOnMinLevel||1,enableMassClear:e.enableMassClear===false?false:true,displayOnMaxLevel:e.displayOnMaxLevel||19,stretch:e.stretch||false};if(e.opacity===0){this._config.opacity=0}var i=this;cH.load("groundoverlay",function(){i._draw()})}cy.inherits(bK,"GroundOverlay");x.extend(cy.prototype,{setBounds:function(e){this._config.bounds=e},getBounds:function(){return this._config.bounds},setOpacity:function(e){this._config.opacity=e},getOpacity:function(){return this._config.opacity},setImageURL:function(e){this._config.imageURL=e},getImageURL:function(){return this._config.imageURL},setDisplayOnMinLevel:function(e){this._config.displayOnMinLevel=e},getDisplayOnMinLevel:function(){return this._config.displayOnMinLevel},setDisplayOnMaxLevel:function(e){this._config.displayOnMaxLevel=e},getDisplayOnMaxLevel:function(){return this._config.displayOnMaxLevel}});function cO(e,i){e=isNaN(e)?0:e;i=isNaN(i)?0:i;this.x=e;this.y=i}cO.prototype.equals=function(e){if(!e){return false}return e.x===this.x&&e.y===this.y};cO.prototype.clone=function(){return new cO(this.x,this.y)};cO.prototype.toString=function(){return"Pixel"};function cG(i,e){if(typeof i!=="number"){this.width=parseFloat(i)}else{this.width=i}if(typeof e!=="number"){this.height=parseFloat(e)}else{this.height=e}}cG.prototype.equals=function(e){return !!(e&&this.width===e.width&&this.height===e.height)};cG.prototype.toString=function(){return"Size"};var aY={B_NORMAL_MAP:{tileUrls:cT(dn.tileDomain,dn.rasterTilePath),vectorTileUrls:cT(dn.tileDomain,dn.vectorTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:dn.imgPath+"bg.png",bounds:new cv(new e4(-21364736,-11708041.66),new e4(23855104,12474104.17)),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["https://maponline0.bdimg.com/starpic/?qt=satepc&","https://maponline1.bdimg.com/starpic/?qt=satepc&","https://maponline2.bdimg.com/starpic/?qt=satepc&","https://maponline3.bdimg.com/starpic/?qt=satepc&"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dn.imgPath+"bg.png",bounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),imgExtend:"png"},B_STREET_MAP:{tileUrls:cT(dn.tileDomain,dn.rasterTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dn.imgPath+"bg.png",bounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:dn.imgPath+"blank.gif",bounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:dn.imgPath+"blank.gif",bounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),imgExtend:"png"}};var be=aY;function a5(fs,i,fo,fm,fn){this.mgr=fs;this.position=fo;this._cbks=[];this.name=fs.getTileName(fm,fn,fs.map.config.style);this.info=fm;this._transparentPng=fn.isTransparentPng();var ft=H("img");b6(ft);ft.galleryImg=false;var fr=ft.style;fr.position="absolute";fr.width=fs.tileSize+"px";fr.height=fs.tileSize+"px";fr.left=fo[0]+"px";fr.top=fo[1]+"px";this.img=ft;this.src=i;if(L&&fo._offsetX===0){fr.opacity=0;fr.willChange="opacity"}var fq=this;this.img.onload=function(fB){if(!fq.mgr){return}var fw=fq.mgr;var fu=fw.bufferTiles;if(fw.bufferNumber>0){fu[fq.name]=fq;fu.push(fq.name)}var fy=fu.length-fw.bufferNumber;for(var fz=0;fy>0&&fz<fu.length;fz++){var fA=fu[fz];if(!fw.mapTiles[fA]){if(fu[fA]){fu[fA].mgr=null;var fx=fu[fA].img;if(fx.parentNode){dE(fx);fx.parentNode.removeChild(fx)}fx=null;fu[fA].img=null;fu[fA]=null;delete fu[fA]}fu.splice(fz,1);fz--;fy--}}fq.loaded=true;fw.imgNumber++;if(!eS(fq.img)){if(fn.tilesDiv){fn.tilesDiv.appendChild(fq.img)}}var fB=new aB("onimagechange");fB.action="show";fB.tile=fq.name;fw.map.dispatchEvent(fB);if(L&&fo._offsetX===0){var fv=new l({fps:10,duration:300,render:function(e){if(fq.img&&fq.img.style){fq.img.style.opacity=e*1}},finish:function(){if(fq.img&&fq.img.style){delete fq.img.style.opacity;fq.img.style.willChange="auto"}}})}fq._callCbks()};this.img.onerror=function(fw){fq.error=true;fq._callCbks();if(!fq.mgr){return}var fu=fq.mgr;var fv=be[fn.mapType];if(fv.errorUrl){fq.img.src=fv.errorUrl}if(!eS(fq.img)){if(fn.tilesDiv){fn.tilesDiv.appendChild(fq.img)}}};ft=null;var fp=new aB("onimagebefore");fp.tile=fq.name;fs.map.dispatchEvent(fp)}a5.prototype._addLoadCbk=function(e){this._cbks.push(e)};a5.prototype._load=function(){if(FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng){this.img.src=dn.imgPath+"blank.gif"}else{this.img.src=this.src}};a5.prototype._callCbks=function(){var fm=this;for(var e=0;e<fm._cbks.length;e++){fm._cbks[e]()}fm._cbks.length=0};var L=(!x.Browser.ie||x.Browser.ie>8);function dv(e){this.tileLayers=[];this.map=e;this.bufferNumber=300;this.mapTiles=[];this.bufferTiles=[];this.config=be[this.map.mapType];this.errorUrl=this.config.errorUrl;this.tileSize=this.config.tileSize;this.baseUnits=this.config.baseUnits;this.baseZoomLevel=this.config.zoomLevelBase;this.tileURLs=this.config.tileUrls;this.imgNumber=0;this.numLoading=0;this.temp={}}aI.register(function(i){if(i._renderType==="webgl"){return}var e=i.tileMgr=new dv(i);i.addEventListener("mousewheel",function(fm){e.mouseWheel(fm)});i.addEventListener("dblclick",function(fm){e.dblClick(fm)});i.addEventListener("rightdblclick",function(fm){e.dblClick(fm)});i.addEventListener("minuspress",function(fm){e.keypress(fm)});i.addEventListener("pluspress",function(fm){e.keypress(fm)});i.addEventListener("load",function(fm){if(this.mapType===BMAP_EARTH_MAP){return}e.loadTiles()});i.addEventListener("zoomstartcode",function(fm){if(this.mapType===BMAP_EARTH_MAP){return}e._zoom(fm)});i.addEventListener("moving",function(fm){if(this.mapType===BMAP_EARTH_MAP){return}e.moveGridTiles()});i.addEventListener("resize",function(fm){if(this.mapType===BMAP_EARTH_MAP){return}e.resizeMap(fm)});i.addEventListener("addtilelayer",function(fm){e.addTileLayer(fm)});i.addEventListener("removetilelayer",function(fm){e.removeTileLayer(fm)})});x.extend(dv.prototype,{addTileLayer:function(fn){var fm=this;var i=fn.target;fm.tileLayers.push(i);if(fm.map.loaded){fm.moveGridTiles()}},removeTileLayer:function(fu){var fv=this;var fs=fu.target;var fq=fs.mapType;var fp=fv.mapTiles;var fx=fv.bufferTiles;for(var fm in fx){var fn=fm.split("-")[1];if(fn==fq){delete fx[fm]}}for(var fm in fp){var fn=fm.split("-")[1];if(fn==fq){delete fp[fm]}}if(fv.zoomsDiv&&fv.zoomsDiv.parentNode){fv.zoomsDiv.parentNode.removeChild(fv.zoomsDiv);fv.zoomsDiv.innerHTML=""}var fo=fv.map;if(fo.deepZoom){var fw=fo.deepZoom.preDeepZoomDiv;if(fw&&fw.parentNode){fw.parentNode.removeChild(fw)}}for(var ft=0,fr=fv.tileLayers.length;ft<fr;ft++){if(fs==fv.tileLayers[ft]){fv.tileLayers.splice(ft,1)}}fv.moveGridTiles()},hideDeepZoomDiv:function(){var i=this,fm=i.map;if(fm.deepZoom){var e=fm.deepZoom.preDeepZoomDiv;if(e&&e.style.display!="none"){e.style.display="none"}}},getTileLayer:function(fo){var fn=this;for(var fm=0,e=fn.tileLayers.length;fm<e;fm++){tilelayer=fn.tileLayers[fm];if(tilelayer.mapType==fo){return tilelayer}}return null},_zoom:function(fm){var i=this;if(i.zoomsDiv&&i.zoomsDiv.style.display!="none"){i.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},resizeMap:function(i){this.loaded=false;this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var e=this;if(this.numLoading==0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading==0){e.map.dispatchEvent(new aB("ontilesloaded"))}e._checkLoadedTimer=null},80)}},getTileName:function(e,fm,i){var fo=fm.mapType;var fn="TILE-"+fo+"-"+i+"-"+e[0]+"-"+e[1]+"-"+e[2];return fn},hideTile:function(fn,fm){var i=fn.img;if(eS(i)){if(fn.loaded){this.imgNumber--}if(i.parentNode){dE(i);i.parentNode.removeChild(i)}}var fo=new aB("onimagechange");fo.tile=this.getTileName(fn.info,fm,this.map.config.style);fo.action="hide";delete this.mapTiles[fn.name];if(!fn.loaded){dE(i);fn._callCbks();i=null;fn.img=null;fn.mgr=null}this.map.dispatchEvent(fo)},loadTiles:function(){var i=this;if(x.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(fm){}}if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},getCell:function(fo,fn){var e=this.baseUnits*Math.pow(2,(this.baseZoomLevel-fn));var fm=parseInt(fo.lng/e);var i=parseInt(fo.lat/e);return[fm,i,e*(fm+0.5),e*(i+0.5)]},moveGridTiles:function(){var fB=this.map,fK=fB.getMapType(),fI=this.tileLayers.length;var fG=fB.centerPoint;if(fK!==BMAP_SATELLITE_MAP){fG=cD.calcLoopCenterPoint(fG)}var fs=fB.width;var fW=fB.getZoomUnits();var fH=fW*fs;var fM=fG.lng-fH/2;var fx=fG.lng+fH/2;var fA=cD.isAddWidth(fM,fx);for(var fO=0;fO<fI;fO++){var fo=this.tileLayers[fO];if(fo.baseLayer||fI==1){this.tilesDiv=fo.tilesDiv}var fC=be[fo.mapType];var fn=fB.zoomLevel;var fR=fB.getZoomUnits(fB.zoomLevel);var fw=fC.baseUnits*Math.pow(2,(fC.zoomLevelBase-fn));var fu=Math.floor(fG.lng/fw);var fN=Math.floor(fG.lat/fw);var fz=fC.tileSize;var fD=[fu,fN,(fG.lng-fu*fw)/fw*fz,(fG.lat-fN*fw)/fw*fz];var fv=fA?fB.width/2*1.5:fB.width/2;var fy=fD[0]-Math.ceil((fv-fD[2])/fz);var fV=fD[1]-Math.ceil((fB.height/2-fD[3])/fz);var fP=fD[0]+Math.ceil((fv+fD[2])/fz);var fE=fD[1]+Math.ceil((fB.height/2+fD[3])/fz);var ft=[];for(var fT=fy;fT<fP;fT++){for(var fS=fV;fS<fE;fS++){ft.push([fT,fS]);var fJ="id_"+fT+"_"+fS+"_"+fn;ft[fJ]=true}}if(fo.mapType!==BMAP_SATELLITE_MAP){ft=cD.calcLoopTiles(ft,fn)}ft.sort((function(i){return function(fY,fZ){return((0.4*Math.abs(fY[0]-i[0])+0.6*Math.abs(fY[1]-i[1]))-(0.4*Math.abs(fZ[0]-i[0])+0.6*Math.abs(fZ[1]-i[1])))}})([fD[0],fD[1]]));var fm=this.mapTiles;var e=-fG.lng/fR;var fX=fG.lat/fR;var fL=[e,fX];for(var fF in fm){var fq=fm[fF];var fU=fq.info;if(!fU){continue}var fJ="id_"+fU[0]+"_"+fU[1]+"_"+fU[2];if(!ft[fJ]){this.hideTile(fq,fo)}}var fp=-fB.offsetX+fB.width/2;var fr=-fB.offsetY+fB.height/2;fo.tilesDiv.style.left=Math.round(e+fp)-fL[0]+"px";fo.tilesDiv.style.top=Math.round(fX+fr)-fL[1]+"px";this.numLoading+=ft.length;for(var fT=0,fQ=ft.length;fT<fQ;fT++){this.showTile([ft[fT][0],ft[fT][1],fB.zoomLevel],fL,fo,fT,fB.config.style)}}},showTile:function(fq,fp,ft,fy){this.centerPos=fp;var fr=be[ft.mapType];var fu=this.map.config.style;var fn=this.getTileName(fq,ft,fu);var fo=(fq[0]*fr.tileSize)+fp[0];var fm=(-1-fq[1])*fr.tileSize+fp[1];var fx=[fo,fm];var fs=null;if(ft.mapType!==BMAP_SATELLITE_MAP){fs=cD.calcLoopParam(fq[0],fq[2]);var fw=fs.offsetX;fx[0]+=fw;fx._offsetX=fw}var fB=this;var fA=this.mapTiles[fn];if(fA){fA.img.style.left=fx[0]+"px";fA.img.style.top=fx[1]+"px";if(fA.loaded){this._checkTilesLoaded()}else{fA._addLoadCbk(function(){fB._checkTilesLoaded()})}return}fA=this.bufferTiles[fn];if(fA){this.imgNumber++;ft.tilesDiv.insertBefore(fA.img,ft.tilesDiv.lastChild);this.mapTiles[fn]=fA;fA.img.style.left=fx[0]+"px";fA.img.style.top=fx[1]+"px";if(fA.loaded){this._checkTilesLoaded()}else{fA._addLoadCbk(function(){fB._checkTilesLoaded()})}var fz=new aB("onimagechange");fz.action="cache";fz.tile=this.getTileName(fq,ft,fu);this.map.dispatchEvent(fz)}else{var fv=new cO(fq[0],fq[1]);if(fs){fv.x=fs.col}var i=ft.getTilesUrl(fv,fq[2]);fA=new a5(this,i,fx,fq,ft);fA._addLoadCbk(function(){fB._checkTilesLoaded()});fA._load();this.mapTiles[fn]=fA;aP(this.map)}},mouseWheel:function(fr){var fq=this.map;if(!fq.config.enableWheelZoom){return}var fs=fq.zoomLevel+(fr.trend===true?1:-1);var fo=fq._getProperZoom(fs);if(fo.exceeded){var fm=new aB("onzoomexceeded");fm.targetZoom=fs;fq.dispatchEvent(fm);return}fq.dispatchEvent(new aB("onzoomstart"));fq.lastLevel=fq.zoomLevel;fq.zoomLevel=fo.zoom;var i=fr.pixel;var fn=fq.pixelToPointIn(i,{zoom:fq.lastLevel});var fp=fq.getZoomUnits(fq.zoomLevel);fq.centerPoint=new e4(fn.lng+fp*(fq.width/2-i.x),fn.lat-fp*(fq.height/2-i.y));this.zoom(i)},dblClick:function(fm){var i=this.map;if(!i.config.enableDblclickZoom){return}if(i.mapType==="B_EARTH_MAP"){return}if(i.currentOperation===cx.dragging){return}if(fm.type=="onrightdblclick"){i.zoomOut(fm.point)}else{i.zoomIn(fm.point)}},keypress:function(fm){var i=this.map;if(i.getMapType()===BMAP_EARTH_MAP){return}fm.type=="onpluspress"?i.zoomIn():i.zoomOut()}});function bI(fn){this.opts=fn||{};this.copyright=this.opts.copyright||{};this.transparentPng=this.opts.transparentPng||false;this.png8=this.opts.png8||false;this.baseLayer=this.opts.baseLayer||false;this.dataType=this.opts.dataType||1;this.isFlat=this.opts.isFlat===false?false:true;this.showLabel=this.opts.showLabel===false?false:true;var e=this.opts.tileTypeName||"web";this.tileType=bF.getInstance(e);this.clipTile=this.opts.clipTile||false;this._type="tilelayer";var i=d8()?128:256;this.cacheSize=this.opts.cacheSize||i;var fm=this;this.tileCache=new dj(this.cacheSize,{clearCallback:function(fo){if(fo.label){if(fo.label.textImageBitmap){fo.label.textImageBitmap.close()}if(fo.label.indoorTextImageBitmap){fo.label.indoorTextImageBitmap.close()}}fm._removeIndoorData(fo)}});this.scaler=ay()>=1.5?2:1;this.normalUdt=ad("ditu","normal").udt;this.numLoading=0;this.useThumbData=false;if(this.baseLayer){this.useThumbData=true}if(typeof this.opts.customLayer==="boolean"){this.customLayer=this.opts.customLayer}else{this.customLayer=true}}bI.inherits(cJ,"TileLayer");x.extend(bI.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(fu,e){var fm=be[this.mapType];if(typeof fm!="object"){return null}var fn=fu.x;var fv=fu.y;if(this.mapType!==BMAP_SATELLITE_MAP){var fv=cD.calcLoopParam(fv,e).col}var i="";if(this.opts.tileUrlTemplate){i=this.opts.tileUrlTemplate;i=i.replace(/\{X\}/,fv);i=i.replace(/\{Y\}/,fn);i=i.replace(/\{Z\}/,e)}else{if(this.mapType==BMAP_NORMAL_MAP){var ft=this.isCanvasMap?0:1;var fp=fm.tileUrls[Math.abs(fv+fn)%fm.tileUrls.length];if(window.offLineIPAddress){fp=window.offLineIPAddress+"tile5/"}var fo=this.map.config.style;i=fp+"?qt=vtile&x="+fn+"&y="+fv+"&z="+e+(fo==="default"?"":("&styleId="+dn.mapStyleNameIdPair[fo]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&showtext="+ft;i=i.replace(/-(\d+)/gi,"M$1")}if(this.mapType==BMAP_SATELLITE_MAP){var fq=ad("ditu","satellite");var fs=fq.ver;var fr=fq.udt;i=fm.tileUrls[Math.abs(fv+fn)%fm.tileUrls.length]+"u=x="+fn+";y="+fv+";z="+e+";v="+fs+";type=sate&fm=46&udt="+fr;i=i.replace(/-(\d+)/gi,"M$1")}}return i},initialize:function(fo){this.map=fo;if(fo._renderType==="webgl"){var fn=null;if(this.customLayer!==false){fn=this.getTilesUrl}x.extend(this,dX);this.labelProcessor=new b5(this);this.callbackDataQueue=[];if(fn){this.getTilesUrl=fn}var e=this;fo.on("indoor_data_refresh",function(fp){if(!e.baseLayer){return}e._refreshIndoorData(fp.uid,fp.floor)});fo.on("custom_labels_ready",function(fp){if(!e.baseLayer){return}e._doWorkAfterLabelImageLoad(fp.virtualTile,fp.labelCanvas,null,fp.imgKey)});fo.on("glmoduleloaded",function(){if(!e.baseLayer){return}e.updateAllIconsTextureCoords()})}if(!fo.temp.layerZIndex){fo.temp.layerZIndex=0}this.zIndex=this.zIndex||0;if(this.baseLayer){this.zIndex=0}if(!fo.temp.layid){fo.temp.layid=0}if(!this.opts.mapType){this.mapType="BMAP_CUSTOM_LAYER_"+fo.temp.layid;fo.temp.layid++}else{this.mapType=this.opts.mapType}var i=be[this.mapType];if(!i){be[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:dn.imgPath+"/blank.gif",bounds:new cv(new e4(-21364736,-10616832),new e4(23855104,15859712)),imgExtend:"png"}}if(fo._renderType!=="webgl"){var fm=cq(fo.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');fm.style.display="";fm.style.left=Math.ceil(-fo.offsetX+fo.width/2)+"px";fm.style.top=Math.ceil(-fo.offsetY+fo.height/2)+"px";this.tilesDiv=fm}this.isCanvasMap=fo.isCanvasMap();this.lastZoom=fo.getZoom()},remove:function(){if(this.tilesDiv&&this.tilesDiv.parentNode){this.tilesDiv.innerHTML="";this.tilesDiv.parentNode.removeChild(this.tilesDiv)}delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},setZIndex:function(e){this.zIndex=e;if(this.tilesDiv){this.tilesDiv.style.zIndex=e}}});function bT(i,e,fm){this.bounds=i;this.content=e;this.mapType=fm}bT.inherits(cJ,"Copyright");var em={get:function(e){if(!em.singleton){em.singleton=new R(e)}return em.singleton}};function R(i){this._map=i;this._tileMgr=i.tileMgr;this._animationDiv=null;this._preAnimationDiv=null;this._animation=null;this._baseLayerDiv=null;this._transformStyleName=aA.ifSupportCSS3("transform",true);this._transformOriginStyleName=aA.ifSupportCSS3("transformOrigin",true);this._preZoomTimes=1;this._preRenderTick=1;this._enableCanvas2dMap=!!(i.getRenderType()==="canvas");this._isIE9=!!(x.Browser.ie===9);var e=this;i.addEventListener("maptypechange",function(){e.hide()});i.addEventListener("load",function(){e.hide()})}x.extend(R.prototype,{prepareLayer:function(){var fn=this._map;var e=this._tileMgr;this._canvas2dMapMgr=fn.canvas2dMapMgr;var fm=this._baseLayerDiv=e.tilesDiv;if(!this._animationDiv){var i=this._preAnimationDiv;if(i){i.parentNode&&i.parentNode.removeChild(i);this._preAnimationDiv=null}this._preAnimationDiv=this._animationDiv=fm.cloneNode(true);fn.platform.insertBefore(this._animationDiv,fn.platform.firstChild)}this.show()},prepareAniParam:function(){var fn=this._animationDiv;if(!fn){return}var e=fn.children.length;var fm;this._zoomAniInfo=[];for(var fo=e-1;fo>-1;fo--){var fp={};fm=fn.children[fo].style;fp.top=parseInt(fm.top,10);fp.left=parseInt(fm.left,10);this._zoomAniInfo[fo]=fp}},prepareLabelLayer:function(){var fo=this._map;if(this._enableCanvas2dMap&&fo.canvas2dMapMgr){if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas)}var i=fo.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=i.cloneNode(false);var e=this.touchZoomLabelCanvas.getContext("2d");e.drawImage(i,0,0);fo.platform.insertBefore(this.touchZoomLabelCanvas,fo.platform.firstChild);var fn=parseInt(i.style.left,10);var fm=parseInt(i.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9;this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=(this._fixPosition.x-(fo.offsetX+fn))+"px "+(this._fixPosition.y-(fo.offsetY+fm))+"px";i.style.visibility="hidden"}},show:function(){if(this._animationDiv){this._animationDiv.style.visibility=""}},showLabel:function(){var i=this._map;if(this._enableCanvas2dMap&&i.canvas2dMapMgr){var e=i.canvas2dMapMgr._labelCanvas;if(e){e.style.visibility=""}if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.zIndex=-2;this.touchZoomLabelCanvas.style.visibility="hidden"}}},hide:function(){if(this._animationDiv){this._animationDiv.style.visibility="hidden"}if(this._preAnimationDiv){this._preAnimationDiv.style.visibility="hidden"}},hideNonAnimationLayers:function(){var fn=this._map;if(fn.getRenderType()==="dom"){if(fn.overlayDiv){fn.overlayDiv.style.visibility="hidden"}if(fn.overlayDivEx){fn.overlayDivEx.style.visibility="hidden"}}var fp=fn.tileMgr.tileLayers;var fo;for(var fm=0,e=fp.length;fm<e;fm++){fo=fp[fm];fo.tilesDiv.style.visibility="hidden"}},showNonAnimationLayers:function(){var fn=this._map;if(fn.getRenderType()==="dom"){if(fn.overlayDiv){fn.overlayDiv.style.visibility=""}if(fn.overlayDivEx){fn.overlayDivEx.style.visibility=""}}var fp=fn.tileMgr.tileLayers;var fo;for(var fm=0,e=fp.length;fm<e;fm++){fo=fp[fm];fo.tilesDiv.style.visibility=""}},setFixPosition:function(e){this._fixPosition=e},setZoom:function(e,ft){var fq=this._fixPosition;var fz=this._map;var fA=this._baseLayerDiv;var fr={x:fq.x-parseInt(fA.style.left,10)-fz.offsetX,y:fq.y-parseInt(fA.style.top,10)-fz.offsetY};var fn=this._animationDiv;if(!fn){return}var fx=fn.children.length;var fv;var fy=this._transformStyleName;var fp=this._transformOriginStyleName;var fB=this;var fD;var fs;for(var fw=fx-1;fw>-1;fw--){var fu=this._zoomAniInfo[fw];fv=fn.children[fw].style;var fo=fu.left-fr.x;var fm=fu.top-fr.y;fu.dx=fo*e-fo;fu.dy=fm*e-fm;fu.preDx=fo-fo;fu.preDy=fm-fm;fD=fu.preDx+(fu.dx-fu.preDx);fs=fu.preDy+(fu.dy-fu.preDy)+ft;fv.left=fu.left+fD+"px";fv.top=fu.top+fs+"px";fv.width=fv.height=256*e+"px"}if(this._enableCanvas2dMap){var fC=!fB._isIE9?"translate3d(0px, "+ft+"px, 0) scale("+e+")":"translate(0px, "+ft+"px) scale("+e+")";this.touchZoomLabelCanvas.style[fy]=fC}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(fq){this.prepareLayer();this.hideNonAnimationLayers();var fJ=this._map;if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.display="none"}fq=fq||{};var fH=fq.zoomCount||0;var fv=fq.fixPosition;var fF=fq.fixMCPosition;var ft=fq.pixOffset;this._zoomCount=fH;var fn=fJ.getZoom();var fI=fn+fH;var e=fJ.config.enableContinuousZoom;var fz=0.5;var fu=5;var fm=Math.pow(2,fH);var fL=this._baseLayerDiv;var fw={x:fv.x-parseInt(fL.style.left,10)-fJ.offsetX,y:fv.y-parseInt(fL.style.top,10)-fJ.offsetY};var fr=this._animationDiv;var fD=fr.children.length;var fN=this._preZoomTimes;var fG=[];var fE=this._transformStyleName;var fs=this._transformOriginStyleName;for(var fC=fD-1;fC>-1;fC--){var fA={};var fB=fr.children[fC].style;fA.top=parseInt(fB.top,10);fA.left=parseInt(fB.left,10);var fp=fA.left-fw.x;var fo=fA.top-fw.y;fA.dx=fp*fm-fp;fA.dy=fo*fm-fo;fA.preDx=fp*fN-fp;fA.preDy=fo*fN-fo;fG[fC]=fA}var fK=this;var fy;var fM;var fx;this._zoomAni=new l({fps:60,duration:e?500:1,transition:function(i){i=i*fu/(2*fz);return fu*i-fz*i*i},render:function(fW){fW=fW*(4*fz)/(fu*fu);fy=fN+fW*(fm-fN);var fP=fn+c1(fy);var fU=null;var fT=0;var fX=0;if(fq.onAnimationBeforeLooping){var fY=fq.onAnimationBeforeLooping(fW,fP);fU=fY.loopingCenter;fT=fY.yDiff;fX=fY.totalYDiff}for(var fQ=fG.length-1;fQ>-1;fQ--){var fR=fG[fQ];if(fr.children[fQ]){var fV=fr.children[fQ].style;fM=fR.preDx+(fR.dx-fR.preDx)*fW-ft.width*fW;fx=fR.preDy+(fR.dy-fR.preDy)*fW-ft.height*fW+fT;fV.left=fR.left+fM+"px";fV.top=fR.top+fx+"px";fV.height=fV.width=256*fy+"px"}}var fO=ft.width*fW;var fS=ft.height*fW;if(fJ.isRestrict){fK._enableCanvas2dMap&&fK._canvas2dMapMgr.clearLabel()}else{fK._enableCanvas2dMap&&fK._canvas2dMapMgr.drawLabel(fy,fv,fn,fI,fH,fW,fO,fS,fX,fT)}fK._preZoomTimes=fy;fK._preRenderTick=fW;fq.onAnimationLooping&&fq.onAnimationLooping(fW,fP,fU)},finish:function(){fK._preZoomTimes=1;fK._zoomAni=null;fK._animationDiv=null;fq.onAnimationFinish&&fq.onAnimationFinish();fK.showNonAnimationLayers()}});return this._zoomAni},stopAnimation:function(){if(this._zoomAni){this._zoomAni.stop();this._zoomAni=null}}});function c(e){this._initVars(e);this._initColorCanvas();this._bindEvent(e)}x.extend(c.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this._labelCtx=e._labelCtx;this.ratio=this._map.config.ratio;this.sizeRatio=this.ratio>1?2:1;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},_initColorCanvas:function(){var i=256,fm=H("canvas"),e=fm.style;e.width=i+"px";e.height=i+"px";fm.width=i;fm.height=i;this._colorCvsSize=i;this._colorCvs=fm;this._colorCtx=fm.getContext("2d")},getLabelImageData:function(fA){var fz=fA.textImg;var fm=fA.textPos;var fx=this.ratio;var fv=this.sizeRatio/fx;var fo=this._colorCtx;var fs=this._colorCvsSize;fo.clearRect(0,0,fs,fs);var fu=0;var e=0;var fr=0;for(var ft=0;ft<fm.length;ft++){if(fm[ft].width>fu){fu=fm[ft].width;e=ft;fr=fm[ft].drawX}}fu/=fv;var fw=0;for(var ft=0,fq=fm.length;ft<fq;ft++){var fy=fm[ft];var fB;if(ft===e){fB=0}else{fB=fy.drawX-fr}fo.drawImage(fz,fy.srcX,fy.srcY,fy.width,fy.height,fB,fw,fy.width/fv,fy.height/fv);if(fy.width/fv>fu){fu=fy.width/fv}fw+=fy.height/fv+2*fx}var fn=fo.getImageData(0,0,fu,fw);var fp=fo.getImageData(0,0,fu,fw);return[fn,fp]},_bindEvent:function(i){var e=this,fm=i._map;fm.addEventListener("onspotmouseover",function(fq){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(fq.spots.length>0){var fp=fq.spots[0].userdata.uid;var fo=fq.spots[0].userdata.name;var fn=e.findLabelByUid(fp,fo);fn&&e._toHighLightColor(fn)}});fm.addEventListener("onspotmouseout",function(fq){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(fq.spots.length>0){var fp=fq.spots[0].userdata.uid;var fo=fq.spots[0].userdata.name;var fn=e.findLabelByUid(fp,fo);fn&&e._toDefaultColor(fn)}});fm.addEventListener("onspotclick",function(fq){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(fq.spots&&fq.spots.length>0){var fp=fq.spots[0].userdata.uid;var fo=fq.spots[0].userdata.name;var fn=e.findLabelByUid(fp,fo);fn&&e._changeBaseMapState(fn)}else{e._recoverNormalState()}});fm.on("spot_status_reset",function(){e._recoverNormalState()});fm.on("spot_highlight",function(fo){var fn=e.findLabelByUid(fo.uid);fn&&e._changeBaseMapState(fn)})},_getTextBound:function(fy){if(!fy.textPos){return null}var fw=this.ratio;var fu=this.sizeRatio/fw;var fm=fy.textPos;var fx=fy.baseDrawX;var fv=fy.baseDrawY;var fs=fx*fw+(fm[0].drawX-fx)/fu;var fq=fv*fw+(fm[0].drawY-fv)/fu;var fo=fs+fm[0].width/fu;var e=fq+fm[0].height/fu;for(var ft=0,fr=fm.length;ft<fr;ft++){var fz=fm[ft];var fp=fx*fw+(fz.drawX-fx)/fu;if(fp<fs){fs=fp}var fn=fv*fw+(fz.drawY-fv)/fu;if(fn<fq){fq=fn}if(fp+fz.width>fo){fo=fp+fz.width}if(fn+fz.height>e){e=fn+fz.height}}return[fs,fq,fo,e]},_toHighLightColor:function(fm){if(fm._tempRank&&fm._tempRank==this.RANK5){return}var fr=this._getTextBound(fm);if(!fr){return}var fn=Math.round(fr[0]);var i=Math.round(fr[1]);var e=this.getLabelImageData(fm);var fp=e[0];var fo=e[1];var fq=this._canvas2dMapMgr.getFilterImageData(fp,this.RANK5);fm._oldImgData=fo;this._labelCtx.putImageData(fq,fn,i)},_toDefaultColor:function(e){if(e._tempRank&&e._tempRank==this.RANK5){return}if(e._oldImgData){var i=this.sizeRatio;var fm=this._getTextBound(e);if(!fm){return}this._labelCtx.putImageData(e._oldImgData,Math.round(fm[0]),Math.round(fm[1]));e._oldImgData=null}},_changeBaseMapState:function(fn){var fm=this._canvas2dMapMgr;var i=fn.guid;var e=fn.guidExt;var fo={guid:i,name:fn.name,guidExt:e};fm._labelStrategy.setStrategyInfo(fo);fm._loadData()},_recoverNormalState:function(){var e=this._canvas2dMapMgr;e._labelStrategy.setStrategyInfo(null);e._loadData()},findLabelByUid:function(fp,fn){var fr=this._canvas2dMapMgr,e=fr._computedLabel;for(var fo=0,fm=e.length;fo<fm;fo++){var fq=e[fo];if(!fr.isClickableLabel(fq)){continue}if(fp&&fq.guid===fp){return fq}if(fn&&fq.name===fn){return fq}}return null}});function cI(e){this._initVars(e)}x.extend(cI.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.ratio=this._map.config.ratio;this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},setStrategyInfo:function(e){this._strategyInfo=e},preComputeLabel:function(ft,gk,f3,fF,ge,gy){var fX=[],fB=ft._centerX,fz=ft._centerY,gz=fF*ge;var f9=this.ratio;var fs=this._map.getZoom();var fS=0;if(fs===5){fS=4}if(fs===8){fS=-6}ft.sort(function(gA,i){if(gA.x*gA.y<i.x*i.y){return -1}else{return 1}});for(var fU=0,fQ=ft.length;fU<fQ;fU++){var gp=ft[fU],fL=gp.x,fI=gp.y,fG=gp.z;var fN=cD.calcLoopParam(fL,fG).offsetX;var f7=fL*gz,f6=(fI+1)*gz,fn=(f7-fB)/fF+gk/2+fN,fm=(fz-f6)/fF+f3/2;for(var fR=0,gt=gp.length;fR<gt;fR++){var fv=gp[fR],fC=undefined,fA=undefined,gr=undefined,gq=undefined;var gg=fv.baseDrawX=fn+fv.baseX;var gf=fv.baseDrawY=fm+fv.baseY;if(fv.type=="fixed"){var f1=fv.iconPos,fE=fv.textPos,gv=fv.textImg;if(f1){f1.drawX=fn+f1.destX;f1.drawY=fm+f1.destY;fC=f1.drawX;fA=f1.drawY;gr=f1.drawX+f1.width;gq=f1.drawY+f1.height}if(fE&&gv){for(var gh=0;gh<fE.length;gh++){var gu=fE[gh];gu.drawX=fn+gu.destX;gu.drawY=fm+gu.destY;if(!fC){fC=gu.drawX;fA=gu.drawY;gr=gu.drawX+gu.width;gq=gu.drawY+gu.height}else{if(gu.drawX<fC){fC=gu.drawX}if(gu.drawY<fA){fA=gu.drawY}if(gu.drawX+gu.width>gr){gr=gu.drawX+gu.width}if(gu.drawY+gu.height>gq){gq=gu.drawY+gu.height}}}}}else{fv.tileX=fn;fv.tileY=fm;fC=fn+fv.minXOriginal;fA=fm+fv.minYOriginal;gr=fn+fv.maxXOriginal;gq=fm+fv.maxYOriginal}if(fC!=undefined){var gj=gg+(fC-gg)/f9;var gi=gf+(fA-gf)/f9;var fV=gg+(gr-gg)/f9;var fT=gf+(gq-gf)/f9;fv.minX=gj;fv.minY=gi;fv.maxX=fV;fv.maxY=fT;var gn=(gj+fV)/2,gm=(gi+fT)/2,f4=fB+(gn-gk/2)*fF,f2=fz+(f3/2-gm)*fF;fv.geoX=f4;fv.geoY=f2;fX.push(fv)}}}if(gy){for(var fU=0,fQ=gy.length;fU<fQ;fU++){var fP=gy[fU];var gc=fP[0];var fw=fP[1];var f1=gc.iconPos;var fq=f1.geoX;var fo=f1.geoY;var gg=(fq-fB)/fF+gk/2;var gf=(fz-fo)/fF+f3/2;var fC=gg+f1.destX;var fA=gf+f1.destY;var gr=fC+f1.width;var gq=fA+f1.height;gc.textPos=gc.textPos||gc._textPos;var fE=gc.textPos;var gl=fE[0];var fK=gg+gl.destX;var fy=gf+gl.destY;if(fy<fA){fA=fy}if(fK+gl.width>gr){gr=fK+gl.width}if(fy+gl.height>gq){gq=fy+gl.height}if(fE.length===2){var fJ=fE[1];var fH=gg+fJ.destX;var fx=gf+fJ.destY;if(fx<fA){fA=fx}if(fH+fJ.width>gr){gr=fH+fJ.width}if(fx+fJ.height>gq){gq=fx+fJ.height}}gc._tempBounds=[fC,fA,gr,gq];var f1=fw.iconPos;var fq=f1.geoX;var fo=f1.geoY;var gg=(fq-fB)/fF+gk/2;var gf=(fz-fo)/fF+f3/2;var fC=gg+f1.destX;var fA=gf+f1.destY;var gr=fC+f1.width;var gq=fA+f1.height;fw.textPos=fw.textPos||fw._textPos;var fE=fw.textPos;var gl=fE[0];var fK=gg+gl.destX;var fy=gf+gl.destY;if(fK<fC){fC=fK}if(fy<fA){fA=fy}if(fy+gl.height>gq){gq=fy+gl.height}if(fE.length===2){var fJ=fE[1];var fH=gg+fJ.destX;var fx=gf+fJ.destY;if(fH<fC){fC=fH}if(fx<fA){fA=fx}if(fx+fJ.height>gq){gq=fx+fJ.height}}fw._tempBounds=[fC,fA,gr,gq]}for(var fU=0,fQ=gy.length;fU<fQ;fU++){var fP=gy[fU];var gc=fP[0];var fw=fP[1];if(fU===0&&fw.textPos){fw._textPos=fw.textPos;delete fw.textPos}var go=gc;if(!gc.textPos&&fw.textPos){go=fw}var gs=go._tempBounds;for(fR=fU+1;fR<fQ;fR++){var fO=gy[fR];var fY=fO[0];var gx=fO[1];var fD=0;var gw=fY._tempBounds;if(!(gs[2]<gw[0]||gs[0]>gw[2]||gs[3]<gw[1]||gs[1]>gw[3])){fD++;if(fY.textPos){fY._textPos=fY.textPos;delete fY.textPos}}var gw=gx._tempBounds;if(!(gs[2]<gw[0]||gs[0]>gw[2]||gs[3]<gw[1]||gs[1]>gw[3])){fD++;if(gx.textPos){gx._textPos=gx.textPos;delete gx.textPos}}if(fD>=2){if(go.textPos){go._textPos=go.textPos;delete go.textPos}}}}for(var fU=0,fQ=gy.length;fU<fQ;fU++){var fP=gy[fU];var gc=fP[0];var fw=fP[1];var fZ=gc;if(!gc.textPos&&fw.textPos){fZ=fw}var f1=fZ.iconPos;var fq=f1.geoX;var fo=f1.geoY;var gg=fZ.baseDrawX=(fq-fB)/fF+gk/2;var gf=fZ.baseDrawY=(fz-fo)/fF+f3/2;f1.drawX=gg+f1.destX;f1.drawY=gf+f1.destY;var fC=f1.drawX;var fA=f1.drawY;var gr=f1.drawX+f1.width;var gq=f1.drawY+f1.height;var fE=fZ.textPos;if(fE){var gl=fE[0];gl.drawX=gg+gl.destX;gl.drawY=gf+gl.destY;if(gl.drawX<fC){fC=gl.drawX}if(gl.drawY<fA){fA=gl.drawY}if(gl.drawX+gl.width>gr){gr=gl.drawX+gl.width}if(gl.drawY+gl.height>gq){gq=gl.drawY+gl.height}if(fE.length===2){var fJ=fE[1];fJ.drawX=gg+fJ.destX;fJ.drawY=gf+fJ.destY;if(fJ.drawX<fC){fC=fJ.drawX}if(fJ.drawY<fA){fA=fJ.drawY}if(fJ.drawX+fJ.width>gr){gr=fJ.drawX+fJ.width}if(fJ.drawY+fJ.height>gq){gq=fJ.drawY+fJ.height}}}var gj=gg+(fC-gg)/f9;var gi=gf+(fA-gf)/f9;var fV=gg+(gr-gg)/f9;var fT=gf+(gq-gf)/f9;fZ.minX=gj;fZ.minY=gi;fZ.maxX=fV;fZ.maxY=fT;var gb=(gj+fV)/2;var ga=(gi+fT)/2;var fr=fB+(gb-gk/2)*fF;var fp=fz+(f3/2-ga)*fF;fZ.geoX=fr;fZ.geoY=fp;fX.push(fZ)}}var gd=this._strategyInfo;if(gd){var fW=gd.guid;var f5=gd.name;var fM=gd.guidExt;for(var fU=0,fQ=fX.length;fU<fQ;fU++){var fu=fX[fU];delete fu._tempRank;if(!this._canvas2dMapMgr.isClickableLabel(fu)||(fM===1&&!fu.guidExt)){continue}if((fW&&fW===fu.guid)||(f5&&f5===fu.name)){fu._tempRank=this.RANK5}}}else{for(var fU=0,fQ=fX.length;fU<fQ;fU++){var fu=fX[fU];if(fu.type=="line"||!fu.iconPos){continue}delete fu._tempRank}}fX.sort(function(gB,gA){var gC=gB._tempRank?gB._tempRank:gB.rank,i=gA._tempRank?gA._tempRank:gA.rank;if(gC===i){return gB.baseX-gA.baseX}return i-gC});for(var fU=0,fQ=fX.length;fU<fQ;fU++){var go=fX[fU];go.isDel=false;go.isFadeout=false;go._schedule=0;go._isIgnore=false;go.arrIntersectIndex=[];for(fR=fU+1;fR<fQ;fR++){var f0=fX[fR];if(!(go.maxX-fS<f0.minX||go.minX>f0.maxX-fS||go.maxY-fS<f0.minY||go.minY>f0.maxY-fS)){go.arrIntersectIndex.push(fR)}}}for(var fU=0,fQ=fX.length;fU<fQ;fU++){var fu=fX[fU];if(fu.isDel==false){var e=fu.arrIntersectIndex;for(var fR=0,gt=e.length;fR<gt;fR++){var f8=fX[e[fR]];f8.isDel=true;if(f8.guidExt===1){f8.isDel=false}}}}return fX}});function Q(e){this._map=e;this._initCanvas();this._initVars();this._bindEvent();this._tileType=bF.getInstance("na")}aI.register(function(i){if(i.getRenderType()==="canvas"){var e=i.config.style;if(aI["FeatureStyle"+e]){i.canvas2dMapMgr=new Q(i)}else{i.loadMapStyleFiles(function(){i.canvas2dMapMgr=new Q(i);i.canvas2dMapMgr._loadData()})}}});x.extend(Q.prototype,{_initCanvas:function(){var fq=this._map,fo=fq.getSize(),fn=fo.width,i=fo.height,e=fq.platform,fr=H("canvas"),fp=fr.style;var fm=this.ratio=fq.config.ratio;this._width=fn;this._height=i;fp.cssText="position: absolute;left:0;top:0;width:"+fn+"px;height:"+i+"px;z-index:100;";fr.width=fn*fm;fr.height=i*fm;this._labelCanvas=fr;this._labelCtx=fr.getContext("2d");e.appendChild(fr)},_initVars:function(){var e=ad("ditu","normal");this._udt=e.udt;this._version=e.ver;this._labelDataUrls=be.B_NORMAL_MAP.vectorTileUrls;this._style=aI["FeatureStyle"+this._map.config.style];this._labelCount=0;this._vectorDrawLib=new ar(this);this._cache={maxNum:500,delNum:50,arrCache:[]};this._computedLabel=null;this._spotData=null;this._labelStrategy=new cI(this);this._labelClick=new c(this);this._biz=new eE(this);this._map.temp.isPermitSpotOver=true;this.labelStyleParam="pl";if(this._map.getMapType()===BMAP_SATELLITE_MAP){this.labelStyleParam="sl"}this.statRequestCount=0;this.statResponseCount=0},_resizeHandler:function(fp){var fr=this,i=fr._map,fo=i.getSize(),fm=fo.width,ft=fo.height;var fq=this.ratio;var fu=this._labelCanvas,fn=fu.style;fn.width=fm+"px";fn.height=ft+"px";fu.width=fm*fq;fu.height=ft*fq;fr._width=fm;fr._height=ft;var fs=true;fr._loadData(fs)},_bindEvent:function(){var e=this,i=e._map;i.addEventListener("load",function(fm){e.clearLabel();e._loadData()});i.addEventListener("zoomend",function(fm){if(!fm.notClearLabel){e.clearLabel()}e._loadData()});i.addEventListener("moveend",function(fm){e._loadData()});i.addEventListener("resize",function(fm){e._resizeHandler(fm)});i.addEventListener("maptypechange",function(fm){if(fm.mapType===BMAP_EARTH_MAP){e.hideLabelCanvas()}else{e.showLabelCanvas();if(fm.mapType===BMAP_NORMAL_MAP){e.labelStyleParam="pl"}else{if(fm.mapType===BMAP_SATELLITE_MAP){e.labelStyleParam="sl"}}e._loadData()}});i.addEventListener("streetlayer_show",function(fm){if(this.isCanvasMap()){e.showLabelCanvas()}});i.addEventListener("streetlayer_hide",function(fm){if(this.isCanvasMap()){e.hideLabelCanvas()}});i.addEventListener("loadbizdata",function(fn){var fm=fn.data;e._biz.proecessBizData(fm,function(){e.updateLabel()})});i.addEventListener("unloadbizdata",function(fm){e._biz.clearBizData();e.updateLabel()});e.isDrawText=false;setTimeout(function(){if(!e.isDrawText){i.dispatchEvent(new aB("onmapwhitescreen"))}},10000)},getStyle:function(){return this._style},_getZoomUnits:function(e){return Math.pow(2,18-e)},_createCacheForm:function(fm,fr,fq,i){var fp=this;var e=fp._cache;var fn=e.arrCache;var fs=this._getLabelId(fm,fr,fq,i);var fo={id:fs,updateLabelCounter:0};fn.push(fo);fn[fs]=fo;return fo},_getLabelId:function(i,fn,fm,e){return"_"+i+"_"+fn+"_"+fm+"_"+e+"_"+this.labelStyleParam},_getCache:function(i,fn,fm,e){return this._cache.arrCache[this._getLabelId(i,fn,fm,e)]},_setCacheValue:function(fo,fB,fz,fn,fu){var fw=this;var e=fw._cache;var fq=e.arrCache;var fs=e.maxNum;var fp=e.delNum;var fA=this._getLabelId(fo,fB,fz,fn);var fv=fq[fA];if(fu){fv.lb=fu}if(fq.length>fs){var fm=fq.splice(0,fp);for(var ft=0,fr=fm.length;ft<fr;ft++){var fx=fm[ft],fy=fx.id;if(fq[fy].lb){fq[fy].lb=null}fq[fy]=null;delete fq[fy]}fm=null}},_loadData:function(fz){var fS=this._map;if(!fS.isCanvasMap()){return}var fs=fS.getCenterIn();var fR=cD.calcLoopCenterPoint(fs);var fr=this._tileType;var fu=this._width/2;var fG=this._height;var fH=fS.getZoom();var fD=fr.getDataZoom(fH);var fw=fS.getZoomUnits(fH);var fC=fw*fu;var fQ=fR.lng-fC;var fP=fR.lng+fC;var fA=cD.isAddWidth(fQ,fP);fu=fA?fu*1.5:fu;var fB=fr.getTileSize(fH);var fo=fr.getMercatorSize(fH,fD);var fv=Math.floor(fR.lng/fo);var fx=Math.floor(fR.lat/fo);var fp=[fv,fx,(fR.lng-fv*fo)/fo*fB,(fR.lat-fx*fo)/fo*fB];var fJ=fp[0]-Math.ceil((fu-fp[2])/fB);var fN=fp[1]-Math.ceil((fG/2-fp[3])/fB);var fF=fp[0]+Math.ceil((fu+fp[2])/fB);var fK=fp[1]+Math.ceil((fG/2+fp[3])/fB);fS.temp.isPermitSpotOver=false;var e=[];for(var fM=fJ;fM<fF;fM++){for(var fL=fN;fL<fK;fL++){e.push([fM,fL,fD]);var fE="id_"+fM+"_"+fL+"_"+fH;e[fE]=true}}e._zoom=fD;e=cD.calcLoopTiles(e,fH);e.sort((function(i){return function(fU,fV){return((0.4*Math.abs(fU[0]-i[0])+0.6*Math.abs(fU[1]-i[1]))-(0.4*Math.abs(fV[0]-i[0])+0.6*Math.abs(fV[1]-i[1])))}})([fp[0],fp[1]]));var fy=this._cache.arrCache;this._curViewLabels=[];var fn="viewKey_"+Math.floor(fs.lng)+"_"+Math.floor(fs.lat)+"_"+fH;this.statRequestCount=0;this.statResponseCount=0;this._labelCount+=e.length;var ft=fH;for(var fM=0,fI=e.length;fM<fI;fM++){var fv=e[fM][0];var fx=e[fM][1];var fm=e[fM][2];var fq=this._getLabelId(fv,fx,fm,ft);var fO=fy[fq];if(!fO){fO=this._createCacheForm(fv,fx,fm,ft)}if(typeof fO.lb==="undefined"){fO.lb=null;this._loadLabelData(fv,fx,fm,ft,fB,fn);this.statRequestCount++}else{if(fO.lb){this._curViewLabels.push(fO.lb);this._labelCount--}else{if(fz){this._loadLabelData(fv,fx,fm,ft,fB,fn)}fO.updateLabelCounter++}}}if(this._labelCount===0){this.updateLabel()}var fT=this;if(fT.errorTimer){clearTimeout(fT.errorTimer)}fT.errorTimer=setTimeout(function(){if(fT._labelCount!==0){fT._labelCount=0;fT.updateLabel()}var fV=new aB("onloaddatatimeout");var fW=0;var fU=0;var fX=0;var i=0;if(fT.statRequestCount===fT.statResponseCount){fW=1}else{fU=1}if(fU===1){i=fT.statRequestCount-fT.statResponseCount;fX=fT.statResponseCount}fV.noTimeoutCount=fW;fV.timeoutCount=fU;fV.timeoutNoLoaded=i;fV.timeoutLoaded=fX;fT._map.dispatchEvent(fV)},500)},clearLabel:function(){var e=this._width;var fm=this._height;var i=this.ratio;this._labelCtx.clearRect(0,0,e*i,fm*i)},updateLabel:function(){var i=this._map;var e=i.getCenterIn();var fn=this._width;var fq=this._height;var ft=i.getZoom();var fs=this._tileType.getTileSize(ft);var fr=this._getZoomUnits(ft);var fm=this._labelCtx;this._labelCanvas.style.left=-i.offsetX+"px";this._labelCanvas.style.top=-i.offsetY+"px";var fp=this._curViewLabels;fp._centerX=e.lng;fp._centerY=e.lat;var fo=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(fp,fn,fq,fr,fs,fo);this._computedLabel._zoom=ft;this.clearLabel();this._vectorDrawLib.drawIconAndText(fm,this._computedLabel,ft);this._addSpotData();i.temp.isPermitSpotOver=true;if(fp.length>0){this.isDrawText=true}},_loadLabelData:function(fw,fv,fu,fm,fx,e){var fp=fw.toString();var fn=fv.toString();var fr="cbk_"+fp.replace("-","_")+"_"+fn.replace("-","__")+"_"+Math.floor(fu);var fB=cZ+"."+fr;var fA=this._labelDataUrls;var ft=Math.abs(fw+fv)%fA.length;var fG=fA[ft];if(window.offLineIPAddress){fG=window.offLineIPAddress+"pvd/"}var i=this.labelStyleParam;var fz="?qt=vtile";var fC="";if(this._map.config.style!=="default"){fC="&styleId="+dn.mapStyleNameIdPair[this._map.config.style]}var fy="x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}"+fC+"&textonly=1&textimg=1&scaler={scaler}&fn="+encodeURIComponent(fB);var fD=cD.calcLoopParam(fw,fu).col;var fs=this.ratio>1?2:1;var fq=fy.replace(/{x}/,fD).replace(/{y}/,fv).replace(/{z}/,Math.floor(fu)).replace(/{styles}/,i).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,fs);var fo=fG+fz+"&param="+window.encodeURIComponent(ek(fq));var fF=this;var fE=fF._map;aI[fr]=function(fH){fF._vectorDrawLib.parseLabelData(fH,fw,fv,fu,fm,fx,function(fM){var fJ=fE.getCenterIn();var fN=fE.getZoom();var fP="viewKey_"+Math.floor(fJ.lng)+"_"+Math.floor(fJ.lat)+"_"+fN;fF._labelCount--;var fQ=fF._getCache(fw,fv,fu,fm).updateLabelCounter;fF._labelCount-=fQ;var fK=fF._curViewLabels;if(fP===e||(fF._labelCount<0&&fN===fu)){fK.push(fM)}if(fP===e){fF.statResponseCount++}if(fF._labelCount<=0){var fI=(new Date()).getTime();fF.updateLabel();var fL=(new Date()).getTime();var fO=new aB("oncanvasmaploaded");fO.drawTime=fL-fI;if(fF.statResponseCount===fF.statRequestCount){fO.isAllLoadedDrawing=true}fE.dispatchEvent(fO)}fF._setCacheValue(fw,fv,fu,fm,fM);delete aI[fr]})};eZ.load(fo)},drawLabel:function(fm,fn,fu,i,fs,fo,e,fp,ft,fq){var fr=this;if(!fr._computedLabel){return}if(fr._computedLabel._zoom!==fu){fr.clearLabel();return}fr._map.temp.isPermitSpotOver=false;fr.clearLabel();fr._vectorDrawLib.zoomingIconAndText(this._labelCtx,fr._computedLabel,fm,fn,i,fs,fo,e,fp,ft,fq)},_addSpotData:function(){this._spotData=[];var fu=this._map.getZoom();for(var fp=0,fo=this._computedLabel.length;fp<fo;fp++){var fr=this._computedLabel[fp];if(!this.isClickableLabel(fr)||(fr.guidExt===1&&fr.startScale>fu)){continue}var fq=[];fq[0]=(fr.minX-fr.maxX)/2;fq[1]=(fr.minY-fr.maxY)/2;fq[2]=(fr.maxX-fr.minX)/2;fq[3]=(fr.maxY-fr.minY)/2;var fn=null;if(fr.iconPos){fn=new e4(fr.iconPos.geoX,fr.iconPos.geoY)}var fm=fr.name?fr.name.replace("\\\\","<br>"):"";if(fr.iconPos&&fr.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14){fm=""}var ft={n:fm,pt:new e4(fr.geoX,fr.geoY),userdata:{iconPoint:fn,uid:fr.guid,name:fm,type:fr.iconPos?fr.iconPos.iconType:"",iconImg:fr.iconImg,mapPoi:true,adver_log:fr.adver_log||""},bd:fq,tag:"MAP_SPOT_INFO"};this._spotData.push(ft)}var fs=new aB("onspotsdataready");fs.spots=this._spotData;this._map._spotDataOnCanvas=this._spotData;this._map.dispatchEvent(fs)},isClickableLabel:function(e){if(e.isDel||(!e.guid&&!e.name)){return false}return true},getFilterImageData:function(fm,fq){var fr=fm.data,fp=this._labelStrategy,fq=parseInt(fq);for(var fs=0,fo=fr.length;fs<fo;fs+=4){var e=fr[fs],ft=fr[fs+1],fu=fr[fs+2],fv=fr[fs+3];if(fv===0){continue}var fn=Math.round((e+ft+fu)/3);var fw=fn-90;fw=fw<0?0:fw;if(fq===fp.RANK5){fr[fs]=51+fw*1.3;fr[fs+1]=133+fw*0.8;fr[fs+2]=255}}return fm},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}});var bg=5;var cA=4;var e2=3;var dw=2;var fg=1;var cC=0;var fj=3;var eU=5;var B={3:{start:3,base:3},4:{start:4,base:5},5:{start:4,base:5},6:{start:6,base:7},7:{start:6,base:7},8:{start:8,base:9},9:{start:8,base:9},10:{start:10,base:10},11:{start:11,base:12},12:{start:11,base:12},13:{start:11,base:12},14:{start:14,base:15},15:{start:14,base:15},16:{start:16,base:17},17:{start:16,base:17},18:{start:18,base:19},19:{start:18,base:19},20:{start:18,base:19},21:{start:18,base:19}};function ar(fn){this._canvas2dMapMgr=fn;var i=this.ratio=fn._map.config.ratio;this._featureStyle=null;this._map=fn._map;var fm=dJ();var e="udt="+fm.udt+"&v="+fm.ver;this.sizeRatio=this.ratio>1?2:1;this._binaryCache={};this._iconCache={};this._initColorCanvas()}x.extend(ar.prototype,{_initColorCanvas:function(){var i=256,fm=H("canvas"),e=fm.style;e.width=i+"px";e.height=i+"px";fm.width=i;fm.height=i;this._colorCvs=fm;this._colorCtx=fm.getContext("2d")},parseLabelData:function(i,fp,fo,fn,e,fs,fr){if(!this._featureStyle){this._featureStyle=this._canvas2dMapMgr.getStyle()}if(!i||!i[0]){fr([]);return}var fq=this._map.getZoomUnits();var fm=this;this.loadTextPng(i,fs,fp,fo,fn,e,fq,fr)},loadTextPng:function(fE,fv,ft,fs,fq,i,fo,fn){var fD=this;var e=fE[5];var fC=this._map;var fz=fC.getZoom();var fm=fC.getSize();var fA=fm.width;var fy=fm.height;var fB=fC.getCenterIn();var fr=fB.lng;var fp=fB.lat;var fx=ft*fv*fo;var fw=(fs+1)*fv*fo;if(e){var fu=new Image();fu.onload=function(){fD.calcIconAndTextInfo(fE,fu,fv,ft,fs,fq,i,fo,fx,fw,fn);delete this.onload};fu.src=e}else{setTimeout(function(){fD.calcIconAndTextInfo(fE,null,fv,ft,fs,fq,i,fo,fx,fw,fn)},1)}},calcIconAndTextInfo:function(fG,fx,fy,fw,ft,fr,fn,fp,fA,fz,fo){var fF=this;var fE=fF._featureStyle;var fu=[];fu.x=fw;fu.y=ft;fu.z=fr;var fv=fF._canvas2dMapMgr,fm=fw*fp*fy,fD=(ft+1)*fp*fy,fq={tileLeft:fm,tileTop:fD,zoomUnits:fp};var e=[];if(fG[0]){for(var fB=0;fB<fG[0].length;fB++){if(fG[0][fB][0]===fj){e.push(fG[0][fB])}}}var fs=fG[2]||[];for(var fB=0;fB<e.length;fB++){this._getFixedLabelInfo(e[fB],fx,fn,fp,fy,fA,fz,fu)}var fC=Math.pow(2,fn-fr);for(fB=0;fB<fs.length;fB++){this._getLineLabelInfo(fs[fB],fx,fr,fn,fp,fy,fA,fz,fC,fu)}fo(fu)},_getFixedLabelInfo:function(fx,fB,fo,fs,fC,fF,fE,fH){var fw=fx[1];if(!fw){return}var fJ=this._map.getZoom();var fR=this._map.config.style;var fS=this._featureStyle;var ft=fo;if(ft===9){ft=8}for(var fO=0;fO<fw.length;fO++){var fT=fw[fO];var e=fT[0];var fn=cP.getStyleFromCache(fR,e,"point",ft,fS);var fN=cP.getStyleFromCache(fR,e,"pointText",ft,fS);if((!fN||fN.length===0)&&(!fn||fn.length===0)){if(ft===5){var fr=fT[1];if(!fr){continue}for(var fK=0;fK<fr.length;fK++){var fI=fr[fK][4];if(fI&&fI[7]==="北京"){fn=cP.getStyleFromCache(fR,e,"point",6,fS);fN=cP.getStyleFromCache(fR,e,"pointText",6,fS);break}else{continue}}}else{continue}}var fr=fT[1];if(!fr){continue}var fP=null;var fu=1;var fm=0;var fA=0;if(fn&&fn[0]){fn=fn[0];fP=fn.icon;fu=fn.zoom?fn.zoom/100:1}else{fn=null}for(var fK=0;fK<fr.length;fK++){var fI=fr[fK][4];if(!fI){continue}var fM=fI[2];if(!this._isVisible(fM,fJ)){continue}var fv=fI[12];if(fN&&fN.length>0&&!fv){continue}var fz=Math.round(fI[0]/100);var fy=Math.round(fI[1]/100);var fL={lng:fF+fz,lat:fE-(fC*fs-fy)};var fq=fz/fs;var fp=fC-fy/fs;var fD=fI[7]||"";var fQ=fI[5];var fG={type:"fixed",name:fD,textImg:fB,rank:fI[4],baseX:fq,baseY:fp,iconPos:null,textPos:null,guid:fI[3]||"",tracer:fM,direction:fQ,startScale:3};if((fQ!==cA&&fv||!fv)&&fP!==null){fG.iconPos=this._getIconPosition(fP,fu,fq,fp,fL);if(fG.iconPos){fm=fG.iconPos.width;fA=fG.iconPos.height}}if(fm===0){fG.direction=cA}if(fv){fG.textPos=this._getTextDrawData(fI,fq,fp,fm,fA)}if(fG.textPos||fG.iconPos){fH.push(fG)}}}},_isVisible:function(e,i){var fn;if(!this._binaryCache[e]){fn=e.toString(2);if(fn.length<8){fn=new Array(8-fn.length+1).join("0")+fn}this._binaryCache[e]=fn}fn=this._binaryCache[e];var fm=B[i].start;return fn[i-fm]==="1"},_getIconPosition:function(fr,fp,fm,i,e){var fn=this._map.config.style;var fs=aI["iconSetInfo"+fn][fr];if(!fs){if(fr.charCodeAt(0)>=48&&fr.charCodeAt(0)<=57){fs=aI["iconSetInfo"+fn]["_"+fr]}}if(!fs){return null}var fo=fs[0];var fq=fs[1];fo=fo*fp;fq=fq*fp;return{srcX:0,srcY:0,destX:fm-fo/2,destY:i-fq/2,width:fo,height:fq,geoX:e.lng,geoY:e.lat,mcPt:e,iconType:fr}},_getTextDrawData:function(fy,fx,fw,fn,fu){var fD=fy[5];if(typeof fD!=="number"){fD=0}var fs=this.ratio;var fr=fs/2;fn*=fr;fu*=fr;var ft=fy[12];var fo=ft.length;var fG=0;var fF=0;var fC=[];var fB=0;var fE=0;for(var fA=0;fA<fo;fA++){fE+=Math.round(ft[fA][3])}for(var fA=0;fA<fo;fA++){var fq=ft[fA];var fp=fq[0];var i=fq[1];var fm=fq[2];var e=fq[3];var fH=2*fs;var fz=0;if(fn!==0){fz=2*fs}if(fn===0){fD=cA}switch(fD){case e2:var fv=fw-fE/2-fH*(fo-1)/2;fG=fx-fm-fn/2-fz;fF=fv+fB+fH*fA;break;case fg:var fv=fw-fE/2-fH*(fo-1)/2;fG=fx+fn/2+fz;fF=fv+fB+fH*fA;break;case dw:var fv=fw-fu/2-fE-fH*(fo-1)-fH;fG=fx-fm/2;fF=fv+fB+fH*fA;break;case cC:var fv=fw+fu/2+fH/2;fG=fx-fm/2;fF=fv+fB+fH*fA;break;case cA:var fv=fw-e/2-fH*(fo-1)/2;fG=fx-fm/2;fF=fv+fB+fH*fA;break}fB+=e;if(fm>0&&e>0){fC.push({srcX:fp,srcY:i,destX:fG,destY:fF,width:fm,height:e})}}if(fC.length>0){return fC}return null},_getLineLabelInfo:function(fv,fn,fo,fK,fX,fC,fI,fH,fJ,fB){if(fv.length!==10){return}var fM=this.ratio;var fm=this.ratio;var fT=fv[7].length;var fD=fv[1];var fV=fv[3];var f1=fv[8];var fr=fv[4];var e=2;var fp=fr.slice(0,e);for(var fY=e;fY<fr.length;fY+=e){fp[fY]=fp[fY-e]+fr[fY];fp[fY+1]=fp[fY-(e-1)]+fr[fY+1]}for(var fY=e;fY<fr.length;fY+=e){if(fY%(fV*e)===0||fY%(fV*e)===1){continue}fp[fY]=fp[fY-e]+fr[fY]/fJ;fp[fY+1]=fp[fY-(e-1)]+fr[fY+1]/fJ}for(var f0=0;f0<fT;f0++){var fW=fv[7][f0];if(!this._isVisible(fW,fK)){continue}var fO=fv[6][f0];var fA=f0*fV*e;fr=fp.slice(fA,fA+fV*e);var fE=[];var fN=undefined;var fL=undefined;var fz=undefined;var fy=undefined;var f1=fv[9].slice(0);if(fO){f1.reverse()}var fR;var fP;for(var fZ=0;fZ<fV;fZ++){var fx=fv[5][fV*f0+fZ];var fS=fr[fZ*e]/100;var fQ=fr[fZ*e+1]/100;var fw=f1[fZ];var fs=fw[0];var fu=fw[1];var fq=fw[2];var ft=fw[3];var fG;var fF;var f3;var f2;if(fZ===0){fR=f3=fS/fX;fP=fC-fQ/fX;f2=fQ/fX}else{f3=fS/fX;f2=fQ/fX}var f5=fR+(f3-fR)*fm-fq/2;var f4=fP+(fC-f2-fP)*fm-ft/2;if(fN===undefined){fN=fR-fq/2;fL=fP-ft/2;fz=fN+fq;fy=fL+ft}else{if(f5<fN){fN=f5}if(f4<fL){fL=f4}if(f5+fq>fz){fz=f5+fq}if(f4+ft>fy){fy=f4+ft}}fE.push({angle:fx,srcX:fs,srcY:fu,destX:f5,destY:f4,width:fq,height:ft})}var fU={type:"line",textImg:fn,rank:fD,baseX:fR,baseY:fP,arrWordPos:fE,minXOriginal:fN,minYOriginal:fL,maxXOriginal:fz,maxYOriginal:fy,text:""};fB.push(fU)}},alterColor:function(fq,e,fp){var fm=this._colorCtx,i=this._canvas2dMapMgr;fm.clearRect(0,0,fq.width,fq.height);fm.drawImage(e,fq.srcX,fq.srcY,fq.width,fq.height,0,0,fq.width,fq.height);var fo=fm.getImageData(0,0,fq.width,fq.height),fn=i.getFilterImageData(fo,fp);fm.putImageData(fn,0,0)},drawIconAndText:function(fC,fB,e){var ft=this.ratio;var fr=this.sizeRatio/ft;var fv=2/ft;var fN=this;for(var fF=0,fD=fB.length;fF<fD;fF++){var fu=fB[fF];if(fu.isDel==false){var fo=fu.baseDrawX;var fn=fu.baseDrawY;if(fu.type=="fixed"){var fq=fu.iconPos,fG=fu.textPos,fz=fu.textImg,fJ=fu.startScale;if(fq&&fJ<=e){var fm=this._iconCache[fq.iconType];if(fm){if(fm.img){fC.drawImage(fm.img,0,0,fm.img.width,fm.img.height,Math.round(fo*ft+(fq.drawX-fo)/fv),Math.round(fn*ft+(fq.drawY-fn)/fv),fq.width/fv,fq.height/fv)}else{fm.drawLabels.push(fu)}}else{if(!fm){this._iconCache[fq.iconType]={img:null,drawLabels:[fu]};var fP=new Image();fP._iconName=fq.iconType;fP.onload=function(){var fV=fN._iconCache[this._iconName];fV.img=this;this.onload=null;for(var fR=0;fR<fV.drawLabels.length;fR++){var fT=fV.drawLabels[fR];var fS=fT.baseDrawX;var fQ=fT.baseDrawY;var fU=fT.iconPos;fC.drawImage(this,0,0,this.width,this.height,Math.round(fS*ft+(fU.drawX-fS)/fv),Math.round(fQ*ft+(fU.drawY-fQ)/fv),fU.width/fv,fU.height/fv)}fV.drawPos=[]};fP.src=dn.getIconSetPath(fN._map.config.style)+fq.iconType+".png"}}}if(fG&&fz&&fJ<=e){for(var fs=0;fs<fG.length;fs++){var fA=fG[fs];if(!fu._tempRank){fC.drawImage(fz,fA.srcX,fA.srcY,fA.width,fA.height,Math.round(fo*ft+(fA.drawX-fo)/fr),Math.round(fn*ft+(fA.drawY-fn)/fr),fA.width/fr,fA.height/fr)}else{this.alterColor(fA,fz,fu._tempRank);fC.drawImage(this._colorCvs,0,0,fA.width,fA.height,Math.round(fo*ft+(fA.drawX-fo)/fr),Math.round(fn*ft+(fA.drawY-fn)/fr),fA.width/fr,fA.height/fr)}}}}else{var fp=fu.arrWordPos,fz=fu.textImg,fy=fu.tileX,fw=fu.tileY;for(var fE=0,fx=fp.length;fE<fx;fE++){var fH=fp[fE];var fO=Math.round(fy+fH.destX);var fM=Math.round(fw+fH.destY);var fI=fH.angle;fO=fo*ft+fO-fo;fM=fn*ft+fM-fn;if(fI>10&&fI<350){fC.save();var fL=Math.round(fO+fH.width/2);var fK=Math.round(fM+fH.height/2);fC.translate(fL,fK);fC.rotate(-fI/180*Math.PI);fC.drawImage(fz,fH.srcX,fH.srcY,fH.width,fH.height,-Math.round(fH.width/2),-Math.round(fH.height/2),fH.width/fr,fH.height/fr);fC.restore()}else{fC.drawImage(fz,fH.srcX,fH.srcY,fH.width,fH.height,fO,fM,fH.width/fr,fH.height/fr)}}}}}},isCollide:function(fp,fy,fx,e,fr,fm,ft){for(var fo=0,fn=fm.length;fo<fn;fo++){var fs=fm[fo],fq=1/Math.pow(2,ft+1),fw=fq*fs[3]/2,fv=fq*fs[4]/2,fu=fs[0];if(fu!=fp){if(!(fy+e<fs[1]-fw||fy>fs[1]+fs[3]+fw||fx+fr<fs[2]-fv||fx>fs[2]+fs[4]+fv)){return true}}}return false},zoomingIconAndText:function(fN,fH,fn,fL,fM,ge,fU,fv,f0,fT,fE){var gf=this.ratio;var fw=this.sizeRatio/gf;var gg=2/gf;var gq=gf/2;var ga=fL.x;var f9=fL.y;var fO=2*gf;if(fE!==0){f9+=fT}var fz=undefined,fs=undefined,fp=undefined,fu=undefined,fD=undefined;var fZ=ge>0?true:false;if(!fZ){fz=[];var f3=1-fU}for(var gm=0,gk=fH.length;gm<gk;gm++){var gh=fH[gm];if(gh.isDel==false){var gr=gh.baseDrawX;var go=gh.baseDrawY;fN.save();fN.translate(-fv*gf,-f0*gf);if(gh.isFadeout){if(!fZ&&gh._schedule<=fU&&!gh._isIgnore){fN.globalAlpha=f3;gh._schedule=fU}else{gh._isIgnore=true;continue}}if(gh.type=="fixed"){var fP=gh.iconPos,fW=gh.textPos,fq=gh.textImg,fQ=gh.startScale;var fm;var f7=0;if(fP){f7=fO}if(fP&&!gh.iconImg&&this._iconCache[fP.iconType]){fm=this._iconCache[fP.iconType].img}if(fP&&fQ<=fM&&fm){fu=fP.width;fD=fP.height;fs=(ga+(gr-ga)*fn)*gf-fu/2/gg;fp=(f9+(go-f9)*fn)*gf-fD/2/gg+fE;if(!fZ&&this.isCollide(gm,fs,fp,fu,fD,fz,ge)){gh.isFadeout=true}fN.drawImage(fm,fP.srcX,fP.srcY,fm.width,fm.height,Math.round(fs),Math.round(fp),fu/gg,fD/gg);!fZ&&fz.push([gm,fs,fp,fu,fD])}if(fW&&fq&&fQ<=fM){var fV;var fX;var fG=0;var fS=0;if(fP){fG=fP.width;fS=fP.height}var f8=fW.length;var fy=0;var fY=0;for(var fI=0;fI<f8;fI++){var gj=fW[fI];fY+=gj.height;if(fy<gj.width){fy=gj.width}}fY+=(fI-1)*fO;if(!fZ&&this.isCollide(gm,fs,fp,fy,fY,fz,ge)){gh.isFadeout=true}var gi=0;for(var fI=0;fI<f8;fI++){var gj=fW[fI];switch(gh.direction){case e2:fV=-(fG/2/gg+gj.width+f7);fX=-fY/2+gi+fO*fI;break;case fg:fV=fG/2/gg+f7;fX=-fY/2+gi+fO*fI;break;case dw:fV=-gj.width/2;fX=-fS/2/gg-fY+gi-fO*(fI+1);break;case cC:fV=-gj.width/2;fX=fS/2/gg+gi+fO*(fI+1);break;case cA:fV=-gj.width/2;fX=-fY/2+gi+fO*fI;break}gi+=gj.height;fs=(ga+(gr-ga)*fn)*gf+fV/fw;fp=(f9+(go-f9)*fn)*gf+fX/fw;+fE;fu=gj.width;fD=gj.height;if(!gh._tempRank){fN.drawImage(fq,gj.srcX,gj.srcY,fu,fD,Math.round(fs),Math.round(fp),fu/fw,fD/fw)}else{this.alterColor(gj,fq,gh._tempRank);fN.drawImage(this._colorCvs,0,0,fu,fD,Math.round(fs),Math.round(fp),fu/fw,fD/fw)}!fZ&&fz.push([gm,fs,fp,fu,fD])}}}else{var fF=gh.arrWordPos,fq=gh.textImg,gp=gh.tileX,gn=gh.tileY;var fx=fF[0];var ft=Math.round(gp+fx.destX);var fr=Math.round(gn+fx.destY);for(var gl=0,f6=fF.length;gl<f6;gl++){var gd=fF[gl];var gt=Math.round(gp+gd.destX);var gs=Math.round(gn+gd.destY);var fK=gd.angle;var f5=Math.round((ga+(gr-ga)*fn)*gf-fx.width/2+gt-ft);var f4=Math.round((f9+(go-f9)*fn)*gf-fx.height/2+gs-fr);fs=f5;fp=f4;fu=gd.width;fD=gd.height;if(!fZ&&this.isCollide(gm,fs,fp,fu,fD,fz,ge)){gh.isFadeout=true}if(fK>10&&fK<350){var gc=f5+gd.width/2;var gb=f4+gd.height/2;var fo=fK/180*Math.PI;var fR=Math.cos(fo);var fA=Math.sin(fo);var f2=fR;var fB=fR;var f1=fA;var fC=-fA;var fJ=gc-gc*fR-gb*fA;var e=gb+gc*fA-gb*fR;fN.save();fN.transform(f2,fC,f1,fB,fJ,e);fN.drawImage(fq,gd.srcX,gd.srcY,fu,fD,fs,fp,fu/fw,fD/fw);fN.restore()}else{fN.drawImage(fq,gd.srcX,gd.srcY,fu,fD,fs,fp,fu/fw,fD/fw)}!fZ&&fz.push([gm,fs,fp,fu,fD])}}fN.restore()}}}});function eE(e){this.initVars(e)}x.extend(eE.prototype,{initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.base64Prefix="data:image/png;base64,";this.bizData=null;this.objTextsPng=null;this.arrIconsPng=null;this.bizLabels=null},proecessBizData:function(fp,ft){var fr=this;this.bizData=fp;this.objTextsPng=null;this.arrIconsPng=null;var fm=fp.textsPng;var fv=fp.iconsPng;if(!fm||!fv){return}var fs=new Image();fs.onload=function(){fr.objTextsPng=this;fr.calcIconAndTextInfo(ft);this.onload=null};fs.src=this.base64Prefix+fm;var fu=fv.length;var e=[];for(var fo=0;fo<fu;fo++){var fq=fv[fo];var fn=new Image();(function(i){fn.onload=function(){fu--;e[i]=this;if(fu===0){fr.arrIconsPng=e;fr.calcIconAndTextInfo(ft)}this.onload=null}})(fo);fn.src=this.base64Prefix+fq}},calcIconAndTextInfo:function(fw){if(this.objTextsPng&&this.arrIconsPng){var fs=this.bizData;var fq=fs.pois;var e=[];for(var ft=0,fp=fq.length;ft<fp;ft++){var fn=fq[ft];var fr=this.arrIconsPng[fn.iconPng];var fo=fr.height/2;var fv={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:fr,rank:fn.rank,iconPos:{srcX:0,srcY:0,destX:-fr.width/2,destY:-fo/2,width:fr.width,height:fo,geoX:fn.x,geoY:fn.y,iconType:"vectorCustom"},textPos:this.calcTextPos(fn.pos,fr),startScale:fn.from<12?12:fn.from,guid:fn.guid,guidExt:1,adver_log:fn.adver_log||""};var fm={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:fr,rank:fn.rank,iconPos:{srcX:0,srcY:0,destX:-fr.width/2,destY:-fo/2,width:fr.width,height:fo,geoX:fn.x,geoY:fn.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(fn.pos,fr),startScale:fn.from<12?12:fn.from,guid:fn.guid,guidExt:1,adver_log:fn.adver_log||""};var fu=[fv,fm];e.push(fu)}this.bizLabels=e;fw&&fw()}},calcTextPos:function(fq,fm){var i=[];var fp=fq.length/4;var fo=fm.width/2;if(fp===1){var fn={srcX:fq[0],srcY:fq[1],destX:fo,destY:-fq[3]/2,width:fq[2],height:fq[3]};i.push(fn)}else{var fn={srcX:fq[0],srcY:fq[1],destX:fo,destY:-fq[3],width:fq[2],height:fq[3]};var e={srcX:fq[4],srcY:fq[5],destX:fo,destY:0,width:fq[6],height:fq[7]};i.push(fn);i.push(e)}return i},calcTextPosLeft:function(fq,fm){var i=[];var fp=fq.length/4;var fo=fm.width/2;if(fp===1){var fn={srcX:fq[0],srcY:fq[1],destX:-fo-fq[2],destY:-fq[3]/2,width:fq[2],height:fq[3]};i.push(fn)}else{var fn={srcX:fq[0],srcY:fq[1],destX:-fo-fq[2],destY:-fq[3],width:fq[2],height:fq[3]};var e={srcX:fq[4],srcY:fq[5],destX:-fo-fq[2],destY:0,width:fq[6],height:fq[7]};i.push(fn);i.push(e)}return i},clearBizData:function(){this.bizData=null;this.bizLabels=null}});function bU(){}x.extend(bU.prototype,{centerAndZoomIn:function(fm,ft,fu){fu=fu||{};if(!this.loaded){this.firstTileLoad=false}ft=this._getProperZoom(ft).zoom;if(fu.noAnimation!==true&&this.loaded){var fp=this._ifUseAnimation(fm,ft);if(fp){this.flyToIn(fm,ft,fu);return}}var fr=this;if(!fm&&!ft){return}this._stopAllAnimations();if(fm&&!fm.equals(this.centerPoint)){this.fire(new aB("oncenter_changed"))}if(ft&&ft!==this.zoomLevel){this.fire(new aB("onzoom_changed"))}fm=fm||this.centerPoint;ft=ft||this.zoomLevel;ft=this._getProperZoom(ft).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAP_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function fs(){fr._earth=new aI.Earth(fr,{showRealSunlight:fr.config.showRealSunlight,showMilkyway:fr.config.showMilkyway,earthBackground:fr.config.earthBackground});fr._proxyEarthEvents();fr._changeEarthMapType(BMAP_EARTH_MAP);x.extend(fr,aI.EarthView.prototype);delete fr.temp.originMapType}cH.load("earth",function(){if(aI["FeatureStyle"+fr.config.style]){fs()}else{fr.loadMapStyleFiles(function(){fs()})}})}}this.lastLevel=this.zoomLevel||ft;this.zoomLevel=ft;var fq=new aB("onload");fq.point=fm;fq.zoom=ft;this.centerPoint=new e4(fm.lng,fm.lat);this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(this.mapType!==BMAP_EARTH_MAP){this.centerPoint=this.restrictCenter(this.centerPoint)}if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var fo=new bT(i,"baidu",this.mapType);var fn=new bI({mapType:this.mapType,copyright:fo,dataType:eq,customLayer:false,baseLayer:true,tileTypeName:"na"});fn._isInnerLayer=true;this.addTileLayer(fn);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}this.baseLayerAdded=true;this.on("zoom_changed",function(){if(this._heading===0){return}if(this.getZoom()<7&&this.config.restrictCenter===true){fr.resetHeading()}})}this.loaded=true;this.dispatchEvent(fq);fu.callback&&fu.callback()},_ifUseAnimation:function(fn,fs){var fr=this.getSize();var fm={zoom:this.zoomLevel};var fu={zoom:fs};var ft=this.pointToPixelIn(this.centerPoint);var fo=this.pointToPixelIn(fn,fm);var fq=this.pointToPixelIn(this.centerPoint,fu);var fw=this.pointToPixelIn(fn,fu);var fp=Math.abs(ft.x-fo.x);var i=Math.abs(ft.y-fo.y);var e=Math.abs(fq.x-fw.x);var fv=Math.abs(fq.y-fw.y);if((fp>fr.width||i>fr.height)&&(e>fr.width||fv>fr.height)){return false}return true},_setPlatformPosition:function(fu,ft,fw){fw=fw||{};if(fu===0&&ft===0&&!fw.point){return}if(isNaN(fw.initMapOffsetX)){fw.initMapOffsetX=this.offsetX}if(isNaN(fw.initMapOffsetY)){fw.initMapOffsetY=this.offsetY}var fq=cr(this._heading);if(this._tilt>0){ft=ft/Math.cos(cr(this._tilt))}var fv=fu*Math.cos(fq)+ft*Math.sin(fq);var fs=-fu*Math.sin(fq)+ft*Math.cos(fq);fv=fv+fw.initMapOffsetX;fs=fs+fw.initMapOffsetY;if(fw.point){var i=this.restrictCenter(fw.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new aB("oncenter_changed"))}}else{var fn=this.offsetX-fv;var e=this.offsetY-fs;var fr=this.centerPoint.lng;var fp=this.centerPoint.lat;var fo=new e4(fr,fp);var fm=this.getZoomUnits();this.centerPoint=this.restrictCenter(new e4(fo.lng+fn*fm,fo.lat-e*fm),fm);this.fire(new aB("oncenter_changed"))}this.offsetX=fv;this.offsetY=fs;this.dispatchEvent(new aB("onmoving"))},restrictCenter:function(fn,fo){if(this.config.restrictCenter===false){return fn}fo=fo||this.getZoomUnits();var fm=this.pixelToPointIn(new cO(0,0),{center:fn});var i=this.pixelToPointIn(new cO(0,this.height),{center:fn});if(this.zoomLevel<5){if(fm.lat>bV.MAX_LAT&&i.lat<bV.MIN_LAT){var fp=bV.MAX_LAT-fn.lat;var e=fn.lat-bV.MIN_LAT;var fr;if(fp<e){fr=fp/(this.height/2)}else{fr=e/(this.height/2)}var fq=18-c1(fr);this.zoomLevel=fq;return fn}}if(fm.lat>bV.MAX_LAT){fn.lat=bV.MAX_LAT-this.height/2*fo}else{if(i.lat<bV.MIN_LAT){fn.lat=bV.MIN_LAT+this.height/2*fo}}return fn},zoomTo:function(e,fy,fz){var fu=be[this.mapType];if(!fu){return}var ft=this._getProperZoom(e);e=ft.zoom;if(this.zoomLevel===e){return}var fp=e;this.lastLevel=this.zoomLevel;fz=fz||{};if(this.zoomEventStatus==="idle"){this.fire(new aB("onzoomstart"));this.zoomEventStatus="zooming"}if(!fy&&(this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen())){fy=this.getInfoWindow().getPoint()}var fm;if(fy){fm=this.pointToPixelIn(fy)}var fq=this.pixelToPointIn(fm);var fr=this.centerPoint.clone();this.fixPoint=fy;this.fixPixel=fm;this.fixCenter=fr;this.mousePosMCPoint=fq;if(fz.noAnimation){e=ft.zoom;this.zoomLevel=e;this.fire(new aB("onzoom_changed"));var fo=this.getCurrentMaxTilt();if(this._tilt>fo){this._tilt=fo}if(fy){if(this._heading%360!==0||this._tilt>0){var i=this._webglMapCamera.fromScreenPixelToMC(fm.x,fm.y,{center:fr,zoom:this.zoomLevel});if(i){var fv=i.sub(fq);var fn=fr.sub(fv);this.centerPoint=this.restrictCenter(fn)}}else{var fs=this.getZoomUnits();var fn=new e4(fy.lng-fs*(fm.x-this.width/2),fy.lat+fs*(fm.y-this.height/2));this.centerPoint=this.restrictCenter(fn,fs)}this.fire(new aB("oncenter_changed"))}this._checkFireZoomend();return}this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel,target:e};var fw=this;fz.callback=function(){fw._checkFireZoomend()};var fx=this._tilt;if(this.fixPoint||fx>bV.MAX_DRAG_TILT_L2){fz.renderCallback=function(){var fD=fw.getCurrentMaxTilt();if(fw._tilt>fD){fw._tilt=fD}var fE=fw.fixPixel;if(!fw.fixPixel||!fw.fixPoint){return}var fA=fw.fixPixel;var fK=fw.fixPoint;var fH=fw.fixCenter;var fF=fw.mousePosMCPoint;if(fw._heading%360!==0||fw._tilt>0){var fB=fw._webglMapCamera.fromScreenPixelToMC(fA.x,fA.y,{center:fH,zoom:fw.zoomLevel,tilt:fw._tilt});if(fB){var fJ=fB.sub(fF);var fC=fH.sub(fJ);fw.centerPoint=fw.restrictCenter(fC)}}else{var fG=fA;var fI=fw.getZoomUnits();var fC=new e4(fK.lng-fI*(fG.x-fw.width/2),fK.lat+fI*(fG.y-fw.height/2));fw.centerPoint=fw.restrictCenter(fC,fI)}fw.fire(new aB("oncenter_changed"))}}if(fz.fromMouseWheel===true){this._startInfiniteZoomAnimation(fz);return}this._startAnimation(fz)},_checkFireZoomend:function(){var e=this;if(e.fireZoomendTimer){clearTimeout(e.fireZoomendTimer)}e.fireZoomendTimer=setTimeout(function(){if(e.zoomEventStatus==="zooming"){e.fire(new aB("onzoomend"));e.zoomEventStatus="idle"}e.fireZoomendTimer=null},150)},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(e){this.zoomTo(e)},flyToIn:function(fm,fR,fC){fC=fC||{};var fo=this._getProperZoom(fR);fR=fo.zoom;if(this.centerPoint.equals(fm)&&this.zoomLevel===fR&&typeof fC.heading!=="number"&&typeof fC.tilt!=="number"){return}var e=this.getHeading()%360;var fu=this.getTilt();var fA=0;var fE=0;var fx=this.getBounds().containsPoint(fm);if(typeof fC.heading==="number"){fA=fC.heading}else{if(fx){fA=e}}if(typeof fC.tilt==="number"){fE=fC.tilt}else{if(fx){fE=fu}}this._heading=e;var fO=fA-e;var fK=fE-fu;var fy=this;var fq=this.zoomLevel;var fr=1.42;var fG=this.zoomScale(fR-fq);var fT=this.getZoomUnits();var fw=this.centerPoint.div(fT);var fU=fm.div(fT);var fN=this.worldSize();var fJ=fr;var fI=Math.max(this.width,this.height);var fH=fI/fG;var fv=fU.sub(fw).mag();var i=fJ*fJ;function fQ(fW){var fV=(fH*fH-fI*fI+(fW?-1:1)*i*i*fv*fv)/(2*(fW?fH:fI)*i*fv);return Math.log(Math.sqrt(fV*fV+1)-fV)}function fn(fV){return(Math.exp(fV)-Math.exp(-fV))/2}function fs(fV){return(Math.exp(fV)+Math.exp(-fV))/2}function fB(fV){return fn(fV)/fs(fV)}var ft=fQ(0);var fL=function(fV){return(fs(ft)/fs(ft+fJ*fV))};var fM=function(fV){return fI*((fs(ft)*fB(ft+fJ*fV)-fn(ft))/i)/fv};var fp=(fQ(1)-ft)/fJ;if(Math.abs(fv)<0.000001||fp===Infinity||isNaN(fp)){if(Math.abs(fI-fH)<0.000001){this._animationInfo.zoom={current:this.zoomLevel,diff:fR-this.zoomLevel};this._animationInfo.center={current:this.centerPoint,diff:fm.sub(this.centerPoint)};this._animationInfo.heading={current:e,diff:fA-e};this._animationInfo.tilt={current:fu,diff:fE-fu};this.setLock(true);this._startAnimation({callback:function(fV){fy.setLock(false);if(fC.callback){fC.callback(fV)}},duration:fC.duration});return}var fS=fH<fI?-1:1;fp=Math.abs(Math.log(fH/fI))/fJ;fM=function(){return 0};fL=function(fV){return Math.exp(fS*fJ*fV)}}var fP=1.7;if(fp<0.3){fP=0.8}else{if(fp>5){fP=(fp-5)/2+fP}}var fD=fC.duration||1000*fp/fP;if(isNaN(fD)){var fF={};for(var fz in fC){fF[fz]=fC[fz];fF.noAnimation=true}this.centerAndZoomIn(fm,fR,fF);return}this.fire(new aB("onmovestart"));this.fire(new aB("onzoomstart"));this.setLock(true);this._startAnimation({duration:fD,renderCallback:function(fV,fW){var fX=fV*fp;var f0=fM(fX);var fZ=fq+fy.scaleZoom(1/fL(fX));if(fZ<fy.getMinZoom()){fZ=fy.getMinZoom()}if(fZ>fy.getMaxZoom()){fZ=fy.getMaxZoom()}if(fZ!==fy.zoomLevel){fy.zoomLevel=fZ;fy.fire(new aB("onzoom_changed"))}fy.centerPoint=fw.add(fU.sub(fw).mult(f0)).mult(fT);fy.fire(new aB("oncenter_changed"));if(typeof fA==="number"){var fY=fV/0.7;if(fY>1){fY=1}fy.setHeading(e+fO*fV,{noAnimation:true})}if(typeof fE==="number"){fy.setTilt(fu+fK*fV,{noAnimation:true})}},callback:function(fV,fW){fy.setLock(false);if(fW&&fW.stop===true){fy.fire(new aB("onmoveend"));fy.fire(new aB("onzoomend"));fC.callback&&fC.callback(fV);return}if(fR!==fy.zoomLevel){fy.zoomLevel=fR;fy.fire(new aB("onzoom_changed"))}fy.fire(new aB("onmoveend"));fy.fire(new aB("onzoomend"));fC.callback&&fC.callback(fV)}})},zoomScale:function(e){return Math.pow(2,e)},scaleZoom:function(e){return Math.log(e)/Math.LN2},panToIn:function(i,fm){fm=fm||{};if(!i||i.equals(this.centerPoint)){fm.callback&&fm.callback();return}var fn=this.pointToPixelIn(i);var e=Math.round(this.width/2);var fp=Math.round(this.height/2);var fo=this._ifUseAnimation(i,this.zoomLevel);if(fm.noAnimation===true||fo===false){this._stopAllAnimations();this._panToIn(e-fn.x,fp-fn.y,i);fm.callback&&fm.callback();return}this.flyToIn(i,this.zoomLevel,fm)},_panToIn:function(i,e,fn){var fm=this.temp;if(fm.operating===true){return}if(fm.dragAni){fm.dragAni.stop(false,{readyToMove:true});fm.dragAni=null}this.dispatchEvent(new aB("onmovestart"));this._setPlatformPosition(i,e,{point:fn});this.dispatchEvent(new aB("onmoveend"))},_stopAllAnimations:function(e){e=e||{};if(this._ani){this._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation});this._ani=null}if(this._infiniteAni){this._infiniteAni.stop();this._infiniteAni=null}},panBy:function(i,e,fm){i=Math.round(i)||0;e=Math.round(e)||0;fm=fm||{};if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&fm.noAnimation!==true){this._panBy(i,e,fm)}else{this._panToIn(i,e,fm.point);fm.callback&&fm.callback()}},_panBy:function(i,e,fo){if(this.temp.operating===true){return}fo=fo||{};this.dispatchEvent(new aB("onmovestart"));var fn=this;var fm=fn.temp;fm.pl=fn.offsetX;fm.pt=fn.offsetY;if(fm.tlPan){fm.tlPan.cancel()}if(fm.dragAni){fm.dragAni.stop(false,{readyToMove:true});fm.dragAni=null}fm.tlPan=new l({fps:fo.fps||fn.config.fps,duration:fo.duration||fn.config.actionDuration,transition:fo.transition||bq.easeInOutQuad,render:function(fp){this.terminative=fn.temp.operating;if(fn.temp.operating){return}fn._setPlatformPosition(i*fp,e*fp,{initMapOffsetX:fm.pl,initMapOffsetY:fm.pt})},finish:function(fp){fn.dispatchEvent(new aB("onmoveend"));fn.temp.tlPan=false;if(fn.temp.stopArrow===true){fn.temp.stopArrow=false;if(fn.temp.arrow!==0){fn._arrow()}}}})},_startAnimation:function(i){var fo=this._animationInfo;console.log(fo);var fm=this;i=i||{};if(fm._ani){fm._ani.stop(!!i.goToEnd,{stopCurrentAnimation:i.stopCurrentAnimation})}if(fm._infiniteAni){fm._infiniteAni.stop();fm._infiniteAni=null}var fp=i.duration||500;var fq=i.transition||bq.ease;var e=new aB("onanimation_start");this.fire(e);if(i.unstopable){fo=this._animationInfoUnstopable}var fn=new l({duration:fp,transition:fq,render:function(ft,fs){for(var fr in fo){if(!fo.hasOwnProperty(fr)){continue}var fv=fo[fr].current;var fu=fo[fr].diff;fm._setValueTick(fr,fv,fu,ft)}if(i.renderCallback){i.renderCallback(ft,fs)}},finish:function(fr){fm.fire(new aB("onanimation_end"));if(i.unstopable){fm._animationInfoUnstopable={};fm._unstopableAni=null}else{fm._ani=null;fm._animationInfo={}}if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(fr)}},onStop:function(fr){fr=fr||{};fm.fire(new aB("onanimation_end"));if(fr.stopCurrentAnimation){fm._animationInfo={}}fm._ani=null;if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(null,{stop:true})}}});if(i.unstopable){fm._unstopableAni=fn}else{fm._ani=fn}},_startInfiniteZoomAnimation:function(e){var i=this;if(i._ani){i._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation})}if(i._infiniteAni){return}this.fire(new aB("onanimation_start"));i._infiniteAni=new l({duration:10000,transition:bq.linear,render:function(){var fm=i._animationInfo.zoom;if(Math.abs(fm.current-fm.target)<0.001){i._setValue("zoom",fm.target);i._infiniteAni.stop();return}fm.current+=(fm.target-fm.current)*0.35;i._setValue("zoom",fm.current);if(e.renderCallback){e.renderCallback()}},finish:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new aB("onanimation_end"));if(e.callback){e.callback()}},onStop:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new aB("onanimation_end"));if(e.callback){e.callback()}}})},_setValue:function(e,fm){if(e==="zoom"){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(fm);fm=i.zoom;if(fm!==this.zoomLevel){this.zoomLevel=fm;if(fm<5){this.restrictCenter(this.centerPoint)}this.fire(new aB("on"+e+"_changed"))}return}else{if(e==="center"){this.centerPoint=fm}}this["_"+e]=fm;this.fire(new aB("on"+e+"_changed"))},_setValueTick:function(e,fo,fn,i){if(e==="center"){var fm=new e4(fo.lng+fn.lng*i,fo.lat+fn.lat*i);this._setValue(e,fm);return}if(e==="zoom"){this._setValue(e,Math.pow(fo,1-i)*Math.pow(fo+fn,i));return}this._setValue(e,fo+fn*i)},setHeading:function(fn,i){i=i||{};if(fn===this._heading){i.callback&&i.callback();return}var fm=d4(this._heading,360);var e=d4(fn,360);if(e===fm){this._heading=fn;i.callback&&i.callback();return}if(i.noAnimation){this._setValue("heading",fn);i.callback&&i.callback();return}if(i.unstopable){this._animationInfoUnstopable.heading={current:this._heading,diff:fn-this._heading}}else{this._animationInfo.heading={current:this._heading,diff:fn-this._heading}}this._startAnimation(i)},resetHeading:function(e){var i=this._heading;while(i<0){i+=360}i=i%360;if(i>180){i-=360}this._heading=i;e=e||{};e.unstopable=true;this.setHeading(0,e)},getHeading:function(){return this._heading},setTilt:function(e,i){i=i||{};if(e===this._tilt){i.callback&&i.callback();return}if(e>bV.MAX_TILT){e=bV.MAX_TILT}if(e<bV.MIN_TILT){e=bV.MIN_TILT}if(i&&i.noAnimation){this._setValue("tilt",e);i.callback&&i.callback();return}this._animationInfo.tilt={current:this._tilt,diff:e-this._tilt};this._startAnimation(i)},getTilt:function(){return this._tilt},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(fm){fm=fm||{};var e=fm.center||this.centerPoint;var fn=fm.zoom||this.zoomLevel;var fq=typeof fm.heading==="number"?fm.heading:this._heading;var i=typeof fm.tilt==="number"?fm.tilt:this._tilt;var fp=this._webglMapCamera.generateMVMatrix(e,fn,fq,i);var fo=mat4.create(Float32Array);mat4.invert(fo,fp);return this._webglMapCamera.getPosition(fo)}});function dU(i){this._jobQueue=[];this._idleOnlyJobQueue=[];var e=this;this.isIdle=true;i.on("updateframe",function(fn){var fm=12-fn.frameTime;fm=fm<1?1:fm;e.isIdle=false;if(e.idleWorkTimer){clearInterval(e.idleWorkTimer);e.idleWorkTimer=null}e.runJobs(fm)});this._idleWorkerTicker=(function(fm){return function(){if(fm.isIdle){fm.runJobs();fm.runIdleOnlyJobs()}}})(this);i.on("mapglidle",function(){e.isIdle=true;e.runJobs();e.runIdleOnlyJobs();e.idleWorkTimer=setInterval(e._idleWorkerTicker,dU.MAX_IDLE_TIME)})}dU.MAX_IDLE_TIME=50;dU.MAX_FRAME_TIME=6;dU.prototype.runJobs=function(i){if(this._jobQueue.length===0){return}var fn=dK();var e=0;i=i||dU.MAX_FRAME_TIME;while(this._jobQueue.length&&e<i){var fm=this._jobQueue.shift();if(fm.state!=="invalid"){fm.call()}e=dK()-fn}};dU.prototype.runIdleOnlyJobs=function(){if(this._idleOnlyJobQueue.length===0){return}var fm=dK();var e=0;while(this._idleOnlyJobQueue.length&&e<dU.MAX_IDLE_TIME){var i=this._idleOnlyJobQueue.shift();if(i.state!=="invalid"){i.call()}e=dK()-fm}};dU.prototype.checkIdleRunning=function(){if(this.isIdle&&!this.idleWorkTimer){this.runJobs();this.runIdleOnlyJobs();this.idleWorkTimer=setInterval(this._idleWorkerTicker,50)}};dU.prototype.addJob=function(e){this._jobQueue.push(e);this.checkIdleRunning()};dU.prototype.clearJobs=function(){this._jobQueue.length=0;this._idleOnlyJobQueue.length=0};dU.prototype.addIdleOnlyJob=function(e){this._idleOnlyJobQueue.push(e);this.checkIdleRunning()};var bi={};(function(fq){if(!fu){var fu=0.000001}if(!i){var i=(typeof Float32Array!=="undefined")?Float32Array:Array}if(!fo){var fo=Math.random}var fm={};var fp=Math.PI/180;fm.toRadian=function(fv){return fv*fp};var ft={};ft.create=function(fw){fw=fw||i;var fv=new fw(2);fv[0]=0;fv[1]=0;return fv};ft.clone=function(fv,fx){fx=fx||i;var fw=new fx(2);fw[0]=fv[0];fw[1]=fv[1];return fw};ft.fromValues=function(fv,fy,fx){fx=fx||i;var fw=new fx(2);fw[0]=fv;fw[1]=fy;return fw};ft.copy=function(fw,fv){fw[0]=fv[0];fw[1]=fv[1];return fw};ft.set=function(fw,fv,fx){fw[0]=fv;fw[1]=fx;return fw};ft.add=function(fx,fw,fv){fx[0]=fw[0]+fv[0];fx[1]=fw[1]+fv[1];return fx};ft.subtract=function(fx,fw,fv){fx[0]=fw[0]-fv[0];fx[1]=fw[1]-fv[1];return fx};ft.sub=ft.subtract;ft.multiply=function(fx,fw,fv){fx[0]=fw[0]*fv[0];fx[1]=fw[1]*fv[1];return fx};ft.mul=ft.multiply;ft.divide=function(fx,fw,fv){fx[0]=fw[0]/fv[0];fx[1]=fw[1]/fv[1];return fx};ft.div=ft.divide;ft.min=function(fx,fw,fv){fx[0]=Math.min(fw[0],fv[0]);fx[1]=Math.min(fw[1],fv[1]);return fx};ft.max=function(fx,fw,fv){fx[0]=Math.max(fw[0],fv[0]);fx[1]=Math.max(fw[1],fv[1]);return fx};ft.scale=function(fx,fw,fv){fx[0]=fw[0]*fv;fx[1]=fw[1]*fv;return fx};ft.scaleAndAdd=function(fx,fw,fv,fy){fx[0]=fw[0]+(fv[0]*fy);fx[1]=fw[1]+(fv[1]*fy);return fx};ft.distance=function(fx,fw){var fv=fw[0]-fx[0],fy=fw[1]-fx[1];return Math.sqrt(fv*fv+fy*fy)};ft.dist=ft.distance;ft.squaredDistance=function(fx,fw){var fv=fw[0]-fx[0],fy=fw[1]-fx[1];return fv*fv+fy*fy};ft.sqrDist=ft.squaredDistance;ft.length=function(fw){var fv=fw[0],fx=fw[1];return Math.sqrt(fv*fv+fx*fx)};ft.len=ft.length;ft.squaredLength=function(fw){var fv=fw[0],fx=fw[1];return fv*fv+fx*fx};ft.sqrLen=ft.squaredLength;ft.negate=function(fw,fv){fw[0]=-fv[0];fw[1]=-fv[1];return fw};ft.normalize=function(fy,fx){var fw=fx[0],fz=fx[1];var fv=fw*fw+fz*fz;if(fv>0){fv=1/Math.sqrt(fv);fy[0]=fx[0]*fv;fy[1]=fx[1]*fv}return fy};ft.dot=function(fw,fv){return fw[0]*fv[0]+fw[1]*fv[1]};ft.cross=function(fx,fw,fv){var fy=fw[0]*fv[1]-fw[1]*fv[0];fx[0]=fx[1]=0;fx[2]=fy;return fx};ft.lerp=function(fx,fw,fv,fy){var fA=fw[0],fz=fw[1];fx[0]=fA+fy*(fv[0]-fA);fx[1]=fz+fy*(fv[1]-fz);return fx};ft.random=function(fv,fx){fx=fx||1;var fw=fo()*2*Math.PI;fv[0]=Math.cos(fw)*fx;fv[1]=Math.sin(fw)*fx;return fv};ft.transformMat2=function(fy,fx,fw){var fv=fx[0],fz=fx[1];fy[0]=fw[0]*fv+fw[2]*fz;fy[1]=fw[1]*fv+fw[3]*fz;return fy};ft.transformMat2d=function(fy,fx,fw){var fv=fx[0],fz=fx[1];fy[0]=fw[0]*fv+fw[2]*fz+fw[4];fy[1]=fw[1]*fv+fw[3]*fz+fw[5];return fy};ft.transformMat3=function(fy,fx,fw){var fv=fx[0],fz=fx[1];fy[0]=fw[0]*fv+fw[3]*fz+fw[6];fy[1]=fw[1]*fv+fw[4]*fz+fw[7];return fy};ft.transformMat4=function(fy,fx,fw){var fv=fx[0],fz=fx[1];fy[0]=fw[0]*fv+fw[4]*fz+fw[12];fy[1]=fw[1]*fv+fw[5]*fz+fw[13];return fy};ft.rotate=function(fy,fw,fv,fC){var fB=fw[0]-fv[0];var fA=fw[1]-fv[1];var fx=Math.sin(fC);var fz=Math.cos(fC);fy[0]=fB*fz-fA*fx+fv[0];fy[1]=fB*fx+fA*fz+fv[1];return fy};ft.forEach=(function(){var fv=ft.create();return function(fy,fC,fD,fB,fA,fw){var fz,fx;if(!fC){fC=2}if(!fD){fD=0}if(fB){fx=Math.min((fB*fC)+fD,fy.length)}else{fx=fy.length}for(fz=fD;fz<fx;fz+=fC){fv[0]=fy[fz];fv[1]=fy[fz+1];fA(fv,fv,fw);fy[fz]=fv[0];fy[fz+1]=fv[1]}return fy}})();ft.str=function(fv){return"vec2("+fv[0]+", "+fv[1]+")"};fq.vec2=ft;var fs={};fs.create=function(fw){fw=fw||i;var fv=new fw(3);fv[0]=0;fv[1]=0;fv[2]=0;return fv};fs.clone=function(fv,fx){fx=fx||i;var fw=new fx(3);fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];return fw};fs.fromValues=function(fv,fz,fx,fy){fy=fy||i;var fw=new fy(3);fw[0]=fv;fw[1]=fz;fw[2]=fx;return fw};fs.copy=function(fw,fv){fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];return fw};fs.set=function(fw,fv,fy,fx){fw[0]=fv;fw[1]=fy;fw[2]=fx;return fw};fs.add=function(fx,fw,fv){fx[0]=fw[0]+fv[0];fx[1]=fw[1]+fv[1];fx[2]=fw[2]+fv[2];return fx};fs.subtract=function(fx,fw,fv){fx[0]=fw[0]-fv[0];fx[1]=fw[1]-fv[1];fx[2]=fw[2]-fv[2];return fx};fs.sub=fs.subtract;fs.multiply=function(fx,fw,fv){fx[0]=fw[0]*fv[0];fx[1]=fw[1]*fv[1];fx[2]=fw[2]*fv[2];return fx};fs.mul=fs.multiply;fs.divide=function(fx,fw,fv){fx[0]=fw[0]/fv[0];fx[1]=fw[1]/fv[1];fx[2]=fw[2]/fv[2];return fx};fs.div=fs.divide;fs.min=function(fx,fw,fv){fx[0]=Math.min(fw[0],fv[0]);fx[1]=Math.min(fw[1],fv[1]);fx[2]=Math.min(fw[2],fv[2]);return fx};fs.max=function(fx,fw,fv){fx[0]=Math.max(fw[0],fv[0]);fx[1]=Math.max(fw[1],fv[1]);fx[2]=Math.max(fw[2],fv[2]);return fx};fs.scale=function(fx,fw,fv){fx[0]=fw[0]*fv;fx[1]=fw[1]*fv;fx[2]=fw[2]*fv;return fx};fs.scaleAndAdd=function(fx,fw,fv,fy){fx[0]=fw[0]+(fv[0]*fy);fx[1]=fw[1]+(fv[1]*fy);fx[2]=fw[2]+(fv[2]*fy);return fx};fs.distance=function(fx,fw){var fv=fw[0]-fx[0],fz=fw[1]-fx[1],fy=fw[2]-fx[2];return Math.sqrt(fv*fv+fz*fz+fy*fy)};fs.dist=fs.distance;fs.squaredDistance=function(fx,fw){var fv=fw[0]-fx[0],fz=fw[1]-fx[1],fy=fw[2]-fx[2];return fv*fv+fz*fz+fy*fy};fs.sqrDist=fs.squaredDistance;fs.length=function(fw){var fv=fw[0],fy=fw[1],fx=fw[2];return Math.sqrt(fv*fv+fy*fy+fx*fx)};fs.len=fs.length;fs.squaredLength=function(fw){var fv=fw[0],fy=fw[1],fx=fw[2];return fv*fv+fy*fy+fx*fx};fs.sqrLen=fs.squaredLength;fs.negate=function(fw,fv){fw[0]=-fv[0];fw[1]=-fv[1];fw[2]=-fv[2];return fw};fs.normalize=function(fy,fx){var fw=fx[0],fA=fx[1],fz=fx[2];var fv=fw*fw+fA*fA+fz*fz;if(fv>0){fv=1/Math.sqrt(fv);fy[0]=fx[0]*fv;fy[1]=fx[1]*fv;fy[2]=fx[2]*fv}return fy};fs.dot=function(fw,fv){return fw[0]*fv[0]+fw[1]*fv[1]+fw[2]*fv[2]};fs.cross=function(fw,fB,fA){var fv=fB[0],fD=fB[1],fC=fB[2],fz=fA[0],fy=fA[1],fx=fA[2];fw[0]=fD*fx-fC*fy;fw[1]=fC*fz-fv*fx;fw[2]=fv*fy-fD*fz;return fw};fs.lerp=function(fx,fw,fv,fy){var fB=fw[0],fA=fw[1],fz=fw[2];fx[0]=fB+fy*(fv[0]-fB);fx[1]=fA+fy*(fv[1]-fA);fx[2]=fz+fy*(fv[2]-fz);return fx};fs.random=function(fv,fz){fz=fz||1;var fx=fo()*2*Math.PI;var fy=(fo()*2)-1;var fw=Math.sqrt(1-fy*fy)*fz;fv[0]=Math.cos(fx)*fw;fv[1]=Math.sin(fx)*fw;fv[2]=fy*fz;return fv};fs.transformMat4=function(fy,fx,fw){var fv=fx[0],fA=fx[1],fz=fx[2];fy[0]=fw[0]*fv+fw[4]*fA+fw[8]*fz+fw[12];fy[1]=fw[1]*fv+fw[5]*fA+fw[9]*fz+fw[13];fy[2]=fw[2]*fv+fw[6]*fA+fw[10]*fz+fw[14];return fy};fs.transformMat3=function(fy,fx,fw){var fv=fx[0],fA=fx[1],fz=fx[2];fy[0]=fv*fw[0]+fA*fw[3]+fz*fw[6];fy[1]=fv*fw[1]+fA*fw[4]+fz*fw[7];fy[2]=fv*fw[2]+fA*fw[5]+fz*fw[8];return fy};fs.transformQuat=function(fB,fH,fv){var fI=fH[0],fG=fH[1],fF=fH[2],fD=fv[0],fC=fv[1],fA=fv[2],fE=fv[3],fy=fE*fI+fC*fF-fA*fG,fx=fE*fG+fA*fI-fD*fF,fw=fE*fF+fD*fG-fC*fI,fz=-fD*fI-fC*fG-fA*fF;fB[0]=fy*fE+fz*-fD+fx*-fA-fw*-fC;fB[1]=fx*fE+fz*-fC+fw*-fD-fy*-fA;fB[2]=fw*fE+fz*-fA+fy*-fC-fx*-fD;return fB};fs.rotateX=function(fx,fw,fv,fA){var fz=[],fy=[];fz[0]=fw[0]-fv[0];fz[1]=fw[1]-fv[1];fz[2]=fw[2]-fv[2];fy[0]=fz[0];fy[1]=fz[1]*Math.cos(fA)-fz[2]*Math.sin(fA);fy[2]=fz[1]*Math.sin(fA)+fz[2]*Math.cos(fA);fx[0]=fy[0]+fv[0];fx[1]=fy[1]+fv[1];fx[2]=fy[2]+fv[2];return fx};fs.rotateY=function(fx,fw,fv,fA){var fz=[],fy=[];fz[0]=fw[0]-fv[0];fz[1]=fw[1]-fv[1];fz[2]=fw[2]-fv[2];fy[0]=fz[2]*Math.sin(fA)+fz[0]*Math.cos(fA);fy[1]=fz[1];fy[2]=fz[2]*Math.cos(fA)-fz[0]*Math.sin(fA);fx[0]=fy[0]+fv[0];fx[1]=fy[1]+fv[1];fx[2]=fy[2]+fv[2];return fx};fs.rotateZ=function(fx,fw,fv,fA){var fz=[],fy=[];fz[0]=fw[0]-fv[0];fz[1]=fw[1]-fv[1];fz[2]=fw[2]-fv[2];fy[0]=fz[0]*Math.cos(fA)-fz[1]*Math.sin(fA);fy[1]=fz[0]*Math.sin(fA)+fz[1]*Math.cos(fA);fy[2]=fz[2];fx[0]=fy[0]+fv[0];fx[1]=fy[1]+fv[1];fx[2]=fy[2]+fv[2];return fx};fs.forEach=(function(){var fv=fs.create();return function(fy,fC,fD,fB,fA,fw){var fz,fx;if(!fC){fC=3}if(!fD){fD=0}if(fB){fx=Math.min((fB*fC)+fD,fy.length)}else{fx=fy.length}for(fz=fD;fz<fx;fz+=fC){fv[0]=fy[fz];fv[1]=fy[fz+1];fv[2]=fy[fz+2];fA(fv,fv,fw);fy[fz]=fv[0];fy[fz+1]=fv[1];fy[fz+2]=fv[2]}return fy}})();fs.str=function(fv){return"vec3("+fv[0]+", "+fv[1]+", "+fv[2]+")"};fq.vec3=fs;var fr={};fr.create=function(fw){fw=fw||i;var fv=new fw(4);fv[0]=0;fv[1]=0;fv[2]=0;fv[3]=0;return fv};fr.clone=function(fv,fx){fx=fx||i;var fw=new fx(4);fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];return fw};fr.fromValues=function(fv,fA,fy,fw,fz){fz=fz||i;var fx=new fz(4);fx[0]=fv;fx[1]=fA;fx[2]=fy;fx[3]=fw;return fx};fr.copy=function(fw,fv){fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];return fw};fr.set=function(fx,fv,fz,fy,fw){fx[0]=fv;fx[1]=fz;fx[2]=fy;fx[3]=fw;return fx};fr.add=function(fx,fw,fv){fx[0]=fw[0]+fv[0];fx[1]=fw[1]+fv[1];fx[2]=fw[2]+fv[2];fx[3]=fw[3]+fv[3];return fx};fr.subtract=function(fx,fw,fv){fx[0]=fw[0]-fv[0];fx[1]=fw[1]-fv[1];fx[2]=fw[2]-fv[2];fx[3]=fw[3]-fv[3];return fx};fr.sub=fr.subtract;fr.multiply=function(fx,fw,fv){fx[0]=fw[0]*fv[0];fx[1]=fw[1]*fv[1];fx[2]=fw[2]*fv[2];fx[3]=fw[3]*fv[3];return fx};fr.mul=fr.multiply;fr.divide=function(fx,fw,fv){fx[0]=fw[0]/fv[0];fx[1]=fw[1]/fv[1];fx[2]=fw[2]/fv[2];fx[3]=fw[3]/fv[3];return fx};fr.div=fr.divide;fr.min=function(fx,fw,fv){fx[0]=Math.min(fw[0],fv[0]);fx[1]=Math.min(fw[1],fv[1]);fx[2]=Math.min(fw[2],fv[2]);fx[3]=Math.min(fw[3],fv[3]);return fx};fr.max=function(fx,fw,fv){fx[0]=Math.max(fw[0],fv[0]);fx[1]=Math.max(fw[1],fv[1]);fx[2]=Math.max(fw[2],fv[2]);fx[3]=Math.max(fw[3],fv[3]);return fx};fr.scale=function(fx,fw,fv){fx[0]=fw[0]*fv;fx[1]=fw[1]*fv;fx[2]=fw[2]*fv;fx[3]=fw[3]*fv;return fx};fr.scaleAndAdd=function(fx,fw,fv,fy){fx[0]=fw[0]+(fv[0]*fy);fx[1]=fw[1]+(fv[1]*fy);fx[2]=fw[2]+(fv[2]*fy);fx[3]=fw[3]+(fv[3]*fy);return fx};fr.distance=function(fy,fw){var fv=fw[0]-fy[0],fA=fw[1]-fy[1],fz=fw[2]-fy[2],fx=fw[3]-fy[3];return Math.sqrt(fv*fv+fA*fA+fz*fz+fx*fx)};fr.dist=fr.distance;fr.squaredDistance=function(fy,fw){var fv=fw[0]-fy[0],fA=fw[1]-fy[1],fz=fw[2]-fy[2],fx=fw[3]-fy[3];return fv*fv+fA*fA+fz*fz+fx*fx};fr.sqrDist=fr.squaredDistance;fr.length=function(fx){var fv=fx[0],fz=fx[1],fy=fx[2],fw=fx[3];return Math.sqrt(fv*fv+fz*fz+fy*fy+fw*fw)};fr.len=fr.length;fr.squaredLength=function(fx){var fv=fx[0],fz=fx[1],fy=fx[2],fw=fx[3];return fv*fv+fz*fz+fy*fy+fw*fw};fr.sqrLen=fr.squaredLength;fr.negate=function(fw,fv){fw[0]=-fv[0];fw[1]=-fv[1];fw[2]=-fv[2];fw[3]=-fv[3];return fw};fr.normalize=function(fz,fy){var fw=fy[0],fB=fy[1],fA=fy[2],fx=fy[3];var fv=fw*fw+fB*fB+fA*fA+fx*fx;if(fv>0){fv=1/Math.sqrt(fv);fz[0]=fy[0]*fv;fz[1]=fy[1]*fv;fz[2]=fy[2]*fv;fz[3]=fy[3]*fv}return fz};fr.dot=function(fw,fv){return fw[0]*fv[0]+fw[1]*fv[1]+fw[2]*fv[2]+fw[3]*fv[3]};fr.lerp=function(fx,fw,fv,fy){var fB=fw[0],fA=fw[1],fz=fw[2],fC=fw[3];fx[0]=fB+fy*(fv[0]-fB);fx[1]=fA+fy*(fv[1]-fA);fx[2]=fz+fy*(fv[2]-fz);fx[3]=fC+fy*(fv[3]-fC);return fx};fr.random=function(fv,fw){fw=fw||1;fv[0]=fo();fv[1]=fo();fv[2]=fo();fv[3]=fo();fr.normalize(fv,fv);fr.scale(fv,fv,fw);return fv};fr.transformMat4=function(fz,fy,fw){var fv=fy[0],fB=fy[1],fA=fy[2],fx=fy[3];fz[0]=fw[0]*fv+fw[4]*fB+fw[8]*fA+fw[12]*fx;fz[1]=fw[1]*fv+fw[5]*fB+fw[9]*fA+fw[13]*fx;fz[2]=fw[2]*fv+fw[6]*fB+fw[10]*fA+fw[14]*fx;fz[3]=fw[3]*fv+fw[7]*fB+fw[11]*fA+fw[15]*fx;return fz};fr.transformQuat=function(fB,fH,fv){var fI=fH[0],fG=fH[1],fF=fH[2],fD=fv[0],fC=fv[1],fA=fv[2],fE=fv[3],fy=fE*fI+fC*fF-fA*fG,fx=fE*fG+fA*fI-fD*fF,fw=fE*fF+fD*fG-fC*fI,fz=-fD*fI-fC*fG-fA*fF;fB[0]=fy*fE+fz*-fD+fx*-fA-fw*-fC;fB[1]=fx*fE+fz*-fC+fw*-fD-fy*-fA;fB[2]=fw*fE+fz*-fA+fy*-fC-fx*-fD;return fB};fr.forEach=(function(){var fv=fr.create();return function(fy,fC,fD,fB,fA,fw){var fz,fx;if(!fC){fC=4}if(!fD){fD=0}if(fB){fx=Math.min((fB*fC)+fD,fy.length)}else{fx=fy.length}for(fz=fD;fz<fx;fz+=fC){fv[0]=fy[fz];fv[1]=fy[fz+1];fv[2]=fy[fz+2];fv[3]=fy[fz+3];fA(fv,fv,fw);fy[fz]=fv[0];fy[fz+1]=fv[1];fy[fz+2]=fv[2];fy[fz+3]=fv[3]}return fy}})();fr.str=function(fv){return"vec4("+fv[0]+", "+fv[1]+", "+fv[2]+", "+fv[3]+")"};fq.vec4=fr;var fn={};fn.create=function(fw){fw=fw||i;var fv=new fw(4);fv[0]=1;fv[1]=0;fv[2]=0;fv[3]=1;return fv};fn.clone=function(fv,fx){fx=fx||i;var fw=new fx(4);fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];return fw};fn.copy=function(fw,fv){fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];return fw};fn.identity=function(fv){fv[0]=1;fv[1]=0;fv[2]=0;fv[3]=1;return fv};fn.transpose=function(fx,fw){if(fx===fw){var fv=fw[1];fx[1]=fw[2];fx[2]=fv}else{fx[0]=fw[0];fx[1]=fw[2];fx[2]=fw[1];fx[3]=fw[3]}return fx};fn.invert=function(fz,fx){var fy=fx[0],fw=fx[1],fv=fx[2],fB=fx[3],fA=fy*fB-fv*fw;if(!fA){return null}fA=1/fA;fz[0]=fB*fA;fz[1]=-fw*fA;fz[2]=-fv*fA;fz[3]=fy*fA;return fz};fn.adjoint=function(fx,fv){var fw=fv[0];fx[0]=fv[3];fx[1]=-fv[1];fx[2]=-fv[2];fx[3]=fw;return fx};fn.determinant=function(fv){return fv[0]*fv[3]-fv[2]*fv[1]};fn.multiply=function(fz,fE,fC){var fy=fE[0],fx=fE[1],fw=fE[2],fv=fE[3];var fF=fC[0],fD=fC[1],fB=fC[2],fA=fC[3];fz[0]=fy*fF+fw*fD;fz[1]=fx*fF+fv*fD;fz[2]=fy*fB+fw*fA;fz[3]=fx*fB+fv*fA;return fz};fn.mul=fn.multiply;fn.rotate=function(fz,fC,fB){var fy=fC[0],fx=fC[1],fw=fC[2],fv=fC[3],fD=Math.sin(fB),fA=Math.cos(fB);fz[0]=fy*fA+fw*fD;fz[1]=fx*fA+fv*fD;fz[2]=fy*-fD+fw*fA;fz[3]=fx*-fD+fv*fA;return fz};fn.scale=function(fz,fA,fC){var fy=fA[0],fx=fA[1],fw=fA[2],fv=fA[3],fD=fC[0],fB=fC[1];fz[0]=fy*fD;fz[1]=fx*fD;fz[2]=fw*fB;fz[3]=fv*fB;return fz};fn.str=function(fv){return"mat2("+fv[0]+", "+fv[1]+", "+fv[2]+", "+fv[3]+")"};fn.frob=function(fv){return(Math.sqrt(Math.pow(fv[0],2)+Math.pow(fv[1],2)+Math.pow(fv[2],2)+Math.pow(fv[3],2)))};fn.LDU=function(fv,fy,fx,fw){fv[2]=fw[2]/fw[0];fx[0]=fw[0];fx[1]=fw[1];fx[3]=fw[3]-fv[2]*fx[1];return[fv,fy,fx]};fq.mat2=fn;var e={};e.create=function(fw){fw=fw||i;var fv=new fw(16);fv[0]=1;fv[1]=0;fv[2]=0;fv[3]=0;fv[4]=0;fv[5]=1;fv[6]=0;fv[7]=0;fv[8]=0;fv[9]=0;fv[10]=1;fv[11]=0;fv[12]=0;fv[13]=0;fv[14]=0;fv[15]=1;return fv};e.clone=function(fv){var fw=new i(16);fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];fw[4]=fv[4];fw[5]=fv[5];fw[6]=fv[6];fw[7]=fv[7];fw[8]=fv[8];fw[9]=fv[9];fw[10]=fv[10];fw[11]=fv[11];fw[12]=fv[12];fw[13]=fv[13];fw[14]=fv[14];fw[15]=fv[15];return fw};e.copy=function(fw,fv){fw[0]=fv[0];fw[1]=fv[1];fw[2]=fv[2];fw[3]=fv[3];fw[4]=fv[4];fw[5]=fv[5];fw[6]=fv[6];fw[7]=fv[7];fw[8]=fv[8];fw[9]=fv[9];fw[10]=fv[10];fw[11]=fv[11];fw[12]=fv[12];fw[13]=fv[13];fw[14]=fv[14];fw[15]=fv[15];return fw};e.identity=function(fv){fv[0]=1;fv[1]=0;fv[2]=0;fv[3]=0;fv[4]=0;fv[5]=1;fv[6]=0;fv[7]=0;fv[8]=0;fv[9]=0;fv[10]=1;fv[11]=0;fv[12]=0;fv[13]=0;fv[14]=0;fv[15]=1;return fv};e.transpose=function(fy,fx){if(fy===fx){var fC=fx[1],fA=fx[2],fz=fx[3],fv=fx[6],fB=fx[7],fw=fx[11];fy[1]=fx[4];fy[2]=fx[8];fy[3]=fx[12];fy[4]=fC;fy[6]=fx[9];fy[7]=fx[13];fy[8]=fA;fy[9]=fv;fy[11]=fx[14];fy[12]=fz;fy[13]=fB;fy[14]=fw}else{fy[0]=fx[0];fy[1]=fx[4];fy[2]=fx[8];fy[3]=fx[12];fy[4]=fx[1];fy[5]=fx[5];fy[6]=fx[9];fy[7]=fx[13];fy[8]=fx[2];fy[9]=fx[6];fy[10]=fx[10];fy[11]=fx[14];fy[12]=fx[3];fy[13]=fx[7];fy[14]=fx[11];fy[15]=fx[15]}return fy};e.invert=function(fO,fT){var fX=fT[0],fV=fT[1],fU=fT[2],fR=fT[3],fz=fT[4],fy=fT[5],fx=fT[6],fw=fT[7],fN=fT[8],fM=fT[9],fL=fT[10],fK=fT[11],fZ=fT[12],fY=fT[13],fW=fT[14],fS=fT[15],fJ=fX*fy-fV*fz,fI=fX*fx-fU*fz,fH=fX*fw-fR*fz,fG=fV*fx-fU*fy,fF=fV*fw-fR*fy,fE=fU*fw-fR*fx,fD=fN*fY-fM*fZ,fC=fN*fW-fL*fZ,fB=fN*fS-fK*fZ,fA=fM*fW-fL*fY,fQ=fM*fS-fK*fY,fP=fL*fS-fK*fW,fv=fJ*fP-fI*fQ+fH*fA+fG*fB-fF*fC+fE*fD;if(!fv){return null}fv=1/fv;fO[0]=(fy*fP-fx*fQ+fw*fA)*fv;fO[1]=(fU*fQ-fV*fP-fR*fA)*fv;fO[2]=(fY*fE-fW*fF+fS*fG)*fv;fO[3]=(fL*fF-fM*fE-fK*fG)*fv;fO[4]=(fx*fB-fz*fP-fw*fC)*fv;fO[5]=(fX*fP-fU*fB+fR*fC)*fv;fO[6]=(fW*fH-fZ*fE-fS*fI)*fv;fO[7]=(fN*fE-fL*fH+fK*fI)*fv;fO[8]=(fz*fQ-fy*fB+fw*fD)*fv;fO[9]=(fV*fB-fX*fQ-fR*fD)*fv;fO[10]=(fZ*fF-fY*fH+fS*fJ)*fv;fO[11]=(fM*fH-fN*fF-fK*fJ)*fv;fO[12]=(fy*fC-fz*fA-fx*fD)*fv;fO[13]=(fX*fA-fV*fC+fU*fD)*fv;fO[14]=(fY*fI-fZ*fG-fW*fJ)*fv;fO[15]=(fN*fG-fM*fI+fL*fJ)*fv;return fO};e.adjoint=function(fD,fG){var fK=fG[0],fI=fG[1],fH=fG[2],fE=fG[3],fy=fG[4],fx=fG[5],fw=fG[6],fv=fG[7],fC=fG[8],fB=fG[9],fA=fG[10],fz=fG[11],fM=fG[12],fL=fG[13],fJ=fG[14],fF=fG[15];fD[0]=(fx*(fA*fF-fz*fJ)-fB*(fw*fF-fv*fJ)+fL*(fw*fz-fv*fA));fD[1]=-(fI*(fA*fF-fz*fJ)-fB*(fH*fF-fE*fJ)+fL*(fH*fz-fE*fA));fD[2]=(fI*(fw*fF-fv*fJ)-fx*(fH*fF-fE*fJ)+fL*(fH*fv-fE*fw));fD[3]=-(fI*(fw*fz-fv*fA)-fx*(fH*fz-fE*fA)+fB*(fH*fv-fE*fw));fD[4]=-(fy*(fA*fF-fz*fJ)-fC*(fw*fF-fv*fJ)+fM*(fw*fz-fv*fA));fD[5]=(fK*(fA*fF-fz*fJ)-fC*(fH*fF-fE*fJ)+fM*(fH*fz-fE*fA));fD[6]=-(fK*(fw*fF-fv*fJ)-fy*(fH*fF-fE*fJ)+fM*(fH*fv-fE*fw));fD[7]=(fK*(fw*fz-fv*fA)-fy*(fH*fz-fE*fA)+fC*(fH*fv-fE*fw));fD[8]=(fy*(fB*fF-fz*fL)-fC*(fx*fF-fv*fL)+fM*(fx*fz-fv*fB));fD[9]=-(fK*(fB*fF-fz*fL)-fC*(fI*fF-fE*fL)+fM*(fI*fz-fE*fB));fD[10]=(fK*(fx*fF-fv*fL)-fy*(fI*fF-fE*fL)+fM*(fI*fv-fE*fx));fD[11]=-(fK*(fx*fz-fv*fB)-fy*(fI*fz-fE*fB)+fC*(fI*fv-fE*fx));fD[12]=-(fy*(fB*fJ-fA*fL)-fC*(fx*fJ-fw*fL)+fM*(fx*fA-fw*fB));fD[13]=(fK*(fB*fJ-fA*fL)-fC*(fI*fJ-fH*fL)+fM*(fI*fA-fH*fB));fD[14]=-(fK*(fx*fJ-fw*fL)-fy*(fI*fJ-fH*fL)+fM*(fI*fw-fH*fx));fD[15]=(fK*(fx*fA-fw*fB)-fy*(fI*fA-fH*fB)+fC*(fI*fw-fH*fx));return fD};e.determinant=function(fQ){var fV=fQ[0],fT=fQ[1],fR=fQ[2],fP=fQ[3],fy=fQ[4],fx=fQ[5],fw=fQ[6],fv=fQ[7],fM=fQ[8],fL=fQ[9],fK=fQ[10],fJ=fQ[11],fX=fQ[12],fW=fQ[13],fU=fQ[14],fS=fQ[15],fI=fV*fx-fT*fy,fH=fV*fw-fR*fy,fG=fV*fv-fP*fy,fF=fT*fw-fR*fx,fE=fT*fv-fP*fx,fD=fR*fv-fP*fw,fC=fM*fW-fL*fX,fB=fM*fU-fK*fX,fA=fM*fS-fJ*fX,fz=fL*fU-fK*fW,fO=fL*fS-fJ*fW,fN=fK*fS-fJ*fU;return fI*fN-fH*fO+fG*fz+fF*fA-fE*fB+fD*fC};e.multiply=function(fH,fL,fI){var fP=fL[0],fO=fL[1],fM=fL[2],fJ=fL[3],fB=fL[4],fz=fL[5],fx=fL[6],fv=fL[7],fG=fL[8],fF=fL[9],fE=fL[10],fD=fL[11],fR=fL[12],fQ=fL[13],fN=fL[14],fK=fL[15];var fC=fI[0],fA=fI[1],fy=fI[2],fw=fI[3];fH[0]=fC*fP+fA*fB+fy*fG+fw*fR;fH[1]=fC*fO+fA*fz+fy*fF+fw*fQ;fH[2]=fC*fM+fA*fx+fy*fE+fw*fN;fH[3]=fC*fJ+fA*fv+fy*fD+fw*fK;fC=fI[4];fA=fI[5];fy=fI[6];fw=fI[7];fH[4]=fC*fP+fA*fB+fy*fG+fw*fR;fH[5]=fC*fO+fA*fz+fy*fF+fw*fQ;fH[6]=fC*fM+fA*fx+fy*fE+fw*fN;fH[7]=fC*fJ+fA*fv+fy*fD+fw*fK;fC=fI[8];fA=fI[9];fy=fI[10];fw=fI[11];fH[8]=fC*fP+fA*fB+fy*fG+fw*fR;fH[9]=fC*fO+fA*fz+fy*fF+fw*fQ;fH[10]=fC*fM+fA*fx+fy*fE+fw*fN;fH[11]=fC*fJ+fA*fv+fy*fD+fw*fK;fC=fI[12];fA=fI[13];fy=fI[14];fw=fI[15];fH[12]=fC*fP+fA*fB+fy*fG+fw*fR;fH[13]=fC*fO+fA*fz+fy*fF+fw*fQ;fH[14]=fC*fM+fA*fx+fy*fE+fw*fN;fH[15]=fC*fJ+fA*fv+fy*fD+fw*fK;return fH};e.mul=e.multiply;e.translate=function(fH,fJ,fC){var fB=fC[0],fA=fC[1],fz=fC[2],fM,fL,fK,fI,fy,fx,fw,fv,fG,fF,fE,fD;if(fJ===fH){fH[12]=fJ[0]*fB+fJ[4]*fA+fJ[8]*fz+fJ[12];fH[13]=fJ[1]*fB+fJ[5]*fA+fJ[9]*fz+fJ[13];fH[14]=fJ[2]*fB+fJ[6]*fA+fJ[10]*fz+fJ[14];fH[15]=fJ[3]*fB+fJ[7]*fA+fJ[11]*fz+fJ[15]}else{fM=fJ[0];fL=fJ[1];fK=fJ[2];fI=fJ[3];fy=fJ[4];fx=fJ[5];fw=fJ[6];fv=fJ[7];fG=fJ[8];fF=fJ[9];fE=fJ[10];fD=fJ[11];fH[0]=fM;fH[1]=fL;fH[2]=fK;fH[3]=fI;fH[4]=fy;fH[5]=fx;fH[6]=fw;fH[7]=fv;fH[8]=fG;fH[9]=fF;fH[10]=fE;fH[11]=fD;fH[12]=fM*fB+fy*fA+fG*fz+fJ[12];fH[13]=fL*fB+fx*fA+fF*fz+fJ[13];fH[14]=fK*fB+fw*fA+fE*fz+fJ[14];fH[15]=fI*fB+fv*fA+fD*fz+fJ[15]}return fH};e.scale=function(fy,fw,fx){var fv=fx[0],fA=fx[1],fz=fx[2];fy[0]=fw[0]*fv;fy[1]=fw[1]*fv;fy[2]=fw[2]*fv;fy[3]=fw[3]*fv;fy[4]=fw[4]*fA;fy[5]=fw[5]*fA;fy[6]=fw[6]*fA;fy[7]=fw[7]*fA;fy[8]=fw[8]*fz;fy[9]=fw[9]*fz;fy[10]=fw[10]*fz;fy[11]=fw[11]*fz;fy[12]=fw[12];fy[13]=fw[13];fy[14]=fw[14];fy[15]=fw[15];return fy};e.rotate=function(fP,fW,fY,fv){var fF=fv[0],fE=fv[1],fD=fv[2],fQ=Math.sqrt(fF*fF+fE*fE+fD*fD),fK,fU,fJ,f0,fZ,fX,fV,fC,fB,fA,fz,fO,fN,fM,fL,fI,fH,fG,fT,fS,fR,fy,fx,fw;if(Math.abs(fQ)<fu){return null}fQ=1/fQ;fF*=fQ;fE*=fQ;fD*=fQ;fK=Math.sin(fY);fU=Math.cos(fY);fJ=1-fU;f0=fW[0];fZ=fW[1];fX=fW[2];fV=fW[3];fC=fW[4];fB=fW[5];fA=fW[6];fz=fW[7];fO=fW[8];fN=fW[9];fM=fW[10];fL=fW[11];fI=fF*fF*fJ+fU;fH=fE*fF*fJ+fD*fK;fG=fD*fF*fJ-fE*fK;fT=fF*fE*fJ-fD*fK;fS=fE*fE*fJ+fU;fR=fD*fE*fJ+fF*fK;fy=fF*fD*fJ+fE*fK;fx=fE*fD*fJ-fF*fK;fw=fD*fD*fJ+fU;fP[0]=f0*fI+fC*fH+fO*fG;fP[1]=fZ*fI+fB*fH+fN*fG;fP[2]=fX*fI+fA*fH+fM*fG;fP[3]=fV*fI+fz*fH+fL*fG;fP[4]=f0*fT+fC*fS+fO*fR;fP[5]=fZ*fT+fB*fS+fN*fR;fP[6]=fX*fT+fA*fS+fM*fR;fP[7]=fV*fT+fz*fS+fL*fR;fP[8]=f0*fy+fC*fx+fO*fw;fP[9]=fZ*fy+fB*fx+fN*fw;fP[10]=fX*fy+fA*fx+fM*fw;fP[11]=fV*fy+fz*fx+fL*fw;if(fW!==fP){fP[12]=fW[12];fP[13]=fW[13];fP[14]=fW[14];fP[15]=fW[15]}return fP};e.rotateX=function(fv,fC,fB){var fH=Math.sin(fB),fA=Math.cos(fB),fG=fC[4],fF=fC[5],fE=fC[6],fD=fC[7],fz=fC[8],fy=fC[9],fx=fC[10],fw=fC[11];if(fC!==fv){fv[0]=fC[0];fv[1]=fC[1];fv[2]=fC[2];fv[3]=fC[3];fv[12]=fC[12];fv[13]=fC[13];fv[14]=fC[14];fv[15]=fC[15]}fv[4]=fG*fA+fz*fH;fv[5]=fF*fA+fy*fH;fv[6]=fE*fA+fx*fH;fv[7]=fD*fA+fw*fH;fv[8]=fz*fA-fG*fH;fv[9]=fy*fA-fF*fH;fv[10]=fx*fA-fE*fH;fv[11]=fw*fA-fD*fH;return fv};e.rotateY=function(fz,fG,fF){var fH=Math.sin(fF),fE=Math.cos(fF),fy=fG[0],fx=fG[1],fw=fG[2],fv=fG[3],fD=fG[8],fC=fG[9],fB=fG[10],fA=fG[11];if(fG!==fz){fz[4]=fG[4];fz[5]=fG[5];fz[6]=fG[6];fz[7]=fG[7];fz[12]=fG[12];fz[13]=fG[13];fz[14]=fG[14];fz[15]=fG[15]}fz[0]=fy*fE-fD*fH;fz[1]=fx*fE-fC*fH;fz[2]=fw*fE-fB*fH;fz[3]=fv*fE-fA*fH;fz[8]=fy*fH+fD*fE;fz[9]=fx*fH+fC*fE;fz[10]=fw*fH+fB*fE;fz[11]=fv*fH+fA*fE;return fz};e.rotateZ=function(fz,fC,fB){var fH=Math.sin(fB),fA=Math.cos(fB),fy=fC[0],fx=fC[1],fw=fC[2],fv=fC[3],fG=fC[4],fF=fC[5],fE=fC[6],fD=fC[7];if(fC!==fz){fz[8]=fC[8];fz[9]=fC[9];fz[10]=fC[10];fz[11]=fC[11];fz[12]=fC[12];fz[13]=fC[13];fz[14]=fC[14];fz[15]=fC[15]}fz[0]=fy*fA+fG*fH;fz[1]=fx*fA+fF*fH;fz[2]=fw*fA+fE*fH;fz[3]=fv*fA+fD*fH;fz[4]=fG*fA-fy*fH;fz[5]=fF*fA-fx*fH;fz[6]=fE*fA-fw*fH;fz[7]=fD*fA-fv*fH;return fz};e.fromRotationTranslation=function(fI,fG,fE){var fB=fG[0],fA=fG[1],fz=fG[2],fC=fG[3],fJ=fB+fB,fv=fA+fA,fD=fz+fz,fy=fB*fJ,fx=fB*fv,fw=fB*fD,fH=fA*fv,fF=fA*fD,fM=fz*fD,fN=fC*fJ,fL=fC*fv,fK=fC*fD;fI[0]=1-(fH+fM);fI[1]=fx+fK;fI[2]=fw-fL;fI[3]=0;fI[4]=fx-fK;fI[5]=1-(fy+fM);fI[6]=fF+fN;fI[7]=0;fI[8]=fw+fL;fI[9]=fF-fN;fI[10]=1-(fy+fH);fI[11]=0;fI[12]=fE[0];fI[13]=fE[1];fI[14]=fE[2];fI[15]=1;return fI};e.fromQuat=function(fF,fC){var fz=fC[0],fy=fC[1],fx=fC[2],fA=fC[3],fG=fz+fz,fv=fy+fy,fB=fx+fx,fw=fz*fG,fE=fy*fG,fD=fy*fv,fM=fx*fG,fL=fx*fv,fJ=fx*fB,fK=fA*fG,fI=fA*fv,fH=fA*fB;fF[0]=1-fD-fJ;fF[1]=fE+fH;fF[2]=fM-fI;fF[3]=0;fF[4]=fE-fH;fF[5]=1-fw-fJ;fF[6]=fL+fK;fF[7]=0;fF[8]=fM+fI;fF[9]=fL-fK;fF[10]=1-fw-fD;fF[11]=0;fF[12]=0;fF[13]=0;fF[14]=0;fF[15]=1;return fF};e.frustum=function(fz,fw,fE,fv,fD,fB,fA){var fC=1/(fE-fw),fy=1/(fD-fv),fx=1/(fB-fA);fz[0]=(fB*2)*fC;fz[1]=0;fz[2]=0;fz[3]=0;fz[4]=0;fz[5]=(fB*2)*fy;fz[6]=0;fz[7]=0;fz[8]=(fE+fw)*fC;fz[9]=(fD+fv)*fy;fz[10]=(fA+fB)*fx;fz[11]=-1;fz[12]=0;fz[13]=0;fz[14]=(fA*fB*2)*fx;fz[15]=0;return fz};e.perspective=function(fy,fx,fw,fz,fv){var fB=1/Math.tan(fx/2),fA=1/(fz-fv);fy[0]=fB/fw;fy[1]=0;fy[2]=0;fy[3]=0;fy[4]=0;fy[5]=fB;fy[6]=0;fy[7]=0;fy[8]=0;fy[9]=0;fy[10]=(fv+fz)*fA;fy[11]=-1;fy[12]=0;fy[13]=0;fy[14]=(2*fv*fz)*fA;fy[15]=0;return fy};e.ortho=function(fy,fw,fE,fv,fC,fB,fA){var fz=1/(fw-fE),fD=1/(fv-fC),fx=1/(fB-fA);fy[0]=-2*fz;fy[1]=0;fy[2]=0;fy[3]=0;fy[4]=0;fy[5]=-2*fD;fy[6]=0;fy[7]=0;fy[8]=0;fy[9]=0;fy[10]=2*fx;fy[11]=0;fy[12]=(fw+fE)*fz;fy[13]=(fC+fv)*fD;fy[14]=(fA+fB)*fx;fy[15]=1;return fy};e.lookAt=function(fJ,fQ,fR,fB){var fP,fO,fM,fx,fw,fv,fE,fD,fC,fK,fN=fQ[0],fL=fQ[1],fI=fQ[2],fA=fB[0],fz=fB[1],fy=fB[2],fH=fR[0],fG=fR[1],fF=fR[2];if(Math.abs(fN-fH)<fu&&Math.abs(fL-fG)<fu&&Math.abs(fI-fF)<fu){return e.identity(fJ)}fE=fN-fH;fD=fL-fG;fC=fI-fF;fK=1/Math.sqrt(fE*fE+fD*fD+fC*fC);fE*=fK;fD*=fK;fC*=fK;fP=fz*fC-fy*fD;fO=fy*fE-fA*fC;fM=fA*fD-fz*fE;fK=Math.sqrt(fP*fP+fO*fO+fM*fM);if(!fK){fP=0;fO=0;fM=0}else{fK=1/fK;fP*=fK;fO*=fK;fM*=fK}fx=fD*fM-fC*fO;fw=fC*fP-fE*fM;fv=fE*fO-fD*fP;fK=Math.sqrt(fx*fx+fw*fw+fv*fv);if(!fK){fx=0;fw=0;fv=0}else{fK=1/fK;fx*=fK;fw*=fK;fv*=fK}fJ[0]=fP;fJ[1]=fx;fJ[2]=fE;fJ[3]=0;fJ[4]=fO;fJ[5]=fw;fJ[6]=fD;fJ[7]=0;fJ[8]=fM;fJ[9]=fv;fJ[10]=fC;fJ[11]=0;fJ[12]=-(fP*fN+fO*fL+fM*fI);fJ[13]=-(fx*fN+fw*fL+fv*fI);fJ[14]=-(fE*fN+fD*fL+fC*fI);fJ[15]=1;return fJ};e.str=function(fv){return"mat4("+fv[0]+", "+fv[1]+", "+fv[2]+", "+fv[3]+", "+fv[4]+", "+fv[5]+", "+fv[6]+", "+fv[7]+", "+fv[8]+", "+fv[9]+", "+fv[10]+", "+fv[11]+", "+fv[12]+", "+fv[13]+", "+fv[14]+", "+fv[15]+")"};e.frob=function(fv){return(Math.sqrt(Math.pow(fv[0],2)+Math.pow(fv[1],2)+Math.pow(fv[2],2)+Math.pow(fv[3],2)+Math.pow(fv[4],2)+Math.pow(fv[5],2)+Math.pow(fv[6],2)+Math.pow(fv[6],2)+Math.pow(fv[7],2)+Math.pow(fv[8],2)+Math.pow(fv[9],2)+Math.pow(fv[10],2)+Math.pow(fv[11],2)+Math.pow(fv[12],2)+Math.pow(fv[13],2)+Math.pow(fv[14],2)+Math.pow(fv[15],2)))};fq.mat4=e})(window);function bZ(){this.result={bkData:[],eleData:[[],[],[],[],[],[]],tileLabels:[]}}x.extend(bZ.prototype,{createLayer:function(fm,i){var e=this.result.bkData;i=i||{};if(!e[fm]){e[fm]=[[],[],[]]}e[fm].dataType=i.dataType||2;e[fm].png8=i.png8||false;e[fm].clipTile=i.clipTile||false},removeLayer:function(i){var e=this.result.bkData;e[i]=null},getResult:function(){return this.result},setData:function(fp,fo,fq){var e=this.result.bkData;var fm=e[fo]?e[fo][fq]:null;if(!fm){return}for(var fn=0;fn<fm.length;fn++){if(fm[fn].key&&fm[fn].key===fp.key){fm[fn]=fp;return}}fm.push(fp)},setLabelData:function(e){this.result.tileLabels=e},getLabelData:function(){return this.result.tileLabels},setOverlayData:function(i,e){if(!this.result.eleData[e]){return}this.result.eleData[e]=i},clearLabelOverlayData:function(){this.result.eleData[2]=[];this.result.eleData[3]=[];this.result.eleData[4]=[]},clearData:function(fn){var e=this.result.bkData;if(typeof fn==="number"){if(e[fn]){e[fn][0]=[];e[fn][1]=[];e[fn][2]=[]}return}for(var fm=0;fm<e.length;fm++){if(!e[fm]){continue}e[fm][0]=[];e[fm][1]=[];e[fm][2]=[]}},sortThumbData:function(i){var e=this.result.bkData;var fm=e[i];if(!fm){return}if(fm[0]&&fm[0].length>0){fm[0].sort(function(fo,fn){return fo.tileInfo.useZoom-fn.tileInfo.useZoom})}}});var dy=(function(){var fy=new Int8Array(4);var fm=new Int32Array(fy.buffer,0,1);var fs=new Float32Array(fy.buffer,0,1);function fA(fG){fm[0]=fG;return fs[0]}function i(fG){fs[0]=fG;return fm[0]}function ft(fG){var fI=(fG[3]<<24|fG[2]<<16|fG[1]<<8|fG[0]);var fH=fA(fI&4278190079);return fH}var fo=0;var fr=1;var fw=2;var fD=0;var fB=1;var fz=2;var fp=6;var fv=7;function fx(fG,fH){var fI;if(fH%2===0){fI=[-fG[1],fG[0]]}else{fI=[fG[1],-fG[0]]}return fI}function e(fG,fH,fI){var fJ=fx(fG,fH);var fK;if(fI===fr){return fJ}else{if(fH===4||fH===5){fK=[fJ[0]-fG[0],fJ[1]-fG[1]]}else{fK=[fJ[0]+fG[0],fJ[1]+fG[1]]}if(fI===fo){vec2.normalize(fK,fK)}return fK}}function fn(fK,fJ,fI,fG){var fH=vec2.dot(fK,fJ);if(fI===fz||fI===fB){if((fG===0||fG===1)&&fH>0){return true}else{if((fG===2||fG===3)&&fH<0){return true}}}if((fG===0||fG===1)&&fH<0){return true}else{if((fG===2||fG===3)&&fH>0){return true}}return false}function fu(fH,fM,fO){var fN=fx(fH,fM);var fJ;var fL=fH;var fK=fO;var fQ=[];vec2.normalize(fQ,[fL[0]+fK[0],fL[1]+fK[1]]);var fP=vec2.dot(fN,[-fQ[1],fQ[0]]);if(Math.abs(fP)<0.1){fP=1}var fI=1/fP;fJ=[-fQ[1]*fI,fQ[0]*fI];var fG=vec2.dot(fH,fJ);if(fG<0){vec2.negate(fJ,fJ)}return{cos2:fG,offset:fJ}}function fF(fH,fM,fO,fG){var fN=fx(fH,fM);var fL;var fK;var fJ;if(fM===0||fM===1){fL=fO;fK=fH}else{fL=fH;fK=fO}if(!fL||!fK){return fN}var fQ=[fL[0]+fK[0],fL[1]+fK[1]];if(fQ[0]===0&&fQ[1]===0){vec2.normalize(fQ,fK)}else{vec2.normalize(fQ,fQ)}var fR=fn(fQ,fN,fG,fM);if(fR){return fN}var fP=vec2.dot(fN,[-fQ[1],fQ[0]]);if(Math.abs(fP)<0.1){fP=1}var fI=1/fP;fJ=[-fQ[1]*fI,fQ[0]*fI];return fJ}function fE(fQ,fR,fK,fS,fP,fI,fL,fJ,fO){var fN;var fH=0;var fG=false;if(fO===undefined){fN=fP.length/fp-1}else{fN=fP.length/fv-1}fq(fR[0],fQ[0],fS,fK,4,fL,fJ,undefined,fP,fO);fN++;fH++;fq(fR[0],fQ[0],fS,fK,5,fL,fJ,undefined,fP,fO);fN++;fH++;for(var fM=0;fM<fQ.length;fM++){fq(fR[fM],fQ[fM],fS,fK,0,fL,fJ,fQ[fM-1],fP,fO);fC(fI,++fN,++fH,fG);fq(fR[fM],fQ[fM],fS,fK,1,fL,fJ,fQ[fM-1],fP,fO);fC(fI,++fN,++fH,fG);fq(fR[fM+1],fQ[fM],fS,fK,2,fL,fJ,fQ[fM+1],fP,fO);fC(fI,++fN,++fH,fG);fq(fR[fM+1],fQ[fM],fS,fK,3,fL,fJ,fQ[fM+1],fP,fO);fC(fI,++fN,++fH,fG);if(fK===fB&&fM!==fQ.length-1){fq(fR[fM+1],fQ[fM],fS,fK,8,fL,fJ,fQ[fM+1],fP,fO);fC(fI,++fN,++fH,fG);fG=fG?false:true}}fq(fR[fR.length-1],fQ[fQ.length-1],fS,fK,6,fL,fJ,undefined,fP,fO);fC(fI,++fN,++fH,fG);fq(fR[fR.length-1],fQ[fQ.length-1],fS,fK,7,fL,fJ,undefined,fP,fO);fC(fI,++fN,++fH,fG)}function fq(fS,fJ,fT,fI,fN,fL,fH,fQ,fP,fO){var fR=fN%2===0?1:-1;var fM;if(fN===4||fN===5||fN===6||fN===7){fM=e(fJ,fN,fT)}else{if(fN===0||fN===1||fN===2||fN===3){fM=fF(fJ,fN,fQ,fI)}else{if(fN===8){var fK=fu(fJ,fN,fQ);fM=fK.offset;vec2.normalize(fM,fM);var fG=fK.cos2;if(fG<0){fR=-fR}}}}fP[fP.length]=fS[0]*10;fP[fP.length]=fS[1]*10;fP[fP.length]=fM[0]*fH*10;fP[fP.length]=fM[1]*fH*10;fP[fP.length]=fL;fP[fP.length]=fR;if(fO!==undefined){fP[fP.length]=fO}}function fC(fK,fI,fG,fJ){var fH;if(fG%2===0){if(fJ){fK[fK.length]=fI-2;fK[fK.length]=fI-1;fK[fK.length]=fI}else{fK[fK.length]=fI-1;fK[fK.length]=fI-2;fK[fK.length]=fI}}else{if(fJ){fK[fK.length]=fI-1;fK[fK.length]=fI-2;fK[fK.length]=fI}else{fK[fK.length]=fI-2;fK[fK.length]=fI-1;fK[fK.length]=fI}}}return{getVertexCount:function(fH,fG){if(fG===fB){return fH*5-2}else{return fH*4}},overlayLine:function(fP,fI,fQ,fM,fG,fK,fH,fN){var fO=[];for(var fL=0;fL<fP.length;fL++){if(fL!==fP.length-1){var fJ=[fP[fL+1][0]-fP[fL][0],fP[fL+1][1]-fP[fL][1]];var fR=[];if(fJ[0]===0&&fJ[1]===0){fR=[0,0]}else{vec2.normalize(fR,fJ)}fO[fO.length]=[fR[0],fR[1]]}}return fE(fO,fP,fI,fQ,fM,fG,ft(fK),fH,fN)},toSolidVertices:function(fK,fH){var fI=new Float32Array(fK.length/fv*5);var fG=new Int16Array(fI.buffer);var fM=0;var fJ=0;for(var fL=0;fL<fK.length;fL+=fv){fG[fM]=~~fK[fL];fG[fM+1]=~~fK[fL+1];fG[fM+2]=~~fK[fL+2];fG[fM+3]=~~fK[fL+3];fI[fJ+2]=fK[fL+4];fG[fM+6]=fK[fL+5];fG[fM+7]=fH?fH:0;fG[fM+8]=fK[fL+6];fG[fM+9]=0;fM+=10;fJ+=5}return fI}}})();var c4=1;var eq=2;var dX={drawIndex:0,devicePixelRatio:ay(),zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:false,lastCollisionTestTime:0,remove:function(){this.tileCache.clear()},initDrawData:function(){this.drawIndex=this.zIndex;this.map._featureMgr.createLayer(this.drawIndex,{dataType:this.dataType,png8:this.png8,clipTile:this.clipTile})},destroyDrawData:function(){this.map._featureMgr.removeLayer(this.drawIndex)},setZIndex:function(e){this.zIndex=e},getTileKey:function(e,fn){fn=fn||{};var i=typeof fn.useZoom==="number"?fn.useZoom:e.useZoom;var fm=e.style||this.mapStyleId||"default";return this.mapType+"_"+fm+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},getTileRenderDataKey:function(i){var fm=i.col;var fn=i.zoom;var e=i.baseTileSize;fm=cD.calcLoopParam(fm,fn,e).col;return this.mapType+"_"+fm+"_"+i.row+"_"+fn+"_"+i.useZoom},getTileUnits:function(e){var fn=this.map;var fm=be[fn.getMapType()];var i=fm.baseUnits*Math.pow(2,fm.zoomLevelBase-e);return i},getTilesUrl:function(fo,fx,fy){var i=fo.x;var fz=fo.y;var fu=ad("ditu","normal");var fq=fu.ver;var fr=fu.udt;i=cD.calcLoopParam(i,fx,fy).col;var fw=be.B_NORMAL_MAP.vectorTileUrls;var fp=Math.abs(i+fz)%fw.length;var fv=fw[fp];if(window.offLineIPAddress){fw=[window.offLineIPAddress+"pvd/"];fv=fw[0]}var fm="x="+i+"&y="+fz+"&z="+Math.floor(fx);var ft=this.devicePixelRatio>1?"&scaler=2":"";var fs="&textimg=1";if(this.map.config.textRenderType==="canvas"){fs="&textimg=0"}var fn=this.map.config.style;if(typeof fn==="string"&&fn!=="default"){fm+="&styleId="+dn.mapStyleNameIdPair[fn]}fm+="&styles=pl"+fs+ft+"&v="+fq+"&udt="+fr+"&json=0";var e=fv+"?qt=vtile&param="+window.encodeURIComponent(ek(fm));return e},getRasterTilesUrl:function(fm,fp,fn){var fo=be[this.map.mapType];var i=this.map.config.style;var e=fo.tileUrls[Math.abs(fp+fm)%fo.tileUrls.length]+"?qt=tile&x="+fm+"&y="+fp+"&z="+fn+((i==="default"||typeof i!=="string")?"":("&styleId="+dn.mapStyleNameIdPair[i]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";e=e.replace(/-(\d+)/gi,"M$1");return e},getZoomState:function(){var fm=this.map;var i=fm.getZoom();var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState},releaseOutViewTileData:function(e){var fo=this.map._workerMgr.releasePendingData(e);for(var fn=0,fm=fo.length;fn<fm;fn++){var fp=this.getTileKey(fo[fn]);this.tileCache.removeData(fp)}},loadLayerData:function(e,fn,i){this.hasZoomChange=i;this.curViewTilesInfo=e;this.mapStyleId=this.map.getMapStyleId();this.releaseOutViewTileData(e);var fm=this.getZoomState();if(this.dataType===eq){if(fn){this.getVectorLayerDataFromCache(e,fm)}else{this.loadVectorLayerData(e)}}else{this.loadRasterLayerData(e,fn)}},getVectorLayerDataFromCache:function(fs,fC){this.map.temp.isPermitSpotOver=false;this.tileLabels=[];if(this.baseLayer===true){var fw=this.map._customLabelMgr.virtualTile;if(fw&&fw.label){this.tileLabels.push(fw.label)}}this.thumbCache={};var fD=-1;for(var fz=0,fx=fs.length;fz<fx;fz++){var fA=fs[fz];var fo=fA.col;var fp=fA.row;var fm=fA.zoom;var fy=this._getTileTexImgKey(fA);var fn=fA.useZoom;fD=fm;var fq=this.getTileKey(fA);var fF=this.tileCache.getData(fq);if(fF&&fF.status==="ready"){var fG=fF;this.map._featureMgr.setData(fF,this.drawIndex,2);if(fF.label){if(fF.label.status==="ready"){fF.label.tileInfo=fF.tileInfo;this.tileLabels.push(fF.label);if(fF.label.textureSources&&fF.label.textureSources[fn]&&this.map._webglMapScene){var fE=this.map._webglMapScene._painter;if(!fE._labelTextureAtlasOffset[fy]){fE._addToAsyncJob(fF.label.textureSources[fn])}}}else{if(fF.label.status!=="processing"){this.processLabelData(fF)}}}}else{var fB={tileInfo:fA,dataType:eq,key:fq};this.map._featureMgr.setData(fB,this.drawIndex,2);if(this.useThumbData){this.setThumbData(fo,fp,fm,fn,fC)}}}this.tileLabels.labelZoom=fD;this.updateLabels(fC);var ft=this.map.getZoom();var fr=Math.floor(ft);var fv=ft-fr;var fu=Math.floor(this.LAST_CALC_ZOOM);var e=this.LAST_CALC_ZOOM-fu;var fH=false;if(this.hasZoomChange){if(Math.abs(ft-this.LAST_CALC_ZOOM)>=0.5){fH=true}else{if(fv<0.5&&e>=0.5){fH=true}else{if(fv>=0.5&&e<0.5){fH=true}}}if(fH){this.cacheDataCollideLabels(0)}this.LAST_CALC_ZOOM=ft}else{if(this.tileLabels.length>0){this.cacheDataCollideLabels(30)}}},loadVectorLayerData:function(fv,fx){this.map.temp.isPermitSpotOver=false;var fu=this;function ft(i,fz){var fB=fu.tileCache.getData(fz);if(!fB){return}if(!i||i.error){if(typeof alog!=="undefined"){alog("exception.fire","catch",{msg:i.tileKey+":"+i.message,path:"api.js",ln:1})}var fA=new aB("ontileloaderror");i=i||{};fA.error=i.error||"";fA.message=i.message||"";fu.map.fire(fA);fB.status="init";fB.reloadTimer=setTimeout(function(){if(fB.retry<3){fB.retry++;fB.status="loading";fu.loadVectorTileData(i.tileInfo,ft)}else{fu.tileCache.removeData(fz)}},4000);fu.map._featureMgr.clearData(fu.drawIndex);fu._checkTilesLoaded();fu.getVectorLayerDataFromCache(fu.curViewTilesInfo,fu.getZoomState());return}if(fB.reloadTimer){clearTimeout(fB.reloadTimer);fB.reloadTimer=null}fu.callbackDataQueue.push([i,fz]);if(fu.processDataTimer){return}fu.processDataTimer=setTimeout(function(){while(fu.callbackDataQueue.length>0){var fC=fu.callbackDataQueue.shift();fu.vectorTileDataCbk(fC[0],fC[1]);fu._checkTilesLoaded()}fu.map._featureMgr.clearData(fu.drawIndex);fu.getVectorLayerDataFromCache(fu.curViewTilesInfo,fu.getZoomState());fu.processDataTimer=null},200)}for(var fs=0,fq=fv.length;fs<fq;fs++){var fn=fv[fs];var fo=fn.col;var fy=fn.row;var fw=fn.zoom;var fm=fn.loopOffsetX;var fr=this.getTileKey(fn);var e=this.tileCache.getData(fr);if(!e){e={status:"init",tileInfo:fn,dataType:eq,key:fr,retry:0}}if(e.status!=="ready"&&e.status!=="loading"){this.numLoading++;e.status="loading";this.tileCache.setData(fr,e);var fp=this.getProcessedLabelZoom(fn);if(fp){fn.processedLabelZooms=fp}this.loadVectorTileData(fn,ft)}}},setThumbData:function(i,fo,fn,e,fm){if(fm===1){if(this._findParentZoomTile(i,fo,fn,e,8)===false){this._findChildZoomTile(i,fo,fn,e,3)}}else{if(fm===-1){if(this._findChildZoomTile(i,fo,fn,e,3)===false){this._findParentZoomTile(i,fo,fn,e,8)}}}this.map._featureMgr.sortThumbData(this.drawIndex)},_findParentZoomTile:function(fq,fz,fy,fo,ft){var fp=be[this.getMapType()];var fm=fp.minDataZoom;var e=fq;var fw=fz;var fu=fy;var fv=fo;for(var fs=1;fs<=ft;fs++){var fn=this.tileType.getParentTile(e,fw,fu,fv,fm);if(fn===null){continue}var fx=this.getTileKey(fn);var fr=this.tileCache.getData(fx);if(fr&&fr.status==="ready"){if(this.thumbCache[fx]){continue}this.map._featureMgr.setData(fr,this.drawIndex,0);this.thumbCache[fx]=true;return true}e=fn.col;fw=fn.row;fu=fn.zoom;fv=fn.useZoom}return false},_findChildZoomTile:function(fr,ft,e,fo,fC){var fA=be[this.getMapType()];var fw=fA.maxDataZoom;var fq=fr;var fs=ft;var fu=e;var fn=fo;var fp=true;for(var fz=1;fz<=fC;fz++){var fx=false;var fm=this.tileType.getChildTiles(fq,fs,fu,fn,fw,fz);if(!fm){continue}for(var fy=0;fy<fm.length;fy++){var fv=this.getTileKey(fm[fy]);var fB=this.tileCache.getData(fv);if(fB&&fB.status==="ready"){if(!this.thumbCache[fv]){this.map._featureMgr.setData(fB,this.drawIndex,1);this.thumbCache[fv]=true}fx=true}else{fp=false}}if(fx){break}}return fp},loadVectorTileData:function(i,fo){var fm=i.col;var fs=i.row;var fq=i.zoom;var fr=i.baseTileSize;var e=this.getTilesUrl(new cO(fm,fs),fq,fr);if(!e){return}var fp=this.getTileKey(i);aP(this.map);if(!this.processData){this.map._workerMgr.loadTileData(e,i,fp,fo);return}var fo="cbk"+fp.replace(/-/g,"_");var fn=this;aI[fo]=function(ft){var fu=(function(fv){return function(){fv.tileInfo=i;var fB=fn.processData(fv);if(!fB.road){return}var fy={tileInfo:i,renderData:{base:[]},status:"ready",key:fp,mapType:fn.mapType};var fE=[];var fH=[];for(var fA=0;fA<fB.road.length;fA++){var fD=fB.road[fA];var fC=-1;for(var fz=0;fz<fD.length;fz++){var fF=fD[fz];var fG=[];if(fE.length/7+fF[0].length/2>65536){fy.renderData.base.push({type:"line",data:[dy.toSolidVertices(fE,4000),new Uint16Array(fH)]});fE=[];fH=[]}for(var fx=0;fx<fF[0].length;fx+=2){fG[fG.length]=[fF[0][fx],fF[0][fx+1]]}var fw=fF[3];dy.overlayLine(fG,fF[1],fF[2],fE,fH,fw,fF[4],fA+20)}fy.renderData.base.push({type:"line",data:[dy.toSolidVertices(fE,4000),new Uint16Array(fH)]})}fn.tileCache.setData(fp,fy);fn.map._featureMgr.clearData(fn.drawIndex);fn.getVectorLayerDataFromCache(fn.curViewTilesInfo,fn.getZoomState());fn.map.dispatchEvent(new aB("onrefresh"))}})(ft);fn.map.jobScheduler.addJob(fu);delete aI[fo]};e+="&fn="+encodeURIComponent(cZ+"."+fo);eZ.load(e)},vectorTileDataCbk:function(fn,fo){var fs=new aB("ontileloaded");fs.perfStat=fn.perfStat||[];var e=this.map;e.fire(fs);var i=fn.tileInfo;var fm=i.col;var fx=i.row;var fw=i.zoom;var fv=i.baseTileSize;var fq=this.tileCache.getData(fo);if(!fq){return}if(!this.showLabel){fn.label=null}fq.renderData=fn;fq.tileInfo=i;var fp=cD.calcLoopParam(fm,fw,fv);var ft=fp.geoOffsetX;fq.tileInfo.loopOffsetX=ft;fq.status="ready";fq.mapType=this.mapType;this.tileCache.setData(fo,fq);fq.label=fn.label;fn.label=null;if(fn.indoorData){e._indoorMgr.setData(fn.indoorData)}var fr="id_"+fm+"_"+fx+"_"+fw;if(!this.curViewTilesInfo[fr]){e.fire(new aB("ontilenotinview"));return}this.processLabelData(fq);if(fn.indoorData&&e._indoorMgr.currentUid){this._refreshIndoorData(e._indoorMgr.currentUid,e._indoorMgr.currentFloor)}var fu=new aB("onrefresh");fu.source="webgllayer";this.map.dispatchEvent(fu)},_refreshIndoorData:function(fv,fu){var fx=this.map._indoorMgr.getIndoorData(fv);var fA=fx.tileKeys;var fy=Math.floor(this.map.getZoom());for(var fs=0;fs<fA.length;fs++){var fp=fA[fs];var fr=this.tileCache.getData(fp);if(!fr){continue}var fz=fr.renderData;fz.indoorBase=[];fz.indoorBaseContour=[];fz.indoorBorder3D=[];fz.indoorArea3D=[];fr.label.indoorLabel=[];this.labelProcessor.clearCollisionCache(fr.label);for(var ft in fz.indoorData){if(ft==="tileInfo"){continue}var e=fz.indoorData[ft];var fo=e.defaultFloor;if(ft===fv){fo=fu;e.currentFloor=fu}if(e.floors[fo]){if(e.floors[fo].base){for(var fq=0;fq<e.floors[fo].base.length;fq++){fz.indoorBase.push(e.floors[fo].base[fq])}}if(e.floors[fo].contour){for(var fq=0;fq<e.floors[fo].contour.length;fq++){fz.indoorBaseContour.push(e.floors[fo].contour[fq])}}if(e.floors[fo].indoorBorder3D){fz.indoorBorder3D.push(e.floors[fo].indoorBorder3D)}if(e.floors[fo].area3D){fz.indoorArea3D.push(e.floors[fo].area3D)}if(e.floors[fo].pois){fr.label.indoorLabel=fr.label.indoorLabel.concat(e.floors[fo].pois)}}}this.updateAllIconsTextureCoords(fr);var fw=this;this.labelProcessor.loadIconImages(fr,function(i){fw.updateAllIconsTextureCoords(i)});var fn=fp.split("_");var fm=parseInt(fn[fn.length-1],10);if(fm!==fy){continue}fw.map._featureMgr.setData(fr,this.drawIndex,2)}this.dataBackCollideLabels();this.map.dispatchEvent(new aB("onrefresh"))},_removeIndoorData:function(i){if(!i.indoorData){return}for(var e in i.indoorData){if(e==="tileInfo"){continue}this.map._indoorMgr.removeData(e,i.key)}},getProcessedLabelZoom:function(fn){var fo=b4.baseZoomInfo[fn.zoom];if(!fo){return false}var fm=[];for(var fp=0;fp<fo.length;fp++){var fq=this.getTileKey(fn,{useZoom:fo[fp]});var e=this.tileCache.getData(fq);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){fm.push(fo[fp])}}if(fm.length){return fm}else{return false}},getSameZoomDataFromCache:function(fm){var fn=b4.baseZoomInfo[fm.zoom];for(var fo=0;fo<fn.length;fo++){var fp=this.getTileKey(fm,{useZoom:fn[fo]});if(fm.useZoom===fn[fo]){continue}var e=this.tileCache.getData(fp);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){return e}}return false},hasSameLabelData:function(fn,fm){for(var e=0;e<fm.length;e++){if(fm[e].key===fn){return true}}return false},getDataByFloorName:function(fm,fn){for(var e=0;e<fm.length;e++){if(fm[e].floorName===fn){return fm[e]}}return null},mergeIndoorLabelData:function(fs,e){for(var fq in fs){if(fq==="tileInfo"){continue}if(e[fq]){var fm=fs[fq].floors;var ft=e[fq].floors;for(var fo=0;fo<fm.length;fo++){var fn=fm[fo];var fr=fn.floorName;var fp=this.getDataByFloorName(ft,fr);if(fp){if(fp.pois){fp.pois=fp.pois.concat(fn.pois);fn.pois=fp.pois}else{fp.pois=fn.pois}}}}}},mergeSameZoomLabelData:function(fq){var fo=fq.label;if(!fo){return}var e=fq.tileInfo;var fp=this.getSameZoomDataFromCache(e);if(!fp){return}var fn=fp.label;if(!fn){return}for(var fm=0;fm<fo.fixedLabel.length;fm++){if(!this.hasSameLabelData(fo.fixedLabel[fm].key,fn.fixedLabel)){fn.hasNewData=true;fn.fixedLabel.push(fo.fixedLabel[fm])}}for(var fm=0;fm<fo.lineLabel.length;fm++){if(!this.hasSameLabelData(fo.lineLabel[fm].key,fn.lineLabel)){fn.hasNewData=true;fn.lineLabel.push(fo.lineLabel[fm])}}for(var fm=0;fm<fo.indoorLabel.length;fm++){if(!this.hasSameLabelData(fo.indoorLabel[fm].key,fn.indoorLabel)){fn.hasNewData=true;fn.indoorLabel.push(fo.indoorLabel[fm])}}fq.label=fn;if(fp.renderData.indoorData&&fq.renderData.indoorData){this.mergeIndoorLabelData(fq.renderData.indoorData,fp.renderData.indoorData)}},processLabelData:function(fp){if(!fp.label){return}if(fp.label.status==="processing"){return}fp.label.status="processing";var fn=this;fn.updateAllIconsTextureCoords(fp);this.labelProcessor.loadIconImages(fp,function(fq){fn.updateAllIconsTextureCoords(fq)});if(this.map.config.textRenderType==="canvas"){var e=this.labelProcessor.drawLabelsOnCanvas(fp,function(fs,ft){var fr=fp.tileInfo;fn.mergeSameZoomLabelData(fp);if(fs){if(!fp.label.textureHeights){fp.label.textureHeights=[]}fp.label.textureHeights[fr.useZoom]=fs.height}if(ft){if(!fp.label.indoorTextureHeights){fp.label.indoorTextureHeights=[]}fp.label.indoorTextureHeights[fr.useZoom]=ft.height}var fq=fn._getTileTexImgKey(fr);fn._doWorkAfterLabelImageLoad(fp,fs,ft,fq)});return}var fm=fp.label.textImageBitmap||fp.label.textImgStr;var fo=fp.label.indoorTextImageBitmap||fp.label.indoorTextImgStr;this.labelProcessor.loadImgByStr(fm,fo,function i(fv,ft){var fs=fp.label.textureHeight;var fw=fp.label.indoorTextureHeight;fp.label.textureHeight=undefined;fp.label.indoorTextureHeight=undefined;var fr=fp.tileInfo;fn.mergeSameZoomLabelData(fp);var fu=fp.label;fu.textImgStr="";fu.indoorTextImgStr&&(fu.indoorTextImgStr="");if(!fu.textureHeights){fu.textureHeights=[]}fu.textureHeights[fr.useZoom]=fs;if(!fu.indoorTextureHeights){fu.indoorTextureHeights=[]}fu.indoorTextureHeights[fr.useZoom]=fw;var fq=fn._getTileTexImgKey(fr);fn._doWorkAfterLabelImageLoad(fp,fv,ft,fq)})},_getTileTexImgKey:function(i){var fm=i.style||this.mapStyleId||"default";var e=fm+"_"+i.col+"_"+i.row+"_"+i.zoom;if(this.map.config.textRenderType==="canvas"){e+="_"+i.useZoom}return e},_doWorkAfterLabelImageLoad:function(fr,fp,fn,i){var fq=this;var fo=fr.label;fo.tileInfo=fr.tileInfo;fo.status="ready";if(fp||fn){var e=fo.tileInfo;if(fp){fp.id=i;if(!fo.textureSources){fo.textureSources=[]}fo.textureSources[e.useZoom]=fp}if(fn){fn.id=i+"_indoor";if(!fo.indoorTextureSources){fo.indoorTextureSources=[]}fo.indoorTextureSources[e.useZoom]=fn}if(fq.map._webglMapScene){var fm=fq.map._webglMapScene._painter;if(fp){fm._addToAsyncJob(fo.textureSources[e.useZoom])}}}if(fr.custom!==true){fq.tileLabels.push(fo)}if(fq.collisionTimer){return}fq.collisionTimer=setTimeout(function(){fq.dataBackCollideLabels();fq.collisionTimer=null},300)},_updateIconTextureCoords:function(fr,fm){if(!fr){return}var fq=this.map;for(var fn=0;fn<fr.length;fn++){var fp=fr[fn];if(!fp.iconPos){continue}if(fq._webglMapScene){var e=fq._webglMapScene._painter;var fo=fm+"_"+fp.iconPos.iconType;fp.iconPos.texcoord=e._iconTextureAtlasCoords[fo]||null}}},updateAllIconsTextureCoords:function(fo){if(this.map.viewAnimationTime){return}if(fo){if(fo.label){var i=fo.tileInfo.style;this._updateIconTextureCoords(fo.label.fixedLabel,i);this._updateIconTextureCoords(fo.label.indoorLabel,i)}}else{var fn=this.tileCache.getAllData();for(var fm in fn){var e=fn[fm].data;if(e.status==="ready"&&e.label){var i=e.tileInfo.style;this._updateIconTextureCoords(e.label.fixedLabel,i);this._updateIconTextureCoords(e.label.indoorLabel,i)}}}this.updateLabels();this.map.dispatchEvent(new aB("onrefresh"))},cacheDataCollideLabels:function(fm){var fo=this;var i=this.map._featureMgr;function fn(){fo.cacheLabelTimer=null;var fp;var fq=fo.map.getTilt();var fr=fo.map.getHeading()%360;if(fo.tileLabels.length===0||(fo.tileLabels.length===1&&fo.tileLabels[0].tileInfo.zoom===0)){fp=i.getLabelData();if(fp.length>0){fp=fo.labelProcessor.collisionTest(fp,-1)}}else{if(fq||fr){if(this._collisionTimer){if(!fq){clearTimeout(this._collisionTimer)}else{if(Date.now()-fo.lastCollisionTestTime>500){fo.lastCollisionTestTime=Date.now()}else{clearTimeout(this._collisionTimer)}}}this._collisionTimer=setTimeout(function(){fp=fo.labelProcessor.collisionTest(fo.tileLabels);if(fp){i.setLabelData(fp)}fo.updateLabels();fo.map.dispatchEvent(new aB("onrefresh"));fo._collisionTimer=null},60);return}else{fp=fo.labelProcessor.getCachedLabels(fo.tileLabels)}}if(fp){i.setLabelData(fp)}fo.updateLabels();fo.map.dispatchEvent(new aB("onrefresh"))}if(!fm){clearTimeout(fo.cacheLabelTimer);fn()}else{if(fo.cacheLabelTimer){return}fo.cacheLabelTimer=setTimeout(function e(){fn()},fm)}},dataBackCollideLabels:function(){var i=this;if((i.tileLabels&&i.tileLabels.length===0)){return}var e;i.labelProcessor.calcLabelsCollision(i.tileLabels);e=i.labelProcessor.getCachedLabels(i.tileLabels);if(e){i.map._featureMgr.setLabelData(e)}i.updateLabels();i.map.dispatchEvent(new aB("onrefresh"));if(d8()){this.labelProcessor._refreshSpotData()}},updateLabels:function(fo){var fp=this.map;var i=fp._featureMgr;var fm=i.getLabelData();if(fm.length>0){var fn=fp.getZoom();if(fm.labelZoom-fn<3){this.labelProcessor.updateLabels(fm);var e=this.labelProcessor.fixDataFormat(fm);i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData(e[2],4)}else{i.clearLabelOverlayData()}fp.temp.isPermitSpotOver=false;this.labelProcessor.curSpotAdded=false}},loadRasterLayerData:function(fn,fr){if(fr){for(var fp=0,fo=fn.length;fp<fo;fp++){var fm=fn[fp];var fs=this.getTileKey(fm);var e=this.tileCache.getData(fs);if(e&&e.status==="ready"){this.map._featureMgr.setData(e,this.drawIndex,2)}}return}for(var fp=0,fo=fn.length;fp<fo;fp++){var fm=fn[fp];var fs=this.getTileKey(fm);var e=this.tileCache.getData(fs);if(!e){this.tileCache.setData(fs,{});var fq=this;this.loadRasterTileData(fm,function(i,ft){fq.rasterTileDataCbk(i,ft)})}}},loadRasterTileData:function(i,e){var fo=i.col;var fr=i.row;var fp=i.zoom;var fn=this.getTilesUrl(new cO(fo,fr),fp);if(!fn){return}var fq=this.getTileKey(i);var fm=this.loadTileImage(fn,fq,e);fm.tileInfo=i},loadTileImage:function(fn,fm,e){var i=new Image();i.crossOrigin="anonymous";i.onload=function(){e&&e(this,fm)};i.onerror=function(){e&&e(null,fm)};i.src=fn;return i},rasterTileDataCbk:function(fp,fn){if(!fp){this.tileCache.removeData(fn);return}var i=fp.tileInfo;var fm=i.col;var fv=i.row;var fu=i.zoom;var e=this.tileCache.getData(fn);if(!e){return}var fo=cD.calcLoopParam(fm,fu);var fs=fo.geoOffsetX;fp.tileInfo.loopOffsetX=fs;e.textureSource=fp;e.dataType=c4;e.tileInfo=i;e.renderData={vertexAll:[0,0,0,0,0,256,0,0,1,0,256,256,0,1,1,0,0,0,0,0,256,256,0,1,1,0,256,0,0,1]};e.status="ready";this.tileCache.setData(fn,e);var fq="id_"+fm+"_"+fv+"_"+fu;var fr=false;if(this.curViewTilesInfo[fq]){e.dataType=c4;e.png8=this.png8||false;this.map._featureMgr.setData(e,this.drawIndex,2);fr=true}if(fr){var ft=new aB("onrefresh");ft.source="webgllayer";this.map.dispatchEvent(ft)}},_checkTilesLoaded:function(){this.numLoading--;if(this.map.firstTileLoad===false){this.map.dispatchEvent(new aB("onfirsttilesloaded"));this.map.firstTileLoad=true}var e=this;if(this.numLoading===0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading===0){e.map.dispatchEvent(new aB("ontilesloaded"))}e._checkLoadedTimer=null},60)}},isClickableLabel:function(e){if(e.isDel){return false}if(e.zoom>9&&!e.guid){return false}if(e.zoom<=9&&!e.name&&!e.guid){return false}return true}};var bg=5;var cA=4;var e2=3;var dw=2;var fg=1;var cC=0;function r(e){this._ratio=ay();this._iconCache={};this._map=e;this._drawingCanvasPool=[];this._drawingCanvasHeight=4096}x.extend(r.prototype,{_loadIcons:function(i,fr){var fp=0;var fo=this;var fm=this._map.config.style;for(var fq in i){fp++;var e=new Image();e.id=fq;e.crossOrigin="anonymous";e.onload=function(){fo._iconCache[this.id].loaded=true;fp--;if(fp===0){fr()}this.onload=null};e.onerror=function(){fo._iconCache[this.id]=null;fp--;if(fp===0){fr()}this.onerror=null};var fn=dn.getIconSetPath(fm)+fq+".png";e.src=fn;this._iconCache[fq]={loaded:false,image:e}}},_getEmptyDrawingCanvas:function(){for(var fm=0;fm<this._drawingCanvasPool.length;fm++){if(this._drawingCanvasPool[fm]._free===true){this._drawingCanvasPool[fm]._free=false;return this._drawingCanvasPool[fm]}}var e=this._createNewDrawingCanvas();this._drawingCanvasPool.push(e);e._free=false;return e},_createNewDrawingCanvas:function(){var e=H("canvas");e.width=512;e.height=this._drawingCanvasHeight;e._free=true;e._id=aI.getGUID();var i=e.getContext("2d");i.textBaseline="bottom";i.lineJoin="round";return e},drawLabelsOnCanvas:function(fF,fn){var fv=fF.label.fixedLabel.slice(0);var fB=fF.label.lineLabel.slice(0);var fm=fF.label.indoorLabel.slice(0);if(fv.length===0&&fB.length===0&&fm.length===0){fn();return}var fq=function(fK,i){return fK.styleId-i.styleId};fv.sort(fq);fB.sort(fq);fm.sort(fq);var fE={};var e=this._getEmptyDrawingCanvas();var fA=e.getContext("2d");fA.clearRect(0,0,e.width,e.height);var fI=0;var fw=null;var fp=0;if(fv.length>0){while(fp<fv.length&&!fv[fp].styleText[0]){fp++}if(fv[fp]&&fv[fp].styleText[0]){fw=fv[fp].styleText[0].fontSize+fv[fp].styleText[0].haloSize*2}}if(fw===null&&fm.length>0){fp=0;while(fp<fm.length&&!fm[fp].styleText[0]){fp++}if(fm[fp]&&fm[fp].styleText[0]){fw=fm[fp].styleText[0].fontSize+fm[fp].styleText[0].haloSize*2}}if(fw===null&&fB.length>0){fp=0;while(fp<fB.length&&!fB[fp].styleText[0]){fp++}if(fB[fp]&&fB[fp].styleText[0]){fw=fB[fp].styleText[0].fontSize+fB[fp].styleText[0].haloSize*2}}if(fw===null||isNaN(fw)){fn();return}var fs=0;var fr=fw;var fy={};var fJ=0;var fz=[];for(var fD=0;fD<fv.length;fD++){var fu=fv[fD];var fx=fu.name;var fC=fu.styleText;if(!fx||fC.length===0){continue}var fo=fu.icon;if(fu.textOnIcon&&(!this._iconCache[fo]||this._iconCache[fo].loaded===false)){fz.push(fu);fJ++;if(!fy[fo]){fy[fo]=true}continue}var fG=this._drawEachText(fA,fu,fI,fs,fr,fw,fE);if(!fG){continue}fs=fG.curX;fr=fG.curY;fw=fG.curLineHeight;fI=fG.styleId}var fG=this._drawEachTypeOfLabels(fA,fm,fI,fs,fr,fw,fE);fI=fG.curStyleId;fs=fG.curX;fr=fG.curY;fw=fG.curLineHeight;var fG=this._drawEachTypeOfLabels(fA,fB,fI,fs,fr,fw,fE);fI=fG.curStyleId;fs=fG.curX;fr=fG.curY;fw=fG.curLineHeight;if(fJ>0){var fH=this;this._loadIcons(fy,function(){fG=fH._drawEachTypeOfLabels(fA,fz,fI,fs,fr,fw,fE);fI=fG.curStyleId;fs=fG.curX;fr=fG.curY;fw=fG.curLineHeight;var i=fH._generateEachLabelCanvas(e,fr,fv,fB,fm,fF);fn(i[0],i[1])});return}var ft=this._generateEachLabelCanvas(e,fr,fv,fB,fm,fF);fn(ft[0],ft[1])},drawCustomLabelsOnCanvas:function(fq,fw){if(fq.length===0){fw();return}var fm=0;var e=(fq[0].style.fontSize+(fq[0].style.haloSize||0)*2)||0;var fn=e;var fs=this._getEmptyDrawingCanvas();var fx=fs.getContext("2d");fx.clearRect(0,0,fs.width,fs.height);var ft={};var fv=-1;for(var fo=0;fo<fq.length;fo++){if(!fq[fo].name){continue}var fu=this._drawEachText(fx,fq[fo],fv,fm,e,fn,ft);if(!fu){continue}fm=fu.curX;e=fu.curY;fn=fu.curLineHeight;fv=fu.styleId}var fp=e;var fr=this._copyToNewCanvas(fs,fp);for(var fo=0;fo<fq.length;fo++){if(!fq[fo].name&&fq[fo].style.iconSize){this._addFixedLabelBounds(fq[fo]);continue}if(!fq[fo].textSize){continue}this._updateFixedLabelCoords(fq[fo],fp);this._addFixedLabelBounds(fq[fo])}fw(fr)},_drawEachTypeOfLabels:function(fw,fq,fu,fn,fm,fo,fs){for(var fp=0;fp<fq.length;fp++){var fr=fq[fp];var fv=fr.name;var e=fr.styleText;if(!fv||e.length===0){continue}var ft=this._drawEachText(fw,fr,fu,fn,fm,fo,fs);if(!ft){continue}fn=ft.curX;fm=ft.curY;fo=ft.curLineHeight;fu=ft.styleId;if(ft.curY>this._drawingCanvasHeight){return{curX:fn,curY:fm,curLineHeight:fo,curStyleId:fu}}}return{curX:fn,curY:fm,curLineHeight:fo,curStyleId:fu}},_drawIndoorTextLabelOnCanvas:function(fo){var e=this._getEmptyDrawingCanvas();var fv=e.getContext("2d");fv.clearRect(0,0,e.width,e.height);var fD=0;var fu=null;var ft=0;var fr;var fA={};var fz=[];for(var fp in fo){if(fp==="tileInfo"){continue}var fn=fo[fp];var fy=fn.defaultFloor;var fs=fn.floors;for(var fx=0;fx<fs.length;fx++){if(fx===fy){continue}var fB=fs[fx];if(!fB.pois){continue}var fq=fB.pois;for(var fw=0;fw<fq.length;fw++){if(fu===null&&fq[fw].styleText[0]){fu=fq[fw].styleText[0].fontSize+fq[fw].styleText[0].haloSize*2;fr=fu}fz.push(fq[fw])}}}if(fu===null){return null}fz.sort(function(fE,i){return i.rank-fE.rank||fE.styleId-i.styleId});var fC=this._drawEachTypeOfLabels(fv,fz,fD,ft,fr,fu,fA);fD=fC.curStyleId;ft=fC.curX;fr=fC.curY;fu=fC.curLineHeight;var fm=this._copyToNewCanvas(e,fr);return fm},_updateIndoorLabelsCoords:function(fu,fv){for(var ft in fu){if(ft==="tileInfo"){continue}var e=fu[ft];var fp=e.defaultFloor;var fq=e.floors;for(var fr=0;fr<fq.length;fr++){if(fr===fp){continue}var fm=fq[fr];if(!fm.pois){continue}var fo=fm.pois;for(var fn=0;fn<fo.length;fn++){var fs=fo[fn];if(fs.name&&(!fs.textSize||fs.textSize.length===0)){fo.splice(fn,1);fn--;continue}this._updateFixedLabelCoords(fs,fv);this._addFixedLabelBounds(fs)}}}},_generateEachLabelCanvas:function(fq,fp,fr,e,ft,fm){fp=Math.min(fp,this._drawingCanvasHeight);var fs=this._copyToNewCanvas(fq,fp);var fn=null;if(fm.renderData.indoorData){fn=this._drawIndoorTextLabelOnCanvas(fm.renderData.indoorData);if(fn){this._updateIndoorLabelsCoords(fm.renderData.indoorData,fn.height)}}for(var fo=0;fo<fr.length;fo++){if(!fr[fo].textSize){continue}this._updateFixedLabelCoords(fr[fo],fp);this._addFixedLabelBounds(fr[fo])}for(var fo=0;fo<ft.length;fo++){if(!ft[fo].textSize){continue}this._updateFixedLabelCoords(ft[fo],fp);this._addFixedLabelBounds(ft[fo])}for(var fo=0;fo<e.length;fo++){this._updateLineLabelCoords(e[fo],fp)}return[fs,fn]},_copyToNewCanvas:function(fm,i){if(i===0){return null}var fn=H("canvas");fn.width=fm.width;fn.height=i;var e=fn.getContext("2d");e.drawImage(fm,0,0,512,i,0,0,512,i);fn._id=fm._id;fm._free=true;return fn},_drawEachText:function(fC,fq,i,fE,fD,fL,fn){var fK=fq.name;var fu=fq.styleText?fq.styleText[0]:fq.style;if(!fu){return null}var fx=fu.fontSize;var f0=fu.haloSize||0;if(!fy){}var fU=fu.fontRgba?"rgba("+fu.fontRgba.join(",")+")":fu.color;var fp=fu.haloRgba?"rgba("+fu.haloRgba.join(",")+")":fu.strokeColor;var f2=fq.styleId||0;if(f0>2){f0=2}var fM=[];var fB=[];var fI=0;if(fn&&!fn[f2]){fn[f2]={}}var fw=fx+f0*2;var fN=fw;if(fq.containDescendings){fN+=4}if(f0===0){fN+=2}if(fq.textOnIcon){fN=Math.max(fN,fq.iconSize[1])}if(f2!==i||fN>fL){i=f2;fC.font=fx+"px sans-serif";if(fN>fL){var fJ=fN-fL;fL+=fJ;fD+=fJ}if(f0>0){fC.lineWidth=f0*2;fC.strokeStyle=fp}fC.fillStyle=fU}if(fq.type==="line"){var fs=fK.split("");for(var f3=0;f3<fs.length;f3++){var fW=fs[f3];var fF;var fO;if(fn[f2][fW]){var fy=fn[f2][fW];fF=fy.displaySize;fO=fy.curWordPosition}else{var fm=Math.ceil(fC.measureText(fW).width);if(fE+fm>512){fE=0;fD+=fN;fL=fN}if(fD>this._drawingCanvasHeight){return{curX:fE,curY:fD,curLineHeight:fL,styleId:f2}}var fX=fE;if(f0>0){fm+=f0;fX-=Math.round(f0/2);fC.strokeText(fW,fE,fD)}fC.fillText(fW,fE,fD);var fT=[fm,fN];fF=[Math.round(fT[0]/2),Math.round(fT[1]/2)];fO=[fX,fD-fN];fn[f2][fW]={displaySize:fF,curWordPosition:fO,totalHeight:fI};fE+=fm+2}fM.push(fF);fB.push(fO)}fI=Math.round(fM[0][1])}else{if(fn[f2][fK]){var fy=fn[f2][fK];fM=fy.textSize;fB=fy.labelImagePosition;fI=fy.totalHeight}else{var fz=fK.split("\\");if(fz.length>1&&fq.textOnIcon){var f4=0;var f1=0;var f5=[];var fG=8;for(var f3=0;f3<fz.length;f3++){var fK=fz[f3];var fv=Math.ceil(fC.measureText(fK).width);if(fv>f4){f4=fv}f5.push(Math.round(fv/2));f1+=fN}var ft=f4+2*fG;var fZ=f1+2*fG;if(fE+ft>512){fE=0;fD+=fL}fD+=f1-fN+2*fG;var fS=fE;var fH=fD-fZ;var e=Math.round(ft/2);var fA=this._iconCache[fq.icon].image;this.drawStretchedIcon(fC,fA,[fS,fH],fG,f4,f1);for(var f3=0;f3<fz.length;f3++){var fK=fz[f3];var fY=fS+(e-f5[f3]);var fV=fH+4+(f3+1)*fN;fC.fillText(fK,fY,fV)}fM.push([Math.round(ft/2),Math.round(fZ/2)]);fB.push([fS,fH]);fE+=ft;fL=fZ;fI=Math.round(fZ/2)}else{for(var f3=0;f3<fz.length;f3++){var fK=fz[f3];var fv=Math.ceil(fC.measureText(fK).width);var ft=fv;var fo=0;if(fq.textOnIcon){fo=10;ft+=fo*2;if(fq.styleId===519){ft=fq.iconSize[0];fo=Math.round((ft-fv)/2)}}if(fE+ft>512){fE=0;fD+=fN;fL=fN}if(fD>this._drawingCanvasHeight){return{curX:fE,curY:fD,curLineHeight:fL,styleId:f2}}var fS=fE;var fH=fD-fN;var fR=fE;var fQ=fD;if(fq.containDescendings){fQ-=4}if(fq.textOnIcon){var fA=this._iconCache[fq.icon].image;var fP=fq.iconSize;if(fq.styleId===519){fC.drawImage(fA,0,0,fP[0],fP[1],fS,fH,fP[0],fP[1])}else{this.draw3StretchedIcon(fC,fA,[fS,fH],fo,fv,fP[1])}fR+=fo;if(fq.iconSize[1]>fw){fQ-=(fq.iconSize[1]-fw)/2-1}ft+=1}if(f0>0){ft+=f0;fS-=Math.round(f0/2);fC.strokeText(fK,fR,fQ)}fC.fillText(fK,fR,fQ);var fr=[ft,fN];var fF=[Math.round(fr[0]/2),Math.round(fr[1]/2)];fM.push(fF);fB.push([fS,fH]);fI+=Math.round(fF[1]);fE+=ft}}fn[f2][fK]={textSize:fM,labelImagePosition:fB,totalHeight:fI}}}fq.textSize=fM;fq.labelImagePosition=fB;fq.totalHeight=fI;return{curX:fE,curY:fD,curLineHeight:fL,styleId:f2}},drawStretchedIcon:function(e,fm,fn,fq,fr,i){var fp=fn[0];var fo=fn[1];e.drawImage(fm,0,0,fq,fq,fp,fo,fq,fq);e.drawImage(fm,fq,0,1,fq,fp+fq,fo,fr,fq);e.drawImage(fm,fm.width-fq,0,fq,fq,fp+fr+fq,fo,fq,fq);e.drawImage(fm,0,fq,fq,1,fp,fo+fq,fq,i);e.drawImage(fm,fq,fq,1,1,fp+fq,fo+fq,fr,i);e.drawImage(fm,fm.width-fq,fq,fq,1,fp+fr+fq,fo+fq,fq,i);e.drawImage(fm,0,fm.height-fq,fq,fq,fp,fo+i+fq,fq,fq);e.drawImage(fm,fq,fm.height-fq,1,fq,fp+fq,fo+i+fq,fr,fq);e.drawImage(fm,fm.width-fq,fm.height-fq,fq,fq,fp+fr+fq,fo+i+fq,fq,fq)},draw3StretchedIcon:function(e,i,fm,fp,fr,fq){var fo=fm[0];var fn=fm[1];e.drawImage(i,0,0,fp,i.height,fo,fn,fp,i.height);e.drawImage(i,fp,0,1,i.height,fo+fp,fn,fr,i.height);e.drawImage(i,i.width-fp,0,fp,i.height,fo+fp+fr,fn,fp,i.height)},_updateFixedLabelCoords:function(fo,fD){if(fD===0){return}var fy=[];var fK=[];var fL=0;var fB=fo.totalHeight;var fT=fo.textSize.length;var fp=fo.direction;if(typeof fp!=="number"){fp=0}for(var fM=0;fM<fT;fM++){var fE=fo.labelImagePosition[fM];var fC=fo.textSize[fM];var fA=fE[0];var fn=fE[1];var fq=fC[0];var fv=fC[1];var fx=0;var fJ=0;if(typeof fo.textMargin==="number"){fJ=fo.textMargin}var fw;var e;var fs=0;var fz=0;if(!fo.iconPos){if(!fo.custom){fp=cA}}else{fs=fo.iconPos.width;fz=fo.iconPos.height}switch(fp){case e2:var fm=fB/2-fv+fx*(fT-1)/2;fw=Math.round(-fs/2-fq-fJ);e=Math.round(fm-fL-fx*fM);break;case fg:var fm=fB/2-fv+fx*(fT-1)/2;fw=Math.round(fs/2+fJ);e=Math.round(fm-fL-fx*fM);break;case dw:var fm=fz/2+fB-fv+fx*fT;fw=Math.round(-fq/2);e=Math.round(fm-fL-fx*fM);break;case cC:var fm=-fz/2-fx-fv;fw=Math.round(-fq/2);e=Math.round(fm-fL-fx*fM);break;case cA:var fm=-fB/2-fx*(fT-1)/2;fw=Math.round(-fq/2);e=Math.round(fm-fL-fx*fM);break}fL+=fv;var fu=fw+fq;var fU=e;var ft=fu;var fS=fU+fv;var fr=fw;var fR=fS;fy.push(fw,e,fu,fU,ft,fS,fw,e,ft,fS,fr,fR);var fQ=fA/512;var fI=(fD-fn-fv*2)/fD;var fP=(fA+fq*2)/512;var fH=fI;var fO=fP;var fG=(fD-fn)/fD;var fN=fQ;var fF=fG;fK.push(fQ,fI,fP,fH,fO,fG,fQ,fI,fO,fG,fN,fF)}if(!fo.textPos){fo.textPos={}}fo.textPos.vertex=fy;fo.textPos.texcoord=fK},_addFixedLabelBounds:function(ft){var fp=1000;var fn=1000;var fm=-1000;var e=-1000;if(ft.iconPos){var fr=ft.iconPos["vertex"];for(var fs=0,fo=fr.length;fs<fo;fs+=2){var fx=fr[fs];var fv=fr[fs+1];if(fx<fp){fp=fx}if(fx>fm){fm=fx}if(fv<fn){fn=fv}if(fv>e){e=fv}}}if(ft.custom&&ft.style.iconSize&&!ft.name){var fu=ft.style.iconSize;var fw=ft.direction;switch(fw){case cA:fp=-Math.round(fu[0]/2);fn=-Math.round(fu[1]/2);fm=Math.round(fu[0]/2);e=Math.round(fu[1]/2);break;case dw:fp=-Math.round(fu[0]/2);fn=0;fm=Math.round(fu[0]/2);e=fu[1];break}}if(ft.textPos){var fq=ft.textPos["vertex"];for(var fs=0,fo=fq.length;fs<fo;fs+=2){var fx=fq[fs];var fv=fq[fs+1];if(fx<fp){fp=fx}if(fx>fm){fm=fx}if(fv<fn){fn=fv}if(fv>e){e=fv}}}ft.bds=[fp,fn,fm,e]},_updateLineLabelCoords:function(fE,fu){if(fu===0){return}var fn=fE.wordsInfo;var fB=fE.wordCount;if(!fE.labelImagePosition){return}var fw=fE.labelImagePosition.slice(0);if(fE.reverse){fw.reverse()}var fN=1000;var fK=1000;var fL=-1000;var fJ=-1000;for(var fF=0;fF<fB;fF++){var fO=fw[fF];var fM=fO[0];var fC=fO[1];var fA=fE.textSize[fF];var ft=fA[0];var e=fA[1];var fs=fM/512;var fz=(fu-fC-e*2)/fu;var fq=(fM+ft*2)/512;var fy=fz;var fo=fq;var fx=(fu-fC)/fu;var fm=fs;var fv=fx;fn[fF].size=[ft,e];fn[fF].texcoord=[fs,fz,fq,fy,fo,fx,fs,fz,fo,fx,fm,fv];var fI=fn[fF].offset[0];var fH=fn[fF].offset[1];var fG=fI-ft/2;var fr=fH+e/2;var fp=fH-e/2;var fD=fI+ft/2;if(fG<fN){fN=fG}if(fD>fL){fL=fD}if(fp<fK){fK=fp}if(fr>fJ){fJ=fr}}fE.bds=[fN,fK,fL,fJ]}});var bJ={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};function br(fm,fn,fo){var e=fm.bds;if(!e){return false}var i=fm.tracer;var fr;if(i){if(!bJ[i]){fr=i.toString(2);if(fr.length<8){fr=new Array(8-fr.length+1).join("0")+fr}bJ[i]=fr}fr=bJ[i];var fq=b4.mapZoomStartZoomMapping[fn];return fr[fn-fq]==="1"}var fp=fm.displayRange;if(fo>=fp[0]&&fo<=fp[1]){return true}return false}function b5(i,e){this.map=i.map;this.layer=i;e=e||[];this.allLabels=[];this._spotData=[];this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000;this._useRound=false;this._mapIsMoving=false;this._onMapIdleCallback=e.onMapIdleCallback;this.map.temp.isPermitSpotOver=true;this.currentSelectedLabel=null;this.map._labelProcessor=this;this.iconCache={};this.fixedLabelData=[];this.lineLabelData=[];this.highlightLabelData=[];this._iconLoadTimer=null;this._labelTextCanvas=null;if(this.map.config.textRenderType==="canvas"){this._labelTextCanvas=this.map.tileMgr.getLabelTextCanvas()}this.bind()}x.extend(b5.prototype,{bind:function(){var fm=this.map;var i=this;fm.addEventListener("mapstatusbusy_inner",function(fn){i._useRound=false;i._mapIsMoving=true});fm.addEventListener("mapstatusidle_inner",function(fn){if(!d8()){i._useRound=true}i._mapIsMoving=false});fm.addEventListener("onspotmouseover",function(fp){if(!this.temp.isPermitSpotOver){return}if(fp.spots.length>0){var fo=fp.spots[0].userdata.uid;var fq=fp.spots[0].userdata.tilePosStr;var fn=i.getLabelByUid(fo,fq);fn&&fn.formatedData&&i._toHighlightColor(fn.formatedData)}});fm.addEventListener("onspotmouseout",function(fp){if(!this.temp.isPermitSpotOver){return}if(fp.spots.length>0){var fo=fp.spots[0].userdata.uid;var fq=fp.spots[0].userdata.tilePosStr;var fn=i.getLabelByUid(fo,fq);fn&&fn.formatedData&&i._toDefaultColor(fn.formatedData)}});fm.addEventListener("spotclick",function(fp){if(fp.spots&&fp.spots.length>0){if(fp.spots[0].userdata.zoom<10){return}var fo=fp.spots[0].userdata.uid;var fq=fp.spots[0].userdata.tilePosStr;if(i.currentSelectedLabel&&(i.currentSelectedLabel.uid!==fo||i.currentSelectedLabel.tilePosStr!==fq)){i._recoverNormalState()}var fn=i.getLabelByUid(fo,fq);fn&&i._changeBaseMapState(fn)}else{i._recoverNormalState()}});fm.on("spot_status_reset",function(){i._recoverNormalState()});fm.on("spot_highlight",function(fo){var fn=i.getLabelByUid(fo.uid,fo.tilePosStr);fn&&fn.formatedData&&i._toHighlightColor(fn.formatedData)});fm.addEventListener("mousemove",function(fn){if(i.curSpotAdded){return}if(this.currentOperation!==cx.idle||i._mapIsMoving===true){return}i._refreshSpotData();this.temp.isPermitSpotOver=true;i.curSpotAdded=true});if(d8()){function e(){i._refreshSpotData()}fm.addEventListener("mapstatusidle_inner",e)}fm.on("style_loaded",function(){if(i.map.config.textRenderType==="canvas"&&!i._labelTextCanvas){i._labelTextCanvas=i.map.tileMgr.getLabelTextCanvas()}})},getLabelByUid:function(fq,fr){var e=this.map._featureMgr.getResult().tileLabels;for(var fp=0;fp<e.length;fp++){var fm=e[fp].fixedLabel;for(var fo=0;fo<fm.length;fo++){if(e[fp].fixedLabel[fo].guid===fq&&e[fp].fixedLabel[fo].tilePosStr===fr){return e[fp].fixedLabel[fo]}}var fn=e[fp].indoorLabel;for(var fo=0;fo<fn.length;fo++){if(e[fp].indoorLabel[fo].guid===fq&&e[fp].indoorLabel[fo].tilePosStr===fr){return e[fp].indoorLabel[fo]}}}return null},getTileByLabelUid:function(fq){var e=this.map._featureMgr.getResult().tileLabels;for(var fp=0;fp<e.length;fp++){var fm=e[fp].fixedLabel;for(var fo=0;fo<fm.length;fo++){if(e[fp].fixedLabel[fo].guid===fq){return e[fp]}}var fn=e[fp].indoorLabel;for(var fo=0;fo<fn.length;fo++){if(e[fp].indoorLabel[fo].guid===fq){return e[fp]}}}return null},_toHighlightColor:function(fm){if(fm.tempRank&&fm.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];var fo=false;for(var fn=0;fn<e.length;fn++){if(e[fn]===fm||(e[fn].guid===fm.guid&&e[fn].tilePosStr===fm.tilePosStr&&e[fn].zoom===fm.zoom)){fo=true;break}}if(fo){return}e.push(fm);this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new aB("onrefresh"))},_toDefaultColor:function(fm){if(fm.tempRank&&fm.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4]||[];for(var fn=0;fn<e.length;fn++){if(fm===e[fn]||(fm.guid===e[fn].guid&&fm.tilePosStr===e[fn].tilePosStr&&fm.zoom===e[fn].zoom)){e.splice(fn,1);break}}this.map._featureMgr.setOverlayData(e,4);this.map.dispatchEvent(new aB("onrefresh"))},_changeBaseMapState:function(i){var fo=i.guid;var fs=i.formatedData.guidExt;var fu={guid:fo,tilePosStr:i.tilePosStr,guidExt:fs};this._strategyInfo=fu;this.currentSelectedLabel=i;var fn=this.map._featureMgr;var e=fn.getLabelData();e=this.collisionTest(e);this.updateLabels(e);var fv=this.fixDataFormat(e);fn.setOverlayData(fv[0],2);fn.setOverlayData(fv[1],3);fn.setOverlayData(fv[2],4);var fm=this.getTileByLabelUid(fo);this.currentSelectedLabel.tileInfo=fm.tileInfo;var ft=fm.tileInfo.zoom;var fr=this.layer.tileCache.getAllData();for(var fq in fr){var fp=fr[fq].data;if(!fp.label){continue}this.clearCollisionCache(fp.label)}this.map.dispatchEvent(new aB("onrefresh"))},_recoverNormalState:function(){this._strategyInfo=null;var fr=false;var fp=this.map._featureMgr.getLabelData();if(this.currentSelectedLabel){var fm=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(fm));var fo=this.layer.tileCache.getAllData();for(var fn in fo){var fq=fo[fn].data;if(!fq.label){continue}this.clearCollisionCache(fq.label)}this.currentSelectedLabel.tempRank=null;this.currentSelectedLabel=null;fr=true}fp=this.collisionTest(fp);this.updateLabels(fp);var e=this.fixDataFormat(fp);var i=this.map._featureMgr;i.setOverlayData(e[0],2);i.setOverlayData(e[1],3);i.setOverlayData([],4);this.map.dispatchEvent(new aB("onrefresh"));if(fr){this.curSpotAdded=false;this._refreshSpotData()}},loadIconImages:function(fo,fz){var fr=fo.label;var fp=fo.tileInfo.style;var fm=fr.fixedLabel;var fw=fr.indoorLabel;var fA=fm.length+fw.length;var ft=this;var fn=0;var fy=200;for(var fq=0;fq<fA;fq++){var fs;if(fq<fm.length){fs=fm[fq]}else{fs=fw[fq-fm.length]}if(!fs.iconPos){continue}var fv=fs.iconPos.iconType;var fx=fp+"_"+fv;fn++;if(this.iconCache[fx]){if(this.iconCache[fx].loaded){fz(fo)}continue}var fu=new Image();fu.id=fx;fu.crossOrigin="anonymous";fu.onload=function(){ft.iconCache[this.id].loaded=true;ft._addToIconTexture(this);if(ft._iconLoadTimer===null){ft._iconLoadTimer=setTimeout(function(){fz();ft._iconLoadTimer=null},fy)}this.onload=null};fu.onerror=function(){if(!ft._iconLoadTimer){ft._iconLoadTimer=setTimeout(function(){fz();ft._iconLoadTimer=null},fy)}ft.iconCache[this.id]=null;this.onerror=null};var e=dn.getIconSetPath(this.map.config.style)+fv+".png";fu.src=e;this.iconCache[fx]={loaded:false,image:fu}}return fn},_addToIconTexture:function(fp){if(!this.map._webglMapScene){return}var fr=this.map._webglMapScene._painter;var e=fr._iconTextureAtlas.addTexture(fp);fr._iconTextureAtlasOffset[fp.id]=e;var fu=0*fp.width/1024+e.width;var fo=0*fp.height/1024+e.height;var ft=fp.width/1024+e.width;var fn=fo;var fs=ft;var fm=fp.height/1024+e.height;var fq=fu;var i=fm;fr._iconTextureAtlasCoords[fp.id]=[fu,fo,ft,fn,fs,fm,fu,fo,fs,fm,fq,i]},loadImgByStr:function(fn,fo,fp){if(!fn&&!fo){fp&&fp(null,null);return}if(typeof fn==="object"&&typeof fo==="object"){fp(fn,fo);return}var i=0;var fm=null;var e=null;if(fn){i++;fm=new Image();fm.onload=function(){i--;if(i===0){fp&&fp(this,e)}this.onload=null};fm.src=fn}if(fo){i++;e=new Image();e.onload=function(){i--;if(i===0){fp&&fp(fm,this)}this.onload=null};e.src=fo}},collisionTest:function(fs,f5,fK){if(this.map.viewAnimationTime){return[]}if(!fs){return[]}var fC=this.map;var fR=fC.getHeading();fR=this.calcLoopHeading(fR);var f0=fC.height;var fW=this.allLabels;fW.length=0;fs.sort(function(f7,i){var f9=f7.tileInfo;var f8=i.tileInfo;if(f9.col*f9.row<f8.col*f8.row){return -1}else{return 1}});var ft=fs.labelZoom;var fD=fC.getTilt();var fv=fC.getZoom();var fV;if(fK){fV=fK}else{fV=this.getZoomStep()}for(var f3=0,f1=fs.length;f3<f1;f3++){var fG=fs[f3];var fr=fG.tileInfo;var fo=fr.zoom;var fU=fr.loopOffsetX/Math.pow(2,18-fo);if(!fR&&!fD){if(fG.unnecessaryCollisionTest&&fG.unnecessaryCollisionTest[fK]){continue}}var fN=fG.fixedLabel||[];for(var f2=0,fI=fN.length;f2<fI;f2++){var fp=fN[f2];fp.zoom=fo;if(f5===-1&&fp.isDel){continue}if(!br(fp,fr.useZoom,fv)){fp.isDel=true;continue}this.calcCollisionBounds(fp,fV,fU,f0);fW.push(fp)}var fM=fG.indoorLabel||[];for(var f2=0,fI=fM.length;f2<fI;f2++){var fp=fM[f2];fp.zoom=fo;if(f5===-1&&fp.isDel){continue}if(!br(fp,fr.useZoom)){fp.isDel=true;continue}this.calcCollisionBounds(fp,fV,fU,f0);fW.push(fp)}var fq=fG.lineLabel||[];for(var f2=0,fI=fq.length;f2<fI;f2++){var fp=fq[f2];if(f5===-1&&fp.isDel){continue}if(!br(fp,fr.useZoom)){fp.isDel=true;continue}var f6=fp.pt;var fJ=fC.pointToPixelIn(f6,{zoom:fV,useRound:this._useRound});var fH=fJ.x+fU;var fF=f0-fJ.y;var fL=fp.bds;var fZ=fL[0];var fX=fL[1];var fA=fL[2];var fz=fL[3];var fS=fZ;var fQ=fX;var fy=fA;var fx=fz;if((fR>=0&&fR<45)||(fR>=315&&fR<360)){fS=fZ;fQ=fX;fy=fA;fx=fz}else{if(fR>=45&&fR<135){fS=fX;fQ=-fA;fy=fz;fx=-fZ}else{if(fR>=135&&fR<225){fS=-fA;fQ=-fz;fy=-fZ;fx=-fX}else{if(fR>=225&&fR<315){fS=-fz;fQ=fZ;fy=-fX;fx=fA}}}}fp._tempBds=[fH+fS,fF+fQ,fH+fy,fF+fx];fW.push(fp)}}var fT=this._strategyInfo;if(fT){var fw=fT.guid;var fE=fT.guidExt;var fm=false;for(var f3=0,f1=fW.length;f3<f1;f3++){var fY=fW[f3];delete fY.tempRank;if(!this.layer.isClickableLabel(fY)||(fE===1&&!fY.guidExt)){continue}if(fw===fY.guid&&fT.tilePosStr===fY.tilePosStr){fY.tempRank=this.RANK5;fm=true}}if(!fm&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var fr=this.currentSelectedLabel.tileInfo;var fo=fr.zoom;var fU=fr.loopOffsetX/Math.pow(2,18-fo);this.calcCollisionBounds(this.currentSelectedLabel,fV,fU,f0);fW.push(this.currentSelectedLabel)}}else{for(var f3=0,f1=fW.length;f3<f1;f3++){var fY=fW[f3];if(fY.type==="line"||!fY.iconPos){continue}delete fY.tempRank}}fW.sort(function(f8,f7){var f9=f8.tempRank?f8.tempRank:f8.rank;var i=f7.tempRank?f7.tempRank:f7.rank;return i-f9||f8.startZoom-f7.startZoom||f7.pt.lng-f8.pt.lng||f7.pt.lat-f8.pt.lat});var fn=0;if(fD>0){fn=6}var fv=fC.getZoom();if(fv>=8&&fv<9){fv<8.5?(fn=6):(fn=3)}var e=2;if(fv<6&&fv>=5){e=-1}for(var f3=0,f1=fW.length;f3<f1;f3++){var fP=fW[f3];var fu=fP._tempBds;fP.isDel=false;fP._intersectIdx=[];for(f2=f3+1;f2<f1;f2++){var fB=fW[f2];var f4=fB._tempBds;if(!(fu[2]+fn+e<f4[0]-fn||fu[0]-fn>f4[2]+fn+e||fu[3]+fn+e<f4[1]-fn||fu[1]-fn>f4[3]+fn+e)){fP._intersectIdx.push(f2)}}}for(var f3=0,f1=fW.length;f3<f1;f3++){var fY=fW[f3];if(fY.isDel===false){var fO=fY._intersectIdx;for(var f2=0,fI=fO.length;f2<fI;f2++){fW[fO[f2]].isDel=true}}}return fs},calcCollisionBounds:function(fs,fq,i,fr){var fp=fs.pt;var fn=this.map;var fo=fn.pointToPixelIn(fp,{zoom:fq,useRound:this._useRound});var fm=fo.x+i;var ft=fr-fo.y;var e=fs.bds;fs._tempBds=[fm+e[0],ft+e[1],fm+e[2],ft+e[3]]},getZoomStep:function(){var fm=this.map.getZoom();var e=Math.floor(fm);var i=fm-e>=0.5?e+0.5:e;return i},clearCollisionCache:function(e){if(!e){return}e.cacheState=null;e.unnecessaryCollisionTest=null},getCachedLabels:function(e){e=e||[];var fm=this.getZoomStep();var fo=[];var fq=false;for(var fn=0;fn<e.length;fn++){var fp=e[fn];if(!fp.cacheState||!fp.cacheState[fm]){fq=true;break}if(fp.hasNewData){fq=true;break}}if(fq){this.calcLabelsCollision(e)}return e},calcLabelsCollision:function(fm){var fo=this.getZoomStep();var fp={};var fs;var fn;fm=this.collisionTest(fm,undefined,fo);for(var fr=0;fr<fm.length;fr++){fs=fm[fr];fn=fs.tileInfo;var fw=fn.col+","+fn.row;fp[fw]=1}var e={};for(var fr=0;fr<fm.length;fr++){fs=fm[fr];if(!fs.cacheState){fs.cacheState={}}fn=fs.tileInfo;var fv=fn.col;var ft=fn.row;fw=fv+","+ft;if(fs.cacheState[fo]==="stable"){e[fw]=1;if(!fs.hasNewData){continue}}for(var fq=0;fq<fs.fixedLabel.length;fq++){var fu=fs.fixedLabel[fq];if(!fu.cachedIsDel){fu.cachedIsDel={}}fu.cachedIsDel[fo]=fu.isDel}for(var fq=0;fq<fs.indoorLabel.length;fq++){var fu=fs.indoorLabel[fq];if(!fu.cachedIsDel){fu.cachedIsDel={}}fu.cachedIsDel[fo]=fu.isDel}for(var fq=0;fq<fs.lineLabel.length;fq++){var fu=fs.lineLabel[fq];if(!fu.cachedIsDel){fu.cachedIsDel={}}fu.cachedIsDel[fo]=fu.isDel}if(fp[(fv-1)+","+(ft-1)]&&fp[(fv-1)+","+ft]&&fp[(fv-1)+","+(ft+1)]&&fp[fv+","+(ft-1)]&&fp[fv+","+(ft+1)]&&fp[(fv+1)+","+(ft-1)]&&fp[(fv+1)+","+ft]&&fp[(fv+1)+","+(ft+1)]){fs.cacheState[fo]="stable";e[fw]=1}else{if(!fs.cacheState[fo]){fs.cacheState[fo]="unstable"}}}for(var fr=0;fr<fm.length;fr++){var fs=fm[fr];fn=fs.tileInfo;var fw=fn.col+","+fn.row;var fv=+fn.col;var ft=+fn.row;if(e[(fv-1)+","+(ft-1)]&&e[(fv-1)+","+ft]&&e[(fv-1)+","+(ft+1)]&&e[fv+","+(ft-1)]&&e[fv+","+(ft+1)]&&e[(fv+1)+","+(ft-1)]&&e[(fv+1)+","+ft]&&e[(fv+1)+","+(ft+1)]){if(!fs.unnecessaryCollisionTest){fs.unnecessaryCollisionTest={}}fs.unnecessaryCollisionTest[fo]=1}}fm.hasNewData=false},updateLabels:function(fn){var e=this.map;var ft=e.getZoom();var fv=e.getHeading();fv=this.calcLoopHeading(fv);var fu=e.getTilt();var fo=this.getZoomStep();for(var fs=0,fp=fn.length;fs<fp;fs++){var fr=fn[fs];var fm=fr.tileInfo;var fq=fm.loopOffsetX||0;this.updateFixedLabel(fr.fixedLabel,fu,fv,fr,fo,ft,fq);this.updateFixedLabel(fr.indoorLabel,fu,fv,fr,fo,ft,0);this.updateLineLabel(fr.lineLabel,fu,fv,fr,fo)}},updateFixedLabel:function(fs,fu,i,fw,fo,e,fn){if(fs.length===1){}for(var fx=0,fp=fs.length;fx<fp;fx++){var ft=fs[fx];if(!ft.cachedIsDel){continue}if(!fu&&!i&&fw.cacheState&&fw.cacheState[fo]){ft.isDel=ft.cachedIsDel[fo];if(typeof ft.isDel==="undefined"){ft.isDel=ft.cachedIsDel[fo]=true}}if(ft.startScale>e){ft.isDel=true}if(ft.isDel){continue}var fz=ft.pt;var fm=ft.iconPos;if(fm&&fm.texcoord){if(!fm.rtVertex){fm.rtVertex=[];var fB=fm.vertex;var fq=ae(fz.lng);var fy=ae(fz.lat);fm.rtVertex=[fq[0],fy[0],fq[1],fy[1],0,fB[0],fB[1],0,0,fm.texcoord[0],fm.texcoord[1],fq[0],fy[0],fq[1],fy[1],0,fB[2],fB[3],0,0,fm.texcoord[2],fm.texcoord[3],fq[0],fy[0],fq[1],fy[1],0,fB[4],fB[5],0,0,fm.texcoord[4],fm.texcoord[5],fq[0],fy[0],fq[1],fy[1],0,fB[6],fB[7],0,0,fm.texcoord[6],fm.texcoord[7],fq[0],fy[0],fq[1],fy[1],0,fB[8],fB[9],0,0,fm.texcoord[8],fm.texcoord[9],fq[0],fy[0],fq[1],fy[1],0,fB[10],fB[11],0,0,fm.texcoord[10],fm.texcoord[11]]}}var fA=ft.textPos;if(fA){if(!fA.rtVertex){fA.rtVertex=[];var fB=fA.vertex;var fr=fA.rtVertex;var fq=ae(fz.lng);var fy=ae(fz.lat);var fD=ae(fn);for(var fv=0,fC=fB.length;fv<fC;fv+=12){fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv],fB[fv+1],fD[0],fD[1],fA.texcoord[0],fA.texcoord[1]);fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv+2],fB[fv+3],fD[0],fD[1],fA.texcoord[2],fA.texcoord[3]);fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv+4],fB[fv+5],fD[0],fD[1],fA.texcoord[4],fA.texcoord[5]);fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv+6],fB[fv+7],fD[0],fD[1],fA.texcoord[6],fA.texcoord[7]);fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv+8],fB[fv+9],fD[0],fD[1],fA.texcoord[8],fA.texcoord[9]);fr.push(fq[0],fy[0],fq[1],fy[1],0,fB[fv+10],fB[fv+11],fD[0],fD[1],fA.texcoord[10],fA.texcoord[11])}}}}},updateLineLabel:function(fs,fW,fM,fH,fI){fs=fs||[];var fC=this.map;var fv=fC.getZoomUnits();for(var fV=0,fT=fs.length;fV<fT;fV++){var fr=fs[fV];if(!fr.cachedIsDel){continue}if(!fW&&!fM&&fH.cacheState&&fH.cacheState[fI]){fr.isDel=fr.cachedIsDel[fI];if(typeof fr.isDel==="undefined"){fr.isDel=fr.cachedIsDel[fI]=true}}if(fr.isDel){continue}if(!fr.styleText||fr.styleText.length===0){continue}var ft=fr.mcInTile;var fP=ft.x;var fN=ft.y;var fG=fr.wordsInfo;var fE=fr.labelAngle;var fA=false;var fO=0;if(fM!==0){var fB=fG[0].angle;var fS=this.calcLoopHeading(fB-fM);var fy=this.calcLoopHeading(fE-fM);if(fS>45&&fS<315){if(fS>45&&fS<=135){fO=270}else{if(fS>135&&fS<=225){fO=180}else{if(fS>225&&fS<315){fO=90}}}if(fE>225&&fE<=315&&fO<=180){fA=true}else{if((fE>=0&&fE<=45||fE>=315&&fE<360)&&fO>=180){fA=true}}}}for(var fU=0,fw=fG.length;fU<fw;fU++){var fR=fG[fU];var fz=fR.calcInfo;var fL=fR.offset[0];var fJ=fR.offset[1];if(!fR.size){continue}var e=fR.size[0];var fm=fR.size[1];var fx=fR.angle;if(!fz){fz={}}if(fM!==fz.mapHeading||fv!==fz.zoomUnits){fz.mapHeading=fM;fz.zoomUnits=fv;if(fA){var fD=fG[fw-1-fU];fL=fD.offset[0];fJ=fD.offset[1];fx=fD.angle}var fo=fP+fL*fv;var fn=fN+fJ*fv;fz.rotationCenter={lng:fo,lat:fn};fz.calcHeading=fO;fz.angle=fx;fz.offsetX=fL;fz.offsetY=fJ;fR.calcInfo=fz}if(!fR.rtVertex){fR.rtVertex=[]}fR.rtVertex.length=0;var fF=fz.calcHeading+fz.angle;var fp=fz.rotationCenter;fL=fz.offsetX;fJ=fz.offsetY;var fq=Math.round(fL-e/2);var fQ=Math.round(fL+e/2);var fK=Math.round(fJ+fm/2);var fu=Math.round(fJ-fm/2);fR.rtVertex.push(fP,fN,fR.z,fq,fu,fp.lng,fp.lat,fF,fR.texcoord[0],fR.texcoord[1],fP,fN,fR.z,fQ,fu,fp.lng,fp.lat,fF,fR.texcoord[2],fR.texcoord[3],fP,fN,fR.z,fQ,fK,fp.lng,fp.lat,fF,fR.texcoord[4],fR.texcoord[5],fP,fN,fR.z,fq,fu,fp.lng,fp.lat,fF,fR.texcoord[6],fR.texcoord[7],fP,fN,fR.z,fQ,fK,fp.lng,fp.lat,fF,fR.texcoord[8],fR.texcoord[9],fP,fN,fR.z,fq,fK,fp.lng,fp.lat,fF,fR.texcoord[10],fR.texcoord[11])}}},calcLoopHeading:function(e){while(e>=360){e-=360}while(e<0){e+=360}return e},fixDataFormat:function(fv){var fn=this.fixedLabelData;var e=this.lineLabelData;var fm=this.highlightLabelData;var fC=0;var fr=0;var fA=0;var fB;if(this.currentSelectedLabel){var fq=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);if(!fq||fq.isDel){fn[fC]=this.currentSelectedLabel.formatedData;fC++;fm[fA]=this.currentSelectedLabel.formatedData;fA++}}for(var fz=0;fz<fv.length;fz++){var ft=fv[fz];var fs=ft.fixedLabel;var fo=ft.indoorLabel;var fy=ft.lineLabel;fB=this.fixFixedLabelDataFormat(fs,ft,fn,fC,fm,fA);fC=fB[0];fA=fB[1];fB=this.fixFixedLabelDataFormat(fo,ft,fn,fC,fm,fA,true);fC=fB[0];fA=fB[1];e[fr]={tileInfo:ft.tileInfo,lineLabels:[]};for(var fx=0;fx<fy.length;fx++){if(fy[fx].isDel){continue}var fu=fy[fx].wordsInfo;if(fu){for(var fw=0;fw<fu.length;fw++){if(!fu[fw].rtVertex){continue}var fp=fu[fw].formatedData;if(!fp){fp={textureSource:ft.textureSources[fy[fx].processedInZoom],textureHeight:ft.textureHeights[fy[fx].processedInZoom],renderData:{vertex:fu[fw].rtVertex,textureCoord:fu[fw].texcoord}};fu[fw].formatedData=fp}e[fr].lineLabels.push(fp)}}}fr++}fn.length=fC;e.length=fr;fm.length=fA;return[e,fn,fm]},fixFixedLabelDataFormat:function(fq,ft,fu,fr,fo,e,fs){for(var i=0;i<fq.length;i++){if(fq[i].isDel){continue}var fp=fq[i].textPos;var fn=fq[i].iconPos;var fm=null;if(fp&&fp.rtVertex){if(!fq[i].formatedData){fm={guid:fq[i].guid,guidExt:fq[i].guidExt,tilePosStr:fq[i].tilePosStr,zoom:fq[i].zoom,tempRank:fq[i].tempRank,textureSource:ft.textureSources[fq[i].processedInZoom],textureHeight:ft.textureHeights[fq[i].processedInZoom],renderData:{vertex:fp.rtVertex,textureCoord:fp.texcoord}};if(fs&&fq[i].onDefaultFloor===false){fm.textureSource=ft.indoorTextureSources[fq[i].processedInZoom];fm.textureHeight=ft.indoorTextureHeights[fq[i].processedInZoom]}fq[i].formatedData=fm}else{fm=fq[i].formatedData;fm.tempRank=fq[i].tempRank}if(this.currentSelectedLabel&&fm.guid===this.currentSelectedLabel.guid&&fm.tilePosStr===this.currentSelectedLabel.tilePosStr){fo[e]=fm;e++}}if(fn&&fn.rtVertex){if(fm){if(!fm.iconRenderData){fm.iconRenderData={vertex:fn.rtVertex,textureCoord:fn.texcoord}}}else{fm={guid:fq[i].guid,guidExt:fq[i].guidExt,zoom:fq[i].zoom,tempRank:fq[i].tempRank,iconRenderData:{vertex:fn.rtVertex,textureCoord:fn.texcoord}};fq[i].formatedData=fm}}fu[fr]=fm;fr++}return[fr,e]},_refreshSpotData:function(){this._spotData.length=0;var fs=this.map;var fq=Math.floor(fs.getZoom());var fm=this.map._featureMgr.getLabelData();if(fm){for(var fo=0,fn=fm.length;fo<fn;fo++){this._addFixedSpotData(fm[fo].fixedLabel,fq);this._addFixedSpotData(fm[fo].indoorLabel,fq)}}var ft=this.currentSelectedLabel;if(ft&&!this.getTileByLabelUid(ft.guid,ft.tilePosStr)){var fp=this._getSpotDataFromLabel(this.currentSelectedLabel);if(fp){this._spotData.push(fp)}}var fr=new aB("onspotsdataready");fr.spots=this._spotData;fs._spotDataOnCanvas=this._spotData;fs.dispatchEvent(fr)},_addFixedSpotData:function(fo,fn){for(var e=0;e<fo.length;e++){var fm=fo[e];if(!this.layer.isClickableLabel(fm)||(fm.guidExt===1&&fm.startScale>fn)){continue}var i=fo[e].spot||this._getSpotDataFromLabel(fo[e]);if(i){this._spotData.push(i)}}},_getSpotDataFromLabel:function(fm){var fp=this.map;if(!fm.bds){return null}var e=fm.bds.slice(0);var fn=null;if(fm.iconPos){fn=new e4(fm.pt.lng,fm.pt.lat)}var i=fm.name?fm.name.replace("\\\\","<br>"):"";if(fm.iconPos&&fm.iconPos.iconType.indexOf("ditie")>-1&&fp.getZoom()>14){i=""}var fo={n:i,pt:new e4(fm.pt.lng,fm.pt.lat),userdata:{iconPoint:fn,uid:fm.guid,name:i,mapPoi:true,type:fm.iconPos?fm.iconPos.iconType:"",rank:fm.rank,zoom:fm.zoom,tilePosStr:fm.tilePosStr},bd:e,tag:"MAP_SPOT_INFO"};fm.spot=fo;return fo},drawLabelsOnCanvas:function(i,e){this._labelTextCanvas.drawLabelsOnCanvas(i,e)}});function dY(e){this._map=e;this.virtualTile={custom:true,label:{fixedLabel:[],indoorLabel:[],lineLabel:[],textureHeights:[],status:"ready"},tileInfo:{col:0,row:0,zoom:0,useZoom:0,loopOffsetX:0},status:"ready"};this.virtualTile.label.tileInfo=this.virtualTile.tileInfo;this.init()}dY.prototype.init=function(){var fm=this._map;var i=this;function e(){i.updateLabels()}fm.addEventListener("add_tile_labels",e);fm.addEventListener("onremove_tile_labels",e);fm.addEventListener("onclear_labels",e)};dY.prototype.updateLabels=function(){var i=this._map.tileMgr.getLabelTextCanvas();var fm=this._map;var e=this;i.drawCustomLabelsOnCanvas(fm._customTileLabels,function(fo){var fn=e.virtualTile;if(fo){fn.label.textureHeights[0]=[fo.height]}fn.label.fixedLabel=fm._customTileLabels;var fp=new aB("oncustom_labels_ready");fp.virtualTile=fn;fp.labelCanvas=fo;fp.imgKey=aI.getGUID("custom_labels_");fm.dispatchEvent(fp)})};aI.register(function(e){e._customLabelMgr=new dY(e)});function c8(i){var fn=null;try{if(ce.inMapHost){fn=new Worker(i);fn.onerror=function(e){e.preventDefault();fn=p(i)}}else{fn=p(i)}}catch(fm){fn=p(i)}return fn}function p(fp){var fs=null;try{var fm;try{fm=new Blob(['importScripts("'+fp+'");'],{type:"application/javascript"})}catch(fq){var fo=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();fo.append('importScripts("'+fp+'");');fm=fo.getBlob("application/javascript")}var fn=window.URL||window.webkitURL;var i=fn.createObjectURL(fm);fs=new Worker(i)}catch(fr){}return fs}function ec(e){this.init(e)}var aC={init:function(fm){var i=this;this.map=fm;this.arrPendingData=[];var e=navigator.hardwareConcurrency||4;if(d8()&&e>2){e=2}this.arrWorker=[];this.ratio=ay();this.wordSpaceRatio=this.ratio;if(this.ratio>1){this.textSizeRatio=2}else{this.textSizeRatio=1}bP.canUseWebAssembly(function(fn){var fq;if(fn){fq="https://api.map.baidu.com/res/webgl/10/worker_wasm_uxtrdn.js"}else{fq="https://api.map.baidu.com/res/webgl/10/worker_asm_vh1j0f.js"}for(var fp=0;fp<e;fp++){var fs=c8(fq);fs.onmessage=function fo(fu){if(fu.data){this._cbk&&this._cbk(fu.data,this._parsingTileKey)}else{this._cbk&&this._cbk(null,this._parsingTileKey)}this._isBusy=false;this._cbk=null;this._parsingTileInfo=null;this._parsingTileKey=null;if(i.arrPendingData.length>0){var fw=i.arrPendingData.shift();var ft=fw.cbk;i.loadTileData(fw.url,fw.tileInfo,fw.tileKey,ft)}var fv=new aB("onrefresh");fv.source="workermgr";fm.fire(fv)};i.arrWorker.push(fs)}if(i.arrPendingData.length>0){for(var fp=0;fp<Math.min(i.arrPendingData.length,e);fp++){var fr=i.arrPendingData.shift();i.loadTileData(fr.url,fr.tileInfo,fr.tileKey,fr.cbk)}}});fm.on("style_willchange",function(){for(var fo=0,fn=i.arrWorker.length;fo<fn;fo++){i.arrWorker[fo].isSendFS=false}if(typeof this.config.style!=="string"){ec.stringifiedCustomStyleInfo=null;ec.stringifiedCustomStyleInfoZoom=[]}})},getIdleWorker:function(){for(var fm=0,e=this.arrWorker.length;fm<e;fm++){var fn=this.arrWorker[fm];if(!fn._isBusy){fn._isBusy=true;return fn}}return null},releasePendingData:function(fm){var fn=[];var fq=this.arrPendingData;for(var fp=fq.length-1;fp>=0;fp--){var fr=fq[fp];var e=fr.tileInfo;if(fm.tileTypeName!==e.tileTypeName){continue}var fo="id_"+e.col+"_"+e.row+"_"+e.zoom;if(!fm[fo]){fq.splice(fp,1);fn.push(e)}}return fn},loadTileData:function(e,fm,ft,fs){var fn=this.getIdleWorker();if(fn){fn._cbk=fs;fn._parsingTileInfo=fm;fn._parsingTileKey=ft;var i={action:"loadTileData",url:e,tileInfo:fm,tileKey:ft};var fr=this.map.getMapStyleId();var fq=!!(fr.indexOf("custom")===0);var fp=fr;if(fq){fp="Custom"}if(!fn.isSendFS){if(!ec["stringifiedFeatureStyle"+fr]&&aI["FeatureStyle"+fr]){ec["stringifiedFeatureStyle"+fr]=JSON.stringify(aI["FeatureStyle"+fr])}if(!ec["stringifiedIconSetInfo"+fp]){ec["stringifiedIconSetInfo"+fp]=JSON.stringify(aI["iconSetInfo"+fp])}if(!ec.stringifiedIndoorStyle){ec.stringifiedIndoorStyle=JSON.stringify(aI.indoorStyle)}if(fq&&aI.customStyleInfo){if(!ec.stringifiedCustomStyleInfo){ec.stringifiedCustomStyleInfo=JSON.stringify(aI.customStyleInfo)}}if(ec["stringifiedFeatureStyle"+fr]){i.featureStyle=ec["stringifiedFeatureStyle"+fr]}i.iconSetInfo=ec["stringifiedIconSetInfo"+fp];i.indoorStyle=ec.stringifiedIndoorStyle;if(fq&&ec.stringifiedCustomStyleInfo){i.customMapStyle=ec.stringifiedCustomStyleInfo}i.iconInfo={wordSpaceRatio:this.wordSpaceRatio,textSizeRatio:this.textSizeRatio};i.mapStyleId=fr;fn.isSendFS=true}fn.postMessage(i)}else{var fo={url:e,tileInfo:fm,tileKey:ft,cbk:fs};this.arrPendingData.push(fo)}}};x.extend(ec.prototype,aC);function cw(i){this.tileLayers=[];this.map=i;var e=this.config=be[this.map.mapType];this.errorUrl=e.errorUrl;this.tileSize=e.tileSize;this.baseUnits=e.baseUnits;this.baseZoomLevel=e.zoomLevelBase;this.tileURLs=e.tileUrls;this.tilesInfoCache={};this.loadDelay=10;this._labelTextCanvas=null}aI.register(function(i){if(i._renderType!=="webgl"){return}var e=i.tileMgr=new cw(i);i.addEventListener("addtilelayer",function(fn){e.addWebGLLayer(fn.target)});i.addEventListener("removetilelayer",function(fn){e.removeWebGLLayer(fn.target)});i.on("update",function fm(fn){if(!aI["FeatureStyle"+this.config.style]&&!aI.customStyleLoaded){return}e.loadLayersData({zoomChanged:fn.changedStatus.onzoom_changed?true:false})});i.on("style_changed",function(){e.loadLayersData()})});x.extend(cw.prototype,{addWebGLLayer:function(fn){this.tileLayers.push(fn);fn.initDrawData();if(this.tileLayers.length>1){for(var fm=1;fm<this.tileLayers.length;fm++){if(this.tileLayers[fm].isFlat){this.map.setDisplayOptions({isFlat:true});break}}}var e=this.map.config.style;if(aI["FeatureStyle"+e]){this.loadLayersData()}else{var fo=this;this.map.loadMapStyleFiles(function(){fo.loadLayersData()})}},removeWebGLLayer:function(fp){var fq=false;for(var fo=0,fn=this.tileLayers.length;fo<fn;fo++){if(fp===this.tileLayers[fo]){fq=true;this.tileLayers.splice(fo,1);break}}if(fq===false){return}fp.destroyDrawData();if(aI["FeatureStyle"+this.map.config.style]){this.loadLayersData()}if(this.tileLayers.length===1){this.map.setDisplayOptions({isFlat:false})}else{var e=false;for(var fo=1;fo<this.tileLayers.length;fo++){if(this.tileLayers[fo].isFlat){e=true;break}}this.map.setDisplayOptions({isFlat:e})}var fm=new aB("onrefresh");fm.source="removewebgllayer";this.map.fire(fm)},getLabelTextCanvas:function(){if(!this._labelTextCanvas){this._labelTextCanvas=new r(this.map)}return this._labelTextCanvas},loadLayersData:function(i){if(this.map.suspendLoad){return}var fn=this;i=i||{};var fm=!!i.zoomChanged;var e=(fm===true||this.map.getTilt()>50);if(!e){if(!this.syncLoadTimer){this.syncLoadTimer=setTimeout(function(){fn._loadLayersFromCache(fm);fn.syncLoadTimer=null},40)}}else{this._loadLayersFromCache(fm)}if(!fn.map.viewAnimationTime){this.timer&&window.clearTimeout(this.timer)}this.timer=window.setTimeout(function(){if(fn.map.viewAnimationTime){if(new Date().getTime()-fn.map.viewAnimationTime<1000){return}fn.map.viewAnimationTime=new Date().getTime()}var fp=fn.tileLayers.length;fn.tilesInfoCache={};for(var fq=0;fq<fp;fq++){var fs=fn.tileLayers[fq];var fr=fs.tileType;var fo=null;if(fn.tilesInfoCache[fr.getName()]){fo=fn.tilesInfoCache[fr.getName()]}else{fo=fn.calcTilesInfo(fr);fn.tilesInfoCache[fr.getName()]=fo}fs.loadLayerData(fo,false,fm)}fn.timer=null},this.loadDelay);if(d8()&&fm){this.loadDelay=200}else{this.loadDelay=80}},_loadLayersFromCache:function(fo){this.map._featureMgr.clearData();var fr=this.tileLayers;fr.sort(function(fs,i){return fs.zIndex-i.zIndex>0});var fm=fr.length;this.tilesInfoCache={};for(var fn=0;fn<fm;fn++){var fq=fr[fn];var fp=fq.tileType;var e=null;if(this.tilesInfoCache[fp.getName()]){e=this.tilesInfoCache[fp.getName()]}else{e=this.calcTilesInfo(fp);this.tilesInfoCache[fp.getName()]=e}fq.loadLayerData(e,true,fo)}},calcTilesInfo:function(fy){var fK=this.map;var fQ=fK.getMapType();var fL=be[fQ];var fF=fK.getZoom();var e=Math.floor(fF);var fp=fy.getDataZoom(fF);var f0=fy.getName();fp=dN(fp,fL.minDataZoom,fL.maxDataZoom);var fT=e;if(fy._name==="web"){fT=fp}var fJ=fy.getTileSize(fF);var fo=fy.getBaseTileSize(fF);var fC=fy.getMercatorSize(fF,fp);var fB;var fR;var fI;var fV;var fM=fK.getCenterIn();if(fQ!==BMAP_SATELLITE_MAP){fM=cD.calcLoopCenterPoint(fM)}var fG=Math.floor(fM.lng/fC);var fr=Math.floor(fM.lat/fC);var fH=fK.getBoundsIn();var fO=0;var fm=0;fH=cD.calcLoopMapBounds(fH,fK.getCenter());if(fH.ne.lng>cD._mc180X){var fw=cD.getSpaceDistanceInPixel(fp);fO=Math.ceil(fw/fo)}if(fH.sw.lng<cD._mcM180X){var fw=cD.getSpaceDistanceInPixel(fp);fm=Math.ceil(fw/fo)}var ft=[Math.floor(fH.sw.lng/fC)-fm,Math.floor(fH.sw.lat/fC)];var fY=[Math.floor(fH.ne.lng/fC)+fO,Math.floor(fH.ne.lat/fC)];fB=ft[0];fR=fY[0]+1;fI=ft[1];fV=fY[1]+1;var fx=[];for(var fu=fB;fu<fR;fu++){if(cD.isTileBlank(fu,fp,fo)===true){continue}for(var fz=fI;fz<fV;fz++){var fv={col:fu,row:fz,zoom:fp,useZoom:fT,tileTypeName:f0,loopOffsetX:0,tileSize:fJ,baseTileSize:fo,mercatorSize:fC};fx.push(fv);var fP="id_"+fu+"_"+fz+"_"+fp;fx[fP]=true}}if(fQ!==BMAP_SATELLITE_MAP){fx=cD.calcLoopTiles(fx,fp,fo,fC)}if(fp===3){for(var fX=0,fW=fx.length;fX<fW;fX++){var fu=fx[fX].col;var fz=fx[fX].row;var fS=cD.calcLoopParam(fu,fp);var fq=fS.T;var fD=fu>=0?fu-fq:fu+fq;var fE="id_"+fD+"_"+fz+"_"+fp;if(!fx[fE]){var fv={col:fD,row:fz,zoom:fp,useZoom:fT,loopOffsetX:0,tileSize:fJ,baseTileSize:fo,mercatorSize:fC};fx.push(fv);fx[fE]=true}}}if(this.map._tilt>0){for(var fX=0;fX<fx.length;fX++){var fs=fx[fX];var fU=fs.col;var fZ=fs.row;var fN=[];fN.minX=fU*fC;fN.maxX=(fU+1)*fC;fN.minY=fZ*fC;fN.maxY=(fZ+1)*fC;var fn=new e4(0,0);fn.lng=(fN.minX+fN.maxX)/2;fn.lat=(fN.minY+fN.maxY)/2;var fA=fK.pointToPixelIn(fn);if(fA.x>0&&fA.x<this.map.width&&fA.y>0&&fA.y<this.map.height){continue}if(fN.minX<fM.lng&&fN.maxX>fM.lng&&fN.minY<fM.lat&&fN.maxY>fM.lat){continue}if(!this.ifTileInMapBounds(fN,fH,fU,fZ)){fx.splice(fX,1);fX--}}}fx.sort((function(i){return function(f1,f2){return((0.4*Math.abs(f1.col-i[0])+0.6*Math.abs(f1.row-i[1]))-(0.4*Math.abs(f2.col-i[0])+0.6*Math.abs(f2.row-i[1])))}})([fG,fr]));fx.zoom=fp;fx.tileTypeName=f0;return fx},getCurrentViewTilesInfo:function(i){var e=this.tilesInfoCache[i.getName()];if(!e){return this.calcTilesInfo(i)}return e},ifTileInMapBounds:function(e,fp,fm,fo){var i=fp.normalizedBottomLeft;var fA=fp.normalizedTopRight;var fs=fp.normalizedTopLeft;var fq=fp.normalizedBottomRight;var fn=false;var fz=new e4(e.minX,e.minY);var fw=new e4(e.maxX,e.maxY);var fr=new e4(fw.lng,fz.lat);var fx=new e4(fz.lng,fw.lat);var fu=[fx,fw,fr,fz];for(var fy=0,ft=fu.length;fy<ft;fy++){var fv=fy+1;if(fv===ft){fv=0}var fB=fy;var fC=eu(fu[fv],fu[fB],fs,i);if(fC){fn=true;break}fC=eu(fu[fv],fu[fB],fq,fA);if(fC){fn=true;break}fC=eu(fu[fv],fu[fB],fA,fs);if(fC){fn=true;break}fC=eu(fu[fv],fu[fB],i,fq);if(fC){fn=true;break}}return fn},getTileLayer:function(fo){for(var fn=0,e=this.tileLayers.length;fn<e;fn++){var fm=this.tileLayers[fn];if(fm.mapType===fo){return fm}}return null}});function am(e){this._map=e;this._spotsId=null;this._init()}am.prototype._init=function(){var e=this._map;e.addEventListener("onspotsdataready",function(fm){var i=fm.spots;if(this._spotsId){e.removeSpots(this._spotsId)}this._spotsId=e.addSpots(i)})};aI.register(function(e){if(!e.config.enableIconClick){return}e._mapIcon=new am(e)});function ap(e){this._indoorData={};this._map=e;this.currentUid=null;this.currentFloor=null;this._indoorControl=null;this.enterMethod=null;this.showMask=false;this._isMobile=d8();this._autoEnterZoom=19;if(this._isMobile){this._autoEnterZoom=17}this._init(e);window._indoorMgr=this}ap.prototype._init=function(i){var e=this;i.on("indoor_status_changed",function(fq){var fm=fq.uid;var fo=fq.floor;if(fm===null){fm=e.currentUid;if(e._indoorData[fm]){fo=e._indoorData[fm].defaultFloor}if(e._indoorControl){e._indoorControl.hide()}e.currentUid=null;e.currentFloor=null;e.enterMethod=null}else{if(e._indoorData[fm]){var fp=e._indoorData[fm];fo=(typeof fo==="number")?fo:fp.defaultFloor;if(!e._indoorControl){if(i.config.showControls&&i._displayOptions.indoor){e._indoorControl=new ev(i,fp)}}else{e._indoorControl.setInfo(fp);e._indoorControl.show()}e.currentUid=fm;e.currentFloor=fo}}if(!e._indoorData||!e._indoorData[fm]||e._indoorData[fm].currentFloor===fo){this.fire(new aB("onrefresh"));return}var fn=new aB("onindoor_data_refresh");fn.uid=fm;fn.floor=fo;fn.tileKey=e._indoorData[fm].tileKey;e._indoorData[fm].currentFloor=fo;e.currentFloor=fo;this.fire(fn)});i.on("spotclick",function(fn){var fm=null;if(fn.curAreaSpot&&this.areaSpots[fn.curAreaSpot]){fm=this.areaSpots[fn.curAreaSpot].userData.uid}if(fm===e.currentUid){if(fn.curAreaSpot){e.enterMethod="byClick"}return}if(fm===null){if(e.currentUid&&e.enterMethod==="byClick"){i.showIndoor(null);e.enterMethod=null}}else{e.enterMethod="byClick";if(e.currentUid){i.showIndoor(e.currentUid,e._indoorData[e.currentUid].defaultFloor)}i.showIndoor(fm,e._indoorData[fm].defaultFloor)}});i.on("moveend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}});i.on("zoomend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}else{if(e.enterMethod!=="byClick"&&e.currentUid!==null){this.showIndoor(null)}}})};ap.prototype._checkIndoorByMove=function(){var fm=this._map;var ft=fm.getSize();var fy={x:ft.width/2,y:ft.height/2};var fx=Math.max(ft.width,ft.height);var fz=[];for(var fu in this._indoorData){var e=this._indoorData[fu].center;var fn=fm.pointToPixelIn(new aI.Point(e[0],e[1]));var fq=eI(fy,fn);fz.push({uid:fu,distance:fq})}if(fz.length===0){return}fz.sort(function(fA,i){return fA.distance-i.distance});var fp=fz[0];var fv=fm.getCenterIn();var fo=false;for(var fs=0;fs<this._indoorData[fp.uid].contour.length;fs++){if(b2([fv.lng,fv.lat],this._indoorData[fp.uid].contour[fs])){fo=true;break}}if(fo===false&&fp.uid==="e96b44200baa3b4082288acc"){var fr=this._indoorData[fp.uid].boundsMin;var fw=this._indoorData[fp.uid].boundsMax;if(fv.lng>fr[0]&&fv.lat>fr[1]&&fv.lng<fw[0]&&fv.lat<fw[1]){fo=true}}if(fo){if(this.enterMethod!=="byClick"){if(this.currentUid!==null&&this.currentUid!==fp.uid){this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor)}if(this.currentUid!==fp.uid){this._map.showIndoor(fp.uid,this._indoorData[fp.uid].defaultFloor)}this.enterMethod="byMove"}}else{if(this.enterMethod!=="byClick"){this._map.showIndoor(null)}}};ap.prototype.setData=function(fn){if(fn===null){return}for(var fm in fn){if(fm==="tileInfo"){continue}var fo=fn[fm].tileKey;if(this._indoorData[fm]){if(!this._indoorData[fm][fo]){this._indoorData[fm].tileKeys.push(fo);this._indoorData[fm][fo]=true}}else{this._indoorData[fm]=fn[fm];this._indoorData[fm].tileKeys=[fn[fm].tileKey];this._indoorData[fm][fo]=true;for(var e=0;e<this._indoorData[fm].contour.length;e++){this._map.addAreaSpot(this._indoorData[fm].contour[e],{id:fm+e,userData:{uid:fm}})}}}if(this._map.getZoom()>=this._autoEnterZoom){this._checkIndoorByMove()}};ap.prototype.removeData=function(fm,fo){if(!this._indoorData[fm]){return}var fn=this._indoorData[fm];for(var e=0;e<fn.tileKeys.length;e++){if(fn.tileKeys[e]===fo){fn.tileKeys.splice(e,1);break}}delete fn[fo];if(fn.tileKeys.length===0){delete this._indoorData[fm]}};ap.prototype.getIndoorData=function(e){return this._indoorData[e]||null};ap.prototype.getData=function(){return this._indoorData};aI.register(function(e){e._indoorMgr=new ap(e)});var cP=(function(){var fn={};var fw={};var fs={};function fu(fy){if(Object.prototype.toString.call(fy)==="[object Object]"){for(var fx in fy){return false}return true}else{return false}}function ft(fD,fE,fH,fA,fG){fA=fA||FS;var fy;if(fA){fy=fv(fD,fE,fH,fA)}else{fy=fm(fD,fE,fH,fG)}var fC=fy.drawId;var fx=fy.style;var fF=fy.styleUpdate;var fI=[];if(!fC){return fI}for(var fz=0;fz<fC.length;fz++){var fB=fF[fC[fz]]||fx[fC[fz]];if(fB){switch(fE){case"polygon":fB=fo(fB,fD);break;case"line":fB=fr(fB,fD);break;case"pointText":fB=fp(fB,fD);break;case"point":fB=e(fB,fD);break;case"polygon3d":fB=fq(fB,fD);break}if(fB){fI[fI.length]=fB}}}return fI}function fv(fy,fA,fB,fx){var fz=fx[2];switch(fA){case"point":fz=fz[0];break;case"pointText":fz=fz[1];break;case"line":fz=fz[3];break;case"polygon":fz=fz[4];break;case"polygon3d":fz=fz[5];break}var fD=fB-1;if(fA==="line"&&fB===12){fD=fB}var fE=fx[1][fD][0];var fC=fE[fy];if(!fC){if(fA==="point"||fA==="pointText"){fE=fx[1][fB][0];fC=fE[fy]}}return{drawId:fC,style:fz,styleUpdate:[]}}function fm(fB,fC,fF,fE){if(!fE){return{drawId:null,style:[],styleUpdate:[]}}var fD;var fz=fE.baseFs;if(fu(fE.zoomRegion)){fD=fE.StyleBody||[]}else{fD=fE.zoomStyleBody[fF]||[]}var fy=fz[2];switch(fC){case"point":fy=fy[0];fD=fD[0]||{};break;case"pointText":fy=fy[1];fD=fD[1]||{};break;case"line":fy=fy[3];fD=fD[3]||{};break;case"polygon":fy=fy[4];fD=fD[4]||{};break;case"polygon3d":fy=fy[5];fD=fD[5]||{};break}var fx=fz[1][fF-1][0];var fA=fx[fB];return{drawId:fA,style:fy,styleUpdate:fD}}function fp(fy,fx){if(!fy||fy.length===0){return null}return{sid:fx,fontRgba:i(fy[0]),haloRgba:i(fy[1]),backRgba:i(fy[2]),fontSize:fy[3],haloSize:fy[4],fontWeight:fy[5],fontStyle:fy[6],density:fy[7]}}function e(fy,fx){return{sid:fx,rank:fy[0],ucflag:fy[1],icon:fy[2],iconType:fy[3],nineGG:fy[4],density:fy[5],zoom:fy[6]}}function fr(fy,fx){return{sid:fx,borderRgba:i(fy[0]),fillRgba:i(fy[1]),borderWidth:fy[2],fillWidth:fy[3],borderCap:fy[4],fillCap:fy[5],haveBorderLine:fy[6],haveBorderTexture:fy[7],haveFillTexture:fy[8],isUseBorderRgba:fy[9],isUseFillRgba:fy[10],borderTexture:fy[11],fillTexture:fy[12],borderTextureType:fy[13],fillTextureType:fy[14],isRealWidth:fy[15],haveArrow:fy[16],needRound:fy[17],realBorderWidth:fy[18]}}function fo(fy,fx){return{sid:fx,fillRgba:i(fy[0]),borderRgba:i(fy[1]),borderWidth:fy[2],borderTexture:fy[3],borderTextureType:fy[4],waterStyle:fy[5],haloStyle:fy[6],textureStyle:fy[7],thickRgba:i(fy[8])}}function fq(fy,fx){return{sid:fx,filter:fy[0],ratio:fy[1],haveBorder:fy[2],borderWidth:fy[3],borderRgba:i(fy[4]),fillTop:i(fy[5]),fillSide:i(fy[6]),polyTexture:fy[7]}}function i(fC){var fB=fC;if(fs[fB]){return fs[fB]}fC=fC>>>0;var fA=(fC)&255;var fz=(fC>>8)&255;var fx=(fC>>16)&255;var fy=(fC>>24)&255;fs[fB]=[fA,fz,fx,fy];return fs[fB]}return{getStyleFromCache:function(fE,fz,fC,fD,fy,fB,fx){fE=fE||"default";var fA=fE+"-"+fz+"-"+fC+"-"+fD;if(fB){fA+="-indoor"}if(fy){fw[fA]=ft(fz,fC,fD,fy);return fw[fA]}if(!fn[fA]){fn[fA]=ft(fz,fC,fD,fy,fx)}return fn[fA]}}})();aI.register(function(i){var e=new co(i)});function co(e){e.container.appendChild(this.render());this.bind(e)}co.prototype.render=function(){var i=document.createElement("div");i.className="click-ripple-container";var e=document.createElement("div");e.className="click-ripple";i.appendChild(e);this._div=i;this._ripple=e;return i};co.prototype.bind=function(i){var e=this;i.addEventListener("spotclick",function(fm){if(!fm.spots||fm.spots.length===0){return}e._div.style.left=fm.pixel.x+"px";e._div.style.top=fm.pixel.y+"px";x.ac(e._ripple,"ripple-playing")});x.on(e._ripple,"transitionend",function(){x.rc(e._ripple,"ripple-playing")})};function d6(e){cJ.call(this);if(!e){return}this._opts={};this._map=e;this._maxLat=84.6;this._minLat=-80.6;this._maxLatMC=cQ.convertLL2MC(new bS(this._maxLat,0)).lat;this._minLatMC=cQ.convertLL2MC(new bS(this._minLat,0)).lat}d6.inherits(cJ,"ToolbarItem");x.extend(d6.prototype,{open:function(){if(this._isOpen==true){return true}if(this._map._toolInUse){return false}this._map._toolInUse=true;this._isOpen=true;return true},close:function(){if(!this._isOpen){return}this._map._toolInUse=false;this._isOpen=false},_checkStr:function(e){if(!e){return""}return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}});function eD(fm,i){d6.call(this,fm);i=i||{};this._opts=x.extend(x.extend(this._opts||{},{autoClear:false,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:true,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:dn.distCursor,styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:true}),i);if(this._opts.showResult===false){if(typeof i.tips==="undefined"){this._opts.tips="绘制折线"}if(!i.cursor){this._opts.cursor="crosshair"}}if(this._opts.lineStroke<=0){this._opts.lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!=="solid"&&this._opts.lineStyle!=="dashed"){this._opts.lineStyle="solid"}this._checked=false;this._drawing=null;this.followTitle=null;this._totalDis={};this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._dLineColor="#ff6319";this._dLineStroke=3;this._dOpacity=0.8;this._dLineStyle="solid";this._dCursor=dn.distCursor;if(this._opts.showResult){this._opts.followText="单击确定起点"}this._followTextM="单击确定地点，双击结束";this._sectionMarkerTip="单击可删除此点，拖拽可调整位置";this._movingTimerId=null;if(this._opts.showResult){this.text="测距"}else{this.text="绘线"}this._isOpen=false;var e=this;cH.load("tools",function(){e._draw()})}eD.inherits(d6,"PolylineTItem");x.extend(eD.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){if(Math.round(e)>0){this._opts.lineStroke=Math.round(e)}},setOpacity:function(e){if(e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e==="solid"||e==="dashed"){this._opts.lineStyle=e}},clear:function(){for(var fm=0,e=this._overlays.length;fm<e;fm++){if(this._overlays[fm]){this._map.removeOverlay(this._overlays[fm])}}this._overlays.length=0;for(var fm=0,e=this._dots.length;fm<e;fm++){if(this._dots[fm]&&this._dots[fm].parentNode){this._dots[fm].parentNode.removeChild(this._dots[fm])}}this._dots.length=0},setCursor:function(e){if(this._opts.showResult===true){return}this._opts.cursor=e},getCursor:function(){if(this._opts.showResult===true){return this._dCursor}var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);if(e!==null){return e[1]}else{return this._opts.cursor}},showResult:function(e){this._opts.showResult=!!e}});function bv(){var fo=3;var fv=256;var fn=Math.pow(2,18-fo)*fv;var fw=2;var fu=(fw+1)*fn;var fm=cQ.convertLL2MC(new e4(180,0));var fs=fm.lng;var fq=fu-fs;var ft=-3;var e=ft*fn;var fp=cQ.convertLL2MC(new e4(-180,0));var fr=fp.lng;var i=fr-e;this._validPixels=fs/Math.pow(2,18-fo);this._mc180X=fs;this._mcM180X=fr;this._loopOffset=fq+i;this._mcTSpan=fs-fr;this._spaceDistance=fq;this._mSpaceDistance=i}bv.prototype={calcLoopParam:function(fm,i,ft){ft=ft||256;var fq=0;var fn=3;var fp=6;var fo=fp*Math.pow(2,(i-fn))*256/ft;var fs=fo/2-1;var fr=-fo/2;while(fm>fs){fm-=fo;fq-=this._loopOffset}while(fm<fr){fm+=fo;fq+=this._loopOffset}var e=fq;fq=Math.round(fq/Math.pow(2,18-i));return{offsetX:fq,geoOffsetX:e,col:fm,T:fo,maxCol:fs,minCol:fr}},calcLoopCenterPoint:function(i){var e=i.lng;while(e>this._mc180X){e-=this._mcTSpan}while(e<this._mcM180X){e+=this._mcTSpan}i.lng=e;return i},calcLoopMapBounds:function(fm,fn){var i=fn||fm.getCenter();var e=fm.sw.lng;var fo=fm.ne.lng;while(i.lng>this._mc180X){i.lng-=this._mcTSpan;e-=this._mcTSpan;fo-=this._mcTSpan}while(i.lng<this._mcM180X){i.lng+=this._mcTSpan;e+=this._mcTSpan;fo+=this._mcTSpan}fm.sw.lng=e;fm.ne.lng=fo;if(fm.pointBottomLeft){fm.pointBottomLeft=this.calcLoopCenterPoint(fm.pointBottomLeft);fm.pointTopLeft=this.calcLoopCenterPoint(fm.pointTopLeft);fm.pointTopRight=this.calcLoopCenterPoint(fm.pointTopRight);fm.pointBottomRight=this.calcLoopCenterPoint(fm.pointBottomRight)}return fm},calcLoopTiles:function(fv,e,fz,fs){fz=fz||256;var fo=fs||Math.pow(2,18-e)*fz;var fu=Math.floor(this._mc180X/fo);var fq=Math.floor(this._mcM180X/fo);var fw=Math.floor(this._loopOffset/fo);var fx=[];for(var fr=0;fr<fv.length;fr++){var fy=fv[fr];var fn=fy[0];var fA=fy[1];if(fn>=fu){var ft=fn+fw;if(this.isTileBlank(ft,e,fz)===true){continue}var fm="id_"+ft+"_"+fA+"_"+e;if(!fv[fm]){fv[fm]=true;fx.push([ft,fA,e,0])}}else{if(fn<=fq){var ft=fn-fw;if(this.isTileBlank(ft,e,fz)===true){continue}var fm="id_"+ft+"_"+fA+"_"+e;if(!fv[fm]){fv[fm]=true;fx.push([ft,fA,e,0])}}}}for(var fr=0,fp=fx.length;fr<fp;fr++){fv.push(fx[fr])}for(var fr=fv.length-1;fr>=0;fr--){var fn=fv[fr][0];if(this.isTileBlank(fn,e,fz)){fv.splice(fr,1)}}return fv},isTileBlank:function(fm,fo,e){var fp=Math.pow(2,fo-3);var i=Math.round(this._validPixels*fp);var fn=6*fp*256/e;while(fm>fn/2-1){fm-=fn}while(fm<-(fn/2)){fm+=fn}if(fm>0&&fm*e>i){return true}if(fm<0&&Math.abs((fm+1)*e)>i){return true}return false},isAddWidth:function(e,i){return e<this._mcM180X||i>this._mc180X},getSpaceDistanceInPixel:function(i){var e=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-i));return e}};var cD=new bv();var bk=(function(){var e=true;var fn=256;var fp=ad("ditu","normalTraffic");var fm=fp.udt;var fq="https://sp3.baidu.com/7_AZsjOpB1gCo2Kml5_Y_DAcsMJiwa/traffic/";var fo=[[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",4,2,0,[],0,0],[2,"79,210,125,1",5,2,0,[],0,0],[2,"79,210,125,1",6,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",4,2,0,[],0,0],[2,"255,208,69,1",5,2,0,[],0,0],[2,"255,208,69,1",6,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",4,2,0,[],0,0],[2,"232,14,14,1",5,2,0,[],0,0],[2,"232,14,14,1",6,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",4,2,0,[],0,0],[2,"181,0,0,1",5,2,0,[],0,0],[2,"181,0,0,1",6,2,0,[],0,0],[2,"255,255,255,1",4,0,0,[],0,0],[2,"255,255,255,1",5.5,0,0,[],0,0],[2,"255,255,255,1",7,0,0,[],0,0],[2,"255,255,255,1",8.5,0,0,[],0,0],[2,"255,255,255,1",10,0,0,[],0,0]];var i=new bI({transparentPng:true,dataType:2,cacheSize:256,clipTile:true});i.zIndex=2;i.getTilesUrl=function(ft,fu){if(!ft||fu<7){return null}var fs=ft.x;var fv=ft.y;var fr=fq+"?qt=vtraffic&z="+fu+"&x="+fs+"&y="+fv+"&udt="+fm;return fr};i.processData=function(fu){var fy=fu.content;var fw=10;if(typeof fu.precision==="number"){fw=fu.precision*10}var fF={road:[[],[]]};if(!fy){return fF}var fD=fy.tf;if(!fD){return fF}for(var fv=0;fv<fD.length;fv++){var fE=fD[fv][1];var fC=[];var fA=0;var fz=0;var fB=fo[fD[fv][3]];for(var ft=0,fr=fE.length;ft<fr/2;ft++){fA+=fE[ft*2]/fw;fz+=fE[ft*2+1]/fw;fC.push(fA,256-fz)}var fs=fB[1].split(",");fs[3]=fs[3]*255;var fx=fB[2]/2;fF.road[0].push([fC,1,2,[255,255,255,255],fx+2]);fF.road[1].push([fC,1,2,fs,fx])}return fF};return i})();aI.register(function(i){if(i.config&&i.config.isOverviewMap){return}if(i.isLoaded()){dL(i)}else{i.addEventListener("load",function(){dL(this)})}i.cityName="中国";i.cCode="1";var e={};e.enableRequest=true;e.request=function(){if(e.enableRequest){e.enableRequest=false;setTimeout(function(){e._request()},500)}};e._request=function(){var fn=i.getBoundsIn();var fp=i.getZoom();var fm=fn.getSouthWest();var fo=fn.getNorthEast();bA.request(function(fs){if(fs.current_city["code"]>=9000&&fs.current_city["code"]<=9378){fs.current_city["name"]="台湾省"}if(fs.current_city["code"]>=20000&&fs.current_city["code"]<=20499){fs.current_city["name"]="新加坡"}if(fs.current_city["code"]>=20500&&fs.current_city["code"]<=25999){fs.current_city["name"]="泰国"}if(fs.current_city["code"]>=26000&&fs.current_city["code"]<=29999){fs.current_city["name"]="日本"}if(fs.current_city["code"]>=30000&&fs.current_city["code"]<=30999){fs.current_city["name"]="韩国"}if(fs.current_city["code"]>=31000&&fs.current_city["code"]<=37000){fs.current_city["name"]="亚太"}if(fs.current_city["code"]>=46609&&fs.current_city["code"]<=52505){fs.current_city["name"]="欧洲"}if(fs.current_city["code"]>=39509&&fs.current_city["code"]<=53500){fs.current_city["name"]="南美洲"}if(fs.current_city["code"]>=54000&&fs.current_city["code"]<=70000){fs.current_city["name"]="北美洲"}if(fs.current_city["code"]===54003&&fs.current_city["code"]>=60731&&fs.current_city["code"]<=61123){fs.current_city["name"]="美国"}if(fs.current_city["code"]===54015||fs.current_city["code"]>=57970&&fs.current_city["code"]<=60223){fs.current_city["name"]="加拿大"}if(fs.current_city["code"]===54025||fs.current_city["code"]>=54338&&fs.current_city["code"]<=57374){fs.current_city["name"]="墨西哥"}e.enableRequest=true;if(fs&&fs.current_city){var fr=fs.current_city["name"];var fq=fs.current_city["code"];if(fq!==i.cCode){i.dispatchEvent("citychange",{name:fr,code:fq})}i.cityName=fr;i.cCode=fs.current_city["code"];if(!d8()){cX(i)}}},{qt:"cen",b:fm.lng+","+fm.lat+";"+fo.lng+","+fo.lat,l:fp},"","",true)};i.addEventListener("load",function(fm){e.request()});i.addEventListener("moveend",function(fm){e.request()});i.addEventListener("zoomend",function(fm){e.request()});e.request()});function dL(i){if(i.temp.copyadded){return}i.temp.copyadded=true;if(!i.cpyCtrl){var fn=new cG(2,2);i.config.cpyCtrlOffset=fn;if(d8()){fn.width=72;fn.height=0}var fm=new cp({offset:fn,printable:true});i.cpyCtrl=fm}if(!d8()){cX(i);i.addEventListener("maptypechange",function(){cX(i)})}i.addControl(fm);var e=new O();e._opts={printable:true};i.logoCtrl=e;i.addControl(e);i.addEventListener("resize",function(){if(this.getSize().width>=300&&i.getSize().height>=100){e.show();fm.setOffset(i.config.cpyCtrlOffset)}else{e.hide();fm.setOffset(new cG(4,2))}});if(i.getSize().width>=300&&i.getSize().height>=100){e.show()}else{e.hide();fm.setOffset(new cG(4,2))}i.addEventListener("oncopyrightoffsetchange",function(fo){i.logoCtrl.setOffset(fo.target.logo);i.cpyCtrl.setOffset(fo.target.cpy)});i.dispatchEvent(new aB("oncopyrightaddend"))}function cX(fC){if(!fC.cpyCtrl){var fK=new cG(2,2);if(d8()){fK.width=72;fK.height=0}var fF=new cp({offset:fK,printable:true});fC.cpyCtrl=fF}var fT=fC.cityName||"中国";var fD=fC.getMapType();var fE=["常州市","南昌市","乌鲁木齐市","无锡市","福州市","泉州市","珠海市","贵阳市"];var fw=["北京市","上海市","广州市","深圳市","宁波市","石家庄市","沈阳市","长春市","青岛市","温州市","台州市","金华市","佛山市","中山市","昆明市","南宁市","苏州市","西安市","济南市","郑州市","合肥市","呼和浩特市","杭州市","成都市","武汉市","长沙市","天津市","南京市","重庆市","大连市","东莞市","厦门市"];var fy=["香港特别行政区"];var fs=["台湾省"];var fL=["日本"];var fR=["韩国"];var fG=["泰国"];var fJ=["亚太"];var ft=["新加坡"];var fS=["欧洲"];var fn=["南美洲"];var fO=["北美洲"];var fm=["美国"];var fI=["墨西哥"];var fq=["加拿大"];for(var fP in fE){if(fE[fP]===fT){var fz=true;break}}for(var fP in fw){if(fw[fP]===fT){var fo=true;break}}for(var fP in fy){if(fy[fP]===fT){var fV=true;break}}if(fs[0]===fT){var fN=true}if(ft[0]===fT){var i=true}if(fL[0]===fT){var fv=true}if(fR[0]===fT){var fB=true}if(fG[0]===fT){var fA=true}if(fJ[0]===fT){var fr=true}if(fS[0]===fT){var fx=true}if(fn[0]===fT){var fu=true}if(fO[0]===fT){var e=true}if(fm[0]===fT){var fQ=true}if(fq[0]===fT){var fM=true}if(fI[0]===fT){var fp=true}var fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "];var fH="rgba(255, 255, 255, 0.701961)";if(fC.getZoom()<=9){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(fN){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(fv||fB){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(i||fA){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(fr){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(fx){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(fu){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}else{if(e){fU=["&copy;&nbsp;2020 Baidu - GS(2019)5218号 - 甲测资字1100930 - 京ICP证030173号 - Data &copy; "]}}}}}}}}if(fC.getZoom()<=9){fU.push("长地万方");fU.push(' &amp; <a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');fU.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');if(fD===BMAP_SATELLITE_MAP||fD===BMAP_HYBRID_MAP){fU.push(' &amp; <a target="_blank" href="http://www.eso.org/public/">ESO</a>');fH="rgba(0,0,0,.7)"}}else{if(fv||fB){fU.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>')}else{if(i||fA){fU.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>')}else{if(fr){fU.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');fU.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(fx){fU.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');fU.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(fu){fU.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');fU.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(fQ||fp||fM){fU.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');fU.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(e){fU.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');fU.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{fU.push("长地万方");if(fz){fU.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>')}if(fV){fU.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>')}if(fN){fU.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');fU.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>')}if(fD===BMAP_SATELLITE_MAP||fD===BMAP_HYBRID_MAP){fH="rgba(0,0,0,.7)"}}}}}}}}}fU.unshift('<span style="background: '+fH+';padding: 0px 1px;line-height: 16px;display: inline;height: 16px;">');fU.push("</span>");fU=fU.join("");fC.cpyCtrl.addCopyright({id:1,content:fU})}aI.Map=bV;aI.MapType=be;aI.Point=e4;aI.Pixel=cO;aI.Size=cG;aI.Bounds=cv;aI.TileLayer=bI;aI.Copyright=bT;aI.Projection=aI.Project=cQ;aI.RenderTypeUtils=aA;aI.Overlay=aH;aI.Label=dV;aI.Marker=ac;aI.Icon=eR;aI.Polyline=T;aI.PolylineMultipart=dB;aI.Polygon=eO;aI.InfoWindow=W;aI.SimpleInfoWindow=ff;aI.Circle=cn;aI.GroundOverlay=cy;aI.Control=az;aI.NavigationControl=cb;aI.NavigationControl3D=df;aI.CopyrightControl=cp;aI.ScaleControl=eV;aI.MapTypeControl=aT;aI.ZoomControl=by;aI.LocationControl=aR;aI.LogoControl=O;aI.DistanceTool=eD;aI.ContextMenu=bl;aI.MenuItem=dI;aI.OperationMask=cN;aI.Animation=l;aI.ViewAnimation=bG;aI.Transitions=bq;aI.Event=aB;aI.trafficLayer=bk;aI.verify();aI.apiLoad();window._groundOverlay=1;x.extend(cy.prototype,{_draw:function(){if(!this.map){return}if(!this.domElement){this._addDom()}var fp=this.map.getZoom();if(fp<this._config.displayOnMinLevel||fp>this._config.displayOnMaxLevel){this.hide();return}var fm=this._config.bounds.getSouthWest();var fo=this._config.bounds.getNorthEast();var fq={x:this.map.pointToOverlayPixel(fm).x,y:this.map.pointToOverlayPixel(fo).y};var i={x:this.map.pointToOverlayPixel(fo).x,y:this.map.pointToOverlayPixel(fm).y};var fn=i.x-fq.x;var e=i.y-fq.y;this.domElement.style.left=fq.x+"px";this.domElement.style.top=fq.y+"px";this.domElement.style.width=fn+"px";this.domElement.style.height=e+"px";this.show()},draw:function(){this._draw()},_addDom:function(){if(this.domElement){return}this.domElement=document.createElement("div");var i=this.domElement.style;i.cssText="position: absolute; -moz-user-select: none; overflow: hidden;";i.zIndex=aH.getZIndex(this._config.bounds.getSouthWest().lat);if(this._config.opacity||this._config.opacity===0){i.opacity=this._config.opacity;i.filter="alpha(opacity="+(parseInt(this._config.opacity,10)*100)+")"}this._imgElement=document.createElement("img");this._imgElement.style.width="100%";this._imgElement.style.webkitUserDrag="none";if(this._config.stretch){this._imgElement.style.height="100%"}this.domElement.appendChild(this._imgElement);var e=this;this._imgElement.onload=function(fm){e._imgElementWidth=e._imgElement.naturalWidth||e._imgElement.width;e._imgElementHeight=e._imgElement.naturalHeight||e._imgElement.height};if(this._config.imageURL){this._imgElement.src=this._config.imageURL}this.map.getPanes().labelPane.appendChild(this.domElement);var e=this;x.on(this.domElement,"click",function(fm){e.dispatchEvent(new aB("click"),fm)});x.on(this.domElement,"dblclick",function(fm){e.dispatchEvent(new aB("dblclick"),fm)})},setBounds:function(e){this._config.bounds=e;if(this.map){this._draw()}this.domElement.style.zIndex=aH.getZIndex(this._config.bounds.getSouthWest().lat)},getBounds:function(){return this._config.bounds},setOpacity:function(e){this._config.opacity=e;this.domElement.style.opacity=e;this.domElement.style.filter="alpha(opacity="+(parseInt(e,10)*100)+")"},getOpacity:function(e){return this._config.opacity},setImageURL:function(e){this._config.imageURL=e;if(this._imgElement){this._imgElement.src=e}},getImageURL:function(){return this._config.imageURL},setDisplayOnMinLevel:function(e){this._config.displayOnMinLevel=e},getDisplayOnMinLevel:function(){return this._config.displayOnMinLevel},setDisplayOnMaxLevel:function(e){this._config.displayOnMaxLevel=e},getDisplayOnMaxLevel:function(){return this._config.displayOnMaxLevel}});cy.prototype.setBounds=cy.prototype.setBounds;cy.prototype.getBounds=cy.prototype.getBounds;cy.prototype.setOpacity=cy.prototype.setOpacity;cy.prototype.getOpacity=cy.prototype.getOpacity;cy.prototype.setImageURL=cy.prototype.setImageURL;cy.prototype.getImageURL=cy.prototype.getImageURL;cy.prototype.setDispalyOnMinLevel=cy.prototype.setDispalyOnMinLevel;cy.prototype.setDispalyOnMaxLevel=cy.prototype.setDispalyOnMaxLevel;window._groundOverlay=2;})(BMapGL,"BMapGL");