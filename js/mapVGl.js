(function(w,O){"object"===typeof exports&&"undefined"!==typeof module?O(exports):"function"===typeof define&&define.amd?define(["exports"],O):(w=w||self,O(w.mapvgl={}))})(this,function(w){function O(q){return q&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q["default"]:q}function ca(q,n){return n={exports:{}},q(n,n.exports),n.exports}function Cc(q,n){return function(d){return n(q(d))}}function Dc(q){var n=function(d){if(void 0===d||null===d)return d;1<arguments.length&&(d=Array.prototype.slice.call(arguments));
    return q(d)};"conversion"in q&&(n.conversion=q.conversion);return n}function Ec(q){var n=function(d){if(void 0===d||null===d)return d;1<arguments.length&&(d=Array.prototype.slice.call(arguments));var b=q(d);if("object"===("undefined"===typeof b?"undefined":W(b)))for(var c=b.length,a=0;a<c;a++)b[a]=Math.round(b[a]);return b};"conversion"in q&&(n.conversion=q.conversion);return n}function U(q,n){if(!(this instanceof U))return new U(q,n);n&&n in Sb&&(n=null);if(n&&!(n in la))throw Error("Unknown model: "+
    n);if("undefined"===typeof q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof U)this.model=q.model,this.color=q.color.slice(),this.valpha=q.valpha;else if("string"===typeof q){n=Wa.get(q);if(null===n)throw Error("Unable to parse color from string: "+q);this.model=n.model;var d=la[this.model].channels;this.color=n.value.slice(0,d);this.valpha="number"===typeof n.value[d]?n.value[d]:1}else if(q.length)this.model=n||"rgb",d=la[this.model].channels,n=Xa.call(q,0,d),this.color=ib(n,
    d),this.valpha="number"===typeof q[d]?q[d]:1;else if("number"===typeof q)q&=16777215,this.model="rgb",this.color=[q>>16&255,q>>8&255,q&255],this.valpha=1;else{this.valpha=1;n=Object.keys(q);"alpha"in q&&(n.splice(n.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);n=n.sort().join("");if(!(n in jb))throw Error("Unable to parse color from object: "+JSON.stringify(q));this.model=jb[n];d=la[this.model].labels;var b=[];for(n=0;n<d.length;n++)b.push(q[d[n]]);this.color=ib(b)}if(Ya[this.model])for(d=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           la[this.model].channels,n=0;n<d;n++)(q=Ya[this.model][n])&&(this.color[n]=q(this.color[n]));this.valpha=Math.max(0,Math.min(1,this.valpha));Object.freeze&&Object.freeze(this)}function Fc(q){return function(n){return Number(n.toFixed(q))}}function K(q,n,d){q=Array.isArray(q)?q:[q];q.forEach(function(b){(Ya[b]||(Ya[b]=[]))[n]=d});q=q[0];return function(b){if(arguments.length){d&&(b=d(b));var c=this[q]();c.color[n]=b;return c}c=this[q]().color[n];d&&(c=d(c));return c}}function N(q){return function(n){return Math.max(0,
    Math.min(q,n))}}function ib(q,n){for(var d=0;d<n;d++)"number"!==typeof q[d]&&(q[d]=0);return q}function pa(){}function bc(q,n){for(var d in n)q[d]=n[d]}function ta(q,n){this.lng=q;this.lat=n}function cc(q,n){this.x=q;this.y=n}function Za(q){return q*Math.PI/180}function Db(q,n){var d=document.createElement("canvas");q&&(d.width=q);n&&(d.height=n);return d}function fa(q){q=q||{};this.gradient=q.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"};
    this.maxSize=void 0===q.maxSize?35:q.maxSize;this.minSize=q.minSize||0;this.max=q.max||100;this.min=q.min||0;this.initPalette()}function ha(q){this.options=q||{};this._initialize()}function kb(q,n,d,b,c){var a=1-q,f=1-q;return a*a*a*n+3*f*f*q*d+3*(1-q)*q*q*b+q*q*q*c}function dc(q){for(var n=["webgl","experimental-webgl"],d,b=0;b<n.length;b++)try{d=q.getContext(n[b])}catch(c){}return d}function ec(q,n,d){var b=q.createShader(q.VERTEX_SHADER);q.shaderSource(b,n);q.compileShader(b);if(!q.getShaderParameter(b,
    q.COMPILE_STATUS))return q="Vertex shader failed to compile.  The error log is:"+q.getShaderInfoLog(b),console.error(q),-1;n=q.createShader(q.FRAGMENT_SHADER);q.shaderSource(n,d);q.compileShader(n);if(!q.getShaderParameter(n,q.COMPILE_STATUS))return q="Fragment shader failed to compile.  The error log is:"+q.getShaderInfoLog(n),console.error(q),-1;d=q.createProgram();q.attachShader(d,b);q.attachShader(d,n);q.linkProgram(d);return q.getProgramParameter(d,q.LINK_STATUS)?d:(q="Shader program failed to link.  The error log is:"+
    q.getProgramInfoLog(d),console.error(q),-1)}function Q(q,n){this.gl=q;n=this.program=ec(q,n.vertexShader,n.fragmentShader);for(var d={},b=q.getProgramParameter(n,q.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var a=q.getActiveAttrib(n,c);d[a.name]=q.getAttribLocation(n,a.name)}b={};c=q.getProgramParameter(n,q.ACTIVE_UNIFORMS);for(a=0;a<c;a++){var f=q.getActiveUniform(n,a);b[f.name]=q.getUniformLocation(n,f.name)}this.attributes=d;this.uniforms=b}function Eb(q,n){var d=q.createTexture();q.bindTexture(q.TEXTURE_2D,
    d);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,!0);q.texImage2D(q.TEXTURE_2D,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,n);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.REPEAT);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.REPEAT);q.bindTexture(q.TEXTURE_2D,null);return d}function $a(q,n,d){if("object"===("undefined"===typeof n?"undefined":W(n)))n=Eb(q,n),d(n,null);else{var b=new Image;b.crossOrigin=
    "anonymous";b.onload=function(){var c=Eb(q,this);d(c,b)};b.src=n}}function ab(q,n,d){d=d||2;var b=n&&n.length,c=b?n[0]*d:q.length,a=fc(q,0,c,d,!0),f=[];if(!a||a.next===a.prev)return f;var k;if(b){var g=d;b=[];var e;var l=0;for(e=n.length;l<e;l++){var t=n[l]*g;var r=l<e-1?n[l+1]*g:q.length;t=fc(q,t,r,g,!1);t===t.next&&(t.steiner=!0);b.push(Gc(t))}b.sort(Hc);for(l=0;l<b.length;l++){n=b[l];g=a;if(g=Ic(n,g))n=gc(g,n),bb(n,n.next);a=bb(a,a.next)}}if(q.length>80*d){var h=k=q[0];var m=b=q[1];for(g=d;g<c;g+=
    d)l=q[g],n=q[g+1],l<h&&(h=l),n<m&&(m=n),l>k&&(k=l),n>b&&(b=n);k=Math.max(k-h,b-m);k=0!==k?1/k:0}Ea(a,f,d,h,m,k);return f}function fc(q,n,d,b,c){if(c===0<lb(q,n,d,b))for(c=n;c<d;c+=b)var a=hc(c,q[c],q[c+1],a);else for(c=d-b;c>=n;c-=b)a=hc(c,q[c],q[c+1],a);a&&Aa(a,a.next)&&(Ma(a),a=a.next);return a}function bb(q,n){if(!q)return q;n||(n=q);do{var d=!1;if(q.steiner||!Aa(q,q.next)&&0!==M(q.prev,q,q.next))q=q.next;else{Ma(q);q=n=q.prev;if(q===q.next)break;d=!0}}while(d||q!==n);return n}function Ea(q,n,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     d,b,c,a,f){if(q){if(!f&&a){var k=q,g=k;do null===g.z&&(g.z=mb(g.x,g.y,b,c,a)),g.prevZ=g.prev,g=g.nextZ=g.next;while(g!==k);g.prevZ.nextZ=null;g.prevZ=null;k=g;var e,l,t,r,h=1;do{g=k;var m=k=null;for(l=0;g;){l++;var p=g;for(e=t=0;e<h&&(t++,p=p.nextZ,p);e++);for(r=h;0<t||0<r&&p;)0!==t&&(0===r||!p||g.z<=p.z)?(e=g,g=g.nextZ,t--):(e=p,p=p.nextZ,r--),m?m.nextZ=e:k=e,e.prevZ=m,m=e;g=p}m.nextZ=null;h*=2}while(1<l)}for(k=q;q.prev!==q.next;){g=q.prev;p=q.next;if(a)m=Jc(q,b,c,a);else a:if(m=q,l=m.prev,t=m,h=
    m.next,0<=M(l,t,h))m=!1;else{for(e=m.next.next;e!==m.prev;){if(Na(l.x,l.y,t.x,t.y,h.x,h.y,e.x,e.y)&&0<=M(e.prev,e,e.next)){m=!1;break a}e=e.next}m=!0}if(m)n.push(g.i/d),n.push(q.i/d),n.push(p.i/d),Ma(q),k=q=p.next;else if(q=p,q===k){if(!f)Ea(bb(q),n,d,b,c,a,1);else if(1===f){f=n;k=d;g=q;do p=g.prev,m=g.next.next,!Aa(p,m)&&ic(p,g,g.next,m)&&cb(p,m)&&cb(m,p)&&(f.push(p.i/k),f.push(g.i/k),f.push(m.i/k),Ma(g),Ma(g.next),g=q=m),g=g.next;while(g!==q);q=g;Ea(q,n,d,b,c,a,2)}else if(2===f)a:{f=q;do{for(k=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           f.next.next;k!==f.prev;){if(g=f.i!==k.i){g=f;p=k;if(m=g.next.i!==p.i&&g.prev.i!==p.i){b:{m=g;do{if(m.i!==g.i&&m.next.i!==g.i&&m.i!==p.i&&m.next.i!==p.i&&ic(m,m.next,g,p)){m=!0;break b}m=m.next}while(m!==g);m=!1}m=!m}if(m=m&&cb(g,p)&&cb(p,g)){m=g;l=!1;t=(g.x+p.x)/2;p=(g.y+p.y)/2;do m.y>p!==m.next.y>p&&m.next.y!==m.y&&t<(m.next.x-m.x)*(p-m.y)/(m.next.y-m.y)+m.x&&(l=!l),m=m.next;while(m!==g);m=l}g=m}if(g){q=gc(f,k);f=bb(f,f.next);q=bb(q,q.next);Ea(f,n,d,b,c,a);Ea(q,n,d,b,c,a);break a}k=k.next}f=f.next}while(f!==
q)}break}}}}function Jc(q,n,d,b){var c=q.prev,a=q.next;if(0<=M(c,q,a))return!1;var f=c.x>q.x?c.x>a.x?c.x:a.x:q.x>a.x?q.x:a.x,k=c.y>q.y?c.y>a.y?c.y:a.y:q.y>a.y?q.y:a.y,g=mb(c.x<q.x?c.x<a.x?c.x:a.x:q.x<a.x?q.x:a.x,c.y<q.y?c.y<a.y?c.y:a.y:q.y<a.y?q.y:a.y,n,d,b);n=mb(f,k,n,d,b);d=q.prevZ;for(b=q.nextZ;d&&d.z>=g&&b&&b.z<=n;){if(d!==q.prev&&d!==q.next&&Na(c.x,c.y,q.x,q.y,a.x,a.y,d.x,d.y)&&0<=M(d.prev,d,d.next))return!1;d=d.prevZ;if(b!==q.prev&&b!==q.next&&Na(c.x,c.y,q.x,q.y,a.x,a.y,b.x,b.y)&&0<=M(b.prev,
    b,b.next))return!1;b=b.nextZ}for(;d&&d.z>=g;){if(d!==q.prev&&d!==q.next&&Na(c.x,c.y,q.x,q.y,a.x,a.y,d.x,d.y)&&0<=M(d.prev,d,d.next))return!1;d=d.prevZ}for(;b&&b.z<=n;){if(b!==q.prev&&b!==q.next&&Na(c.x,c.y,q.x,q.y,a.x,a.y,b.x,b.y)&&0<=M(b.prev,b,b.next))return!1;b=b.nextZ}return!0}function Hc(q,n){return q.x-n.x}function Ic(q,n){var d=n,b=q.x,c=q.y,a=-Infinity;do{if(c<=d.y&&c>=d.next.y&&d.next.y!==d.y){var f=d.x+(c-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(f<=b&&f>a){a=f;if(f===b){if(c===d.y)return d;
    if(c===d.next.y)return d.next}var k=d.x<d.next.x?d:d.next}}d=d.next}while(d!==n);if(!k)return null;if(b===a)return k.prev;n=k;f=k.x;var g=k.y,e=Infinity;for(d=k.next;d!==n;){if(b>=d.x&&d.x>=f&&b!==d.x&&Na(c<g?b:a,c,f,g,c<g?a:b,c,d.x,d.y)){var l=Math.abs(c-d.y)/(b-d.x);(l<e||l===e&&d.x>k.x)&&cb(d,q)&&(k=d,e=l)}d=d.next}return k}function mb(q,n,d,b,c){q=32767*(q-d)*c;n=32767*(n-b)*c;q=(q|q<<8)&16711935;q=(q|q<<4)&252645135;q=(q|q<<2)&858993459;n=(n|n<<8)&16711935;n=(n|n<<4)&252645135;n=(n|n<<2)&858993459;
    return(q|q<<1)&1431655765|((n|n<<1)&1431655765)<<1}function Gc(q){var n=q,d=q;do{if(n.x<d.x||n.x===d.x&&n.y<d.y)d=n;n=n.next}while(n!==q);return d}function Na(q,n,d,b,c,a,f,k){return 0<=(c-f)*(n-k)-(q-f)*(a-k)&&0<=(q-f)*(b-k)-(d-f)*(n-k)&&0<=(d-f)*(a-k)-(c-f)*(b-k)}function M(q,n,d){return(n.y-q.y)*(d.x-n.x)-(n.x-q.x)*(d.y-n.y)}function Aa(q,n){return q.x===n.x&&q.y===n.y}function ic(q,n,d,b){return Aa(q,n)&&Aa(d,b)||Aa(q,b)&&Aa(d,n)?!0:0<M(q,n,d)!==0<M(q,n,b)&&0<M(d,b,q)!==0<M(d,b,n)}function cb(q,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          n){return 0>M(q.prev,q,q.next)?0<=M(q,n,q.next)&&0<=M(q,q.prev,n):0>M(q,n,q.prev)||0>M(q,q.next,n)}function gc(q,n){var d=new nb(q.i,q.x,q.y),b=new nb(n.i,n.x,n.y),c=q.next,a=n.prev;q.next=n;n.prev=q;d.next=c;c.prev=d;b.next=d;d.prev=b;a.next=b;b.prev=a;return b}function hc(q,n,d,b){q=new nb(q,n,d);b?(q.next=b.next,q.prev=b,b.next.prev=q,b.next=q):(q.prev=q,q.next=q);return q}function Ma(q){q.next.prev=q.prev;q.prev.next=q.next;q.prevZ&&(q.prevZ.nextZ=q.nextZ);q.nextZ&&(q.nextZ.prevZ=q.prevZ)}function nb(q,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        n,d){this.i=q;this.x=n;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function lb(q,n,d,b){for(var c=0,a=d-b;n<d;n+=b)c+=(q[a]-q[n])*(q[n+1]+q[a+1]),a=n;return c}function jc(q,n){return function(d){var b=this;if(n){if(Oa&&!d)return d=(""+n).replace(/^function.+?{/,"").slice(0,-1),d=kc(d),this[lc]=new Oa(d),ob.revokeObjectURL(d),this[lc];var c={postMessage:function(a){b.onmessage&&setTimeout(function(){return b.onmessage({data:a,target:c})})}};n.call(c);this.postMessage=
    function(a){setTimeout(function(){return c.onmessage({data:a,target:b})})};this.isThisThread=!0}else return new Oa(q)}}function kc(q){try{return ob.createObjectURL(new Blob([q],{type:"application/javascript"}))}catch(d){var n=new Kc;n.append(q);return ob.createObjectURL(n.getBlob(type))}}function Fa(q,n){this.shapeLayer=q;this.gl=n;this.initData()}function qa(q,n,d){this.heatmapLayer=d;this.options=n||{};this.map=q;q=document.createElement("canvas");this.data=[];this.canvas=q;this.scale(1)}function pb(q,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               n,d){this.layer=q;this.map=n;this.gl=d;this.initWorker()}var Lc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},na={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,
            158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,
            61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
        hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
            136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,
            228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,
            143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],
        whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Pa=ca(function(q){var n=Array.prototype.concat,d=Array.prototype.slice,b=q.exports=function(b){for(var a=[],c=0,k=b.length;c<k;c++){var g=b[c];var e=(e=g)&&"string"!==typeof e?e instanceof Array||Array.isArray(e)||0<=e.length&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name):!1;e?a=n.call(a,d.call(g)):a.push(g)}return a};b.wrap=function(c){return function(){return c(b(arguments))}}}),
    Wa=ca(function(q){function n(a,b,c){return Math.min(Math.max(b,a),c)}function d(a){a=a.toString(16).toUpperCase();return 2>a.length?"0"+a:a}var b={},c;for(c in na)na.hasOwnProperty(c)&&(b[na[c]]=c);var a=q.exports={to:{},get:{}};a.get=function(b){switch(b.substring(0,3).toLowerCase()){case "hsl":b=a.get.hsl(b);var k="hsl";break;case "hwb":b=a.get.hwb(b);k="hwb";break;default:b=a.get.rgb(b),k="rgb"}return b?{model:k,value:b}:null};a.get.rgb=function(a){if(!a)return null;var b=/^#([a-f0-9]{3,4})$/i,
        c=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,e=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,l=/(\D+)/,f=[0,0,0,1],d;if(d=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){b=d[2];d=d[1];for(a=0;3>a;a++)c=2*a,f[a]=parseInt(d.slice(c,c+2),16);b&&(f[3]=Math.round(parseInt(b,16)/255*100)/100)}else if(d=a.match(b)){d=d[1];b=d[3];for(a=0;3>a;a++)f[a]=parseInt(d[a]+d[a],16);b&&(f[3]=Math.round(parseInt(b+
        b,16)/255*100)/100)}else if(d=a.match(c)){for(a=0;3>a;a++)f[a]=parseInt(d[a+1],0);d[4]&&(f[3]=parseFloat(d[4]))}else if(d=a.match(e)){for(a=0;3>a;a++)f[a]=Math.round(2.55*parseFloat(d[a+1]));d[4]&&(f[3]=parseFloat(d[4]))}else{if(d=a.match(l)){if("transparent"===d[1])return[0,0,0,0];f=na[d[1]];if(!f)return null;f[3]=1;return f}return null}for(a=0;3>a;a++)f[a]=n(f[a],0,255);f[3]=n(f[3],0,1);return f};a.get.hsl=function(a){if(!a)return null;var b=a.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);
        if(b){var c=parseFloat(b[4]);a=(parseFloat(b[1])+360)%360;var e=n(parseFloat(b[2]),0,100);b=n(parseFloat(b[3]),0,100);c=n(isNaN(c)?1:c,0,1);return[a,e,b,c]}return null};a.get.hwb=function(a){if(!a)return null;var b=a.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(b){var c=parseFloat(b[4]);a=(parseFloat(b[1])%360+360)%360;var e=n(parseFloat(b[2]),0,100);b=n(parseFloat(b[3]),0,100);c=n(isNaN(c)?1:c,0,1);return[a,e,b,c]}return null};
        a.to.hex=function(){var a=Pa(arguments);return"#"+d(a[0])+d(a[1])+d(a[2])+(1>a[3]?d(Math.round(255*a[3])):"")};a.to.rgb=function(){var a=Pa(arguments);return 4>a.length||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"};a.to.rgb.percent=function(){var a=Pa(arguments),b=Math.round(a[0]/255*100),c=Math.round(a[1]/255*100),e=Math.round(a[2]/255*100);return 4>a.length||1===a[3]?"rgb("+b+
            "%, "+c+"%, "+e+"%)":"rgba("+b+"%, "+c+"%, "+e+"%, "+a[3]+")"};a.to.hsl=function(){var a=Pa(arguments);return 4>a.length||1===a[3]?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"};a.to.hwb=function(){var a=Pa(arguments),b="";4<=a.length&&1!==a[3]&&(b=", "+a[3]);return"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+b+")"};a.to.keyword=function(a){return b[a.slice(0,3)]}}),ua=ca(function(q){var n={};for(c in na)na.hasOwnProperty(c)&&(n[na[c]]=c);var d=q.exports={rgb:{channels:3,
            labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},b;for(b in d)if(d.hasOwnProperty(b)){if(!("channels"in
        d[b]))throw Error("missing channels property: "+b);if(!("labels"in d[b]))throw Error("missing channel labels property: "+b);if(d[b].labels.length!==d[b].channels)throw Error("channel and label counts mismatch: "+b);q=d[b].channels;var c=d[b].labels;delete d[b].channels;delete d[b].labels;Object.defineProperty(d[b],"channels",{value:q});Object.defineProperty(d[b],"labels",{value:c})}d.rgb.hsl=function(a){var b=a[0]/255,k=a[1]/255,c=a[2]/255;a=Math.min(b,k,c);var e=Math.max(b,k,c),l=e-a,d;e===a?d=0:
        b===e?d=(k-c)/l:k===e?d=2+(c-b)/l:c===e&&(d=4+(b-k)/l);d=Math.min(60*d,360);0>d&&(d+=360);b=(a+e)/2;return[d,100*(e===a?0:.5>=b?l/(e+a):l/(2-e-a)),100*b]};d.rgb.hsv=function(a){var b,k=a[0]/255,c=a[1]/255,e=a[2]/255,l=Math.max(k,c,e);var d=l-Math.min(k,c,e);if(0===d)var n=b=0;else{b=d/l;a=(l-k)/6/d+.5;var h=(l-c)/6/d+.5;d=(l-e)/6/d+.5;k===l?n=d-h:c===l?n=1/3+a-d:e===l&&(n=2/3+h-a);0>n?n+=1:1<n&&--n}return[360*n,100*b,100*l]};d.rgb.hwb=function(a){var b=a[0],k=a[1],c=a[2];a=d.rgb.hsl(a)[0];var e=1/
        255*Math.min(b,Math.min(k,c));c=1-1/255*Math.max(b,Math.max(k,c));return[a,100*e,100*c]};d.rgb.cmyk=function(a){var b=a[0]/255,k=a[1]/255;a=a[2]/255;var c=Math.min(1-b,1-k,1-a);return[100*((1-b-c)/(1-c)||0),100*((1-k-c)/(1-c)||0),100*((1-a-c)/(1-c)||0),100*c]};d.rgb.keyword=function(a){var b=n[a];if(b)return b;b=Infinity;var k;for(k in na)if(na.hasOwnProperty(k)){var c=na[k];c=Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2)+Math.pow(a[2]-c[2],2);if(c<b){b=c;var e=k}}return e};d.keyword.rgb=function(a){return na[a]};
        d.rgb.xyz=function(a){var b=a[0]/255,c=a[1]/255;a=a[2]/255;b=.04045<b?Math.pow((b+.055)/1.055,2.4):b/12.92;c=.04045<c?Math.pow((c+.055)/1.055,2.4):c/12.92;a=.04045<a?Math.pow((a+.055)/1.055,2.4):a/12.92;return[100*(.4124*b+.3576*c+.1805*a),100*(.2126*b+.7152*c+.0722*a),100*(.0193*b+.1192*c+.9505*a)]};d.rgb.lab=function(a){var b=d.rgb.xyz(a);a=b[0];var c=b[1];b=b[2];a/=95.047;c/=100;b/=108.883;a=.008856<a?Math.pow(a,1/3):7.787*a+16/116;c=.008856<c?Math.pow(c,1/3):7.787*c+16/116;b=.008856<b?Math.pow(b,
            1/3):7.787*b+16/116;return[116*c-16,500*(a-c),200*(c-b)]};d.hsl.rgb=function(a){var b=a[0]/360,c=a[1]/100;a=a[2]/100;if(0===c){var g=255*a;return[g,g,g]}c=.5>a?a*(1+c):a+c-a*c;a=2*a-c;var e=[0,0,0];for(var l=0;3>l;l++)g=b+1/3*-(l-1),0>g&&g++,1<g&&g--,g=1>6*g?a+6*(c-a)*g:1>2*g?c:2>3*g?a+(c-a)*(2/3-g)*6:a,e[l]=255*g;return e};d.hsl.hsv=function(a){var b=a[0],c=a[1]/100;a=a[2]/100;var g=c,e=Math.max(a,.01);a*=2;c*=1>=a?a:2-a;g*=1>=e?e:2-e;return[b,100*(0===a?2*g/(e+g):2*c/(a+c)),(a+c)/2*100]};d.hsv.rgb=
            function(a){var b=a[0]/60,c=a[1]/100;a=a[2]/100;var g=Math.floor(b)%6,e=b-Math.floor(b);b=255*a*(1-c);var l=255*a*(1-c*e);c=255*a*(1-c*(1-e));a*=255;switch(g){case 0:return[a,c,b];case 1:return[l,a,b];case 2:return[b,a,c];case 3:return[b,l,a];case 4:return[c,b,a];case 5:return[a,b,l]}};d.hsv.hsl=function(a){var b=a[0],c=a[1]/100;a=a[2]/100;var g=Math.max(a,.01);var e=(2-c)*g;g=c*g/(1>=e?e:2-e)||0;return[b,100*g,(2-c)*a/2*100]};d.hwb.rgb=function(a){var b=a[0]/360,c=a[1]/100;a=a[2]/100;var g=c+a;1<
        g&&(c/=g,a/=g);g=Math.floor(6*b);a=1-a;b=6*b-g;0!==(g&1)&&(b=1-b);b=c+b*(a-c);switch(g){default:case 6:case 0:g=a;var e=b;break;case 1:g=b;e=a;break;case 2:g=c;e=a;c=b;break;case 3:g=c;e=b;c=a;break;case 4:g=b;e=c;c=a;break;case 5:g=a,e=c,c=b}return[255*g,255*e,255*c]};d.cmyk.rgb=function(a){var b=a[3]/100;return[255*(1-Math.min(1,a[0]/100*(1-b)+b)),255*(1-Math.min(1,a[1]/100*(1-b)+b)),255*(1-Math.min(1,a[2]/100*(1-b)+b))]};d.xyz.rgb=function(a){var b=a[0]/100,c=a[1]/100,g=a[2]/100;a=3.2406*b+-1.5372*
            c+-.4986*g;var e=-.9689*b+1.8758*c+.0415*g;b=.0557*b+-.204*c+1.057*g;a=.0031308<a?1.055*Math.pow(a,1/2.4)-.055:12.92*a;e=.0031308<e?1.055*Math.pow(e,1/2.4)-.055:12.92*e;b=.0031308<b?1.055*Math.pow(b,1/2.4)-.055:12.92*b;a=Math.min(Math.max(0,a),1);e=Math.min(Math.max(0,e),1);b=Math.min(Math.max(0,b),1);return[255*a,255*e,255*b]};d.xyz.lab=function(a){var b=a[0],c=a[1];a=a[2];b/=95.047;c/=100;a/=108.883;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;c=.008856<c?Math.pow(c,1/3):7.787*c+16/116;a=.008856<
        a?Math.pow(a,1/3):7.787*a+16/116;return[116*c-16,500*(b-c),200*(c-a)]};d.lab.xyz=function(a){var b=a[1],c=a[2];a=(a[0]+16)/116;b=b/500+a;c=a-c/200;var g=Math.pow(a,3),e=Math.pow(b,3),l=Math.pow(c,3);return[95.047*(.008856<e?e:(b-16/116)/7.787),100*(.008856<g?g:(a-16/116)/7.787),108.883*(.008856<l?l:(c-16/116)/7.787)]};d.lab.lch=function(a){var b=a[0],c=a[1];a=a[2];var g=360*Math.atan2(a,c)/2/Math.PI;0>g&&(g+=360);return[b,Math.sqrt(c*c+a*a),g]};d.lch.lab=function(a){var b=a[0],c=a[1];a=a[2]/360*2*
            Math.PI;return[b,c*Math.cos(a),c*Math.sin(a)]};d.rgb.ansi16=function(a){var b=a[0],c=a[1],g=a[2],e=1 in arguments?arguments[1]:d.rgb.hsv(a)[2];e=Math.round(e/50);if(0===e)return 30;b=30+(Math.round(g/255)<<2|Math.round(c/255)<<1|Math.round(b/255));2===e&&(b+=60);return b};d.hsv.ansi16=function(a){return d.rgb.ansi16(d.hsv.rgb(a),a[2])};d.rgb.ansi256=function(a){var b=a[0],c=a[1];a=a[2];return b===c&&c===a?8>b?16:248<b?231:Math.round((b-8)/247*24)+232:16+36*Math.round(b/255*5)+6*Math.round(c/255*5)+
            Math.round(a/255*5)};d.ansi16.rgb=function(a){var b=a%10;if(0===b||7===b)return 50<a&&(b+=3.5),b=b/10.5*255,[b,b,b];a=.5*(~~(50<a)+1);return[(b&1)*a*255,(b>>1&1)*a*255,(b>>2&1)*a*255]};d.ansi256.rgb=function(a){if(232<=a){var b=10*(a-232)+8;return[b,b,b]}a-=16;b=Math.floor(a/36)/5*255;var c=Math.floor((a%=36)/6)/5*255;return[b,c,a%6/5*255]};d.rgb.hex=function(a){a=(((Math.round(a[0])&255)<<16)+((Math.round(a[1])&255)<<8)+(Math.round(a[2])&255)).toString(16).toUpperCase();return"000000".substring(a.length)+
            a};d.hex.rgb=function(a){a=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];var b=a[0];3===a[0].length&&(b=b.split("").map(function(a){return a+a}).join(""));a=parseInt(b,16);return[a>>16&255,a>>8&255,a&255]};d.rgb.hcg=function(a){var b=a[0]/255,c=a[1]/255;a=a[2]/255;var g=Math.max(Math.max(b,c),a),e=Math.min(Math.min(b,c),a),l=g-e;return[(0>=l?0:g===b?(c-a)/l%6:g===c?2+(a-b)/l:(b-c)/l+8)/6%1*360,100*l,100*(1>l?e/(1-l):0)]};d.hsl.hcg=function(a){var b=a[1]/100,c=a[2]/100,g=0;b=
            .5>c?2*b*c:2*b*(1-c);1>b&&(g=(c-.5*b)/(1-b));return[a[0],100*b,100*g]};d.hsv.hcg=function(a){var b=a[2]/100,c=a[1]/100*b,g=0;1>c&&(g=(b-c)/(1-c));return[a[0],100*c,100*g]};d.hcg.rgb=function(a){var b=a[1]/100,c=a[2]/100;if(0===b)return[255*c,255*c,255*c];var g=[0,0,0];a=a[0]/360%1*6;var e=a%1,l=1-e;switch(Math.floor(a)){case 0:g[0]=1;g[1]=e;g[2]=0;break;case 1:g[0]=l;g[1]=1;g[2]=0;break;case 2:g[0]=0;g[1]=1;g[2]=e;break;case 3:g[0]=0;g[1]=l;g[2]=1;break;case 4:g[0]=e;g[1]=0;g[2]=1;break;default:g[0]=
            1,g[1]=0,g[2]=l}c*=1-b;return[255*(b*g[0]+c),255*(b*g[1]+c),255*(b*g[2]+c)]};d.hcg.hsv=function(a){var b=a[1]/100,c=b+a[2]/100*(1-b),g=0;0<c&&(g=b/c);return[a[0],100*g,100*c]};d.hcg.hsl=function(a){var b=a[1]/100,c=a[2]/100*(1-b)+.5*b,g=0;0<c&&.5>c?g=b/(2*c):.5<=c&&1>c&&(g=b/(2*(1-c)));return[a[0],100*g,100*c]};d.hcg.hwb=function(a){var b=a[1]/100,c=b+a[2]/100*(1-b);return[a[0],100*(c-b),100*(1-c)]};d.hwb.hcg=function(a){var b=1-a[2]/100,c=b-a[1]/100,g=0;1>c&&(g=(b-c)/(1-c));return[a[0],100*c,100*
        g]};d.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]};d.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]};d.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]};d.gray.hsl=d.gray.hsv=function(a){return[0,0,a[0]]};d.gray.hwb=function(a){return[0,100,a[0]]};d.gray.cmyk=function(a){return[0,0,0,a[0]]};d.gray.lab=function(a){return[a[0],0,0]};d.gray.hex=function(a){a=Math.round(a[0]/100*255)&255;a=((a<<16)+(a<<8)+a).toString(16).toUpperCase();
            return"000000".substring(a.length)+a};d.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}}),Mc=function(q){for(var n={},d=Object.keys(ua),b=d.length,c=0;c<b;c++)n[d[c]]={distance:-1,parent:null};d=[q];for(n[q].distance=0;d.length;){q=d.pop();b=Object.keys(ua[q]);c=b.length;for(var a=0;a<c;a++){var f=b[a],k=n[f];-1===k.distance&&(k.distance=n[q].distance+1,k.parent=q,d.unshift(f))}}d={};q=Object.keys(n);b=q.length;for(c=0;c<b;c++){var g=q[c];if(null!==n[g].parent){a=g;f=n;k=[f[g].parent,g];
        var e=ua[f[g].parent][g];for(g=f[g].parent;f[g].parent;)k.unshift(f[g].parent),e=Cc(ua[f[g].parent][g],e),g=f[g].parent;e.conversion=k;d[a]=e}}return d},W="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(q){return typeof q}:function(q){return q&&"function"===typeof Symbol&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},x=function(q,n){if(!(q instanceof n))throw new TypeError("Cannot call a class as a function");},A=function(){function q(n,d){for(var b=0;b<d.length;b++){var c=
        d[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(n,c.key,c)}}return function(n,d,b){d&&q(n.prototype,d);b&&q(n,b);return n}}(),Qa=function c(n,d,b){null===n&&(n=Function.prototype);var a=Object.getOwnPropertyDescriptor(n,d);if(void 0===a){if(n=Object.getPrototypeOf(n),null!==n)return c(n,d,b)}else{if("value"in a)return a.value;d=a.get;return void 0===d?void 0:d.call(b)}},H=function(n,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+
        typeof d);n.prototype=Object.create(d&&d.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(n,d):n.__proto__=d)},I=function(n,d){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?n:d},db=function(n){if(Array.isArray(n)){for(var d=0,b=Array(n.length);d<n.length;d++)b[d]=n[d];return b}return Array.from(n)},Ha={};Object.keys(ua).forEach(function(n){Ha[n]=
    {};Object.defineProperty(Ha[n],"channels",{value:ua[n].channels});Object.defineProperty(Ha[n],"labels",{value:ua[n].labels});var d=Mc(n);Object.keys(d).forEach(function(b){var c=d[b];Ha[n][b]=Ec(c);Ha[n][b].raw=Dc(c)})});var la=Ha,Xa=[].slice,Sb=["keyword","gray","hex"],jb={};Object.keys(la).forEach(function(n){jb[Xa.call(la[n].labels).sort().join("")]=n});var Ya={};U.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(n){var d=this.model in
    Wa.to?this:this.rgb();d=d.round("number"===typeof n?n:1);n=1===d.valpha?d.color:d.color.concat(this.valpha);return Wa.to[d.model](n)},percentString:function(n){n=this.rgb().round("number"===typeof n?n:1);n=1===n.valpha?n.color:n.color.concat(this.valpha);return Wa.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var n={},d=la[this.model].channels,b=la[this.model].labels,c=0;c<d;c++)n[b[c]]=this.color[c];1!==this.valpha&&
    (n.alpha=this.valpha);return n},unitArray:function(){var n=this.rgb().color;n[0]/=255;n[1]/=255;n[2]/=255;1!==this.valpha&&n.push(this.valpha);return n},unitObject:function(){var n=this.rgb().object();n.r/=255;n.g/=255;n.b/=255;1!==this.valpha&&(n.alpha=this.valpha);return n},round:function(n){n=Math.max(n||0,0);return new U(this.color.map(Fc(n)).concat(this.valpha),this.model)},alpha:function(n){return arguments.length?new U(this.color.concat(Math.max(0,Math.min(1,n))),this.model):this.valpha},red:K("rgb",
        0,N(255)),green:K("rgb",1,N(255)),blue:K("rgb",2,N(255)),hue:K(["hsl","hsv","hsl","hwb","hcg"],0,function(n){return(n%360+360)%360}),saturationl:K("hsl",1,N(100)),lightness:K("hsl",2,N(100)),saturationv:K("hsv",1,N(100)),value:K("hsv",2,N(100)),chroma:K("hcg",1,N(100)),gray:K("hcg",2,N(100)),white:K("hwb",1,N(100)),wblack:K("hwb",2,N(100)),cyan:K("cmyk",0,N(100)),magenta:K("cmyk",1,N(100)),yellow:K("cmyk",2,N(100)),black:K("cmyk",3,N(100)),x:K("xyz",0,N(100)),y:K("xyz",1,N(100)),z:K("xyz",2,N(100)),
    l:K("lab",0,N(100)),a:K("lab",1),b:K("lab",2),keyword:function(n){return arguments.length?new U(n):la[this.model].keyword(this.color)},hex:function(n){return arguments.length?new U(n):Wa.to.hex(this.rgb().round().color)},rgbNumber:function(){var n=this.rgb().color;return(n[0]&255)<<16|(n[1]&255)<<8|n[2]&255},luminosity:function(){for(var n=this.rgb().color,d=[],b=0;b<n.length;b++){var c=n[b]/255;d[b]=.03928>=c?c/12.92:Math.pow((c+.055)/1.055,2.4)}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast:function(n){var d=
        this.luminosity();n=n.luminosity();return d>n?(d+.05)/(n+.05):(n+.05)/(d+.05)},level:function(n){n=this.contrast(n);return 7.1<=n?"AAA":4.5<=n?"AA":""},isDark:function(){var n=this.rgb().color;return 128>(299*n[0]+587*n[1]+114*n[2])/1E3},isLight:function(){return!this.isDark()},negate:function(){for(var n=this.rgb(),d=0;3>d;d++)n.color[d]=255-n.color[d];return n},lighten:function(n){var d=this.hsl();d.color[2]+=d.color[2]*n;return d},darken:function(n){var d=this.hsl();d.color[2]-=d.color[2]*n;return d},
    saturate:function(n){var d=this.hsl();d.color[1]+=d.color[1]*n;return d},desaturate:function(n){var d=this.hsl();d.color[1]-=d.color[1]*n;return d},whiten:function(n){var d=this.hwb();d.color[1]+=d.color[1]*n;return d},blacken:function(n){var d=this.hwb();d.color[2]+=d.color[2]*n;return d},grayscale:function(){var n=this.rgb().color;n=.3*n[0]+.59*n[1]+.11*n[2];return U.rgb(n,n,n)},fade:function(n){return this.alpha(this.valpha-this.valpha*n)},opaquer:function(n){return this.alpha(this.valpha+this.valpha*
        n)},rotate:function(n){var d=this.hsl(),b=d.color[0];b=(b+n)%360;d.color[0]=0>b?360+b:b;return d},mix:function(n,d){if(!n||!n.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof n?"undefined":W(n)));n=n.rgb();var b=this.rgb();d=void 0===d?.5:d;var c=2*d-1,a=n.alpha()-b.alpha();c=((-1===c*a?c:(c+a)/(1+c*a))+1)/2;a=1-c;return U.rgb(c*n.red()+a*b.red(),c*n.green()+a*b.green(),c*n.blue()+a*b.blue(),n.alpha()*d+b.alpha()*(1-d))}};Object.keys(la).forEach(function(n){if(-1===
    Sb.indexOf(n)){var d=la[n].channels;U.prototype[n]=function(){if(this.model===n)return new U(this);if(arguments.length)return new U(arguments,n);var b="number"===typeof arguments[d]?d:this.valpha;var c=la[this.model][n].raw(this.color);c=Array.isArray(c)?c:[c];return new U(c.concat(b),n)};U[n]=function(b){"number"===typeof b&&(b=ib(Xa.call(arguments),d));return new U(b,n)}}});bc(pa,{EARTHRADIUS:6370996.81,MCBAND:[1.289059486E7,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],
    MC2LL:[[1.410526172116255E-8,8.98305509648872E-6,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,1.73379812E7],[-7.435856389565537E-9,8.983055097726239E-6,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1.026014486E7],[-3.030883460898826E-8,8.98305509983578E-6,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,
        -3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552E-8,8.983055099779535E-6,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437E-9,8.983055096812155E-6,6.995724062E-5,23.10934304144901,-2.3663490511E-4,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878E-9,8.983055095805407E-6,-3.068298E-8,7.47137025468032,-3.53937994E-6,-.02145144861037,-1.234426596E-5,
        1.0322952773E-4,-3.23890364E-6,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[8.277824516172526E-4,111320.7020463578,6.477955746671607E8,-4.082003173641316E9,1.077490566351142E10,-1.517187553151559E10,1.205306533862167E10,-5.124939663577472E9,9.133119359512032E8,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-2.339375119931662E7,7.968221547186455E7,-1.159649932797253E8,
        9.723671115602145E7,-4.366194633752821E7,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-3.441963504368392E-4,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-3.218135878613132E-4,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,
        1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(n,d){if(!n||!d)return 0;n=this.convertMC2LL(n);if(!n)return 0;var b=this.toRadians(n.lng);n=this.toRadians(n.lat);d=this.convertMC2LL(d);if(!d)return 0;var c=this.toRadians(d.lng);d=this.toRadians(d.lat);return this.getDistance(b,c,n,d)},getDistanceByLL:function(n,d){if(!n||!d)return 0;n.lng=this.getLoop(n.lng,-180,180);n.lat=this.getRange(n.lat,-74,74);d.lng=this.getLoop(d.lng,-180,180);d.lat=this.getRange(d.lat,-74,
        74);var b=this.toRadians(n.lng);var c=this.toRadians(n.lat);n=this.toRadians(d.lng);d=this.toRadians(d.lat);return this.getDistance(b,n,c,d)},convertMC2LL:function(n){if(null===n||void 0===n)return new ta(0,0);var d=new ta(Math.abs(n.lng),Math.abs(n.lat));for(var b=0;b<this.MCBAND.length;b++)if(d.lat>=this.MCBAND[b]){var c=this.MC2LL[b];break}n=this.convertor(n,c);return n=new ta(n.lng.toFixed(6),n.lat.toFixed(6))},convertLL2MC:function(n){if(null===n||void 0===n)return new ta(0,0);if(180<n.lng||
        -180>n.lng||90<n.lat||-90>n.lat)return n;n.lng=this.getLoop(n.lng,-180,180);n.lat=this.getRange(n.lat,-74,74);var d=new ta(n.lng,n.lat);for(var b=0;b<this.LLBAND.length;b++)if(d.lat>=this.LLBAND[b]){var c=this.LL2MC[b];break}if(!c)for(b=0;b<this.LLBAND.length;b++)if(d.lat<=-this.LLBAND[b]){c=this.LL2MC[b];break}n=this.convertor(n,c);return n=new ta(Number(n.lng.toFixed(2)),Number(n.lat.toFixed(2)))},convertor:function(n,d){if(n&&d){var b=d[0]+d[1]*Math.abs(n.lng),c=Math.abs(n.lat)/d[9];d=d[2]+d[3]*
        c+d[4]*c*c+d[5]*c*c*c+d[6]*c*c*c*c+d[7]*c*c*c*c*c+d[8]*c*c*c*c*c*c;b*=0>n.lng?-1:1;d*=0>n.lat?-1:1;return new ta(b,d)}},getDistance:function(n,d,b,c){return this.EARTHRADIUS*Math.acos(Math.sin(b)*Math.sin(c)+Math.cos(b)*Math.cos(c)*Math.cos(d-n))},toRadians:function(n){return Math.PI*n/180},toDegrees:function(n){return 180*n/Math.PI},getRange:function(n,d,b){null!=d&&(n=Math.max(n,d));null!=b&&(n=Math.min(n,b));return n},getLoop:function(n,d,b){for(;n>b;)n-=b-d;for(;n<d;)n+=b-d;return n}});bc(pa.prototype,
    {lngLatToMercator:function(n){return pa.convertLL2MC(n)},lngLatToPoint:function(n){n=pa.convertLL2MC(n);return new cc(n.lng,n.lat)},mercatorToLngLat:function(n){return pa.convertMC2LL(n)},pointToLngLat:function(n){n=new ta(n.x,n.y);return pa.convertMC2LL(n)},pointToPixel:function(n,d,b,c,a){if(n)return n=this.lngLatToMercator(n,a),d=this.getZoomUnits(d),new cc(Math.round((n.lng-b.lng)/d+c.width/2),Math.round((b.lat-n.lat)/d+c.height/2))},pixelToPoint:function(n,d,b,c,a){if(n)return d=this.getZoomUnits(d),
            n=new ta(b.lng+d*(n.x-c.width/2),b.lat-d*(n.y-c.height/2)),this.mercatorToLngLat(n,a)},getZoomUnits:function(n){return Math.pow(2,18-n)}});fa.prototype.setMax=function(n){this.max=n||100};fa.prototype.setMin=function(n){this.min=n||0};fa.prototype.setMaxSize=function(n){this.maxSize=n||35};fa.prototype.setMinSize=function(n){this.minSize=n||0};fa.prototype.initPalette=function(){var n=this.gradient,d=this.paletteCtx=(new Db(256,1)).getContext("2d"),b=d.createLinearGradient(0,0,256,1);Object.keys(n).forEach(function(c){b.addColorStop(parseFloat(c),
    n[c])});d.fillStyle=b;d.fillRect(0,0,256,1);d.imageData=d.getImageData(0,0,256,1).data};fa.prototype.getColor=function(n){n=this.getImageData(n);return"rgba("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]/256+")"};fa.prototype.getImageData=function(n){var d=this.paletteCtx.imageData;if(void 0===n)return d;var b=this.max,c=this.min;n>b&&(n=b);n<c&&(n=c);n=4*Math.floor((n-c)/(b-c)*255);return[d[n],d[n+1],d[n+2],d[n+3]]};fa.prototype.getSize=function(n){var d=this.max,b=this.min,c=this.maxSize,a=this.minSize;n>
d&&(n=d);n<b&&(n=b);return a+(n-b)/(d-b)*(c-a)};ha.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start);this.v3=this._normalizaCoord(this.options.end);this.v1=this._getControlPoint(this.v0,this.v3,4);this.v2=this._getControlPoint(this.v3,this.v0,5);this.v0[2]||(this.v0[2]=0);this.v3[2]||(this.v3[2]=0)};ha.prototype.setOptions=function(n){this.options=n||{};this._initialize()};ha.prototype.getPoints=function(n){void 0===n&&(n=20);for(var d=[],b=0;b<=n;b++)d.push(this._getPoint(b/
    n));return d};ha.prototype._normalizaCoord=function(n){if(!n)return[];n=pa.convertLL2MC({lng:Number(n[0]),lat:Number(n[1])});return[n.lng,n.lat]};ha.prototype._getControlPoint=function(n,d){var b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(db(this._getQuarter(n,d)),[this._getDistance(n,d)/b])};ha.prototype._getQuarter=function(n,d){return[(3*n[0]+d[0])/4,(3*n[1]+d[1])/4]};ha.prototype._getDistance=function(n,d){return Math.sqrt(Math.pow(n[0]-d[0],2)+Math.pow(n[1]-d[1],
    2))};ha.prototype._getPoint=function(n){var d=[],b=this.v0,c=this.v1,a=this.v2,f=this.v3;d.push(kb(n,b[0],c[0],a[0],f[0]),kb(n,b[1],c[1],a[1],f[1]),kb(n,b[2],c[2],a[2],f[2]));return d};var Fb=function(){function n(d){x(this,n);this.options=this.getDefaultOptions();this.autoUpdate=!1;Object.assign(this.options,d);this.options.data&&(this.data=this.options.data)}A(n,[{key:"getDefaultOptions",value:function(){return{}}},{key:"initialize",value:function(d){}},{key:"destroy",value:function(){this.onDestroy&&
    this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(d,b){b=b||{};this.data=d;this.onDataChanged&&this.onDataChanged(this.getData());this.onChanged&&this.onChanged(this.getOptions(),this.getData());!1!==b.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(d){d=d||{};Object.assign(this.options,d);this.onOptionsChanged&&this.onOptionsChanged(this.getOptions());this.onChanged&&this.onChanged(this.getOptions(),
        this.getData());d.data?this.setData(d.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(d){}},{key:"onDataChanged",value:function(d){}},{key:"onChanged",value:function(d,b){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(d,b){}},{key:"setWebglLayer",value:function(d){this.webglLayer=d}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",
    value:function(){return this.autoUpdate}}]);return n}(),ia=function(n){function d(b){x(this,d);return I(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,n);A(d,[{key:"normizedColor",value:function(b){var c=b;b instanceof Array||(c=U(b).unitArray());void 0===c[3]&&(c[3]=1);return c}},{key:"normizedPoint",value:function(b){var c=[0,0],a=this.getOptions();this.webglLayer&&this.webglLayer.options.pointOffset?c=this.webglLayer.options.pointOffset:a.pointOffset&&(c=a.pointOffset);a=Number(b[0]);
        var d=Number(b[1]);-180<=a&&180>=a&&-90<=d&&90>=d&&(d=this.webglLayer.map.lnglatToMercator(a,d),a=d[0],d=d[1]);var k=Number(b[2])||0;this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium&&(a=this.convertLngLat([a,d]),k=window.Cesium.Cartesian3.fromDegrees(a[0],a[1],k),a=k.x,d=k.y,k=k.z);return 3<b.length?[a-c[0],d-c[1],k].concat(db(b.slice(3))):[a-c[0],d-c[1],k]}},{key:"convertLngLat",value:function(b){return[b[0]/2.003750834E7*180,180/Math.PI*(2*Math.atan(Math.exp(b[1]/2.003750834E7*
        180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){return this.webglLayer&&this.webglLayer.options.pointOffset?this.webglLayer.options.pointOffset:[0,0]}}]);return d}(Fb),Gb=function a(d,b,c){x(this,a);b=b||d.canvas.width;c=c||d.canvas.height;var f=d.createFramebuffer(),k=d.createTexture();d.bindTexture(d.TEXTURE_2D,k);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,d.UNSIGNED_BYTE,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,
    d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);f.texture=k;var g=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,g);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,b,c);f.depthBuffer=g;d.bindFramebuffer(d.FRAMEBUFFER,f);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,k,0);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,g);b=d.checkFramebufferStatus(d.FRAMEBUFFER);
    d.FRAMEBUFFER_COMPLETE===b&&(d.bindFramebuffer(d.FRAMEBUFFER,null),d.bindTexture(d.TEXTURE_2D,null),d.bindRenderbuffer(d.RENDERBUFFER,null),this.framebuffer=f)},Hb=function(){function d(b){x(this,d);this.options={};Object.assign(this.options,b);this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}A(d,[{key:"getOptions",value:function(){return this.options}},{key:"render",value:function(b){var c=b.gl;b=b.texture;var a=this.programSample;c.useProgram(a.program);
        var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d);var k=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];c.bufferData(c.ARRAY_BUFFER,new Float32Array(k),c.STATIC_DRAW);c.enableVertexAttribArray(a.attributes.aPos);c.vertexAttribPointer(a.attributes.aPos,3,c.FLOAT,!1,0,0);d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d);c.bufferData(c.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),c.STATIC_DRAW);c.enableVertexAttribArray(a.attributes.aTextureCoord);c.vertexAttribPointer(a.attributes.aTextureCoord,
            2,c.FLOAT,!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,b);c.uniform1i(a.uniforms.uSampler,0);c.drawArrays(c.TRIANGLES,0,k.length/3)}}]);return d}(),Nc=function(d){function b(c){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"getProgram",value:function(b){this.programSample||(this.programSample=new Q(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",
        fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}));
        return this.programSample}},{key:"render",value:function(b){var a=b.gl;b=b.texture;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var c=this.getProgram(a);a.useProgram(c.program);var k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,
        new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aTextureCoord);a.vertexAttribPointer(c.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,b);a.uniform1i(c.uniforms.uSampler,1);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3)}}]);return b}(Hb),Oc=function(d){function b(c){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"getProgram",value:function(b){this.programSample||
    (this.programSample=new Q(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform sampler2D uSampler;uniform vec2 canvasSize;uniform float blurSize;varying vec2 vTextureCoord;void main(){vec4 blur=texture2D(uSampler,vTextureCoord);vec3 hdrColor=blur.rgb;float stepSizeX=blurSize/canvasSize.x/5.0;float stepSizeY=blurSize/canvasSize.y/5.0;for(float i=-5.0;i<=5.0;i+=1.){for(float j=-5.0;j<=5.0;j+=1.){blur+=texture2D(uSampler,vTextureCoord+vec2(i*stepSizeX,j*stepSizeY));}}blur.rgba=blur.rgba/(11.0*11.0);hdrColor=(hdrColor.rgb+blur.rgb)/2.0;float gamma=2.2;float exposure=4.0;vec3 mapped=vec3(1.0)-exp(-hdrColor*exposure);mapped=pow(mapped,vec3(1.0/gamma));vec4 color=vec4(mapped,blur.a);if(color.r==0.0&&color.g==0.0&&color.b==0.0){discard;}gl_FragColor=color;}"}));
        return this.programSample}},{key:"render",value:function(b){var a=b.gl;b=b.texture;var c=this.getOptions();a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var k=this.getProgram(a);a.useProgram(k.program);var g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(k.attributes.aPos);a.vertexAttribPointer(k.attributes.aPos,3,a.FLOAT,!1,0,0);g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
        g);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(k.attributes.aTextureCoord);a.vertexAttribPointer(k.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,b);a.uniform1i(k.uniforms.uSampler,1);a.uniform2fv(k.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.uniform1f(k.uniforms.blurSize,c.blurSize||5);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3)}}]);return b}(Hb),Pc=function(d){function b(c){x(this,
    b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"getProgram",value:function(b){this.programSample||(this.programSample=new Q(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"}));
        return this.programSample}},{key:"render",value:function(b){var a=b.gl;b=b.texture;var c=this.getProgram(a);a.useProgram(c.program);var k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aTextureCoord);
        a.vertexAttribPointer(c.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,b);a.uniform1i(c.uniforms.uSampler,1);a.uniform2fv(c.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3)}}]);return b}(Hb),mc=function(){function d(b){x(this,d);this.gl=b;this.effects=[];this.initFbo()}A(d,[{key:"addEffect",value:function(b){this.effects.push(b)}},{key:"removeEffect",value:function(b){}},{key:"setEffects",value:function(b){this.effects=
        b}},{key:"initFbo",value:function(){var b=this.gl;this.fbo=[new Gb(b),new Gb(b)]}},{key:"render",value:function(){var b=this.gl,c=this.effects;if(c&&0<c.length)for(var a={},d=0;d<c.length;d++){var k=this.fbo[d%2].framebuffer;b.bindFramebuffer(b.FRAMEBUFFER,k);var g=[0,0,0,0];b.clearColor(g[0],g[1],g[2],g[3]);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);d===c.length-1&&b.bindFramebuffer(b.FRAMEBUFFER,null);c[d].render({gl:b,texture:a.texture});a=k}}}]);return d}(),ja=ca(function(d,b){Object.defineProperty(b,
    "__esModule",{value:!0});b.setMatrixArrayType=function(c){b.ARRAY_TYPE=a=c};b.toRadian=function(a){return a*f};b.equals=function(a,b){return Math.abs(a-b)<=c*Math.max(1,Math.abs(a),Math.abs(b))};b.RANDOM=b.ARRAY_TYPE=b.EPSILON=void 0;var c=1E-6;b.EPSILON=c;var a="undefined"!==typeof Float32Array?Float32Array:Array;b.ARRAY_TYPE=a;b.RANDOM=Math.random;var f=Math.PI/180});O(ja);var nc=ca(function(d,b){function c(a,b,e){var c=b[0],k=b[1],g=b[2];b=b[3];var h=e[0],m=e[1],d=e[2];e=e[3];a[0]=c*h+g*m;a[1]=
    k*h+b*m;a[2]=c*d+g*e;a[3]=k*d+b*e;return a}function a(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new f.ARRAY_TYPE(4);f.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0);a[0]=1;a[3]=1;return a};b.clone=function(a){var b=new f.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=
    0;a[3]=1;return a};b.fromValues=function(a,b,e,c){var k=new f.ARRAY_TYPE(4);k[0]=a;k[1]=b;k[2]=e;k[3]=c;return k};b.set=function(a,b,e,c,d){a[0]=b;a[1]=e;a[2]=c;a[3]=d;return a};b.transpose=function(a,b){if(a===b){var e=b[1];a[1]=b[2];a[2]=e}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};b.invert=function(a,b){var e=b[0],c=b[1],k=b[2];b=b[3];var g=e*b-k*c;if(!g)return null;g=1/g;a[0]=b*g;a[1]=-c*g;a[2]=-k*g;a[3]=e*g;return a};b.adjoint=function(a,b){var e=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];
    a[3]=e;return a};b.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};b.multiply=c;b.rotate=function(a,b,e){var c=b[0],k=b[1],g=b[2];b=b[3];var h=Math.sin(e);e=Math.cos(e);a[0]=c*e+g*h;a[1]=k*e+b*h;a[2]=c*-h+g*e;a[3]=k*-h+b*e;return a};b.scale=function(a,b,e){var c=b[1],k=b[2],g=b[3],h=e[0];e=e[1];a[0]=b[0]*h;a[1]=c*h;a[2]=k*e;a[3]=g*e;return a};b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;
    a[3]=b[1];return a};b.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};b.LDU=function(a,b,e,c){a[2]=c[2]/c[0];e[0]=c[0];e[1]=c[1];e[3]=c[3]-a[2]*e[1];return[a,b,e]};b.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];return a};b.subtract=a;b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b){var e=a[0],c=a[1],k=a[2];a=a[3];var g=b[0],h=b[1],m=b[2];b=b[3];return Math.abs(e-g)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))&&Math.abs(c-h)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(k-m)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(m))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;return a};b.multiplyScalarAndAdd=function(a,b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*
    c;a[3]=b[3]+e[3]*c;return a};b.sub=b.mul=void 0;var f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,e):{};c.get||c.set?Object.defineProperty(b,e,c):b[e]=a[e]}b.default=a;return b}(ja);b.mul=c;b.sub=a});O(nc);var oc=ca(function(d,b){function c(a,b,e){var c=b[0],k=b[1],g=b[2],h=b[3],m=b[4];b=b[5];var d=e[0],v=e[1],B=e[2],f=e[3],ba=
    e[4];e=e[5];a[0]=c*d+g*v;a[1]=k*d+h*v;a[2]=c*B+g*f;a[3]=k*B+h*f;a[4]=c*ba+g*e+m;a[5]=k*ba+h*e+b;return a}function a(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new f.ARRAY_TYPE(6);f.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[4]=0,a[5]=0);a[0]=1;a[3]=1;return a};b.clone=function(a){var b=new f.ARRAY_TYPE(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];
    return b};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};b.fromValues=function(a,b,e,c,d,r){var h=new f.ARRAY_TYPE(6);h[0]=a;h[1]=b;h[2]=e;h[3]=c;h[4]=d;h[5]=r;return h};b.set=function(a,b,e,c,d,f,h){a[0]=b;a[1]=e;a[2]=c;a[3]=d;a[4]=f;a[5]=h;return a};b.invert=function(a,b){var e=b[0],c=b[1],k=b[2],g=b[3],h=b[4];b=b[5];var m=e*g-c*k;if(!m)return null;m=1/m;a[0]=g*m;a[1]=-c*m;a[2]=
    -k*m;a[3]=e*m;a[4]=(k*b-g*h)*m;a[5]=(c*h-e*b)*m;return a};b.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};b.multiply=c;b.rotate=function(a,b,e){var c=b[0],k=b[1],g=b[2],h=b[3],m=b[4];b=b[5];var d=Math.sin(e);e=Math.cos(e);a[0]=c*e+g*d;a[1]=k*e+h*d;a[2]=c*-d+g*e;a[3]=k*-d+h*e;a[4]=m;a[5]=b;return a};b.scale=function(a,b,e){var c=b[1],k=b[2],d=b[3],h=b[4],m=b[5],g=e[0];e=e[1];a[0]=b[0]*g;a[1]=c*g;a[2]=k*e;a[3]=d*e;a[4]=h;a[5]=m;return a};b.translate=function(a,b,e){var c=b[0],d=b[1],k=b[2],h=
    b[3],m=b[4];b=b[5];var g=e[0];e=e[1];a[0]=c;a[1]=d;a[2]=k;a[3]=h;a[4]=c*g+k*e+m;a[5]=d*g+h*e+b;return a};b.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;a[4]=0;a[5]=0;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};b.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],
    2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};b.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];return a};b.subtract=a;b.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;return a};b.multiplyScalarAndAdd=function(a,b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*c;a[3]=b[3]+e[3]*c;a[4]=b[4]+e[4]*c;a[5]=b[5]+e[5]*c;return a};b.exactEquals=
    function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};b.equals=function(a,b){var e=a[0],c=a[1],d=a[2],g=a[3],h=a[4];a=a[5];var m=b[0],p=b[1],v=b[2],k=b[3],Ib=b[4];b=b[5];return Math.abs(e-m)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(m))&&Math.abs(c-p)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(d-v)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))&&Math.abs(g-k)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(h-Ib)<=f.EPSILON*Math.max(1,
    Math.abs(h),Math.abs(Ib))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.sub=b.mul=void 0;var f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,e):{};c.get||c.set?Object.defineProperty(b,e,c):b[e]=a[e]}b.default=a;return b}(ja);b.mul=c;b.sub=a});O(oc);var eb=ca(function(d,b){function c(a,b,e){var c=b[0],d=b[1],g=b[2],
    h=b[3],m=b[4],p=b[5],v=b[6],k=b[7];b=b[8];var f=e[0],ba=e[1],z=e[2],F=e[3],D=e[4],C=e[5],E=e[6],G=e[7];e=e[8];a[0]=f*c+ba*h+z*v;a[1]=f*d+ba*m+z*k;a[2]=f*g+ba*p+z*b;a[3]=F*c+D*h+C*v;a[4]=F*d+D*m+C*k;a[5]=F*g+D*p+C*b;a[6]=E*c+G*h+e*v;a[7]=E*d+G*m+e*k;a[8]=E*g+G*p+e*b;return a}function a(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];a[6]=b[6]-e[6];a[7]=b[7]-e[7];a[8]=b[8]-e[8];return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=
    new f.ARRAY_TYPE(9);f.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0);a[0]=1;a[4]=1;a[8]=1;return a};b.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};b.clone=function(a){var b=new f.ARRAY_TYPE(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=
    b[8];return a};b.fromValues=function(a,b,e,c,d,r,h,m,p){var l=new f.ARRAY_TYPE(9);l[0]=a;l[1]=b;l[2]=e;l[3]=c;l[4]=d;l[5]=r;l[6]=h;l[7]=m;l[8]=p;return l};b.set=function(a,b,e,c,d,f,h,m,p,v){a[0]=b;a[1]=e;a[2]=c;a[3]=d;a[4]=f;a[5]=h;a[6]=m;a[7]=p;a[8]=v;return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.transpose=function(a,b){if(a===b){var e=b[1],c=b[2],d=b[5];a[1]=b[3];a[2]=b[6];a[3]=e;a[5]=b[7];a[6]=c;a[7]=d}else a[0]=b[0],a[1]=b[3],a[2]=
    b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};b.invert=function(a,b){var c=b[0],l=b[1],d=b[2],g=b[3],h=b[4],m=b[5],p=b[6],v=b[7];b=b[8];var k=b*h-m*v,f=-b*g+m*p,ba=v*g-h*p,z=c*k+l*f+d*ba;if(!z)return null;z=1/z;a[0]=k*z;a[1]=(-b*l+d*v)*z;a[2]=(m*l-d*h)*z;a[3]=f*z;a[4]=(b*c-d*p)*z;a[5]=(-m*c+d*g)*z;a[6]=ba*z;a[7]=(-v*c+l*p)*z;a[8]=(h*c-l*g)*z;return a};b.adjoint=function(a,b){var c=b[0],l=b[1],d=b[2],g=b[3],h=b[4],m=b[5],p=b[6],v=b[7];b=b[8];a[0]=h*b-m*v;a[1]=d*v-l*b;a[2]=
    l*m-d*h;a[3]=m*p-g*b;a[4]=c*b-d*p;a[5]=d*g-c*m;a[6]=g*v-h*p;a[7]=l*p-c*v;a[8]=c*h-l*g;return a};b.determinant=function(a){var b=a[3],c=a[4],l=a[5],d=a[6],k=a[7],h=a[8];return a[0]*(h*c-l*k)+a[1]*(-h*b+l*d)+a[2]*(k*b-c*d)};b.multiply=c;b.translate=function(a,b,c){var e=b[0],d=b[1],g=b[2],h=b[3],m=b[4],p=b[5],v=b[6],B=b[7];b=b[8];var k=c[0];c=c[1];a[0]=e;a[1]=d;a[2]=g;a[3]=h;a[4]=m;a[5]=p;a[6]=k*e+c*h+v;a[7]=k*d+c*m+B;a[8]=k*g+c*p+b;return a};b.rotate=function(a,b,c){var e=b[0],d=b[1],g=b[2],h=b[3],
    m=b[4],p=b[5],v=b[6],B=b[7];b=b[8];var k=Math.sin(c);c=Math.cos(c);a[0]=c*e+k*h;a[1]=c*d+k*m;a[2]=c*g+k*p;a[3]=c*h-k*e;a[4]=c*m-k*d;a[5]=c*p-k*g;a[6]=v;a[7]=B;a[8]=b;return a};b.scale=function(a,b,c){var e=c[0];c=c[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};b.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);
    a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};b.fromQuat=function(a,b){var c=b[0],l=b[1],d=b[2];b=b[3];var g=c+c,h=l+l,m=d+d;c*=g;var p=l*g;l*=h;var v=d*g,B=d*h;d*=m;g*=b;h*=b;b*=m;a[0]=1-l-d;a[3]=p-b;a[6]=v+h;a[1]=p+b;a[4]=1-c-d;a[7]=B-g;a[2]=v-h;a[5]=
    B+g;a[8]=1-c-l;return a};b.normalFromMat4=function(a,b){var c=b[0],l=b[1],d=b[2],g=b[3],h=b[4],m=b[5],p=b[6],v=b[7],B=b[8],f=b[9],k=b[10],z=b[11],F=b[12],D=b[13],C=b[14];b=b[15];var E=c*m-l*h,G=c*p-d*h,Ra=c*v-g*h,P=l*p-d*m,w=l*v-g*m,L=d*v-g*p,Zb=B*D-f*F,x=B*C-k*F;B=B*b-z*F;var A=f*C-k*D;f=f*b-z*D;k=k*b-z*C;z=E*k-G*f+Ra*A+P*B-w*x+L*Zb;if(!z)return null;z=1/z;a[0]=(m*k-p*f+v*A)*z;a[1]=(p*B-h*k-v*x)*z;a[2]=(h*f-m*B+v*Zb)*z;a[3]=(d*f-l*k-g*A)*z;a[4]=(c*k-d*B+g*x)*z;a[5]=(l*B-c*f-g*Zb)*z;a[6]=(D*L-C*w+
    b*P)*z;a[7]=(C*Ra-F*L-b*G)*z;a[8]=(F*w-D*Ra+b*E)*z;return a};b.projection=function(a,b,c){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/c;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};b.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};b.add=function(a,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};b.subtract=a;b.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};b.multiplyScalarAndAdd=function(a,b,c,l){a[0]=b[0]+c[0]*l;a[1]=b[1]+c[1]*l;a[2]=b[2]+c[2]*l;a[3]=b[3]+c[3]*l;a[4]=b[4]+c[4]*l;a[5]=b[5]+c[5]*l;a[6]=b[6]+c[6]*l;a[7]=b[7]+c[7]*l;a[8]=b[8]+c[8]*
    l;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};b.equals=function(a,b){var c=a[0],l=a[1],d=a[2],g=a[3],h=a[4],m=a[5],p=a[6],v=a[7];a=a[8];var B=b[0],Ib=b[1],k=b[2],z=b[3],F=b[4],D=b[5],C=b[6],E=b[7];b=b[8];return Math.abs(c-B)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(l-Ib)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(Ib))&&Math.abs(d-k)<=f.EPSILON*Math.max(1,Math.abs(d),
    Math.abs(k))&&Math.abs(g-z)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(h-F)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(m-D)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(p-C)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(v-E)<=f.EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.sub=b.mul=void 0;var f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,
    c)){var l=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};l.get||l.set?Object.defineProperty(b,c,l):b[c]=a[c]}b.default=a;return b}(ja);b.mul=c;b.sub=a});O(eb);var Lb=ca(function(d,b){function c(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function a(a,b,c){var e=b[0],h=b[1],m=b[2],d=b[3],l=b[4],B=b[5],f=b[6],g=b[7],k=b[8],t=b[9],D=b[10],C=b[11],E=b[12],G=b[13],Ra=b[14];
    b=b[15];var P=c[0],w=c[1],L=c[2],x=c[3];a[0]=P*e+w*l+L*k+x*E;a[1]=P*h+w*B+L*t+x*G;a[2]=P*m+w*f+L*D+x*Ra;a[3]=P*d+w*g+L*C+x*b;P=c[4];w=c[5];L=c[6];x=c[7];a[4]=P*e+w*l+L*k+x*E;a[5]=P*h+w*B+L*t+x*G;a[6]=P*m+w*f+L*D+x*Ra;a[7]=P*d+w*g+L*C+x*b;P=c[8];w=c[9];L=c[10];x=c[11];a[8]=P*e+w*l+L*k+x*E;a[9]=P*h+w*B+L*t+x*G;a[10]=P*m+w*f+L*D+x*Ra;a[11]=P*d+w*g+L*C+x*b;P=c[12];w=c[13];L=c[14];x=c[15];a[12]=P*e+w*l+L*k+x*E;a[13]=P*h+w*B+L*t+x*G;a[14]=P*m+w*f+L*D+x*Ra;a[15]=P*d+w*g+L*C+x*b;return a}function f(a,b,c){var e=
    b[0],h=b[1],m=b[2],d=b[3],l=e+e,B=h+h,f=m+m;b=e*l;var g=e*B;e*=f;var k=h*B;h*=f;m*=f;l*=d;B*=d;d*=f;a[0]=1-(k+m);a[1]=g+d;a[2]=e-B;a[3]=0;a[4]=g-d;a[5]=1-(b+m);a[6]=h+l;a[7]=0;a[8]=e+B;a[9]=h-l;a[10]=1-(b+k);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function k(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];
    a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=new g.ARRAY_TYPE(16);g.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};b.clone=function(a){var b=new g.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];
    b[15]=a[15];return b};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};b.fromValues=function(a,b,c,d,h,m,p,v,B,f,k,z,F,D,C,E){var e=new g.ARRAY_TYPE(16);e[0]=a;e[1]=b;e[2]=c;e[3]=d;e[4]=h;e[5]=m;e[6]=p;e[7]=v;e[8]=B;e[9]=f;e[10]=k;e[11]=z;e[12]=F;e[13]=D;e[14]=C;e[15]=E;return e};b.set=function(a,b,c,d,h,m,p,v,B,f,g,k,F,D,C,E,G){a[0]=b;a[1]=c;a[2]=
    d;a[3]=h;a[4]=m;a[5]=p;a[6]=v;a[7]=B;a[8]=f;a[9]=g;a[10]=k;a[11]=F;a[12]=D;a[13]=C;a[14]=E;a[15]=G;return a};b.identity=c;b.transpose=function(a,b){if(a===b){var c=b[1],e=b[2],h=b[3],d=b[6],l=b[7],v=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=d;a[11]=b[14];a[12]=h;a[13]=l;a[14]=v}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};
    b.invert=function(a,b){var c=b[0],e=b[1],h=b[2],d=b[3],l=b[4],v=b[5],B=b[6],f=b[7],g=b[8],k=b[9],F=b[10],D=b[11],C=b[12],E=b[13],G=b[14];b=b[15];var w=c*v-e*l,x=c*B-h*l,A=c*f-d*l,L=e*B-h*v,H=e*f-d*v,I=h*f-d*B,Jb=g*E-k*C,K=g*G-F*C,R=g*b-D*C,Kb=k*G-F*E,W=k*b-D*E,U=F*b-D*G,S=w*U-x*W+A*Kb+L*R-H*K+I*Jb;if(!S)return null;S=1/S;a[0]=(v*U-B*W+f*Kb)*S;a[1]=(h*W-e*U-d*Kb)*S;a[2]=(E*I-G*H+b*L)*S;a[3]=(F*H-k*I-D*L)*S;a[4]=(B*R-l*U-f*K)*S;a[5]=(c*U-h*R+d*K)*S;a[6]=(G*A-C*I-b*x)*S;a[7]=(g*I-F*A+D*x)*S;a[8]=(l*
        W-v*R+f*Jb)*S;a[9]=(e*R-c*W-d*Jb)*S;a[10]=(C*H-E*A+b*w)*S;a[11]=(k*A-g*H-D*w)*S;a[12]=(v*K-l*Kb-B*Jb)*S;a[13]=(c*Kb-e*K+h*Jb)*S;a[14]=(E*x-C*L-G*w)*S;a[15]=(g*L-k*x+F*w)*S;return a};b.adjoint=function(a,b){var c=b[0],e=b[1],h=b[2],d=b[3],l=b[4],v=b[5],f=b[6],g=b[7],k=b[8],z=b[9],F=b[10],D=b[11],C=b[12],E=b[13],G=b[14];b=b[15];a[0]=v*(F*b-D*G)-z*(f*b-g*G)+E*(f*D-g*F);a[1]=-(e*(F*b-D*G)-z*(h*b-d*G)+E*(h*D-d*F));a[2]=e*(f*b-g*G)-v*(h*b-d*G)+E*(h*g-d*f);a[3]=-(e*(f*D-g*F)-v*(h*D-d*F)+z*(h*g-d*f));a[4]=
        -(l*(F*b-D*G)-k*(f*b-g*G)+C*(f*D-g*F));a[5]=c*(F*b-D*G)-k*(h*b-d*G)+C*(h*D-d*F);a[6]=-(c*(f*b-g*G)-l*(h*b-d*G)+C*(h*g-d*f));a[7]=c*(f*D-g*F)-l*(h*D-d*F)+k*(h*g-d*f);a[8]=l*(z*b-D*E)-k*(v*b-g*E)+C*(v*D-g*z);a[9]=-(c*(z*b-D*E)-k*(e*b-d*E)+C*(e*D-d*z));a[10]=c*(v*b-g*E)-l*(e*b-d*E)+C*(e*g-d*v);a[11]=-(c*(v*D-g*z)-l*(e*D-d*z)+k*(e*g-d*v));a[12]=-(l*(z*G-F*E)-k*(v*G-f*E)+C*(v*F-f*z));a[13]=c*(z*G-F*E)-k*(e*G-h*E)+C*(e*F-h*z);a[14]=-(c*(v*G-f*E)-l*(e*G-h*E)+C*(e*f-h*v));a[15]=c*(v*F-f*z)-l*(e*F-h*z)+k*
        (e*f-h*v);return a};b.determinant=function(a){var b=a[0],c=a[1],e=a[2],h=a[3],d=a[4],p=a[5],v=a[6],f=a[7],g=a[8],k=a[9],z=a[10],F=a[11],D=a[12],C=a[13],E=a[14];a=a[15];return(b*p-c*d)*(z*a-F*E)-(b*v-e*d)*(k*a-F*C)+(b*f-h*d)*(k*E-z*C)+(c*v-e*p)*(g*a-F*D)-(c*f-h*p)*(g*E-z*D)+(e*f-h*v)*(g*C-k*D)};b.multiply=a;b.translate=function(a,b,c){var e=c[0],h=c[1];c=c[2];if(b===a)a[12]=b[0]*e+b[4]*h+b[8]*c+b[12],a[13]=b[1]*e+b[5]*h+b[9]*c+b[13],a[14]=b[2]*e+b[6]*h+b[10]*c+b[14],a[15]=b[3]*e+b[7]*h+b[11]*c+b[15];
    else{var d=b[0];var p=b[1];var v=b[2];var l=b[3];var f=b[4];var g=b[5];var k=b[6];var t=b[7];var D=b[8];var C=b[9];var E=b[10];var G=b[11];a[0]=d;a[1]=p;a[2]=v;a[3]=l;a[4]=f;a[5]=g;a[6]=k;a[7]=t;a[8]=D;a[9]=C;a[10]=E;a[11]=G;a[12]=d*e+f*h+D*c+b[12];a[13]=p*e+g*h+C*c+b[13];a[14]=v*e+k*h+E*c+b[14];a[15]=l*e+t*h+G*c+b[15]}return a};b.scale=function(a,b,c){var e=c[0],h=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=
        b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};b.rotate=function(a,b,c,d){var e=d[0],m=d[1];d=d[2];var p=Math.sqrt(e*e+m*m+d*d);if(p<g.EPSILON)return null;p=1/p;e*=p;m*=p;d*=p;var v=Math.sin(c);var l=Math.cos(c);var f=1-l;c=b[0];p=b[1];var k=b[2];var t=b[3];var r=b[4];var D=b[5];var C=b[6];var E=b[7];var G=b[8];var w=b[9];var x=b[10];var A=b[11];var L=e*e*f+l;var H=m*e*f+d*v;var I=d*e*f-m*v;var K=e*m*f-d*v;var R=m*m*f+l;var W=d*m*f+e*v;var U=e*d*f+m*v;e=m*d*f-e*v;
        m=d*d*f+l;a[0]=c*L+r*H+G*I;a[1]=p*L+D*H+w*I;a[2]=k*L+C*H+x*I;a[3]=t*L+E*H+A*I;a[4]=c*K+r*R+G*W;a[5]=p*K+D*R+w*W;a[6]=k*K+C*R+x*W;a[7]=t*K+E*R+A*W;a[8]=c*U+r*e+G*m;a[9]=p*U+D*e+w*m;a[10]=k*U+C*e+x*m;a[11]=t*U+E*e+A*m;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};b.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var h=b[4],d=b[5],p=b[6],v=b[7],l=b[8],f=b[9],g=b[10],k=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=
        h*c+l*e;a[5]=d*c+f*e;a[6]=p*c+g*e;a[7]=v*c+k*e;a[8]=l*c-h*e;a[9]=f*c-d*e;a[10]=g*c-p*e;a[11]=k*c-v*e;return a};b.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var h=b[0],d=b[1],p=b[2],v=b[3],f=b[8],l=b[9],g=b[10],k=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*c-f*e;a[1]=d*c-l*e;a[2]=p*c-g*e;a[3]=v*c-k*e;a[8]=h*e+f*c;a[9]=d*e+l*c;a[10]=p*e+g*c;a[11]=v*e+k*c;return a};b.rotateZ=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);
        var h=b[0],d=b[1],p=b[2],v=b[3],f=b[4],l=b[5],g=b[6],k=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*c+f*e;a[1]=d*c+l*e;a[2]=p*c+g*e;a[3]=v*c+k*e;a[4]=f*c-h*e;a[5]=l*c-d*e;a[6]=g*c-p*e;a[7]=k*c-v*e;return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=
        0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,b,c){var e=c[0],h=c[1];c=c[2];var d=Math.sqrt(e*e+h*h+c*c);if(d<g.EPSILON)return null;d=1/d;e*=d;h*=d;c*=d;d=Math.sin(b);b=Math.cos(b);var p=1-b;a[0]=e*e*p+b;a[1]=h*e*p+c*d;a[2]=c*e*p-h*d;a[3]=0;a[4]=e*h*p-c*d;a[5]=h*h*p+b;a[6]=c*h*p+e*d;a[7]=0;a[8]=e*c*p+h*d;a[9]=h*c*p-e*d;a[10]=c*c*p+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,b){var c=
        Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=
        0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=f;b.fromQuat2=function(a,b){var c=new g.ARRAY_TYPE(3),e=-b[0],h=-b[1],d=-b[2],p=b[3],v=b[4],l=b[5],k=b[6],ba=b[7],z=e*e+h*h+d*d+p*p;0<z?(c[0]=2*(v*p+ba*e+l*d-k*h)/z,c[1]=2*(l*p+ba*h+k*e-v*d)/z,c[2]=2*(k*p+ba*d+v*h-l*e)/z):(c[0]=2*(v*p+ba*e+l*d-k*h),c[1]=2*(l*p+ba*h+k*e-v*d),c[2]=2*(k*p+ba*d+v*h-l*e));f(a,b,c);return a};b.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};b.getScaling=function(a,b){var c=b[0],d=b[1],
        h=b[2],e=b[4],p=b[5],v=b[6],f=b[8],g=b[9];b=b[10];a[0]=Math.sqrt(c*c+d*d+h*h);a[1]=Math.sqrt(e*e+p*p+v*v);a[2]=Math.sqrt(f*f+g*g+b*b);return a};b.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*
        c,a[2]=(b[6]+b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};b.fromRotationTranslationScale=function(a,b,c,d){var h=b[0],e=b[1],p=b[2],v=b[3],f=h+h,g=e+e,l=p+p;b=h*f;var k=h*g;h*=l;var t=e*g;e*=l;p*=l;f*=v;g*=v;v*=l;l=d[0];var r=d[1];d=d[2];a[0]=(1-(t+p))*l;a[1]=(k+v)*l;a[2]=(h-g)*l;a[3]=0;a[4]=(k-v)*r;a[5]=(1-(b+p))*r;a[6]=(e+f)*r;a[7]=0;a[8]=(h+g)*d;a[9]=(e-f)*d;a[10]=(1-(b+t))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=
        1;return a};b.fromRotationTranslationScaleOrigin=function(a,b,c,d,h){var e=b[0],p=b[1],v=b[2],f=b[3],g=e+e,l=p+p,k=v+v;b=e*g;var t=e*l,r=e*k;e=p*l;p*=k;var C=v*k;v=f*g;l*=f;var E=f*k,G=d[0],w=d[1];k=d[2];d=h[0];f=h[1];h=h[2];g=(1-(e+C))*G;var x=(t+E)*G;G*=r-l;t=(t-E)*w;C=(1-(b+C))*w;w*=p+v;r=(r+l)*k;p=(p-v)*k;b=(1-(b+e))*k;a[0]=g;a[1]=x;a[2]=G;a[3]=0;a[4]=t;a[5]=C;a[6]=w;a[7]=0;a[8]=r;a[9]=p;a[10]=b;a[11]=0;a[12]=c[0]+d-(g*d+t*f+r*h);a[13]=c[1]+f-(x*d+C*f+p*h);a[14]=c[2]+h-(G*d+w*f+b*h);a[15]=1;return a};
    b.fromQuat=function(a,b){var c=b[0],d=b[1],h=b[2];b=b[3];var e=c+c,p=d+d,v=h+h;c*=e;var f=d*e;d*=p;var g=h*e,l=h*p;h*=v;e*=b;p*=b;b*=v;a[0]=1-d-h;a[1]=f+b;a[2]=g-p;a[3]=0;a[4]=f-b;a[5]=1-c-h;a[6]=l+e;a[7]=0;a[8]=g+p;a[9]=l-e;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,b,c,d,h,m,p){var e=1/(c-b),f=1/(h-d),g=1/(m-p);a[0]=2*m*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*m*f;a[6]=0;a[7]=0;a[8]=(c+b)*e;a[9]=(h+d)*f;a[10]=(p+m)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=p*m*2*g;a[15]=
        0;return a};b.perspective=function(a,b,c,d,h){b=1/Math.tan(b/2);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=h&&Infinity!==h?(c=1/(d-h),a[10]=(h+d)*c,a[14]=2*h*d*c):(a[10]=-1,a[14]=-2*d);return a};b.perspectiveFromFieldOfView=function(a,b,c,d){var h=Math.tan(b.upDegrees*Math.PI/180),e=Math.tan(b.downDegrees*Math.PI/180),p=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var v=2/(p+b),f=2/(h+e);a[0]=v;a[1]=
        0;a[2]=0;a[3]=0;a[4]=0;a[5]=f;a[6]=0;a[7]=0;a[8]=-((p-b)*v*.5);a[9]=(h-e)*f*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};b.ortho=function(a,b,c,d,h,m,p){var e=1/(b-c),f=1/(d-h),g=1/(m-p);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*f;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*g;a[11]=0;a[12]=(b+c)*e;a[13]=(h+d)*f;a[14]=(p+m)*g;a[15]=1;return a};b.lookAt=function(a,b,d,f){var h=b[0],e=b[1];b=b[2];var p=f[0];var v=f[1];var B=f[2];var k=d[0];f=d[1];var l=d[2];if(Math.abs(h-k)<
        g.EPSILON&&Math.abs(e-f)<g.EPSILON&&Math.abs(b-l)<g.EPSILON)return c(a);d=h-k;f=e-f;k=b-l;var z=1/Math.sqrt(d*d+f*f+k*k);d*=z;f*=z;k*=z;l=v*k-B*f;B=B*d-p*k;p=p*f-v*d;(z=Math.sqrt(l*l+B*B+p*p))?(z=1/z,l*=z,B*=z,p*=z):p=B=l=0;v=f*p-k*B;var t=k*l-d*p;var r=d*B-f*l;(z=Math.sqrt(v*v+t*t+r*r))?(z=1/z,v*=z,t*=z,r*=z):r=t=v=0;a[0]=l;a[1]=v;a[2]=d;a[3]=0;a[4]=B;a[5]=t;a[6]=f;a[7]=0;a[8]=p;a[9]=r;a[10]=k;a[11]=0;a[12]=-(l*h+B*e+p*b);a[13]=-(v*h+t*e+r*b);a[14]=-(d*h+f*e+k*b);a[15]=1;return a};b.targetTo=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   b,c,d){var h=b[0],e=b[1];b=b[2];var p=d[0],v=d[1],f=d[2];d=h-c[0];var g=e-c[1];c=b-c[2];var k=d*d+g*g+c*c;0<k&&(k=1/Math.sqrt(k),d*=k,g*=k,c*=k);var l=v*c-f*g;f=f*d-p*c;p=p*g-v*d;k=l*l+f*f+p*p;0<k&&(k=1/Math.sqrt(k),l*=k,f*=k,p*=k);a[0]=l;a[1]=f;a[2]=p;a[3]=0;a[4]=g*p-c*f;a[5]=c*l-d*p;a[6]=d*f-g*l;a[7]=0;a[8]=d;a[9]=g;a[10]=c;a[11]=0;a[12]=h;a[13]=e;a[14]=b;a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+
        ", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=
        b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};b.subtract=k;b.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};b.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+
        c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===
        b[14]&&a[15]===b[15]};b.equals=function(a,b){var c=a[0],d=a[1],h=a[2],m=a[3],f=a[4],v=a[5],e=a[6],k=a[7],l=a[8],z=a[9],F=a[10],D=a[11],C=a[12],E=a[13],G=a[14];a=a[15];var w=b[0],x=b[1],A=b[2],L=b[3],H=b[4],I=b[5],K=b[6],R=b[7],W=b[8],U=b[9],N=b[10],Q=b[11],S=b[12],M=b[13],O=b[14];b=b[15];return Math.abs(c-w)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(d-x)<=g.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(h-A)<=g.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-L)<=g.EPSILON*
        Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(f-H)<=g.EPSILON*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(v-I)<=g.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(e-K)<=g.EPSILON*Math.max(1,Math.abs(e),Math.abs(K))&&Math.abs(k-R)<=g.EPSILON*Math.max(1,Math.abs(k),Math.abs(R))&&Math.abs(l-W)<=g.EPSILON*Math.max(1,Math.abs(l),Math.abs(W))&&Math.abs(z-U)<=g.EPSILON*Math.max(1,Math.abs(z),Math.abs(U))&&Math.abs(F-N)<=g.EPSILON*Math.max(1,Math.abs(F),Math.abs(N))&&Math.abs(D-Q)<=g.EPSILON*Math.max(1,
            Math.abs(D),Math.abs(Q))&&Math.abs(C-S)<=g.EPSILON*Math.max(1,Math.abs(C),Math.abs(S))&&Math.abs(E-M)<=g.EPSILON*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(G-O)<=g.EPSILON*Math.max(1,Math.abs(G),Math.abs(O))&&Math.abs(a-b)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.sub=b.mul=void 0;var g=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,
        c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ja);b.mul=a;b.sub=k});O(Lb);var Mb=ca(function(d,b){function c(){var a=new p.ARRAY_TYPE(3);p.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);return a}function a(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)}function f(a,b,c){var d=new p.ARRAY_TYPE(3);d[0]=a;d[1]=b;d[2]=c;return d}function k(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function g(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*
    c[2];return a}function e(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function l(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)}function t(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}function r(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a}function h(a,b){var c=b[0],d=b[1],h=b[2];c=c*c+d*d+h*h;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}function m(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(b,
    "__esModule",{value:!0});b.create=c;b.clone=function(a){var b=new p.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};b.length=a;b.fromValues=f;b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};b.set=function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a};b.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};b.subtract=k;b.multiply=g;b.divide=e;b.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};b.floor=function(a,b){a[0]=Math.floor(b[0]);
    a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};b.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};b.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};b.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};b.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};b.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;
    a[2]=b[2]+c[2]*d;return a};b.distance=l;b.squaredDistance=t;b.squaredLength=r;b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};b.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};b.normalize=h;b.dot=m;b.cross=function(a,b,c){var d=b[0],h=b[1];b=b[2];var m=c[0],f=c[1];c=c[2];a[0]=h*c-b*f;a[1]=b*m-d*c;a[2]=d*f-h*m;return a};b.lerp=function(a,b,c,d){var h=b[0],m=b[1];b=b[2];a[0]=h+d*(c[0]-h);a[1]=m+d*(c[1]-m);a[2]=b+d*(c[2]-b);return a};b.hermite=function(a,b,c,d,h,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                m){var f=m*m,p=f*(2*m-3)+1,e=f*(m-2)+m,g=f*(m-1);m=f*(3-2*m);a[0]=b[0]*p+c[0]*e+d[0]*g+h[0]*m;a[1]=b[1]*p+c[1]*e+d[1]*g+h[1]*m;a[2]=b[2]*p+c[2]*e+d[2]*g+h[2]*m;return a};b.bezier=function(a,b,c,d,h,m){var f=1-m,p=f*f,e=m*m,g=p*f;p*=3*m;f*=3*e;m*=e;a[0]=b[0]*g+c[0]*p+d[0]*f+h[0]*m;a[1]=b[1]*g+c[1]*p+d[1]*f+h[1]*m;a[2]=b[2]*g+c[2]*p+d[2]*f+h[2]*m;return a};b.random=function(a,b){b=b||1;var c=2*p.RANDOM()*Math.PI,d=2*p.RANDOM()-1,h=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*h;a[1]=Math.sin(c)*h;a[2]=d*b;return a};
    b.transformMat4=function(a,b,c){var d=b[0],h=b[1];b=b[2];var m=c[3]*d+c[7]*h+c[11]*b+c[15];m=m||1;a[0]=(c[0]*d+c[4]*h+c[8]*b+c[12])/m;a[1]=(c[1]*d+c[5]*h+c[9]*b+c[13])/m;a[2]=(c[2]*d+c[6]*h+c[10]*b+c[14])/m;return a};b.transformMat3=function(a,b,c){var d=b[0],h=b[1];b=b[2];a[0]=d*c[0]+h*c[3]+b*c[6];a[1]=d*c[1]+h*c[4]+b*c[7];a[2]=d*c[2]+h*c[5]+b*c[8];return a};b.transformQuat=function(a,b,c){var d=c[0],h=c[1],m=c[2],f=b[0],p=b[1];b=b[2];var e=h*b-m*p,g=m*f-d*b,v=d*p-h*f;c=2*c[3];a[0]=f+e*c+2*(h*v-
        m*g);a[1]=p+g*c+2*(m*e-d*v);a[2]=b+v*c+2*(d*g-h*e);return a};b.rotateX=function(a,b,c,d){var h=[],m=[];h[0]=b[0]-c[0];h[1]=b[1]-c[1];h[2]=b[2]-c[2];m[0]=h[0];m[1]=h[1]*Math.cos(d)-h[2]*Math.sin(d);m[2]=h[1]*Math.sin(d)+h[2]*Math.cos(d);a[0]=m[0]+c[0];a[1]=m[1]+c[1];a[2]=m[2]+c[2];return a};b.rotateY=function(a,b,c,d){var h=[],m=[];h[0]=b[0]-c[0];h[1]=b[1]-c[1];h[2]=b[2]-c[2];m[0]=h[2]*Math.sin(d)+h[0]*Math.cos(d);m[1]=h[1];m[2]=h[2]*Math.cos(d)-h[0]*Math.sin(d);a[0]=m[0]+c[0];a[1]=m[1]+c[1];a[2]=
        m[2]+c[2];return a};b.rotateZ=function(a,b,c,d){var h=[],m=[];h[0]=b[0]-c[0];h[1]=b[1]-c[1];h[2]=b[2]-c[2];m[0]=h[0]*Math.cos(d)-h[1]*Math.sin(d);m[1]=h[0]*Math.sin(d)+h[1]*Math.cos(d);m[2]=h[2];a[0]=m[0]+c[0];a[1]=m[1]+c[1];a[2]=m[2]+c[2];return a};b.angle=function(a,b){a=f(a[0],a[1],a[2]);b=f(b[0],b[1],b[2]);h(a,a);h(b,b);b=m(a,b);return 1<b?0:-1>b?Math.PI:Math.acos(b)};b.zero=function(a){a[0]=0;a[1]=0;a[2]=0;return a};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};b.exactEquals=
        function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};b.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var h=b[0],m=b[1];b=b[2];return Math.abs(c-h)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(d-m)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(a-b)<=p.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.forEach=b.sqrLen=b.len=b.sqrDist=b.dist=b.div=b.mul=b.sub=void 0;var p=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,
        c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ja);b.sub=k;b.mul=g;b.div=e;b.dist=l;b.sqrDist=t;b.len=a;b.sqrLen=r;d=function(){var a=c();return function(b,c,d,h,m,f){c||(c=3);d||(d=0);for(h=h?Math.min(h*c+d,b.length):b.length;d<h;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],m(a,a,f),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();b.forEach=d});O(Mb);var Nb=ca(function(d,b){function c(){var a=
    new r.ARRAY_TYPE(4);r.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0);return a}function a(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function f(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function k(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function g(a,b){var c=b[0]-a[0],d=b[1]-a[1],h=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+h*h+a*a)}function e(a,b){var c=b[0]-a[0],d=b[1]-a[1],h=b[2]-
    a[2];a=b[3]-a[3];return c*c+d*d+h*h+a*a}function l(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)}function t(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.create=c;b.clone=function(a){var b=new r.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};b.fromValues=function(a,b,c,d){var h=new r.ARRAY_TYPE(4);h[0]=a;h[1]=b;h[2]=c;h[3]=d;return h};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];
    return a};b.set=function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a};b.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};b.subtract=a;b.multiply=f;b.divide=k;b.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};b.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};b.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],
    c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};b.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};b.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};b.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};b.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};
    b.distance=g;b.squaredDistance=e;b.length=l;b.squaredLength=t;b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};b.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};b.normalize=function(a,b){var c=b[0],d=b[1],h=b[2];b=b[3];var f=c*c+d*d+h*h+b*b;0<f&&(f=1/Math.sqrt(f));a[0]=c*f;a[1]=d*f;a[2]=h*f;a[3]=b*f;return a};b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};b.cross=function(a,b,c,d){var h=c[0]*d[1]-c[1]*d[0],f=c[0]*d[2]-
        c[2]*d[0],m=c[0]*d[3]-c[3]*d[0],e=c[1]*d[2]-c[2]*d[1],p=c[1]*d[3]-c[3]*d[1];c=c[2]*d[3]-c[3]*d[2];d=b[0];var g=b[1],k=b[2];b=b[3];a[0]=g*c-k*p+b*e;a[1]=-(d*c)+k*m-b*f;a[2]=d*p-g*m+b*h;a[3]=-(d*e)+g*f-k*h;return a};b.lerp=function(a,b,c,d){var h=b[0],f=b[1],m=b[2];b=b[3];a[0]=h+d*(c[0]-h);a[1]=f+d*(c[1]-f);a[2]=m+d*(c[2]-m);a[3]=b+d*(c[3]-b);return a};b.random=function(a,b){b=b||1;do{var c=2*r.RANDOM()-1;var d=2*r.RANDOM()-1;var h=c*c+d*d}while(1<=h);do{var f=2*r.RANDOM()-1;var e=2*r.RANDOM()-1;var m=
        f*f+e*e}while(1<=m);h=Math.sqrt((1-h)/m);a[0]=b*c;a[1]=b*d;a[2]=b*f*h;a[3]=b*e*h;return a};b.transformMat4=function(a,b,c){var d=b[0],h=b[1],f=b[2];b=b[3];a[0]=c[0]*d+c[4]*h+c[8]*f+c[12]*b;a[1]=c[1]*d+c[5]*h+c[9]*f+c[13]*b;a[2]=c[2]*d+c[6]*h+c[10]*f+c[14]*b;a[3]=c[3]*d+c[7]*h+c[11]*f+c[15]*b;return a};b.transformQuat=function(a,b,c){var d=b[0],h=b[1],f=b[2],e=c[0],m=c[1],g=c[2];c=c[3];var p=c*d+m*f-g*h,k=c*h+g*d-e*f,l=c*f+e*h-m*d;d=-e*d-m*h-g*f;a[0]=p*c+d*-e+k*-g-l*-m;a[1]=k*c+d*-m+l*-e-p*-g;a[2]=
        l*c+d*-g+p*-m-k*-e;a[3]=b[3];return a};b.zero=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(a,b){var c=a[0],d=a[1],h=a[2];a=a[3];var f=b[0],e=b[1],m=b[2];b=b[3];return Math.abs(c-f)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-e)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(h-m)<=r.EPSILON*Math.max(1,
        Math.abs(h),Math.abs(m))&&Math.abs(a-b)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.forEach=b.sqrLen=b.len=b.sqrDist=b.dist=b.div=b.mul=b.sub=void 0;var r=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ja);b.sub=a;b.mul=f;b.div=k;b.dist=g;b.sqrDist=
        e;b.len=l;b.sqrLen=t;d=function(){var a=c();return function(b,c,d,h,f,e){c||(c=4);d||(d=0);for(h=h?Math.min(h*c+d,b.length):b.length;d<h;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],f(a,a,e),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}();b.forEach=d});O(Nb);var qb=ca(function(d,b){function c(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,
    c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}function a(){var a=new l.ARRAY_TYPE(4);l.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);a[3]=1;return a}function f(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function k(a,b,c){var d=b[0],h=b[1],f=b[2];b=b[3];var e=c[0],m=c[1],g=c[2];c=c[3];a[0]=d*c+b*e+h*g-f*m;a[1]=h*c+b*m+f*e-d*g;a[2]=f*c+b*g+d*m-h*e;a[3]=b*c-d*e-h*m-f*g;return a}function g(a,b,c,d){var h=b[0],f=b[1],
    e=b[2];b=b[3];var m=c[0],g=c[1],p=c[2];c=c[3];var k=h*m+f*g+e*p+b*c;0>k&&(k=-k,m=-m,g=-g,p=-p,c=-c);if(1-k>l.EPSILON){var v=Math.acos(k);var B=Math.sin(v);k=Math.sin((1-d)*v)/B;d=Math.sin(d*v)/B}else k=1-d;a[0]=k*h+d*m;a[1]=k*f+d*g;a[2]=k*e+d*p;a[3]=k*b+d*c;return a}function e(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var h=(d+1)%3,f=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*
h+h]-b[3*f+f]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*h+f]-b[3*f+h])*c;a[h]=(b[3*h+d]+b[3*d+h])*c;a[f]=(b[3*f+d]+b[3*d+f])*c}return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=f;b.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);d>l.EPSILON?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0);return c};b.multiply=k;b.rotateX=function(a,b,c){c*=.5;var d=b[0],h=b[1],f=b[2];b=b[3];var e=Math.sin(c);
    c=Math.cos(c);a[0]=d*c+b*e;a[1]=h*c+f*e;a[2]=f*c-h*e;a[3]=b*c-d*e;return a};b.rotateY=function(a,b,c){c*=.5;var d=b[0],h=b[1],f=b[2];b=b[3];var e=Math.sin(c);c=Math.cos(c);a[0]=d*c-f*e;a[1]=h*c+b*e;a[2]=f*c+d*e;a[3]=b*c-h*e;return a};b.rotateZ=function(a,b,c){c*=.5;var d=b[0],h=b[1],f=b[2];b=b[3];var e=Math.sin(c);c=Math.cos(c);a[0]=d*c+h*e;a[1]=h*c-d*e;a[2]=f*c+b*e;a[3]=b*c-f*e;return a};b.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*
    b));return a};b.slerp=g;b.random=function(a){var b=l.RANDOM(),c=l.RANDOM(),d=l.RANDOM(),h=Math.sqrt(1-b);b=Math.sqrt(b);a[0]=h*Math.sin(2*Math.PI*c);a[1]=h*Math.cos(2*Math.PI*c);a[2]=b*Math.sin(2*Math.PI*d);a[3]=b*Math.cos(2*Math.PI*d);return a};b.invert=function(a,b){var c=b[0],d=b[1],h=b[2];b=b[3];var f=c*c+d*d+h*h+b*b;f=f?1/f:0;a[0]=-c*f;a[1]=-d*f;a[2]=-h*f;a[3]=b*f;return a};b.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};b.fromMat3=e;b.fromEuler=function(a,b,c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   d){var h=.5*Math.PI/180;b*=h;c*=h;d*=h;h=Math.sin(b);b=Math.cos(b);var f=Math.sin(c);c=Math.cos(c);var e=Math.sin(d);d=Math.cos(d);a[0]=h*c*d-b*f*e;a[1]=b*f*d+h*c*e;a[2]=b*c*e-h*f*d;a[3]=b*c*d+h*f*e;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.setAxes=b.sqlerp=b.rotationTo=b.equals=b.exactEquals=b.normalize=b.sqrLen=b.squaredLength=b.len=b.length=b.lerp=b.dot=b.scale=b.mul=b.add=b.set=b.copy=b.fromValues=b.clone=void 0;var l=c(ja),t=c(eb),r=c(Mb);d=c(Nb);b.clone=
    d.clone;b.fromValues=d.fromValues;b.copy=d.copy;b.set=d.set;b.add=d.add;b.mul=k;b.scale=d.scale;b.dot=d.dot;b.lerp=d.lerp;var h=d.length;b.length=h;b.len=h;h=d.squaredLength;b.squaredLength=h;b.sqrLen=h;var m=d.normalize;b.normalize=m;b.exactEquals=d.exactEquals;b.equals=d.equals;d=function(){var a=r.create(),b=r.fromValues(1,0,0),c=r.fromValues(0,1,0);return function(d,h,e){var g=r.dot(h,e);if(-.999999>g)return r.cross(a,b,h),1E-6>r.len(a)&&r.cross(a,c,h),r.normalize(a,a),f(d,a,Math.PI),d;if(.999999<
    g)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;r.cross(a,h,e);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return m(d,d)}}();b.rotationTo=d;d=function(){var b=a(),c=a();return function(a,d,h,f,e,m){g(b,d,e,m);g(c,h,f,m);g(a,b,c,2*m*(1-m));return a}}();b.sqlerp=d;d=function(){var a=t.create();return function(b,c,d,h){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=h[0];a[4]=h[1];a[7]=h[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return m(b,e(b,a))}}();b.setAxes=d});O(qb);var pc=ca(function(d,b){function c(a){if(a&&a.__esModule)return a;
    var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}function a(a,b,c){var d=.5*c[0],h=.5*c[1];c=.5*c[2];var f=b[0],e=b[1],m=b[2];b=b[3];a[0]=f;a[1]=e;a[2]=m;a[3]=b;a[4]=d*b+h*m-c*e;a[5]=h*b+c*f-d*m;a[6]=c*b+d*e-h*f;a[7]=-d*f-h*e-c*m;return a}function f(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];
    a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];return a}function k(a,b,c){var d=b[0],h=b[1],f=b[2],e=b[3],m=c[4],g=c[5],k=c[6],p=c[7],l=b[4],r=b[5],t=b[6];b=b[7];var w=c[0],x=c[1],A=c[2];c=c[3];a[0]=d*c+e*w+h*A-f*x;a[1]=h*c+e*x+f*w-d*A;a[2]=f*c+e*A+d*x-h*w;a[3]=e*c-d*w-h*x-f*A;a[4]=d*p+e*m+h*k-f*g+l*c+b*w+r*A-t*x;a[5]=h*p+e*g+f*m-d*k+r*c+b*x+t*w-l*A;a[6]=f*p+e*k+d*g-h*m+t*c+b*A+l*x-r*w;a[7]=e*p-d*m-h*g-f*k+b*c-l*w-r*x-t*A;return a}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var a=
    new g.ARRAY_TYPE(8);g.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0);a[3]=1;return a};b.clone=function(a){var b=new g.ARRAY_TYPE(8);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};b.fromValues=function(a,b,c,d,f,e,k,l){var h=new g.ARRAY_TYPE(8);h[0]=a;h[1]=b;h[2]=c;h[3]=d;h[4]=f;h[5]=e;h[6]=k;h[7]=l;return h};b.fromRotationTranslationValues=function(a,b,c,d,f,e,k){var h=new g.ARRAY_TYPE(8);h[0]=a;h[1]=b;h[2]=c;h[3]=d;f*=.5;e*=
    .5;k*=.5;h[4]=f*d+e*c-k*b;h[5]=e*d+k*a-f*c;h[6]=k*d+f*b-e*a;h[7]=-f*a-e*b-k*c;return h};b.fromRotationTranslation=a;b.fromTranslation=function(a,b){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=.5*b[0];a[5]=.5*b[1];a[6]=.5*b[2];a[7]=0;return a};b.fromRotation=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};b.fromMat4=function(b,c){var d=e.create();l.getRotation(d,c);var h=new g.ARRAY_TYPE(3);l.getTranslation(h,c);a(b,d,h);return b};b.copy=f;b.identity=function(a){a[0]=
    0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};b.set=function(a,b,c,d,f,e,g,k,l){a[0]=b;a[1]=c;a[2]=d;a[3]=f;a[4]=e;a[5]=g;a[6]=k;a[7]=l;return a};b.getDual=function(a,b){a[0]=b[4];a[1]=b[5];a[2]=b[6];a[3]=b[7];return a};b.setDual=function(a,b){a[4]=b[0];a[5]=b[1];a[6]=b[2];a[7]=b[3];return a};b.getTranslation=function(a,b){var c=b[4],d=b[5],f=b[6],h=b[7],e=-b[0],g=-b[1],m=-b[2];b=b[3];a[0]=2*(c*b+h*e+d*m-f*g);a[1]=2*(d*b+h*g+f*e-c*m);a[2]=2*(f*b+h*m+c*g-d*e);return a};b.translate=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 b,c){var d=b[0],f=b[1],h=b[2],e=b[3],g=.5*c[0],m=.5*c[1];c=.5*c[2];var k=b[4],l=b[5],p=b[6];b=b[7];a[0]=d;a[1]=f;a[2]=h;a[3]=e;a[4]=e*g+f*c-h*m+k;a[5]=e*m+h*g-d*c+l;a[6]=e*c+d*m-f*g+p;a[7]=-d*g-f*m-h*c+b;return a};b.rotateX=function(a,b,c){var d=-b[0],f=-b[1],h=-b[2],g=b[3],m=b[4],k=b[5],l=b[6],p=b[7],r=m*g+p*d+k*h-l*f,t=k*g+p*f+l*d-m*h,w=l*g+p*h+m*f-k*d;m=p*g-m*d-k*f-l*h;e.rotateX(a,b,c);d=a[0];f=a[1];h=a[2];g=a[3];a[4]=r*g+m*d+t*h-w*f;a[5]=t*g+m*f+w*d-r*h;a[6]=w*g+m*h+r*f-t*d;a[7]=m*g-r*d-t*f-w*
    h;return a};b.rotateY=function(a,b,c){var d=-b[0],f=-b[1],h=-b[2],g=b[3],m=b[4],k=b[5],l=b[6],p=b[7],r=m*g+p*d+k*h-l*f,t=k*g+p*f+l*d-m*h,w=l*g+p*h+m*f-k*d;m=p*g-m*d-k*f-l*h;e.rotateY(a,b,c);d=a[0];f=a[1];h=a[2];g=a[3];a[4]=r*g+m*d+t*h-w*f;a[5]=t*g+m*f+w*d-r*h;a[6]=w*g+m*h+r*f-t*d;a[7]=m*g-r*d-t*f-w*h;return a};b.rotateZ=function(a,b,c){var d=-b[0],f=-b[1],h=-b[2],g=b[3],m=b[4],k=b[5],l=b[6],p=b[7],r=m*g+p*d+k*h-l*f,t=k*g+p*f+l*d-m*h,w=l*g+p*h+m*f-k*d;m=p*g-m*d-k*f-l*h;e.rotateZ(a,b,c);d=a[0];f=a[1];
    h=a[2];g=a[3];a[4]=r*g+m*d+t*h-w*f;a[5]=t*g+m*f+w*d-r*h;a[6]=w*g+m*h+r*f-t*d;a[7]=m*g-r*d-t*f-w*h;return a};b.rotateByQuatAppend=function(a,b,c){var d=c[0],f=c[1],h=c[2];c=c[3];var e=b[0],g=b[1],m=b[2],k=b[3];a[0]=e*c+k*d+g*h-m*f;a[1]=g*c+k*f+m*d-e*h;a[2]=m*c+k*h+e*f-g*d;a[3]=k*c-e*d-g*f-m*h;e=b[4];g=b[5];m=b[6];k=b[7];a[4]=e*c+k*d+g*h-m*f;a[5]=g*c+k*f+m*d-e*h;a[6]=m*c+k*h+e*f-g*d;a[7]=k*c-e*d-g*f-m*h;return a};b.rotateByQuatPrepend=function(a,b,c){var d=b[0],f=b[1],h=b[2];b=b[3];var e=c[0],g=c[1],
    m=c[2],k=c[3];a[0]=d*k+b*e+f*m-h*g;a[1]=f*k+b*g+h*e-d*m;a[2]=h*k+b*m+d*g-f*e;a[3]=b*k-d*e-f*g-h*m;e=c[4];g=c[5];m=c[6];k=c[7];a[4]=d*k+b*e+f*m-h*g;a[5]=f*k+b*g+h*e-d*m;a[6]=h*k+b*m+d*g-f*e;a[7]=b*k-d*e-f*g-h*m;return a};b.rotateAroundAxis=function(a,b,c,d){if(Math.abs(d)<g.EPSILON)return f(a,b);var h=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);d*=.5;var e=Math.sin(d),k=e*c[0]/h,m=e*c[1]/h;c=e*c[2]/h;d=Math.cos(d);h=b[0];e=b[1];var l=b[2],p=b[3];a[0]=h*d+p*k+e*c-l*m;a[1]=e*d+p*m+l*k-h*c;a[2]=l*d+p*c+
    h*m-e*k;a[3]=p*d-h*k-e*m-l*c;h=b[4];e=b[5];l=b[6];b=b[7];a[4]=h*d+b*k+e*c-l*m;a[5]=e*d+b*m+l*k-h*c;a[6]=l*d+b*c+h*m-e*k;a[7]=b*d-h*k-e*m-l*c;return a};b.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];return a};b.multiply=k;b.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;return a};b.lerp=function(a,b,c,d){var f=1-d;0>t(b,c)&&(d=-d);a[0]=
    b[0]*f+c[0]*d;a[1]=b[1]*f+c[1]*d;a[2]=b[2]*f+c[2]*d;a[3]=b[3]*f+c[3]*d;a[4]=b[4]*f+c[4]*d;a[5]=b[5]*f+c[5]*d;a[6]=b[6]*f+c[6]*d;a[7]=b[7]*f+c[7]*d;return a};b.invert=function(a,b){var c=r(b);a[0]=-b[0]/c;a[1]=-b[1]/c;a[2]=-b[2]/c;a[3]=b[3]/c;a[4]=-b[4]/c;a[5]=-b[5]/c;a[6]=-b[6]/c;a[7]=b[7]/c;return a};b.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];a[4]=-b[4];a[5]=-b[5];a[6]=-b[6];a[7]=b[7];return a};b.normalize=function(a,b){var c=r(b);if(0<c){c=Math.sqrt(c);var d=b[0]/c,f=b[1]/
    c,e=b[2]/c,h=b[3]/c,g=b[4],k=b[5],m=b[6];b=b[7];var l=d*g+f*k+e*m+h*b;a[0]=d;a[1]=f;a[2]=e;a[3]=h;a[4]=(g-d*l)/c;a[5]=(k-f*l)/c;a[6]=(m-e*l)/c;a[7]=(b-h*l)/c}return a};b.str=function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]};b.equals=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],h=a[4],k=a[5],m=a[6];a=a[7];
    var l=b[0],r=b[1],t=b[2],w=b[3],x=b[4],A=b[5],H=b[6];b=b[7];return Math.abs(c-l)<=g.EPSILON*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-r)<=g.EPSILON*Math.max(1,Math.abs(d),Math.abs(r))&&Math.abs(f-t)<=g.EPSILON*Math.max(1,Math.abs(f),Math.abs(t))&&Math.abs(e-w)<=g.EPSILON*Math.max(1,Math.abs(e),Math.abs(w))&&Math.abs(h-x)<=g.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(k-A)<=g.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(m-H)<=g.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&
        Math.abs(a-b)<=g.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.sqrLen=b.squaredLength=b.len=b.length=b.dot=b.mul=b.setReal=b.getReal=void 0;var g=c(ja),e=c(qb),l=c(Lb);b.getReal=e.copy;b.setReal=e.copy;b.mul=k;var t=e.dot;b.dot=t;d=e.length;b.length=d;b.len=d;var r=e.squaredLength;b.squaredLength=r;b.sqrLen=r});O(pc);var qc=ca(function(d,b){function c(){var a=new r.ARRAY_TYPE(2);r.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0);return a}function a(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}function f(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a}function k(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a}function g(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)}function e(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a}function l(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)}function t(a){var b=a[0];a=a[1];return b*b+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.create=c;b.clone=function(a){var b=new r.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b};b.fromValues=function(a,b){var c=
    new r.ARRAY_TYPE(2);c[0]=a;c[1]=b;return c};b.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};b.set=function(a,b,c){a[0]=b;a[1]=c;return a};b.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a};b.subtract=a;b.multiply=f;b.divide=k;b.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};b.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};b.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};b.max=function(a,b,c){a[0]=Math.max(b[0],
    c[0]);a[1]=Math.max(b[1],c[1]);return a};b.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};b.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};b.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};b.distance=g;b.squaredDistance=e;b.length=l;b.squaredLength=t;b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};b.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};b.normalize=function(a,b){var c=b[0],d=b[1];c=c*c+d*d;0<c&&(c=1/Math.sqrt(c));
    a[0]=b[0]*c;a[1]=b[1]*c;return a};b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};b.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};b.lerp=function(a,b,c,d){var f=b[0];b=b[1];a[0]=f+d*(c[0]-f);a[1]=b+d*(c[1]-b);return a};b.random=function(a,b){b=b||1;var c=2*r.RANDOM()*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};b.transformMat2=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};b.transformMat2d=function(a,b,c){var d=b[0];b=b[1];a[0]=
    c[0]*d+c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};b.transformMat3=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a};b.transformMat4=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};b.rotate=function(a,b,c,d){var f=b[0]-c[0];b=b[1]-c[1];var e=Math.sin(d);d=Math.cos(d);a[0]=f*d-b*e+c[0];a[1]=f*e+b*d+c[1];return a};b.angle=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];var f=c*c+a*a;0<f&&(f=1/Math.sqrt(f));var e=
    d*d+b*b;0<e&&(e=1/Math.sqrt(e));c=(c*d+a*b)*f*e;return 1<c?0:-1>c?Math.PI:Math.acos(c)};b.zero=function(a){a[0]=0;a[1]=0;return a};b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};b.equals=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];return Math.abs(c-d)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(a-b)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.forEach=b.sqrLen=b.sqrDist=b.dist=b.div=b.mul=b.sub=b.len=void 0;
    var r=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ja);b.len=l;b.sub=a;b.mul=f;b.div=k;b.dist=g;b.sqrDist=e;b.sqrLen=t;d=function(){var a=c();return function(b,c,d,f,e,g){c||(c=2);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],
        a[1]=b[d+1],e(a,a,g),b[d]=a[0],b[d+1]=a[1];return b}}();b.forEach=d});O(qc);var oa=ca(function(d,b){function c(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}Object.defineProperty(b,"__esModule",{value:!0});b.vec4=b.vec3=b.vec2=b.quat2=b.quat=b.mat4=b.mat3=b.mat2d=
    b.mat2=b.glMatrix=void 0;d=c(ja);b.glMatrix=d;d=c(nc);b.mat2=d;d=c(oc);b.mat2d=d;d=c(eb);b.mat3=d;d=c(Lb);b.mat4=d;d=c(qb);b.quat=d;d=c(pc);b.quat2=d;d=c(qc);b.vec2=d;d=c(Mb);b.vec3=d;d=c(Nb);b.vec4=d});O(oa);var Qc=oa.vec4,Ia=oa.vec3,Rc=oa.vec2,Sc=oa.quat2,Tc=oa.quat,R=oa.mat4,Uc=oa.mat3,Vc=oa.mat2d,Wc=oa.mat2,Xc=oa.glMatrix;ab.deviation=function(d,b,c,a){var f=b&&b.length,k=Math.abs(lb(d,0,f?b[0]*c:d.length,c));if(f){f=0;for(var g=b.length;f<g;f++)k-=Math.abs(lb(d,b[f]*c,f<g-1?b[f+1]*c:d.length,
    c))}for(f=b=0;f<a.length;f+=3){g=a[f]*c;var e=a[f+1]*c,l=a[f+2]*c;b+=Math.abs((d[g]-d[l])*(d[e+1]-d[g+1])-(d[g]-d[e])*(d[l+1]-d[g+1]))}return 0===k&&0===b?0:Math.abs((b-k)/k)};ab.flatten=function(d){for(var b=d[0][0].length,c={vertices:[],holes:[],dimensions:b},a=0,f=0;f<d.length;f++){for(var k=0;k<d[f].length;k++)for(var g=0;g<b;g++)c.vertices.push(d[f][k][g]);0<f&&(a+=d[f-1].length,c.holes.push(a))}return c};ab.default=ab;var lc="undefined"===typeof Symbol?"__target":Symbol(),Kc=window.BlobBuilder||
    window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,ob=window.URL||window.webkitURL,Oa=window.Worker;if(Oa){var rc=kc("self.onmessage = function () {}"),sc=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");var rb=new Oa(rc);rb.postMessage(sc,[sc.buffer])}catch(d){Oa=null}finally{ob.revokeObjectURL(rc),rb&&rb.terminate()}}var Yc=new jc("./worker.js",function(d,b){}),tc={window:1,windowAnimation:2,gradual:3,ripple:4},
    uc=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c._isShow=!0;a=c.getOptions();if("windowAnimation"===a.style||"ripple"===a.style||0<a.riseTime)c.autoUpdate=!0;c.textureCache={};return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{opacity:1,isTextureFull:!1,topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new Fa(this,this.gl);this.texture=null;
            this.isUseTexture=!1;this.vertexLength=10;this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec3 a_pos;attribute vec3 a_normal;attribute vec3 a_color;attribute float a_height;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec3 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.2,0.2,0.2);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);void main(){vec3 pos=a_pos;if(riseTime>0.0&&time<riseTime){pos.z=pos.z*(time/riseTime);}v_position=pos;v_height=a_height;if(u_use_texture){v_texture_coord=a_texture_coord;}vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos,1.0);gl_Position=position;if(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));v_color=a_color+a_color*light_color*lambert+a_color*light_color_2*lambert_2+a_color*point_color*lambert_point;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec3 vLightWeighting;vLightWeighting=uAmbientColor+uDirectionalColor*directionalLightWeighting;v_color=vLightWeighting;}}else{v_color=a_color;}}",
                fragmentShader:"precision highp float;varying vec3 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color,alpha);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));if(u_use_lighting){color=vec4(textureColor.rgb*v_color,textureColor.a);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}gl_FragColor=color;}"});
            this.initializeTime=new Date;this.normalMatrix=R.create()}},{key:"onChanged",value:function(b,a){var c=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){c.loadTexture(function(){c.dataMgr.parseData(a);c.webglLayer.render()})},0))}},{key:"render",value:function(b){var a=b.gl,c=b.projectionMatrix,d=b.viewMatrix;if(this._isShow){b=this.program;var g=b.uniforms;b=b.attributes;a.useProgram(this.program.program);var e=this.getOptions();if(e.texture)if(this.texture)a.activeTexture(a.TEXTURE0),
            a.bindTexture(a.TEXTURE_2D,this.texture),a.uniform1i(g.u_sampler,0);else return;a.enable(a.DEPTH_TEST);a.enable(a.POLYGON_OFFSET_FILL);a.polygonOffset(1,1);var l=a.isEnabled(a.BLEND),t=a.isEnabled(a.CULL_FACE);a.disable(a.CULL_FACE);e.blend&&(a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE),a.blendEquation(a.FUNC_ADD));a.uniformMatrix4fv(g.u_proj_matrix,!1,c);a.uniformMatrix4fv(g.u_mv_matrix,!1,d);c=0;e.style&&tc[e.style]&&(c=tc[e.style]);"gradual"===e.style?(a.depthMask(!1),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,
            a.ONE_MINUS_SRC_ALPHA)):a.depthMask(!0);a.uniform1f(g.style,c);c=this.normizedColor(e.topColor);a.uniform4f(g.top_color,c[0],c[1],c[2],void 0===c[3]?1:c[3]);a.uniform1i(g.u_use_lighting,e.useLight);a.uniform1i(g.u_use_texture,this.isUseTexture);a.uniform1f(g.alpha,void 0===e.opacity?.8:parseFloat(e.opacity));a.uniform1f(g.time,new Date-this.initializeTime);a.uniform1f(g.riseTime,e.riseTime);"ripple"===e.style&&e.rippleLayer&&e.rippleLayer.data&&e.rippleLayer.data[0]&&(c=this.normizedPoint(e.rippleLayer.data[0].geometry.coordinates),
            a.uniform3fv(g.u_ripple_center,[c[0],c[1],0]),a.uniform1f(g.u_radius,e.rippleLayer.options.size*e.rippleLayer.currentScale));c=Ia.fromValues(0,-1,2);a.uniform3fv(g.u_side_light_dir,c);a.enableVertexAttribArray(b.a_pos);a.enableVertexAttribArray(b.a_normal);a.enableVertexAttribArray(b.a_color);a.enableVertexAttribArray(b.a_height);e.texture?a.enableVertexAttribArray(b.a_texture_coord):a.disableVertexAttribArray(b.a_texture_coord);c=this.normalMatrix;R.invert(c,d);R.transpose(c,c);a.uniformMatrix4fv(g.u_normal_matrix,
            !1,c);d=this.dataMgr.getData();g=4*this.vertexLength;for(c=0;c<d.vertex.length;c++)0>=d.vertex[c].length||(a.bindBuffer(a.ARRAY_BUFFER,d.vertexBuffer[c]),a.vertexAttribPointer(b.a_pos,3,a.FLOAT,!1,g,0),a.vertexAttribPointer(b.a_normal,3,a.FLOAT,!1,g,12),a.vertexAttribPointer(b.a_color,3,a.FLOAT,!1,g,24),a.vertexAttribPointer(b.a_height,1,a.FLOAT,!1,g,36),e.texture&&a.vertexAttribPointer(b.a_texture_coord,2,a.FLOAT,!1,g,40),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d.indexBuffer[c]),a.drawElements(a.TRIANGLES,
            d.index[c].length,a.UNSIGNED_SHORT,0),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null));e.blend&&!1===l&&a.disable(a.BLEND);t&&a.enable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.depthMask(!0);a.disable(a.POLYGON_OFFSET_FILL)}else this.webglLayer.clear()}},{key:"loadTexture",value:function(b){var a=this,c=this.getOptions();c.texture?(this.vertexLength=12,this.isUseTexture=!0,$a(this.gl,c.texture,function(c,d){a.image=d;a.texture=c;b&&b();a.webglLayer.render()})):(this.vertexLength=
            10,this.isUseTexture=!1,this.image=this.texture=null,b&&b())}}]);return b}(ia);Fa.prototype.initData=function(){this.outBuilding3d={vertex:[[]],vertexBuffer:[],index:[[]],indexBuffer:[]}};Fa.prototype.getData=function(){return this.outBuilding3d};Fa.prototype.initWorker=function(){this.worker=new Yc;this.worker.onmessage=function(d){}};Fa.prototype.parseData=function(d){var b=this;this.initData();var c=this.gl,a=this.shapeLayer.getOptions(),f=function(c){var f=d[c],e=[];d[c].geometry.coordinates[0].forEach(function(a){a=
    b.shapeLayer.normizedPoint(a);e.push(a[0],a[1])});var g=d[c].height||0;"properties"in f&&"height"in f.properties&&(g=d[c].properties.height);g*=1;var k=d[c].color||a.color||[.1,.1,.1];"properties"in f&&"color"in f.properties&&(k=d[c].properties.color);k=b.shapeLayer.normizedColor(k);b.parseBuilding3d(e,g,k,b.outBuilding3d)},k=0;for(;k<d.length;k++)f(k);for(k=0;k<this.outBuilding3d.vertex.length;k++){f=[];for(var g=this.outBuilding3d.vertex[k].length,e=0;e<g;e++){var l=this.outBuilding3d.vertex[k][e].length;
    f.push(this.outBuilding3d.vertex[k][e][0]);f.push(this.outBuilding3d.vertex[k][e][1]);for(var t=2;t<l;t++)f.push(this.outBuilding3d.vertex[k][e][t])}g=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,g);c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW);this.outBuilding3d.vertexBuffer[k]=g;c.bindBuffer(c.ARRAY_BUFFER,null);g=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,g);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outBuilding3d.index[k]),c.STATIC_DRAW);this.outBuilding3d.indexBuffer[k]=
    g;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}};Fa.prototype.getBounds=function(d){for(var b=d[0],c=d[1],a=d[0],f=d[1],k=0;k<d.length;k+=2)b=Math.min(d[k],b),c=Math.min(d[k+1],c),a=Math.max(d[k],a),f=Math.max(d[k+1],f);return{minX:b,minY:c,maxX:a,maxY:f,width:a-b,height:f-c}};Fa.prototype.parseBuilding3d=function(d,b,c,a){var f=this.shapeLayer.options,k=a.vertex[a.vertex.length-1],g=a.index[a.index.length-1];c=c||[.328125,.51953125,.8125];65536<=k.length+2*d.length&&(k=[],g=[],a.vertex.push(k),a.index.push(g));
    if("gradual"!=f.style){a=ab(d);var e=a[0],l=a[1],t=a[2];e=[d[2*e],d[2*e+1],b];l=[d[2*l],d[2*l+1],b];var r=[d[2*t],d[2*t+1],b];t=[];Ia.cross(t,[r[0]-l[0],r[1]-l[1],r[2]-l[2]],[e[0]-l[0],e[1]-l[1],e[2]-l[2]]);e=k.length;if(f.texture)var h=this.getBounds(d);l=0;for(r=d.length;l<r;l+=2){var m=[d[l],d[l+1],b,t[0],t[1],t[2],c[0],c[1],c[2]];m.push(b);f.texture&&(m.push((d[l]-h.minX)/130),m.push((h.maxY-d[l+1])/130));k.push(m)}h=0;for(t=a.length;h<t;h++)g.push(a[h]+e)}if(!(0>=b))for(h=a=0,this.shapeLayer.image&&
    (a=this.shapeLayer.image.width*f.textureScale,h=this.shapeLayer.image.height*f.textureScale),t=0,e=d.length;t<e;t+=2){var p=d[t],v=d[t+1];l=[p,v,0];r=[p,v,b];m=t+2;var w=t+3;t===e-2&&(m=0,w=1);m=d[m];w=d[w];v=Math.sqrt(Math.pow(m-p,2),Math.pow(w-v,2));p=[m,w,0];m=[m,w,b];w=[];Ia.cross(w,[p[0]-l[0],p[1]-l[1],p[2]-l[2]],[r[0]-l[0],r[1]-l[1],r[2]-l[2]]);l.push(w[0],w[1],w[2]);r.push(w[0],w[1],w[2]);p.push(w[0],w[1],w[2]);m.push(w[0],w[1],w[2]);l.push(c[0],c[1],c[2]);r.push(c[0],c[1],c[2]);p.push(c[0],
        c[1],c[2]);m.push(c[0],c[1],c[2]);l.push(b);r.push(b);p.push(b);m.push(b);f.texture&&(f.isTextureFull?(l.push(0,0),r.push(0,1),p.push(1,0),m.push(1,1)):(l.push(0,0),r.push(0,b/h),p.push(v/a,0),m.push(v/a,b/h)));v=k.length;k.push(l);k.push(r);k.push(p);k.push(m);g.push(v,v+2,v+3,v,v+3,v+1)}};var vc=function(d){function b(c,a){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a))}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return Object.assign(Qa(b.prototype.__proto__||
        Object.getPrototypeOf(b.prototype),"getDefaultOptions",this).call(this),{style:"grid",gridSize:500,height:function(){return 1E3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(b,a){var c=a.gridSize,d=[],g={};a=b.length;for(var e=this.getPointOffset(),l=0;l<a;l++){var t=this.normizedPoint(b[l].geometry.coordinates);t=~~((t[0]+e[0])/c)+"_"+~~((t[1]+e[1])/c);void 0===g[t]&&(g[t]=0);var r=~~b[l].count||1;"properties"in b[l]&&"count"in b[l].properties&&(r=~~b[l].properties.count);
        g[t]+=r}Object.keys(g).forEach(function(a){var b=a.split("_");d.push([b[0]*c+c/2,b[1]*c+c/2,g[a]])});return d}},{key:"onChanged",value:function(c,a){a=this.processData(a);Qa(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onChanged",this).call(this,c,a)}},{key:"getGridDataRange",value:function(){var b=this.gridData,a=void 0,d=void 0;b[0]&&(a=b[0][2],d=b[0][2]);for(var k=b.length,g=0;g<k;g++){var e=b[g];a=Math.max(e[2],a);d=Math.min(e[2],d)}return{max:a/2,min:d}}},{key:"processData",value:function(b){var a=
        this.getOptions(),c=a.style,d=a.gridSize,g=[];this.gridData=g;if("normal"===c){c=this.getPointOffset();for(var e=0;e<b.length;e++){var l=this.normizedPoint(b[e].geometry.coordinates),t=l[0]+c[0];l=l[1]+c[1];var r=~~b[e].count||1;"properties"in b[e]&&"count"in b[e].properties&&(r=~~b[e].properties.count);var h=b[e].color;"properties"in b[e]&&"color"in b[e].properties&&(h=~~b[e].properties.color);g.push([t,l,r,h])}}else g=this.generateGrid(b,a);b=[];for(c=0;c<g.length;c++)e=g[c],e[0]=e[0],e[1]=e[1],
        t=void 0,a.height&&(t="function"===typeof a.height?a.height({count:e[2]}):a.height),l=d/2-5,r=e[3],a.color&&(r="function"===typeof a.color?a.color({count:e[2],color:e[3]}):U(r).unitArray()),b.push({geometry:{type:"Polygon",coordinates:[[[e[0]-l,e[1]-l],[e[0]-l,e[1]+l],[e[0]+l,e[1]+l],[e[0]+l,e[1]-l]]]},color:r,height:t});return b}}]);return b}(uc),fb=function(d){function b(c){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"initialize",value:function(b){var a=
        this;this.children&&this.children.forEach(function(c){c.setWebglLayer(a.getWebglLayer());c.initialize&&c.initialize(b)})}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Qa(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"isRequestAnimation",this).call(this);for(var c=!1,a=0;a<this.children.length;a++)if(this.children[a].isRequestAnimation()){c=!0;break}return c}},{key:"render",value:function(b){this.children&&this.children.forEach(function(a){a.render(b)})}}]);
    return b}(Fb),Zc=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.gridLayer=new vc(c.getGridOptions());c.children=[c.gridLayer];c.options.riseTime&&(c.autoUpdate=!0);return c}H(b,d);A(b,[{key:"onDataChanged",value:function(b){this.gridLayer.setData(b)}},{key:"getGridOptions",value:function(){var b=this.getOptions(),a=b.max,d=b.min;void 0===a&&(d=this.gridLayer.getGridDataRange(),a=d.max,d=d.min);var k=new fa({max:a,min:d,gradient:b.gradient,
        maxSize:b.maxHeight,minSize:b.minHeight});b.height=function(a){var b=k.getSize(a.count);"properties"in a&&"count"in a.properties&&(b=k.getSize(a.properties.count));return b};b.color=function(a){var b=k.getImageData(a.count);"properties"in a&&"count"in a.properties&&(b=k.getImageData(a.properties.count));return[b[0]/255,b[1]/255,b[2]/255]};return b}},{key:"onOptionsChanged",value:function(b){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",
        gridSize:500,maxHeight:8E3,minHeight:200,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]);return b}(fb),Ja=function(){function d(b){x(this,d);this.map=b}A(d,[{key:"onResize",value:function(b){}},{key:"onUpdate",value:function(b){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5";}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5";}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5";
    }},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5";}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5";}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5";}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5";}},{key:"lnglatToMercator",value:function(b,c){b=pa.convertLL2MC({lng:b,lat:c});return[b.lng,b.lat]}}]);return d}(),$c=function(d){function b(c){x(this,b);return I(this,
    (b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"onResize",value:function(b){this.map.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){this.map.addEventListener("update",b);this.map.addEventListener("onearthstatuschange",b)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},
    {key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getCenter",value:function(){var b=this.map.getCenter();-180<=b.lng&&180>=b.lng&&(b=this.map.lnglatToMercator(b.lng,b.lat),b={lng:b[0],lat:b[1]});return b}},{key:"lnglatToMercator",value:function(b,a){return this.map.lnglatToMercator(b,a)}}]);return b}(Ja),ad=function(d){function b(c){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));c.div=document.createElement("div");c.div.style.position="absolute";
    c.map.getPanes().mapPane.appendChild(c.div);return c}H(b,d);A(b,[{key:"onResize",value:function(b){this.map.addEventListener("resize",b)}},{key:"changeCanvas",value:function(){var b=this.map,a=b.getSize(),d=b.getCenter();b=b.pointToOverlayPixel(d);this.div.style.left=b.x-a.width/2+"px";this.div.style.top=b.y-a.height/2+"px"}},{key:"onUpdate",value:function(b){var a=this;this.map.addEventListener("moveend",function(){a.changeCanvas();b()});this.map.addEventListener("moving",function(){a.changeCanvas();
        b()});this.map.addEventListener("zoomend",function(){a.changeCanvas();b()})}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",value:function(){return 0}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var b=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:b.x,lat:b.y}}}]);
    return b}(Ja),bd=function(d){function b(c){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){function a(){requestAnimationFrame(a);b()}a()}},{key:"getContainer",value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var b=this.map;return{width:b.canvas.clientWidth,height:b.canvas.clientHeight}}},
    {key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var b=this.map;return 6.8*b.scene.globe.ellipsoid.cartesianToCartographic(b.camera.position).height/6500}},{key:"getCenter",value:function(){var b=this.map;b=b.camera.pickEllipsoid(new Cesium.Cartesian2(b.canvas.clientWidth/2,b.canvas.clientHeight/2));b=Cesium.Ellipsoid.WGS84.cartesianToCartographic(b);
            b=this.getMercator([180*b.longitude/Math.PI,180*b.latitude/Math.PI]);return{lng:b[0],lat:b[1]}}},{key:"getMercator",value:function(b){var a=[];a[0]=b[0]*Math.PI/180*6378137;b=b[1]*Math.PI/180;a[1]=3189068.5*Math.log((1+Math.sin(b))/(1-Math.sin(b)));return a}}]);return b}(Ja),cd=function(d){function b(c){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){}},
    {key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return b}(Ja),dd=function(d){function b(c){x(this,b);return I(this,(b.__proto__||
    Object.getPrototypeOf(b)).call(this,c))}H(b,d);A(b,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},
    {key:"getCenter",value:function(){return this.map.center}}]);return b}(Ja),wc=function(){function d(b,c){x(this,d);c=c||{};this.map="bmap"===c.mapType?new ad(b):"blank"===c.mapType?new cd(b):"cesium"===c.mapType?new bd(b):"three"===c.mapType?new dd(b):new $c(b);this.options=c||{};this.renderArr=[];(b=c.canvas)||(b=document.createElement("canvas"));this.canvas=b;this.gl=c.gl?c.gl:dc(b);this.changeSize();this.pMatrix=R.create(Float64Array);this.oMatrix=R.create(Float64Array);this.matrix=R.create(Float64Array);
    this.viewMatrix=R.create(Float64Array);this.fovy=35;this._animation=this.animation.bind(this);this._update=this.update.bind(this);this.onInitialize(this.options.onInitialize);this.options.onRender&&this.renderArr.push(this.options.onRender);this.transferOptions={};this.bindBMapGL()}A(d,[{key:"bindBMapGL",value:function(){var b=this,c=this.map;c.onResize(function(){b.changeSize();b.render()});c.onUpdate(this._update);this.options.canvas||c.getContainer().appendChild(this.canvas)}},{key:"setOptions",
    value:function(b){this.options=b}},{key:"onInitialize",value:function(b){b&&(this.transferOptions=b.bind(this)(this.gl)||{})}},{key:"onRender",value:function(b){this.renderArr.push(b)}},{key:"changeSize",value:function(){var b=this.canvas;if(b){var c=b.style,a=this.map.getSize(),d=window.devicePixelRatio;b.width=a.width*d;b.height=a.height*d;c.cssText="position: absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;z-index:2;";"cesium"===this.options.mapType&&(c.pointerEvents="none");this.gl.viewport(0,
        0,b.width,b.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var b=this.options,c=this.pMatrix,a=this.viewMatrix;if("three"===b.mapType)a=this.map.map.camera,c=a.projectionMatrix.elements,a=a.matrixWorldInverse.elements;else if("cesium"===b.mapType){a=this.map.map;var d=a.camera.frustum.projectionMatrix;c=new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],
        d[15]]);d=a.camera.viewMatrix;a=new Float32Array([d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]])}else this.updateProjectionMatrix(),this.updateModelViewMatrix();d=R.multiply(this.matrix,c,a);Object.assign(this.transferOptions,{gl:this.gl,matrix:d,projectionMatrix:c,orthoMatrix:this.oMatrix,viewMatrix:a});"three"!==b.mapType&&this.clear();for(b=0;b<this.renderArr.length;b++)this.renderArr[b]&&this.renderArr[b].bind(this)(this.transferOptions)}}},{key:"clear",
    value:function(b){var c=this.gl,a=this.options.clearColor||[0,0,0,0];c.clearColor(a[0],a[1],a[2],a[3]);b&&(b instanceof Array||(b=U(b).unitArray()),c.clearColor(b[0],b[1],b[2],b[3]));c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var b=this.gl.canvas.width/this.gl.canvas.height;R.perspective(this.pMatrix,Za(this.fovy),b,1,4E3);this.map.getSize();R.ortho(this.oMatrix,0,this.gl.canvas.width,0,this.gl.canvas.height,1,4E3)}},{key:"updateModelViewMatrix",
    value:function(){var b=this.map,c=this.viewMatrix;R.identity(c);var a=b.getSize();a=Math.round(-a.height/(2*Math.tan(Za(this.fovy)/2)));R.translate(c,c,[0,0,a]);R.rotate(c,c,Za(b.getTilt()),[-1,0,0]);R.translate(c,c,[0,0,-a]);R.rotate(c,c,Za(b.getHeading()),[0,0,-1]);var d=b.getCenter(),k=this.options.pointOffset||[0,0];b=b.getZoomUnits();R.translate(c,c,[(k[0]-d.lng)/b,(k[1]-d.lat)/b,a]);b=1/b;R.scale(c,c,[b,b,b])}},{key:"destroy",value:function(){this.stopAnimation();this.map.getContainer().removeChild(this.canvas);
        this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",value:function(){this.isAnimation=!1}}]);return d}(),ed=new jc("./worker.js",function(d,b){function c(b){function c(a,b){for(var c=0;c<v;c++){var e=a*v+c,g=e-F,h=f.vertex.length-1;e=k.data[4*e+3];f.vertex[h].push(p[0]+
    x*c/v-z[0],p[1]-A*a/w-z[1],15*e+10);f.color[h].push(d[4*e]/255,d[4*e+1]/255,d[4*e+2]/255,e/255);c<v-1&&a<w-1&&!1!==b&&(f.index[h].push(g+v,g+1,g),f.index[h].push(g+1,g+v,g+v+1))}}var d=b.intensity;f=null;f={vertex:[[]],vertexBuffer:[],color:[[]],colorBuffer:[],index:[[]],indexBuffer:[]};var k=b.ctx,t=b.bound,r=b.canvasWidth,h=b.canvasHeight,m=b.zoomUnit,p=[t.minX,t.maxY],v=r,w=h,x=r/b.totalScale*m,A=h/b.totalScale*m,z=b.pointOffset||[0,0],F=0;for(b=0;b<w;b++)65536<f.vertex[f.vertex.length-1].length/
3+2*v&&(F+=f.vertex[f.vertex.length-1].length/3,c(b,!1),f.vertex.push([]),f.color.push([]),f.index.push([])),c(b);for(b=0;b<f.vertex.length;b++)f.vertexBuffer[b]=new Float32Array(f.vertex[b]),f.colorBuffer[b]=new Float32Array(f.color[b]),f.indexBuffer[b]=new Uint16Array(f.index[b]);a.postMessage(f)}var a=this,f=null;a.addEventListener("message",function(a){c(a.data)},!1)});qa.prototype.scale=function(d,b){this.totalScale=d;this.canvasScale=b;d=this.canvas;var c=d.style;this.map.getSize();var a=this.heatmapLayer.getBounds(),
    f=this.map.getZoomUnits();var k=(a.maxX-a.minX)/f;a=(a.maxY-a.minY)/f;k=k*b*this.totalScale;a=a*b*this.totalScale;d.width=k;d.height=a;c.cssText="background: white; position: absolute;left:0;top:0;width:"+k+"px;height:"+a+"px;z-index:3;";this.ctx=d.getContext("2d")};qa.prototype.getImageData=function(){var d=this.ctx;return d.getImageData(0,0,d.canvas.width,d.canvas.height)};qa.prototype.setData=function(d){this.data=d;this._update()};qa.prototype.update=function(d){var b=this;this.clear();this._draw&&
clearTimeout(this._draw);var c=this;this._draw=setTimeout(function(){c._draw=null;b._update();d&&d()},500)};qa.prototype.clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)};qa.prototype._update=function(){this.drawHeatmap(this.ctx)};qa.prototype.drawHeatmap=function(d){var b=this.options;d=this.ctx;d.clearRect(0,0,d.canvas.width,d.canvas.height);d.save();b=b.scale||1;d.scale(b,b);this.drawGray();d.restore()};qa.prototype.drawGray=function(){var d=this.map,b=this.ctx,
    c=this.options,a=c.max||100,f=c.size||600,k=f/=this.map.getZoomUnits(),g=k/2,e=k+g;f=new Db(2*e,2*e);var l=f.getContext("2d");l.shadowBlur=g;l.shadowColor="black";l.shadowOffsetX=l.shadowOffsetY=1E4;l.beginPath();l.arc(e-1E4,e-1E4,k,0,2*Math.PI,!0);l.closePath();l.fill();k=f.width/2;g=f.height/2;e=this.data;d=d.getZoomUnits();l=this.heatmapLayer.getBounds();var t=l.minX,r=l.maxY,h=100*d;if(e)for(var m=this.heatmapLayer.getPointOffset(),p=0;p<e.length;p++){var v=e[p];if(v.geometry){var w=this.heatmapLayer.normizedPoint(v.geometry.coordinates);
    w[0]+=m[0];w[1]+=m[1];if(!(~~w[0]<l.minX-h||~~w[0]>l.maxX+h||~~w[1]>l.maxY+h||~~w[1]<l.minY-h)){var x=void 0===v.count?1:v.count;"properties"in v&&"count"in v.properties&&(x=v.properties.count);v=Math.min(1,x/a);b.globalAlpha=void 0!==c.globalAlpha?c.globalAlpha:v;v=(w[0]-t)/d;w=(r-w[1])/d;0<f.width&&0<f.height&&b.drawImage(f,v-k,w-g)}}}};qa.prototype.destroy=function(){this.canvas=null};pb.prototype.initWorker=function(){var d=this;this.worker=new ed;var b=this.gl;this.worker.onmessage=function(c){d.output=
    c.data;for(c=0;c<d.output.vertex.length;c++){var a=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,a);b.bufferData(b.ARRAY_BUFFER,d.output.vertexBuffer[c],b.STATIC_DRAW);d.output.vertexBuffer[c]=a;b.bindBuffer(b.ARRAY_BUFFER,null);a=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,a);b.bufferData(b.ARRAY_BUFFER,d.output.colorBuffer[c],b.STATIC_DRAW);d.output.colorBuffer[c]=a;b.bindBuffer(b.ARRAY_BUFFER,null);a=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a);b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.output.indexBuffer[c],
    b.STATIC_DRAW);d.output.indexBuffer[c]=a;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}d.layer.webglLayer.render()}};pb.prototype.getData=function(){return this.output};var fd=function(d){function b(c){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));c.totalScale=1/3;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{scale:1/3,size:600,max:40,gradient:{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}}},
    {key:"initialize",value:function(b){var a=this.map;this.intensity=new fa({gradient:this.options.gradient});this._canvasScale=1.1;this._isShow=!0;this.canvasLayer=new qa(a,this.options,this);this.canvasLayer.scale(this.totalScale,this._canvasScale);this._update=this.update.bind(this);a.map.addEventListener("update",this._update);this.gl=b;this.dataMgr=new pb(this,this.map,this.gl);this.program=new Q(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;uniform mat4 u_matrix;varying vec4 vColor;void main(void){gl_Position=u_matrix*vec4(aPos,1);gl_PointSize=10.0;vColor=aColor;}",
            fragmentShader:"precision highp float;varying vec4 vColor;void main(void){gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(b,a){this.intensity=new fa({gradient:b.gradient});this.canvasLayer.setData(a);this.updateHeatmapModel()}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.lineWidth(100);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);if(c=this.dataMgr.getData())for(var d=0;d<
        c.vertexBuffer.length;d++)a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffer[d]),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aPos),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ARRAY_BUFFER,c.colorBuffer[d]),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aColor),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.indexBuffer[d]),a.drawElements(a.TRIANGLES,c.index[d].length,
            a.UNSIGNED_SHORT,0),a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND)}},{key:"update",value:function(b){var a=this;a._isShow?(a.canvasLayer.scale(a.totalScale,a._canvasScale),a.canvasLayer.update(function(){a.updateHeatmapModel()}),a.webglLayer.render()):a.webglLayer.clear()}},{key:"destroy",value:function(){this.setData([]);this.map.map.removeEventListener("update",this._update);this.canvasLayer.destroy()}},{key:"updateHeatmapModel",value:function(){var b=this.canvasLayer.ctx;if(!(0>=b.canvas.width||
            0>=b.canvas.height)){var a=this.map;this.dataMgr.worker.postMessage({intensity:this.intensity.getImageData(),ctx:b.getImageData(0,0,b.canvas.width,b.canvas.height),totalScale:this.totalScale,canvasScale:this._canvasScale,canvasWidth:b.canvas.width,pointOffset:this.webglLayer.options.pointOffset||[0,0],canvasHeight:b.canvas.height,bound:this.getBounds(),mapSize:a.getSize(),center:a.getCenter(),zoomUnit:a.getZoomUnits()});this.webglLayer.render()}}},{key:"getBounds",value:function(){var b=this.map.map.getBounds(),
            a=b.getNorthEast();b=b.getSouthWest();-180<a.lng&&180>a.lat&&(b=pa.convertLL2MC({lng:b.lng,lat:b.lat}),a=pa.convertLL2MC({lng:a.lng,lat:a.lat}));return{minX:b.lng,minY:b.lat,maxX:a.lng,maxY:a.lat}}}]);return b}(ia),xc=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferData=[];return c}H(b,d);A(b,[{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);}",
        fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);var d=[];b=b.color;for(var g=0;g<a.length;g++){var e=a[g].geometry.coordinates,l=a[g].color||b;"properties"in a[g]&&"color"in a[g].properties&&(l=a[g].properties.color);"[object Function]"===
    Object.prototype.toString.call(l)&&(l=l(a[g]));l=this.normizedColor(l);for(var t=0;t<e.length-1;t++){var r=this.normizedPoint(e[t]);d.push(r[0]);d.push(r[1]);d.push(r[2]);d.push(l[0],l[1],l[2],l[3]);r=this.normizedPoint(e[t+1]);d.push(r[0]);d.push(r[1]);d.push(r[2]);d.push(l[0],l[1],l[2],l[3])}}this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;!this.bufferData||0>=this.bufferData.length||
    (b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*c,3*c),b=this.getOptions().blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&
    "lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.LINES,0,this.bufferData.length/7),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST),a.useProgram(null))}}]);return b}(ia);ca(function(d,b){(function(b,a){d.exports=a()})(Lc,function(){function b(a){return"undefined"!==typeof atob?atob(a):"base64:"+a}function a(a){a=Error("(regl) "+a);console.error(a);throw a;}function d(b,c){b||a(c)}function k(a){return a?": "+a:""}
    function g(b,c,d){0>c.indexOf(b)&&a("invalid value"+k(d)+". must be one of: "+c)}function e(a,b){for(a+="";a.length<b;)a=" "+a;return a}function l(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function t(a,b){this.number=a;this.line=b;this.errors=[]}function r(a,b,c){this.file=a;this.line=b;this.message=c}function h(){var a=Error();a=(a.stack||a).toString();var b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?
        a[1]:"unknown"}function m(){var a=Error();a=(a.stack||a).toString();var b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function p(a,c){a=a.split("\n");var d=1,e=0,f={unknown:new l,0:new l};f.unknown.name=f[0].name=c||h();f.unknown.lines.push(new t(0,""));for(c=0;c<a.length;++c){var g=a[c],k=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(g);if(k)switch(k[1]){case "line":if(k=/(\d+)(\s+\d+)?/.exec(k[2]))d=k[1]|0,k[2]&&(e=k[2]|0,e in f||(f[e]=
        new l));break;case "define":if(k=/SHADER_NAME(_B64)?\s+(.*)$/.exec(k[2]))f[e].name=k[1]?b(k[2]):k[2]}f[e].lines.push(new t(d++,g))}Object.keys(f).forEach(function(a){var b=f[a];b.lines.forEach(function(a){b.index[a.number]=a})});return f}function v(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(a);c?b.push(new r(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new r("unknown",0,a))}});return b}function w(a,b){b.forEach(function(b){var c=a[b.file];
        if(c){var d=c.index[b.line];if(d){d.errors.push(b);c.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function x(a){a._commandRef=h()}function A(b,c){var d=m();a(b+" in command "+(c||h())+("unknown"===d?"":" called from "+d))}function z(a,b,c,d){("undefined"===typeof a?"undefined":W(a))!==b&&A("invalid parameter type"+k(c)+". expected "+b+", got "+("undefined"===typeof a?"undefined":W(a)),d||h())}function F(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:ra[a]*
        b}function D(a,b){this.id=db++;this.type=a;this.data=b}function C(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return C(a.substr(0,b.index)).concat(C(b[1])).concat(C(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(c=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0;c<b.length;++c)a=a.concat(C(b[c]));return a}function E(a){return"["+C(a).join("][")+"]"}function G(){var a={"":0},b=[""];return{id:function(c){var d=a[c];if(d)return d;d=a[c]=b.length;b.push(c);return d},str:function(a){return b[a]}}}function H(a,b,c){function d(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(d=a.getBoundingClientRect(),b=d.right-d.left,d=d.bottom-d.top);e.width=c*b;e.height=c*d;Z(e.style,{width:b+"px",height:d+"px"})}var e=document.createElement("canvas");Z(e.style,
        {border:0,margin:0,padding:0,top:0,left:0});a.appendChild(e);a===document.body&&(e.style.position="absolute",Z(a.style,{margin:0,padding:0}));window.addEventListener("resize",d,!1);d();return{canvas:e,onDestroy:function(){window.removeEventListener("resize",d);a.removeChild(e)}}}function I(a,b){function c(c){try{return a.getContext(c,b)}catch(X){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function K(a){if("string"===typeof a)return a.split();u(Array.isArray(a),
        "invalid extension array");return a}function L(a){return"string"===typeof a?(u("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function R(a){var b=a||{},c;a={};var d=[],e=[],f="undefined"===typeof window?1:window.devicePixelRatio,g=!1,h=function(a){a&&u.raise(a)},k=function(){};if("string"===typeof b){u("undefined"!==typeof document,"selector queries only supported in DOM enviroments");var l=document.querySelector(b);u(l,"invalid query string for element")}else if("object"===
        ("undefined"===typeof b?"undefined":W(b)))if("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect)l=b;else if("function"===typeof b.drawArrays||"function"===typeof b.drawElements){var m=b;var y=m.canvas}else u.constructor(b),"gl"in b?m=b.gl:"canvas"in b?y=L(b.canvas):"container"in b&&(c=L(b.container)),"attributes"in b&&(a=b.attributes,u.type(a,"object","invalid context attributes")),"extensions"in b&&(d=K(b.extensions)),"optionalExtensions"in
    b&&(e=K(b.optionalExtensions)),"onDone"in b&&(u.type(b.onDone,"function","invalid or missing onDone callback"),h=b.onDone),"profile"in b&&(g=!!b.profile),"pixelRatio"in b&&(f=+b.pixelRatio,u(0<f,"invalid pixel ratio"));else u.raise("invalid arguments to regl");l&&("canvas"===l.nodeName.toLowerCase()?y=l:c=l);if(!m){if(!y){u("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");l=H(c||document.body,h,f);if(!l)return null;y=l.canvas;k=l.onDestroy}m=I(y,a)}return m?
        {gl:m,canvas:y,container:c,extensions:d,optionalExtensions:e,pixelRatio:f,profile:g,onDone:h,onDestroy:k}:(k(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function U(a,b){function c(b){u.type(b,"string","extension name must be string");b=b.toLowerCase();try{var c=d[b]=a.getExtension(b)}catch(La){}return!!c}for(var d={},e=0;e<b.extensions.length;++e){var f=b.extensions[e];if(!c(f))return b.onDestroy(),b.onDone('"'+f+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
        null}b.optionalExtensions.forEach(c);return{extensions:d,restore:function(){Object.keys(d).forEach(function(a){if(d[a]&&!c(a))throw Error("(regl): error restoring extension "+a);})}}}function N(a,b){for(var c=Array(a),d=0;d<a;++d)c[d]=b(d);return c}function Q(a){var b=(65535<a)<<4;a>>>=b;var c=(255<a)<<3;a>>>=c;b|=c;c=(15<a)<<2;a>>>=c;b|=c;c=(3<a)<<1;return b|c|a>>>c>>1}function M(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}b=c[Q(a)>>2];return 0<b.length?b.pop():new ArrayBuffer(a)}
        function b(a){c[Q(a.byteLength)>>2].push(a)}var c=N(8,function(){return[]});return{alloc:a,free:b,allocType:function(b,c){switch(b){case 5120:b=new Int8Array(a(c),0,c);break;case 5121:b=new Uint8Array(a(c),0,c);break;case 5122:b=new Int16Array(a(2*c),0,c);break;case 5123:b=new Uint16Array(a(2*c),0,c);break;case 5124:b=new Int32Array(a(4*c),0,c);break;case 5125:b=new Uint32Array(a(4*c),0,c);break;case 5126:b=new Float32Array(a(4*c),0,c);break;default:return null}return b.length!==c?b.subarray(0,c):
                b},freeType:function(a){b(a.buffer)}}}function O(a){return!!a&&"object"===("undefined"===typeof a?"undefined":W(a))&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||ma(a.data))}function ca(a,b,c,d,e,f){for(var g=0;g<b;++g)for(var h=a[g],k=0;k<c;++k)for(var l=h[k],m=0;m<d;++m)e[f++]=l[m]}function fa(a,b,c,d,e){for(var f=1,g=c+1;g<b.length;++g)f*=b[g];var h=b[c];if(4===b.length-c){var k=b[c+1],l=b[c+2];b=b[c+3];for(g=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0;g<h;++g)ca(a[g],k,l,b,d,e),e+=f}else for(g=0;g<h;++g)fa(a[g],b,c+1,d,e),e+=f}function S(a){return Ub[Object.prototype.toString.call(a)]|0}function ia(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function la(a,b,c,d,e,f,g){for(var h=0,k=0;k<c;++k)for(var l=0;l<d;++l)a[h++]=b[e*k+f*l+g]}function oa(a,b,c,d){function e(b){this.id=k++;this.buffer=a.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;c.profile&&(this.stats={size:0})}function f(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c,d){b.byteLength=c.byteLength;a.bufferData(b.type,c,d)}function g(a,b,c,d,e,g){a.usage=c;if(Array.isArray(b)){if(a.dtype=d||5126,0<b.length)if(Array.isArray(b[0])){e=ib(b);for(var h=d=1;h<e.length;++h)d*=e[h];a.dimension=d;b=Xa(b,e,a.dtype);f(a,b,c);g?a.persistentData=b:V.freeType(b)}else"number"===typeof b[0]?(a.dimension=e,e=V.allocType(a.dtype,b.length),ia(e,b),f(a,e,c),g?a.persistentData=e:V.freeType(e)):ma(b[0])?(a.dimension=b[0].length,a.dtype=d||S(b[0])||5126,b=Xa(b,[b.length,b[0].length],
        a.dtype),f(a,b,c),g?a.persistentData=b:V.freeType(b)):u.raise("invalid buffer data")}else if(ma(b))a.dtype=d||S(b),a.dimension=e,f(a,b,c),g&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(O(b)){e=b.shape;var k=b.stride;h=b.offset;var l=0,m=0,y=0,p=0;1===e.length?(l=e[0],m=1,y=k[0],p=0):2===e.length?(l=e[0],m=e[1],y=k[0],p=k[1]):u.raise("invalid shape");a.dtype=d||S(b.data)||5126;a.dimension=m;e=V.allocType(a.dtype,l*m);la(e,b.data,l,m,y,p,h);f(a,e,c);g?a.persistentData=e:V.freeType(e)}else u.raise("invalid buffer data")}
        function h(c){b.bufferCount--;for(var e=0;e<d.state.length;++e){var f=d.state[e];f.buffer===c&&(a.disableVertexAttribArray(e),f.buffer=null)}e=c.buffer;u(e,"buffer must not be deleted already");a.deleteBuffer(e);c.buffer=null;delete l[c.id]}var k=0,l={};e.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};e.prototype.destroy=function(){h(this)};var m=[];c.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(l).forEach(function(b){a+=l[b].stats.size});return a});return{create:function(d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      f,k,m){function y(b){var d=35044,e=null,f=0,h=0,k=1;Array.isArray(b)||ma(b)||O(b)?e=b:"number"===typeof b?f=b|0:b&&(u.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(u(null===e||Array.isArray(e)||ma(e)||O(e),"invalid data for buffer"),e=b.data),"usage"in b&&(u.parameter(b.usage,Vb,"invalid buffer usage"),d=Vb[b.usage]),"type"in b&&(u.parameter(b.type,Pb,"invalid buffer type"),h=Pb[b.type]),"dimension"in b&&(u.type(b.dimension,"number","invalid dimension"),
                k=b.dimension|0),"length"in b&&(u.nni(f,"buffer length must be a nonnegative integer"),f=b.length|0));r.bind();e?g(r,e,d,h,k,m):(f&&a.bufferData(r.type,f,d),r.dtype=h||5121,r.usage=d,r.dimension=k,r.byteLength=f);c.profile&&(r.stats.size=r.byteLength*Sa[r.dtype]);return y}function p(b,c){u(c+b.byteLength<=r.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+c+" to a buffer of size "+r.byteLength);a.bufferSubData(r.type,c,
                b)}b.bufferCount++;var r=new e(f);l[r.id]=r;k||y(d);y._reglType="buffer";y._buffer=r;y.subdata=function(a,b){b=(b||0)|0;r.bind();if(ma(a))p(a,b);else if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var c=V.allocType(r.dtype,a.length);ia(c,a);p(c,b);V.freeType(c)}else if(Array.isArray(a[0])||ma(a[0])){var d=ib(a);a=Xa(a,d,r.dtype);p(a,b);V.freeType(a)}else u.raise("invalid buffer data")}else if(O(a)){d=a.shape;var e=a.stride,f=c=0,g=0,h=0;1===d.length?(c=d[0],f=1,g=e[0],h=0):2===d.length?
                (c=d[0],f=d[1],g=e[0],h=e[1]):u.raise("invalid shape");d=Array.isArray(a.data)?r.dtype:S(a.data);d=V.allocType(d,c*f);la(d,a.data,c,f,g,h,a.offset);p(d,b);V.freeType(d)}else u.raise("invalid data for buffer subdata");return y};c.profile&&(y.stats=r.stats);y.destroy=function(){h(r)};return y},createStream:function(a,b){var c=m.pop();c||(c=new e(a));c.bind();g(c,b,35040,0,1,!1);return c},destroyStream:function(a){m.push(a)},clear:function(){Ca(l).forEach(h);m.forEach(h)},getBuffer:function(a){return a&&
            a._buffer instanceof e?a._buffer:null},restore:function(){Ca(l).forEach(function(b){b.buffer=a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:g}}function pa(a,b,c,d){function e(a){this.id=k++;h[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function f(d,e,f,g,h,k,l){d.buffer.bind();if(e){var m=l;l||ma(e)&&(!O(e)||ma(e.data))||(m=b.oes_element_index_uint?5125:5123);c._initBuffer(d.buffer,e,f,m,3)}else a.bufferData(34963,
        k,f),d.buffer.dtype=m||5121,d.buffer.usage=f,d.buffer.dimension=3,d.buffer.byteLength=k;m=l;if(!l){switch(d.buffer.dtype){case 5121:case 5120:m=5121;break;case 5123:case 5122:m=5123;break;case 5125:case 5124:m=5125;break;default:u.raise("unsupported type for element array")}d.buffer.dtype=m}d.type=m;u(5125!==m||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");e=h;0>e&&(e=d.buffer.byteLength,5123===m?e>>=1:5125===m&&(e>>=2));d.vertCount=e;e=g;
        0>g&&(e=4,g=d.buffer.dimension,1===g&&(e=0),2===g&&(e=1),3===g&&(e=4));d.primType=e}function g(a){d.elementsCount--;u(null!==a.buffer,"must not double destroy elements");delete h[a.id];a.buffer.destroy();a.buffer=null}var h={},k=0,l={uint8:5121,uint16:5123};b.oes_element_index_uint&&(l.uint32=5125);e.prototype.bind=function(){this.buffer.bind()};var m=[];return{create:function(a,b){function h(a){if(a)if("number"===typeof a)k(a),m.primType=4,m.vertCount=a|0,m.type=5121;else{var b=null,c=35044,d=-1,
            e=-1,g=0,y=0;if(Array.isArray(a)||ma(a)||O(a))b=a;else if(u.type(a,"object","invalid arguments for elements"),"data"in a&&(b=a.data,u(Array.isArray(b)||ma(b)||O(b),"invalid data for element buffer")),"usage"in a&&(u.parameter(a.usage,Vb,"invalid element buffer usage"),c=Vb[a.usage]),"primitive"in a&&(u.parameter(a.primitive,vb,"invalid element buffer primitive"),d=vb[a.primitive]),"count"in a&&(u("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),e=a.count|0),"type"in a&&(u.parameter(a.type,
            l,"invalid buffer type"),y=l[a.type]),"length"in a)g=a.length|0;else if(g=e,5123===y||5122===y)g*=2;else if(5125===y||5124===y)g*=4;f(m,b,c,d,e,g,y)}else k(),m.primType=4,m.vertCount=0,m.type=5121;return h}var k=c.create(null,34963,!0),m=new e(k._buffer);d.elementsCount++;h(a);h._reglType="elements";h._elements=m;h.subdata=function(a,b){k.subdata(a,b);return h};h.destroy=function(){g(m)};return h},createStream:function(a){var b=m.pop();b||(b=new e(c.create(null,34963,!0,!1)._buffer));f(b,a,35040,
            -1,-1,0,0);return b},destroyStream:function(a){m.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null},clear:function(){Ca(h).forEach(g)}}}function na(a){for(var b=V.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(Infinity===a[c])b[c]=31744;else if(-Infinity===a[c])b[c]=64512;else{jb[0]=a[c];var d=Db[0],e=d>>>31<<15,f=(d<<1>>>24)-127;d=d>>13&1023;b[c]=-24>f?e:-14>f?e+(d+1024>>-14-f):15<f?e+31744:e+(f+15<<10)+d}return b}
    function aa(a){return Array.isArray(a)||ma(a)}function ja(a){return"[object "+a+"]"}function qa(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function ta(a){return Array.isArray(a)&&0!==a.length&&aa(a[0])?!0:!1}function ha(a){return Object.prototype.toString.call(a)}function Aa(a){if(!a)return!1;var b=ha(a);return 0<=Fb.indexOf(b)?!0:qa(a)||ta(a)||O(a)}function Fa(a,b){36193===a.type?(a.data=na(b),V.freeType(b)):a.data=b}function ua(a,b,c,d,e,f){a="undefined"!==typeof ea[a]?ea[a]:
        wa[a]*wb[b];f&&(a*=6);if(e){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}function Na(a,b,c,d,e,f,g){function h(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.colorSpace=37444;this.channels=this.height=this.width=0}function k(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;
        a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function l(a,d){if("object"===("undefined"===typeof d?"undefined":W(d))&&d){"premultiplyAlpha"in d&&(u.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(u.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(u.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=d.alignment);"colorSpace"in d&&(u.parameter(d.colorSpace,
        C,"invalid colorSpace"),a.colorSpace=C[d.colorSpace]);if("type"in d){var e=d.type;u(b.oes_texture_float||!("float"===e||"float32"===e),"you must enable the OES_texture_float extension in order to use floating point textures.");u(b.oes_texture_half_float||!("half float"===e||"float16"===e),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");u(b.webgl_depth_texture||!("uint16"===e||"uint32"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");
        u.parameter(e,E,"invalid texture type");a.type=E[e]}var f=a.width,g=a.height,h=a.channels;e=!1;"shape"in d?(u(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),f=d.shape[0],g=d.shape[1],3===d.shape.length&&(h=d.shape[2],u(0<h&&4>=h,"invalid number of channels"),e=!0),u(0<=f&&f<=c.maxTextureSize,"invalid width"),u(0<=g&&g<=c.maxTextureSize,"invalid height")):("radius"in d&&(f=g=d.radius,u(0<=f&&f<=c.maxTextureSize,"invalid radius")),"width"in d&&(f=d.width,u(0<=f&&f<=c.maxTextureSize,
        "invalid width")),"height"in d&&(g=d.height,u(0<=g&&g<=c.maxTextureSize,"invalid height")),"channels"in d&&(h=d.channels,u(0<h&&4>=h,"invalid number of channels"),e=!0));a.width=f|0;a.height=g|0;a.channels=h|0;f=!1;"format"in d&&(f=d.format,u(b.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),u.parameter(f,G,"invalid texture format"),g=a.internalformat=G[f],a.format=R[g],f in E&&!("type"in d)&&(a.type=
        E[f]),f in F&&(a.compressed=!0),f=!0);!e&&f?a.channels=wa[a.format]:e&&!f?a.channels!==Wb[a.format]&&(a.format=a.internalformat=Wb[a.channels]):f&&e&&u(a.channels===wa[a.format],"number of channels inconsistent with specified format")}}function m(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function y(){h.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=
        !1}function p(a,b){var d=null;Aa(b)?d=b:b&&(u.type(b,"object","invalid pixel data type"),l(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),Aa(b.data)&&(d=b.data));u(!a.compressed||d instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy)u(!d,"can not specify copy and data field for the same texture"),b=e.viewportWidth,d=e.viewportHeight,a.width=a.width||b-a.xOffset,a.height=a.height||d-a.yOffset,a.needsCopy=!0,u(0<=a.xOffset&&a.xOffset<b&&0<=a.yOffset&&
        a.yOffset<d&&0<a.width&&a.width<=b&&0<a.height&&a.height<=d,"copy texture read out of bounds");else if(!d)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(ma(d))a.channels=a.channels||4,a.data=d,"type"in b||5121!==a.type||(a.type=Ub[Object.prototype.toString.call(d)]|0);else if(qa(d)){a.channels=a.channels||4;b=d;d=b.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:d=V.allocType(a.type,d);d.set(b);a.data=d;break;case 36193:a.data=na(b);break;default:u.raise("unsupported texture type, must specify a typed array")}a.alignment=
        1;a.needsFree=!0}else if(O(d)){b=d.data;Array.isArray(b)||5121!==a.type||(a.type=Ub[Object.prototype.toString.call(b)]|0);var f=d.shape,g=d.stride;if(3===f.length){var h=f[2];var k=g[2]}else u(2===f.length,"invalid ndarray pixel data, must be 2 or 3D"),k=h=1;var m=f[0];var T=f[1];f=g[0];g=g[1];a.alignment=1;a.width=m;a.height=T;a.channels=h;a.format=a.internalformat=Wb[h];a.needsFree=!0;m=k;d=d.offset;h=a.width;k=a.height;T=a.channels;for(var y=V.allocType(36193===a.type?5126:a.type,h*k*T),p=0,r=
        0;r<k;++r)for(var t=0;t<h;++t)for(var ac=0;ac<T;++ac)y[p++]=b[f*t+g*r+m*ac+d];Fa(a,y)}else if(ha(d)===$a||ha(d)===lb)ha(d)===$a?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(ha(d)===mb)a.element=d,a.width=d.width,a.height=d.height,a.channels=4;else if(ha(d)===nb)a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight,a.channels=4;else if(ha(d)===pb)a.element=d,a.width=d.videoWidth,a.height=d.videoHeight,a.channels=4;else if(ta(d)){b=a.width||
        d[0].length;f=a.height||d.length;g=a.channels;g=aa(d[0][0])?g||d[0][0].length:g||1;m=Ia.shape(d);h=1;for(k=0;k<m.length;++k)h*=m[k];h=V.allocType(36193===a.type?5126:a.type,h);Ia.flatten(d,m,"",h);Fa(a,h);a.alignment=1;a.width=b;a.height=f;a.channels=g;a.format=a.internalformat=Wb[g];a.needsFree=!0}5126===a.type?u(0<=c.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&u(0<=c.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
        function r(b,c,e,f,g){var h=b.element,k=b.data,l=b.internalformat,T=b.format,y=b.type,p=b.width,u=b.height;m(b);h?a.texSubImage2D(c,g,e,f,T,y,h):b.compressed?a.compressedTexSubImage2D(c,g,e,f,l,p,u,k):b.needsCopy?(d(),a.copyTexSubImage2D(c,g,e,f,b.xOffset,b.yOffset,p,u)):a.texSubImage2D(c,g,e,f,p,u,T,y,k)}function t(){return N.pop()||new y}function v(a){a.needsFree&&V.freeType(a.data);y.call(a);N.push(a)}function w(){h.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
            Array(16)}function va(a,b,c){var d=a.images[0]=t();a.mipmask=1;d.width=a.width=b;d.height=a.height=c;d.channels=a.channels=4}function da(a,b){if(Aa(b)){var c=a.images[0]=t();k(c,a);p(c,b);a.mipmask=1}else if(l(a,b),Array.isArray(b.mipmap)){b=b.mipmap;for(var d=0;d<b.length;++d)c=a.images[d]=t(),k(c,a),c.width>>=d,c.height>>=d,p(c,b[d]),a.mipmask|=1<<d}else c=a.images[0]=t(),k(c,a),p(c,b),a.mipmask=1;k(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||
            33779===a.internalformat)&&u(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function x(b,c){b=b.images;for(var e=0;e<b.length&&b[e];++e){var f=b[e],g=c,h=e,k=f.element,l=f.data,T=f.internalformat,y=f.format,p=f.type,u=f.width,r=f.height,t=f.channels;m(f);k?a.texImage2D(g,h,y,y,p,k):f.compressed?a.compressedTexImage2D(g,h,T,u,r,0,l):f.needsCopy?(d(),a.copyTexImage2D(g,h,y,f.xOffset,f.yOffset,u,r,0)):((f=!l)&&(l=V.zero.allocType(p,
            u*r*t)),a.texImage2D(g,h,y,u,r,0,y,p,l),f&&l&&V.zero.freeType(l))}}function z(){var a=U.pop()||new w;h.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function Ba(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&v(b[c]),b[c]=null;U.push(a)}function X(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function A(a,b){if("min"in b){var d=b.min;u.parameter(d,Xb);a.minFilter=Xb[d];0<=Eb.indexOf(a.minFilter)&&!("faces"in
            b)&&(a.genMipmaps=!0)}"mag"in b&&(d=b.mag,u.parameter(d,D),a.magFilter=D[d]);d=a.wrapS;var e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?(u.parameter(f,xa),d=e=xa[f]):Array.isArray(f)&&(u.parameter(f[0],xa),u.parameter(f[1],xa),d=xa[f[0]],e=xa[f[1]])}else"wrapS"in b&&(d=b.wrapS,u.parameter(d,xa),d=xa[d]),"wrapT"in b&&(e=b.wrapT,u.parameter(e,xa),e=xa[e]);a.wrapS=d;a.wrapT=e;"anisotropic"in b&&(d=b.anisotropic,u("number"===typeof d&&1<=d&&d<=c.maxAnisotropic,"aniso samples must be between 1 and "),
            a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(W(b.mipmap)){case "string":u.parameter(b.mipmap,J,"invalid mipmap hint");a.mipmapHint=J[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":u(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;d=!0;break;default:u.raise("invalid mipmap type")}!d||"min"in b||(a.minFilter=9984)}}function gb(c,d){a.texParameteri(d,10241,c.minFilter);a.texParameteri(d,10240,c.magFilter);a.texParameteri(d,10242,
            c.wrapS);a.texParameteri(d,10243,c.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic);c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function $b(b){h.call(this);this.mipmask=0;this.internalformat=6408;this.id=S++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new X;g.profile&&(this.stats={size:0})}function xb(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function B(){var b=P[0];b?a.bindTexture(b.target,
            b.texture):a.bindTexture(3553,null)}function zc(b){var c=b.texture;u(c,"must not double destroy texture");var d=b.unit,e=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(e,null),P[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete Q[b.id];f.textureCount--}var J={"don't care":4352,"dont care":4352,nice:4354,fast:4353},xa={repeat:10497,clamp:33071,mirror:33648},D={nearest:9728,linear:9729},Xb=Z({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,
            "nearest mipmap linear":9986,"linear mipmap linear":9987},D),C={none:0,browser:37444},E={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},G={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},F={};b.ext_srgb&&(G.srgb=35904,G.srgba=35906);b.oes_texture_float&&(E.float32=E.float=5126);b.oes_texture_half_float&&(E.float16=E["half float"]=36193);b.webgl_depth_texture&&(Z(G,{depth:6402,"depth stencil":34041}),Z(E,{uint16:5123,uint32:5125,"depth stencil":34042}));
        b.webgl_compressed_texture_s3tc&&Z(F,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&Z(F,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&Z(F,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(F["rgb etc1"]=36196);var H=Array.prototype.slice.call(a.getParameter(34467));
        Object.keys(F).forEach(function(a){var b=F[a];0<=H.indexOf(b)&&(G[a]=b)});var I=Object.keys(G);c.textureFormats=I;var sb=[];Object.keys(G).forEach(function(a){sb[G[a]]=a});var L=[];Object.keys(E).forEach(function(a){L[E[a]]=a});var Rb=[];Object.keys(D).forEach(function(a){Rb[D[a]]=a});var hb=[];Object.keys(Xb).forEach(function(a){hb[Xb[a]]=a});var K=[];Object.keys(xa).forEach(function(a){K[xa[a]]=a});var R=I.reduce(function(a,b){var c=G[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===
        c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),N=[],U=[],S=0,Q={},M=c.maxTextureUnits,P=Array(M).map(function(){return null});Z($b.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<M;++c){var d=P[c];if(d){if(0<d.bindCount)continue;d.unit=-1}P[c]=this;b=c;break}b>=M&&u.raise("insufficient number of texture units");g.profile&&f.maxTextureUnits<b+1&&(f.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},
            unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&zc(this)}});g.profile&&(f.getTotalTextureSize=function(){var a=0;Object.keys(Q).forEach(function(b){a+=Q[b].stats.size});return a});return{create2D:function(b,d){function e(a,b){var d=h.texInfo;X.call(d);var f=z();"number"===typeof a?"number"===typeof b?va(f,a|0,b|0):va(f,a|0,a|0):a?(u.type(a,"object","invalid arguments to regl.texture"),A(d,a),da(f,a)):va(f,1,1);d.genMipmaps&&(f.mipmask=(f.width<<1)-1);h.mipmask=f.mipmask;
                k(h,f);u.texture2D(d,f,c);h.internalformat=f.internalformat;e.width=f.width;e.height=f.height;xb(h);x(f,3553);gb(d,3553);B();Ba(f);g.profile&&(h.stats.size=ua(h.internalformat,h.type,f.width,f.height,d.genMipmaps,!1));e.format=sb[h.internalformat];e.type=L[h.type];e.mag=Rb[d.magFilter];e.min=hb[d.minFilter];e.wrapS=K[d.wrapS];e.wrapT=K[d.wrapT];return e}var h=new $b(3553);Q[h.id]=h;f.textureCount++;e(b,d);e.subimage=function(a,b,c,d){u(!!a,"must specify image data");b|=0;c|=0;d|=0;var f=t();k(f,h);
                f.width=0;f.height=0;p(f,a);f.width=f.width||(h.width>>d)-b;f.height=f.height||(h.height>>d)-c;u(h.type===f.type&&h.format===f.format&&h.internalformat===f.internalformat,"incompatible format for texture.subimage");u(0<=b&&0<=c&&b+f.width<=h.width&&c+f.height<=h.height,"texture.subimage write out of bounds");u(h.mipmask&1<<d,"missing mipmap data");u(f.data||f.element||f.needsCopy,"missing image data");xb(h);r(f,3553,b,c,d);B();v(f);return e};e.resize=function(b,c){b|=0;c=c|0||b;if(b===h.width&&c===
                h.height)return e;e.width=h.width=b;e.height=h.height=c;xb(h);for(var d,f=h.channels,k=h.type,l=0;h.mipmask>>l;++l){var m=b>>l,y=c>>l;if(!m||!y)break;d=V.zero.allocType(k,m*y*f);a.texImage2D(3553,l,h.format,m,y,0,h.format,h.type,d);d&&V.zero.freeType(d)}B();g.profile&&(h.stats.size=ua(h.internalformat,h.type,b,c,!1,!1));return e};e._reglType="texture2d";e._texture=h;g.profile&&(e.stats=h.stats);e.destroy=function(){h.decRef()};return e},createCube:function(b,d,e,h,m,y){function w(a,b,d,e,f,h){var m,
                y=J.texInfo;X.call(y);for(m=0;6>m;++m)T[m]=z();if("number"!==typeof a&&a)if("object"===("undefined"===typeof a?"undefined":W(a)))if(b)da(T[0],a),da(T[1],b),da(T[2],d),da(T[3],e),da(T[4],f),da(T[5],h);else if(A(y,a),l(J,a),"faces"in a)for(a=a.faces,u(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),m=0;6>m;++m)u("object"===W(a[m])&&!!a[m],"invalid input for cube map face"),k(T[m],J),da(T[m],a[m]);else for(m=0;6>m;++m)da(T[m],a);else u.raise("invalid arguments to cube map");else for(a=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               a|0||1,m=0;6>m;++m)va(T[m],a,a);k(J,T[0]);c.npotTextureCube||u(kb(J.width)&&kb(J.height),"your browser does not support non power or two texture dimensions");J.mipmask=y.genMipmaps?(T[0].width<<1)-1:T[0].mipmask;u.textureCube(J,y,T,c);J.internalformat=T[0].internalformat;w.width=T[0].width;w.height=T[0].height;xb(J);for(m=0;6>m;++m)x(T[m],34069+m);gb(y,34067);B();g.profile&&(J.stats.size=ua(J.internalformat,J.type,w.width,w.height,y.genMipmaps,!0));w.format=sb[J.internalformat];w.type=L[J.type];w.mag=
                Rb[y.magFilter];w.min=hb[y.minFilter];w.wrapS=K[y.wrapS];w.wrapT=K[y.wrapT];for(m=0;6>m;++m)Ba(T[m]);return w}var J=new $b(34067);Q[J.id]=J;f.cubeCount++;var T=Array(6);w(b,d,e,h,m,y);w.subimage=function(a,b,c,d,e){u(!!b,"must specify image data");u("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;d|=0;e|=0;var f=t();k(f,J);f.width=0;f.height=0;p(f,b);f.width=f.width||(J.width>>e)-c;f.height=f.height||(J.height>>e)-d;u(J.type===f.type&&J.format===f.format&&J.internalformat===f.internalformat,
                "incompatible format for texture.subimage");u(0<=c&&0<=d&&c+f.width<=J.width&&d+f.height<=J.height,"texture.subimage write out of bounds");u(J.mipmask&1<<e,"missing mipmap data");u(f.data||f.element||f.needsCopy,"missing image data");xb(J);r(f,34069+a,c,d,e);B();v(f);return w};w.resize=function(b){b|=0;if(b!==J.width){w.width=J.width=b;w.height=J.height=b;xb(J);for(var c=0;6>c;++c)for(var d=0;J.mipmask>>d;++d)a.texImage2D(34069+c,d,J.format,b>>d,b>>d,0,J.format,J.type,null);B();g.profile&&(J.stats.size=
                ua(J.internalformat,J.type,w.width,w.height,!1,!0));return w}};w._reglType="textureCube";w._texture=J;g.profile&&(w.stats=J.stats);w.destroy=function(){J.decRef()};return w},clear:function(){for(var b=0;b<M;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),P[b]=null;Ca(Q).forEach(zc);f.cubeCount=0;f.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<M;++b){var c=P[b];c&&(c.bindCount=0,c.unit=-1,P[b]=null)}Ca(Q).forEach(function(b){b.texture=a.createTexture();
                a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);gb(b.texInfo,b.target)})}}}function Oa(a,b,c,d,e,f){function g(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=
        a;this.height=d}function h(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function k(a,b,c){if(a)if(a.texture){a=a.texture._texture;var d=Math.max(1,a.height);u(Math.max(1,a.width)===b&&d===c,"inconsistent width/height for supplied texture");a.refCount+=1}else a=a.renderbuffer._renderbuffer,u(a.width===b&&a.height===c,"inconsistent width/height for renderbuffer"),a.refCount+=1}function l(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,
        c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function m(a){var b=3553,c=null,d=null,e=a;"object"===("undefined"===typeof a?"undefined":W(a))&&(e=a.data,"target"in a&&(b=a.target|0));u.type(e,"function","invalid attachment data");a=e._reglType;"texture2d"===a?(c=e,u(3553===b)):"textureCube"===a?(c=e,u(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(d=e,b=36161):u.raise("invalid regl object for attachment");return new g(b,
        c,d)}function y(a,b,c,f,h){if(c)return a=d.create2D({width:a,height:b,format:f,type:h}),a._texture.refCount=0,new g(3553,a,null);a=e.create({width:a,height:b,format:f});a._renderbuffer.refCount=0;return new g(36161,null,a)}function p(a){return a&&(a.texture||a.renderbuffer)}function r(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function t(){this.id=X++;B[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=
        [];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function v(a){a.colorAttachments.forEach(h);h(a.depthAttachment);h(a.stencilAttachment);h(a.depthStencilAttachment)}function w(b){var c=b.framebuffer;u(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;f.framebufferCount--;delete B[b.id]}function va(b){var d;a.bindFramebuffer(36160,b.framebuffer);var e=b.colorAttachments;for(d=0;d<e.length;++d)l(36064+d,e[d]);for(d=e.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,
        36064+d,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);l(36096,b.depthAttachment);l(36128,b.stencilAttachment);l(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);a.isContextLost()||36053===b||u.raise("framebuffer configuration not supported, status = "+Mb[b]);a.bindFramebuffer(36160,x.next?x.next.framebuffer:null);x.cur=x.next;a.getError()}function da(a,d){function e(a,d){u(x.next!==
        g,"can not update framebuffer which is currently in use");var f=0,h=0,l=!0,r=!0;var t=null;var w=!0,da="rgba",ka="uint8",Ka=1,Ob=null,J=null,ub=null,tb=!1;if("number"===typeof a)f=a|0,h=d|0||f;else if(a){u.type(a,"object","invalid arguments for framebuffer");"shape"in a?(h=a.shape,u(Array.isArray(h)&&2<=h.length,"invalid shape for framebuffer"),f=h[0],h=h[1]):("radius"in a&&(f=h=a.radius),"width"in a&&(f=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)t=a.color||a.colors,Array.isArray(t)&&
    u(1===t.length||b.webgl_draw_buffers,"multiple render targets not supported");if(!t){"colorCount"in a&&(Ka=a.colorCount|0,u(0<Ka,"invalid color buffer count"));"colorTexture"in a&&(w=!!a.colorTexture,da="rgba4");if("colorType"in a){ka=a.colorType;if(w)u(b.oes_texture_float||!("float"===ka||"float32"===ka),"you must enable OES_texture_float in order to use floating point framebuffer objects"),u(b.oes_texture_half_float||!("half float"===ka||"float16"===ka),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");
    else if("half float"===ka||"float16"===ka)u(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),da="rgba16f";else if("float"===ka||"float32"===ka)u(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),da="rgba32f";u.oneOf(ka,A,"invalid color type")}if("colorFormat"in a)if(da=a.colorFormat,0<=z.indexOf(da))w=!0;else if(0<=Ba.indexOf(da))w=!1;else if(w)u.oneOf(a.colorFormat,z,
        "invalid color format for texture");else u.oneOf(a.colorFormat,Ba,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)tb=!(!a.depthTexture&&!a.depthStencilTexture),u(!tb||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?l=a.depth:(Ob=a.depth,r=!1));"stencil"in a&&("boolean"===typeof a.stencil?r=a.stencil:(J=a.stencil,l=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?l=r=a.depthStencil:(ub=
        a.depthStencil,r=l=!1))}else f=h=1;var B=d=a=null;if(Array.isArray(t))var X=t.map(m);else if(t)X=[m(t)];else for(X=Array(Ka),t=0;t<Ka;++t)X[t]=y(f,h,w,da,ka);u(b.webgl_draw_buffers||1>=X.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");u(X.length<=c.maxColorAttachments,"too many color attachments, not supported");f=f||X[0].width;h=h||X[0].height;Ob?a=m(Ob):l&&!r&&(a=y(f,h,tb,"depth","uint32"));J?d=m(J):r&&!l&&(d=y(f,h,!1,"stencil","uint8"));ub?B=m(ub):
        !Ob&&!J&&r&&l&&(B=y(f,h,tb,"depth stencil","depth stencil"));u(1>=!!Ob+!!J+!!ub,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");l=null;for(t=0;t<X.length;++t)k(X[t],f,h),u(!X[t]||X[t].texture&&0<=Hb.indexOf(X[t].texture._texture.format)||X[t].renderbuffer&&0<=Lb.indexOf(X[t].renderbuffer._renderbuffer.format),"framebuffer color attachment "+t+" is invalid"),X[t]&&X[t].texture&&(r=eb[X[t].texture._texture.format]*Yb[X[t].texture._texture.type],null===l?l=r:u(l===
        r,"all color attachments much have the same number of bits per pixel."));k(a,f,h);u(!a||a.texture&&6402===a.texture._texture.format||a.renderbuffer&&33189===a.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");k(d,f,h);u(!d||d.renderbuffer&&36168===d.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");k(B,f,h);u(!B||B.texture&&34041===B.texture._texture.format||B.renderbuffer&&34041===B.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");
        v(g);g.width=f;g.height=h;g.colorAttachments=X;g.depthAttachment=a;g.stencilAttachment=d;g.depthStencilAttachment=B;e.color=X.map(p);e.depth=p(a);e.stencil=p(d);e.depthStencil=p(B);e.width=g.width;e.height=g.height;va(g);return e}var g=new t;f.framebufferCount++;e(a,d);return Z(e,{resize:function(a,b){u(x.next!==g,"can not resize a framebuffer which is currently in use");a=Math.max(a|0,1);b=Math.max(b|0||a,1);if(a===g.width&&b===g.height)return e;for(var c=g.colorAttachments,d=0;d<c.length;++d)r(c[d],
            a,b);r(g.depthAttachment,a,b);r(g.stencilAttachment,a,b);r(g.depthStencilAttachment,a,b);g.width=e.width=a;g.height=e.height=b;va(g);return e},_reglType:"framebuffer",_framebuffer:g,destroy:function(){w(g);v(g)},use:function(a){x.setFBO({framebuffer:e},a)}})}var x={cur:null,next:null,dirty:!1,setFBO:null},z=["rgba"],Ba=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&Ba.push("srgba");b.ext_color_buffer_half_float&&Ba.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&Ba.push("rgba32f");var A=["uint8"];
        b.oes_texture_half_float&&A.push("half float","float16");b.oes_texture_float&&A.push("float","float32");var X=0,B={};return Z(x,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof t)?a:null},create:da,createCube:function(a){function e(a){u(0>f.indexOf(x.next),"can not update framebuffer which is currently in use");var c={color:null},g=0,h=null;var k="rgba";var l="uint8",m=1;if("number"===typeof a)g=a|0;else if(a){u.type(a,"object","invalid arguments for framebuffer");
                "shape"in a?(g=a.shape,u(Array.isArray(g)&&2<=g.length,"invalid shape for framebuffer"),u(g[0]===g[1],"cube framebuffer must be square"),g=g[0]):("radius"in a&&(g=a.radius|0),"width"in a?(g=a.width|0,"height"in a&&u(a.height===g,"must be square")):"height"in a&&(g=a.height|0));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h)&&u(1===h.length||b.webgl_draw_buffers,"multiple render targets not supported");h||("colorCount"in a&&(m=a.colorCount|0,u(0<m,"invalid color buffer count")),"colorType"in
                a&&(u.oneOf(a.colorType,A,"invalid color type"),l=a.colorType),"colorFormat"in a&&(k=a.colorFormat,u.oneOf(a.colorFormat,z,"invalid color format for texture")));"depth"in a&&(c.depth=a.depth);"stencil"in a&&(c.stencil=a.stencil);"depthStencil"in a&&(c.depthStencil=a.depthStencil)}else g=1;if(h)if(Array.isArray(h))for(a=[],k=0;k<h.length;++k)a[k]=h[k];else a=[h];else for(a=Array(m),h={radius:g,format:k,type:l},k=0;k<m;++k)a[k]=d.createCube(h);c.color=Array(a.length);for(k=0;k<a.length;++k)m=a[k],u("function"===
                typeof m&&"textureCube"===m._reglType,"invalid cube map"),g=g||m.width,u(m.width===g&&m.height===g,"invalid cube map shape"),c.color[k]={target:34069,data:a[k]};for(k=0;6>k;++k){for(m=0;m<a.length;++m)c.color[m].target=34069+k;0<k&&(c.depth=f[0].depth,c.stencil=f[0].stencil,c.depthStencil=f[0].depthStencil);if(f[k])f[k](c);else f[k]=da(c)}return Z(e,{width:g,height:g,color:a})}var f=Array(6);e(a);return Z(e,{faces:f,resize:function(a){var b=a|0;u(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");
                    if(b===e.width)return e;var d=e.color;for(a=0;a<d.length;++a)d[a].resize(b);for(a=0;6>a;++a)f[a].resize(b);e.width=e.height=b;return e},_reglType:"framebufferCube",destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){Ca(B).forEach(w)},restore:function(){x.cur=null;x.next=null;x.dirty=!0;Ca(B).forEach(function(b){b.framebuffer=a.createFramebuffer();va(b)})}})}function Ha(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;
        this.divisor=this.stride=this.offset=0}function Wa(a,b,c,d){a=c.maxAttributes;b=Array(a);for(c=0;c<a;++c)b[c]=new Ha;return{Record:Ha,scope:{},state:b}}function Za(a,b,c,d){function e(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function f(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function g(c,d,e){var f=35632===c?l:m,g=f[d];if(!g){var h=b.str(d);g=a.createShader(c);a.shaderSource(g,h);a.compileShader(g);u.shaderError(a,g,h,c,e);f[d]=
        g}return g}function h(a,b){this.id=r++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function k(c,h){var k=g(35632,c.fragId);var l=g(35633,c.vertId),m=c.program=a.createProgram();a.attachShader(m,k);a.attachShader(m,l);a.linkProgram(m);u.linkError(a,m,b.str(c.fragId),b.str(c.vertId),h);l=a.getProgramParameter(m,35718);d.profile&&(c.stats.uniformsCount=l);var p=c.uniforms;for(h=0;h<l;++h)if(k=a.getActiveUniform(m,
        h))if(1<k.size)for(var y=0;y<k.size;++y){var r=k.name.replace("[0]","["+y+"]");f(p,new e(r,b.id(r),a.getUniformLocation(m,r),k))}else f(p,new e(k.name,b.id(k.name),a.getUniformLocation(m,k.name),k));l=a.getProgramParameter(m,35721);d.profile&&(c.stats.attributesCount=l);c=c.attributes;for(h=0;h<l;++h)(k=a.getActiveAttrib(m,h))&&f(c,new e(k.name,b.id(k.name),a.getAttribLocation(m,k.name),k))}var l={},m={},p={},y=[],r=0;d.profile&&(c.getMaxUniformsCount=function(){var a=0;y.forEach(function(b){b.stats.uniformsCount>
    a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;y.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);Ca(l).forEach(b);l={};Ca(m).forEach(b);m={};y.forEach(function(b){a.deleteProgram(b.program)});y.length=0;p={};c.shaderCount=0},program:function(a,b,d){u.command(0<=a,"missing vertex shader",d);u.command(0<=b,"missing fragment shader",d);var e=p[b];e||(e=p[b]={});var f=e[a];
            f||(f=new h(b,a),c.shaderCount++,k(f,d),e[a]=f,y.push(f));return f},restore:function(){l={};m={};for(var a=0;a<y.length;++a)k(y[a])},shader:g,frag:-1,vert:-1}}function ab(a,b,c,d,e,f,g){function h(h){if(null===b.next){u(e.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');var k=5121}else u(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),k=b.next.colorAttachments[0].texture._texture.type,
        f.oes_texture_float?(u(5121===k||5126===k,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===k&&u(g.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):u(5121===k,"Reading from a framebuffer is only allowed for the type 'uint8'");var l=0,m=0,p=d.framebufferWidth,y=d.framebufferHeight,r=null;ma(h)?r=h:h&&(u.type(h,"object","invalid arguments to regl.read()"),l=h.x|0,m=h.y|
        0,u(0<=l&&l<d.framebufferWidth,"invalid x offset for regl.read"),u(0<=m&&m<d.framebufferHeight,"invalid y offset for regl.read"),p=(h.width||d.framebufferWidth-l)|0,y=(h.height||d.framebufferHeight-m)|0,r=h.data||null);r&&(5121===k?u(r instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===k&&u(r instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));u(0<p&&p+l<=d.framebufferWidth,"invalid width for read pixels");
        u(0<y&&y+m<=d.framebufferHeight,"invalid height for read pixels");c();h=p*y*4;r||(5121===k?r=new Uint8Array(h):5126===k&&(r=r||new Float32Array(h)));u.isTypedArray(r,"data buffer for regl.read() must be a typedarray");u(r.byteLength>=h,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(l,m,p,y,6408,k,r);return r}function k(a){var c;b.setFBO({framebuffer:a.framebuffer},function(){c=h(a)});return c}return function(a){return a&&"framebuffer"in a?k(a):h(a)}}function yb(a){return Array.prototype.slice.call(a)}
    function zb(a){return yb(a).join("")}function bb(){function a(){var a=[],b=[];return Z(function(){a.push.apply(a,yb(arguments))},{def:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,yb(arguments)),a.push(";"));return d},toString:function(){return zb([0<b.length?"var "+b+";":"",zb(a)])}})}function b(){function b(a,b){d(a,b,"=",c.def(a,b),";")}var c=a(),d=a(),e=c.toString,f=d.toString;return Z(function(){c.apply(c,yb(arguments))},{def:c.def,entry:c,exit:d,save:b,
        set:function(a,d,e){b(a,d);c(a,d,"=",e,";")},toString:function(){return e()+f()}})}var c=0,d=[],e=[],f=a(),g={};return{global:f,link:function(a){for(var b=0;b<e.length;++b)if(e[b]===a)return d[b];b="g"+c++;d.push(b);e.push(a);return b},block:a,proc:function(a,c){function d(){var a="a"+e.length;e.push(a);return a}var e=[];c=c||0;for(var f=0;f<c;++f)d();c=b();var h=c.toString;return g[a]=Z(c,{arg:d,toString:function(){return zb(["function(",e.join(),"){",h(),"}"])}})},scope:b,cond:function(){var a=
            zb(arguments),c=b(),d=b(),e=c.toString,f=d.toString;return Z(c,{then:function(){c.apply(c,yb(arguments));return this},else:function(){d.apply(d,yb(arguments));return this},toString:function(){var b=f();b&&(b="else{"+b+"}");return zb(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',f,"return {"];Object.keys(g).forEach(function(b){a.push('"',b,'":',g[b].toString(),",")});a.push("}");var b=zb(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,
            d.concat(b)).apply(null,e)}}}function Ea(a){return Array.isArray(a)||ma(a)||O(a)}function Ma(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function ya(a,b,c,d){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=d}function Ua(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function Y(a){return new ya(!1,!1,!1,a)}function sa(a,b){var c=a.type;return 0===c?(a=a.data.length,new ya(!0,1<=a,2<=a,b)):4===c?(a=a.data,new ya(a.thisDep,a.contextDep,a.propDep,
        b)):new ya(3===c,2===c,1===c,b)}function cb(a,b,c,d,e,f,g,h,k,l,m,p,r,t,v){function y(a){return a.replace(".","_")}function w(a,b,c){var d=y(a);V.push(a);Qb[d]=S[d]=!!c;Ta[d]=b}function x(a,b,c){var d=y(a);V.push(a);Array.isArray(c)?(S[d]=c.slice(),Qb[d]=c.slice()):S[d]=Qb[d]=c;La[d]=b}function va(){var a=bb(),c=a.link,d=a.global;a.id=ca++;a.batchId="0";var e=c(Z),f=a.shared={props:"a0"};Object.keys(Z).forEach(function(a){f[a]=d.def(e,".",a)});u.optional(function(){a.CHECK=c(u);a.commandStr=u.guessCommand();
        a.command=c(a.commandStr);a.assert=function(a,b,d){a("if(!(",b,"))",this.CHECK,".commandRaise(",c(d),",",this.command,");")};ba.invalidBlendCombinations=qb});var g=a.next={},h=a.current={};Object.keys(La).forEach(function(a){Array.isArray(S[a])&&(g[a]=d.def(f.next,".",a),h[a]=d.def(f.current,".",a))});var k=a.constants={};Object.keys(ba).forEach(function(a){k[a]=d.def(JSON.stringify(ba[a]))});a.invoke=function(b,d){switch(d.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(c(d.data),
        ".call(",e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(f.props,d.data);case 2:return b.def(f.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var m={};a.scopeAttrib=function(a){a=b.id(a);if(a in m)return m[a];var d=l.scope[a];d||(d=l.scope[a]=new Q);return m[a]=c(d)};return a}function z(a){var b=a.static;a=a.dynamic;if("profile"in b){var c=!!b.profile;var d=Y(function(a,b){return c});d.enable=c}else if("profile"in a){var e=
        a.profile;d=sa(e,function(a,b){return a.invoke(b,e)})}return d}function B(a,b){b=a.static;a=a.dynamic;if("framebuffer"in b){var c=b.framebuffer;return c?(c=h.getFramebuffer(c),u.command(c,"invalid framebuffer object"),Y(function(a,b){var d=a.link(c);a=a.shared;b.set(a.framebuffer,".next",d);a=a.context;b.set(a,".framebufferWidth",d+".width");b.set(a,".framebufferHeight",d+".height");return d})):Y(function(a,b){a=a.shared;b.set(a.framebuffer,".next","null");a=a.context;b.set(a,".framebufferWidth",
        a+".drawingBufferWidth");b.set(a,".framebufferHeight",a+".drawingBufferHeight");return"null"})}if("framebuffer"in a){var d=a.framebuffer;return sa(d,function(a,b){var c=a.invoke(b,d),e=a.shared,f=e.framebuffer,g=b.def(f,".getFramebuffer(",c,")");u.optional(function(){a.assert(b,"!"+c+"||"+g,"invalid framebuffer object")});b.set(f,".next",g);e=e.context;b.set(e,".framebufferWidth",g+"?"+g+".width:"+e+".drawingBufferWidth");b.set(e,".framebufferHeight",g+"?"+g+".height:"+e+".drawingBufferHeight");return g})}return null}
        function da(a,b,c){function d(a){if(a in e){var d=e[a];u.commandType(d,"object","invalid "+a,c.commandStr);var g=!0,h=d.x|0,k=d.y|0;if("width"in d){var l=d.width|0;u.command(0<=l,"invalid "+a,c.commandStr)}else g=!1;if("height"in d){var m=d.height|0;u.command(0<=m,"invalid "+a,c.commandStr)}else g=!1;return new ya(!g&&b&&b.thisDep,!g&&b&&b.contextDep,!g&&b&&b.propDep,function(a,b){a=a.shared.context;var c=l;"width"in d||(c=b.def(a,".","framebufferWidth","-",h));var e=m;"height"in d||(e=b.def(a,".",
            "framebufferHeight","-",k));return[h,k,c,e]})}if(a in f){var p=f[a];g=sa(p,function(b,c){var d=b.invoke(c,p);u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var e=b.shared.context,f=c.def(d,".x|0"),g=c.def(d,".y|0"),h=c.def('"width" in ',d,"?",d,".width|0:","(",e,".","framebufferWidth","-",f,")"),k=c.def('"height" in ',d,"?",d,".height|0:","(",e,".","framebufferHeight","-",g,")");u.optional(function(){b.assert(c,h+">=0&&"+k+">=0","invalid "+a)});return[f,g,h,k]});b&&
        (g.thisDep=g.thisDep||b.thisDep,g.contextDep=g.contextDep||b.contextDep,g.propDep=g.propDep||b.propDep);return g}return b?new ya(b.thisDep,b.contextDep,b.propDep,function(a,b){a=a.shared.context;return[0,0,b.def(a,".","framebufferWidth"),b.def(a,".","framebufferHeight")]}):null}var e=a.static,f=a.dynamic;if(a=d("viewport")){var g=a;a=new ya(a.thisDep,a.contextDep,a.propDep,function(a,b){var c=g.append(a,b);a=a.shared.context;b.set(a,".viewportWidth",c[2]);b.set(a,".viewportHeight",c[3]);return c})}return{viewport:a,
            scissor_box:d("scissor.box")}}function A(a){function c(a){if(a in d){var c=b.id(d[a]);u.optional(function(){m.shader(rb[a],c,u.guessCommand())});var f=Y(function(){return c});f.id=c;return f}if(a in e){var g=e[a];return sa(g,function(b,c){var d=b.invoke(c,g),e=c.def(b.shared.strings,".id(",d,")");u.optional(function(){c(b.shared.shader,".shader(",rb[a],",",e,",",b.command,");")});return e})}return null}var d=a.static,e=a.dynamic,f=c("frag"),g=c("vert"),h=null;Ua(f)&&Ua(g)?(h=m.program(g.id,f.id),
            a=Y(function(a,b){return a.link(h)})):a=new ya(f&&f.thisDep||g&&g.thisDep,f&&f.contextDep||g&&g.contextDep,f&&f.propDep||g&&g.propDep,function(a,b){var c=a.shared.shader;var d=f?f.append(a,b):b.def(c,".","frag");var e=g?g.append(a,b):b.def(c,".","vert");var h=c+".program("+e+","+d;u.optional(function(){h+=","+a.command});return b.def(h+")")});return{frag:f,vert:g,progVar:a,program:h}}function X(a,b){function c(a,c){if(a in d){var f=d[a]|0;u.command(!c||0<=f,"invalid "+a,b.commandStr);return Y(function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b){c&&(a.OFFSET=f);return f})}if(a in e){var h=e[a];return sa(h,function(b,d){var e=b.invoke(d,h);c&&(b.OFFSET=e,u.optional(function(){b.assert(d,e+">=0","invalid "+a)}));return e})}return c&&g?Y(function(a,b){a.OFFSET="0";return 0}):null}var d=a.static,e=a.dynamic,g=function(){if("elements"in d){var a=d.elements;Ea(a)?a=f.getElements(f.create(a,!0)):a&&(a=f.getElements(a),u.command(a,"invalid elements",b.commandStr));var c=Y(function(b,c){return a?(c=b.link(a),b.ELEMENTS=c):b.ELEMENTS=null});c.value=
            a;return c}if("elements"in e){var g=e.elements;return sa(g,function(a,b){var c=a.shared,d=c.isBufferArgs;c=c.elements;var e=a.invoke(b,g),f=b.def("null");d=b.def(d,"(",e,")");var h=a.cond(d).then(f,"=",c,".createStream(",e,");").else(f,"=",c,".getElements(",e,");");u.optional(function(){a.assert(h.else,"!"+e+"||"+f,"invalid elements")});b.entry(h);b.exit(a.cond(d).then(c,".destroyStream(",f,");"));return a.ELEMENTS=f})}return null}(),h=c("offset",!0);return{elements:g,primitive:function(){if("primitive"in
                d){var a=d.primitive;u.commandParameter(a,vb,"invalid primitve",b.commandStr);return Y(function(b,c){return vb[a]})}if("primitive"in e){var c=e.primitive;return sa(c,function(a,b){var d=a.constants.primTypes,e=a.invoke(b,c);u.optional(function(){a.assert(b,e+" in "+d,"invalid primitive, must be one of "+Object.keys(vb))});return b.def(d,"[",e,"]")})}return g?Ua(g)?g.value?Y(function(a,b){return b.def(a.ELEMENTS,".primType")}):Y(function(){return 4}):new ya(g.thisDep,g.contextDep,g.propDep,function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b){a=a.ELEMENTS;return b.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in d){var a=d.count|0;u.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return Y(function(){return a})}if("count"in e){var c=e.count;return sa(c,function(a,b){var d=a.invoke(b,c);u.optional(function(){a.assert(b,"typeof "+d+'==="number"&&'+d+">=0&&"+d+"===("+d+"|0)","invalid vertex count")});return d})}if(g){if(Ua(g)){if(g)return h?new ya(h.thisDep,h.contextDep,h.propDep,function(a,b){var c=
                b.def(a.ELEMENTS,".vertCount-",a.OFFSET);u.optional(function(){a.assert(b,c+">=0","invalid vertex offset/element buffer too small")});return c}):Y(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var f=Y(function(){return-1});u.optional(function(){f.MISSING=!0});return f}var k=new ya(g.thisDep||h.thisDep,g.contextDep||h.contextDep,g.propDep||h.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")});u.optional(function(){k.DYNAMIC=
                !0});return k}return null}(),instances:c("instances",!1),offset:h}}function E(a,b){var c=a.static,e=a.dynamic,f={};V.forEach(function(a){function g(b,d){if(a in c){var g=b(c[a]);f[h]=Y(function(){return g})}else if(a in e){var k=e[a];f[h]=sa(k,function(a,b){return d(a,b,a.invoke(b,k))})}}var h=y(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return g(function(c){u.commandType(c,
            "boolean",a,b.commandStr);return c},function(b,c,d){u.optional(function(){b.assert(c,"typeof "+d+'==="boolean"',"invalid flag "+a,b.commandStr)});return d});case "depth.func":return g(function(c){u.commandParameter(c,Ab,"invalid "+a,b.commandStr);return Ab[c]},function(b,c,d){var e=b.constants.compareFuncs;u.optional(function(){b.assert(c,d+" in "+e,"invalid "+a+", must be one of "+Object.keys(Ab))});return c.def(e,"[",d,"]")});case "depth.range":return g(function(a){u.command(aa(a)&&2===a.length&&
            "number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var d=b.def("+",c,"[0]"),e=b.def("+",c,"[1]");return[d,e]});case "blend.func":return g(function(a){u.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,
            d="srcAlpha"in a?a.srcAlpha:a.src,e="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;u.commandParameter(c,Ga,h+".srcRGB",b.commandStr);u.commandParameter(d,Ga,h+".srcAlpha",b.commandStr);u.commandParameter(e,Ga,h+".dstRGB",b.commandStr);u.commandParameter(a,Ga,h+".dstAlpha",b.commandStr);u.command(-1===qb.indexOf(c+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+e+")",b.commandStr);return[Ga[c],Ga[e],Ga[d],Ga[a]]},function(b,c,d){function e(e,g){var h=c.def('"',e,
            g,'" in ',d,"?",d,".",e,g,":",d,".",e);u.optional(function(){b.assert(c,h+" in "+f,"invalid "+a+"."+e+g+", must be one of "+Object.keys(Ga))});return h}var f=b.constants.blendFuncs;u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});var g=e("src","RGB"),h=e("dst","RGB");u.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+g+'+", "+'+h+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var k=c.def(f,
            "[",g,"]"),l=c.def(f,"[",e("src","Alpha"),"]"),m=c.def(f,"[",h,"]"),p=c.def(f,"[",e("dst","Alpha"),"]");return[k,m,l,p]});case "blend.equation":return g(function(c){if("string"===typeof c)return u.commandParameter(c,P,"invalid "+a,b.commandStr),[P[c],P[c]];if("object"===("undefined"===typeof c?"undefined":W(c)))return u.commandParameter(c.rgb,P,a+".rgb",b.commandStr),u.commandParameter(c.alpha,P,a+".alpha",b.commandStr),[P[c.rgb],P[c.alpha]];u.commandRaise("invalid blend.equation",b.commandStr)},
            function(b,c,d){var e=b.constants.blendEquations,f=c.def(),g=c.def(),h=b.cond("typeof ",d,'==="string"');u.optional(function(){function c(a,c,d){b.assert(a,d+" in "+e,"invalid "+c+", must be one of "+Object.keys(P))}c(h.then,a,d);b.assert(h.else,d+"&&typeof "+d+'==="object"',"invalid "+a);c(h.else,a+".rgb",d+".rgb");c(h.else,a+".alpha",d+".alpha")});h.then(f,"=",g,"=",e,"[",d,"];");h.else(f,"=",e,"[",d,".rgb];",g,"=",e,"[",d,".alpha];");c(h);return[f,g]});case "blend.color":return g(function(a){u.command(aa(a)&&
            4===a.length,"blend.color must be a 4d array",b.commandStr);return N(4,function(b){return+a[b]})},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")});return N(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return g(function(a){u.commandType(a,"number",h,b.commandStr);return a|0},function(a,b,c){u.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});
            case "stencil.func":return g(function(c){u.commandType(c,"object",h,b.commandStr);var d=c.cmp||"keep",e=c.ref||0;c="mask"in c?c.mask:-1;u.commandParameter(d,Ab,a+".cmp",b.commandStr);u.commandType(e,"number",a+".ref",b.commandStr);u.commandType(c,"number",a+".mask",b.commandStr);return[Ab[d],e,c]},function(a,b,c){var d=a.constants.compareFuncs;u.optional(function(){function e(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(c+"&&typeof ",c,'==="object"');e('!("cmp" in ',
                c,")||(",c,".cmp in ",d,")")});var e=b.def('"cmp" in ',c,"?",d,"[",c,".cmp]",":",7680),f=b.def(c,".ref|0"),g=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[e,f,g]});case "stencil.opFront":case "stencil.opBack":return g(function(c){u.commandType(c,"object",h,b.commandStr);var d=c.fail||"keep",e=c.zfail||"keep";c=c.zpass||"keep";u.commandParameter(d,Va,a+".fail",b.commandStr);u.commandParameter(e,Va,a+".zfail",b.commandStr);u.commandParameter(c,Va,a+".zpass",b.commandStr);return["stencil.opBack"===
            a?1029:1028,Va[d],Va[e],Va[c]]},function(b,c,d){function e(e){u.optional(function(){b.assert(c,'!("'+e+'" in '+d+")||("+d+"."+e+" in "+f+")","invalid "+a+"."+e+", must be one of "+Object.keys(Va))});return c.def('"',e,'" in ',d,"?",f,"[",d,".",e,"]:",7680)}var f=b.constants.stencilOps;u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return g(function(a){u.commandType(a,
                "object",h,b.commandStr);var c=a.factor|0;a=a.units|0;u.commandType(c,"number",h+".factor",b.commandStr);u.commandType(a,"number",h+".units",b.commandStr);return[c,a]},function(b,c,d){u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var e=c.def(d,".factor|0"),f=c.def(d,".units|0");return[e,f]});case "cull.face":return g(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);u.command(!!c,h,b.commandStr);return c},function(a,b,c){u.optional(function(){a.assert(b,
                c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return g(function(a){u.command("number"===typeof a&&a>=d.lineWidthDims[0]&&a<=d.lineWidthDims[1],"invalid line width, must be a positive number between "+d.lineWidthDims[0]+" and "+d.lineWidthDims[1],b.commandStr);return a},function(a,b,c){u.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">="+d.lineWidthDims[0]+"&&"+c+"<="+d.lineWidthDims[1],"invalid line width")});return c});
            case "frontFace":return g(function(a){u.commandParameter(a,fb,h,b.commandStr);return fb[a]},function(a,b,c){u.optional(function(){a.assert(b,c+'==="cw"||'+c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return g(function(a){u.command(aa(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4",
                "invalid color.mask")});return N(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return g(function(a){u.command("object"===("undefined"===typeof a?"undefined":W(a))&&a,h,b.commandStr);var c="value"in a?a.value:1;a=!!a.invert;u.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[c,a]},function(a,b,c){u.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var d=b.def('"value" in ',
                c,"?+",c,".value:1"),e=b.def("!!",c,".invert");return[d,e]})}});return f}function D(a,b){var c=a.static,d=a.dynamic,e={};Object.keys(c).forEach(function(a){var d=c[a];if("number"===typeof d||"boolean"===typeof d)var f=Y(function(){return d});else if("function"===typeof d){var g=d._reglType;"texture2d"===g||"textureCube"===g?f=Y(function(a){return a.link(d)}):"framebuffer"===g||"framebufferCube"===g?(u.command(0<d.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),
            f=Y(function(a){return a.link(d.color[0])})):u.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else aa(d)?f=Y(function(b){return b.global.def("[",N(d.length,function(c){u.command("number"===typeof d[c]||"boolean"===typeof d[c],"invalid uniform "+a,b.commandStr);return d[c]}),"]")}):u.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);f.value=d;e[a]=f});Object.keys(d).forEach(function(a){var b=d[a];e[a]=sa(b,function(a,c){return a.invoke(c,b)})});return e}function ub(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       c){var d=a.static,f=a.dynamic,g={};Object.keys(d).forEach(function(a){var f=d[a],h=b.id(a),k=new Q;if(Ea(f))k.state=1,k.buffer=e.getBuffer(e.create(f,34962,!1,!0)),k.type=0;else{var l=e.getBuffer(f);if(l)k.state=1,k.buffer=l,k.type=0;else if(u.command("object"===("undefined"===typeof f?"undefined":W(f))&&f,"invalid data for attribute "+a,c.commandStr),"constant"in f){var m=f.constant;k.buffer="null";k.state=2;"number"===typeof m?k.x=m:(u.command(aa(m)&&0<m.length&&4>=m.length,"invalid constant for attribute "+
            a,c.commandStr),Bb.forEach(function(a,b){b<m.length&&(k[a]=m[b])}))}else{l=Ea(f.buffer)?e.getBuffer(e.create(f.buffer,34962,!1,!0)):e.getBuffer(f.buffer);u.command(!!l,'missing buffer for attribute "'+a+'"',c.commandStr);var p=f.offset|0;u.command(0<=p,'invalid offset for attribute "'+a+'"',c.commandStr);var r=f.stride|0;u.command(0<=r&&256>r,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',c.commandStr);var y=f.size|0;u.command(!("size"in f)||0<y&&4>=y,'invalid size for attribute "'+
            a+'", must be 1,2,3,4',c.commandStr);var t=!!f.normalized,T=0;"type"in f&&(u.commandParameter(f.type,Pb,"invalid type for attribute "+a,c.commandStr),T=Pb[f.type]);var w=f.divisor|0;"divisor"in f&&(u.command(0===w||O,'cannot specify divisor for attribute "'+a+'", instancing not supported',c.commandStr),u.command(0<=w,'invalid divisor for attribute "'+a+'"',c.commandStr));u.optional(function(){var b=c.commandStr,d="buffer offset divisor normalized type size stride".split(" ");Object.keys(f).forEach(function(c){u.command(0<=
            d.indexOf(c),'unknown parameter "'+c+'" for attribute pointer "'+a+'" (valid parameters are '+d+")",b)})});k.buffer=l;k.state=1;k.size=y;k.normalized=t;k.type=T||l.dtype;k.offset=p;k.stride=r;k.divisor=w}}g[a]=Y(function(a,b){b=a.attribCache;if(h in b)return b[h];var c={isStream:!1};Object.keys(k).forEach(function(a){c[a]=k[a]});k.buffer&&(c.buffer=a.link(k.buffer),c.type=c.type||c.buffer+".dtype");return b[h]=c})});Object.keys(f).forEach(function(a){var b=f[a];g[a]=sa(b,function(c,d){function e(a){d(l[a],
            "=",f,".",a,"|0;")}var f=c.invoke(d,b),g=c.shared,h=g.isBufferArgs,k=g.buffer;u.optional(function(){c.assert(d,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+h+"("+f+")||"+k+".getBuffer("+f+")||"+k+".getBuffer("+f+".buffer)||"+h+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+g.isArrayLike+"("+f+".constant))))",'invalid dynamic attribute "'+a+'"')});var l={isStream:d.def(!1)},m=new Q;m.state=1;Object.keys(m).forEach(function(a){l[a]=d.def(""+m[a])});var p=
            l.buffer,r=l.type;d("if(",h,"(",f,")){",l.isStream,"=true;",p,"=",k,".createStream(",34962,",",f,");",r,"=",p,".dtype;","}else{",p,"=",k,".getBuffer(",f,");","if(",p,"){",r,"=",p,".dtype;",'}else if("constant" in ',f,"){",l.state,"=",2,";","if(typeof "+f+'.constant === "number"){',l[Bb[0]],"=",f,".constant;",Bb.slice(1).map(function(a){return l[a]}).join("="),"=0;","}else{",Bb.map(function(a,b){return l[a]+"="+f+".constant.length>"+b+"?"+f+".constant["+b+"]:0;"}).join(""),"}}else{","if(",h,"(",f,
            ".buffer)){",p,"=",k,".createStream(",34962,",",f,".buffer);","}else{",p,"=",k,".getBuffer(",f,".buffer);","}",r,'="type" in ',f,"?",g.glTypes,"[",f,".type]:",p,".dtype;",l.normalized,"=!!",f,".normalized;");e("size");e("offset");e("stride");e("divisor");d("}}");d.exit("if(",l.isStream,"){",k,".destroyStream(",p,");","}");return l})});return g}function G(a){var b=a.static,c=a.dynamic,d={};Object.keys(b).forEach(function(a){var c=b[a];d[a]=Y(function(a,b){return"number"===typeof c||"boolean"===typeof c?
            ""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];d[a]=sa(b,function(a,c){return a.invoke(c,b)})});return d}function C(a,b,c,d,e){function f(a){var b=l[a];b&&(p[a]=b)}var g=a.static,h=a.dynamic;u.optional(function(){function a(a){Object.keys(a).forEach(function(a){u.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(V);a(g);a(h)});var k=B(a,e),l=da(a,k,e),m=X(a,e),p=E(a,
            e),r=A(a,e);f("viewport");f(y("scissor.box"));var t=0<Object.keys(p).length;k={framebuffer:k,draw:m,shader:r,state:p,dirty:t};k.profile=z(a,e);k.uniforms=D(c,e);k.attributes=ub(b,e);k.context=G(d,e);return k}function Ka(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach(function(f){b.save(d,"."+f);e(d,".",f,"=",c[f].append(a,b),";")});b(e)}function F(a,b,c,d){var e=a.shared,f=e.gl,g=e.framebuffer,h;M&&(h=b.def(e.extensions,".webgl_draw_buffers"));var k=a.constants;e=k.drawBuffer;k=k.backBuffer;
            a=c?c.append(a,b):b.def(g,".next");d||b("if(",a,"!==",g,".cur){");b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");M&&b(h,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);");b("}else{",f,".bindFramebuffer(",36160,",null);");M&&b(h,".drawBuffersWEBGL(",k,");");b("}",g,".cur=",a,";");d||b("}")}function Ba(a,b,c){var d=a.shared,e=d.gl,f=a.current,g=a.next,h=d.current,k=d.next,l=a.cond(h,".dirty");V.forEach(function(b){b=y(b);if(!(b in c.state))if(b in g){var d=g[b];var m=f[b];
            var p=N(S[b].length,function(a){return l.def(d,"[",a,"]")});l(a.cond(p.map(function(a,b){return a+"!=="+m+"["+b+"]"}).join("||")).then(e,".",La[b],"(",p,");",p.map(function(a,b){return m+"["+b+"]="+a}).join(";"),";"))}else d=l.def(k,".",b),p=a.cond(d,"!==",h,".",b),l(p),b in Ta?p(a.cond(d).then(e,".enable(",Ta[b],");").else(e,".disable(",Ta[b],");"),h,".",b,"=",d,";"):p(e,".",La[b],"(",d,");",h,".",b,"=",d,";")});0===Object.keys(c.state).length&&l(h,".dirty=false;");b(l)}function gb(a,b,c,d){var e=
            a.shared,f=a.current,g=e.current,h=e.gl;Ma(Object.keys(c)).forEach(function(e){var k=c[e];if(!d||d(k)){var l=k.append(a,b);if(Ta[e]){var m=Ta[e];Ua(k)?l?b(h,".enable(",m,");"):b(h,".disable(",m,");"):b(a.cond(l).then(h,".enable(",m,");").else(h,".disable(",m,");"));b(g,".",e,"=",l,";")}else if(aa(l)){var p=f[e];b(h,".",La[e],"(",l,");",l.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";")}else b(h,".",La[e],"(",l,");",g,".",e,"=",l,";")}})}function ka(a,b){O&&(a.instancing=b.def(a.shared.extensions,
            ".angle_instanced_arrays"))}function Tb(a,b,c,d,e){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function g(a){u=b.def();a(u,"=",f(),";");"string"===typeof e?a(m,".count+=",e,";"):a(m,".count++;");t&&(d?(y=b.def(),a(y,"=",r,".getNumPendingQueries();")):a(r,".beginQuery(",m,");"))}function h(a){a(m,".cpuTime+=",f(),"-",u,";");t&&(d?a(r,".pushScopeStats(",y,",",r,".getNumPendingQueries(),",m,");"):a(r,".endQuery();"))}function k(a){var c=b.def(p,".profile");b(p,
            ".profile=",a,";");b.exit(p,".profile=",c,";")}var l=a.shared,m=a.stats,p=l.current,r=l.timer;c=c.profile;var u,y;if(c){if(Ua(c)){c.enable?(g(b),h(b.exit),k("true")):k("false");return}c=c.append(a,b);k(c)}else c=b.def(p,".profile");l=a.block();g(l);b("if(",c,"){",l,"}");a=a.block();h(a);b.exit("if(",c,"){",a,"}")}function H(a,b,c,d,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
            function g(c,d,e){function f(){b("if(!",m,".buffer){",k,".enableVertexAttribArray(",l,");}");var c=e.type;var f=e.size?b.def(e.size,"||",d):d;b("if(",m,".type!==",c,"||",m,".size!==",f,"||",u.map(function(a){return m+"."+a+"!=="+e[a]}).join("||"),"){",k,".bindBuffer(",34962,",",p,".buffer);",k,".vertexAttribPointer(",[l,f,c,e.normalized,e.stride,e.offset],");",m,".type=",c,";",m,".size=",f,";",u.map(function(a){return m+"."+a+"="+e[a]+";"}).join(""),"}");O&&(c=e.divisor,b("if(",m,".divisor!==",c,
                "){",a.instancing,".vertexAttribDivisorANGLE(",[l,c],");",m,".divisor=",c,";}"))}function g(){b("if(",m,".buffer){",k,".disableVertexAttribArray(",l,");","}if(",Bb.map(function(a,b){return m+"."+a+"!=="+r[b]}).join("||"),"){",k,".vertexAttrib4f(",l,",",r,");",Bb.map(function(a,b){return m+"."+a+"="+r[b]+";"}).join(""),"}")}var k=h.gl,l=b.def(c,".location"),m=b.def(h.attributes,"[",l,"]");c=e.state;var p=e.buffer,r=[e.x,e.y,e.z,e.w],u=["buffer","normalized","offset","stride"];1===c?f():2===c?g():(b("if(",
                c,"===",1,"){"),f(),b("}else{"),g(),b("}"))}var h=a.shared;d.forEach(function(d){var h=d.name,k=c.attributes[h];if(k){if(!e(k))return;var l=k.append(a,b)}else{if(!e(Cb))return;var m=a.scopeAttrib(h);u.optional(function(){a.assert(b,m+".state","missing attribute "+h)});l={};Object.keys(new Q).forEach(function(a){l[a]=b.def(m,".",a)})}g(a.link(d),f(d.info.type),l)})}function I(a,c,d,e,f){for(var g=a.shared,h=g.gl,k,l=0;l<e.length;++l){var m=e[l],p=m.name,r=m.info.type,y=d.uniforms[p];m=a.link(m)+".location";
            if(y){if(!f(y))continue;if(Ua(y)){var t=y.value;u.command(null!==t&&"undefined"!==typeof t,'missing uniform "'+p+'"',a.commandStr);if(35678===r||35680===r)u.command("function"===typeof t&&(35678===r&&("texture2d"===t._reglType||"framebuffer"===t._reglType)||35680===r&&("textureCube"===t._reglType||"framebufferCube"===t._reglType)),"invalid texture for uniform "+p,a.commandStr),y=a.link(t._texture||t.color[0]._texture),c(h,".uniform1i(",m,",",y+".bind());"),c.exit(y,".unbind();");else if(35674===r||
                35675===r||35676===r){u.optional(function(){u.command(aa(t),"invalid matrix for uniform "+p,a.commandStr);u.command(35674===r&&4===t.length||35675===r&&9===t.length||35676===r&&16===t.length,"invalid length for matrix uniform "+p,a.commandStr)});y=a.global.def("new Float32Array(["+Array.prototype.slice.call(t)+"])");var w=2;35675===r?w=3:35676===r&&(w=4);c(h,".uniformMatrix",w,"fv(",m,",false,",y,");")}else{switch(r){case 5126:u.commandType(t,"number","uniform "+p,a.commandStr);k="1f";break;case 35664:u.command(aa(t)&&
                2===t.length,"uniform "+p,a.commandStr);k="2f";break;case 35665:u.command(aa(t)&&3===t.length,"uniform "+p,a.commandStr);k="3f";break;case 35666:u.command(aa(t)&&4===t.length,"uniform "+p,a.commandStr);k="4f";break;case 35670:u.commandType(t,"boolean","uniform "+p,a.commandStr);k="1i";break;case 5124:u.commandType(t,"number","uniform "+p,a.commandStr);k="1i";break;case 35671:u.command(aa(t)&&2===t.length,"uniform "+p,a.commandStr);k="2i";break;case 35667:u.command(aa(t)&&2===t.length,"uniform "+p,
                a.commandStr);k="2i";break;case 35672:u.command(aa(t)&&3===t.length,"uniform "+p,a.commandStr);k="3i";break;case 35668:u.command(aa(t)&&3===t.length,"uniform "+p,a.commandStr);k="3i";break;case 35673:u.command(aa(t)&&4===t.length,"uniform "+p,a.commandStr);k="4i";break;case 35669:u.command(aa(t)&&4===t.length,"uniform "+p,a.commandStr),k="4i"}c(h,".uniform",k,"(",m,",",aa(t)?Array.prototype.slice.call(t):t,");")}continue}else var v=y.append(a,c)}else{if(!f(Cb))continue;v=c.def(g.uniforms,"[",b.id(p),
                "]")}35678===r?c("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}"):35680===r&&c("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}");u.optional(function(){function b(b,d){a.assert(c,b,'bad data or missing for uniform "'+p+'".  '+d)}function d(a){b("typeof "+v+'==="'+a+'"',"invalid type, expected "+a)}function e(c,d){b(g.isArrayLike+"("+v+")&&"+v+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function f(c){b("typeof "+v+'==="function"&&'+
                v+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:d("number");break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");break;case 5126:d("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:d("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,
                "number");break;case 35676:e(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});y=1;switch(r){case 35678:case 35680:y=c.def(v,"._texture");c(h,".uniform1i(",m,",",y,".bind());");c.exit(y,".unbind();");continue;case 5124:case 35670:k="1i";break;case 35667:case 35671:k="2i";y=2;break;case 35668:case 35672:k="3i";y=3;break;case 35669:case 35673:k="4i";y=4;break;case 5126:k="1f";break;case 35664:k="2f";y=2;break;case 35665:k="3f";y=3;break;case 35666:k="4f";y=4;break;case 35674:k="Matrix2fv";
                break;case 35675:k="Matrix3fv";break;case 35676:k="Matrix4fv"}c(h,".uniform",k,"(",m,",");if("M"===k.charAt(0)){m=Math.pow(r-35674+2,2);var T=a.global.def("new Float32Array(",m,")");c("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",N(m,function(a){return T+"["+a+"]="+v+"["+a+"]"}),",",T,")")}else 1<y?c(N(y,function(a){return v+"["+a+"]"})):c(v);c(");")}}function K(a,b,c,d){function e(e){var f=m[e];return f?f.contextDep&&d.contextDynamic||f.propDep?f.append(a,c):f.append(a,b):
            b.def(l,".",e)}function f(){function a(){c(w,".drawElementsInstancedANGLE(",[r,t,T,y+"<<(("+T+"-5121)>>1)",v],");")}function b(){c(w,".drawArraysInstancedANGLE(",[r,y,t,v],");")}p?x?a():(c("if(",p,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(k+".drawElements("+[r,t,T,y+"<<(("+T+"-5121)>>1)"]+");")}function b(){c(k+".drawArrays("+[r,y,t]+");")}p?x?a():(c("if(",p,"){"),a(),c("}else{"),b(),c("}")):b()}var h=a.shared,k=h.gl,l=h.draw,m=d.draw,p=function(){var e=m.elements,f=b;if(e){if(e.contextDep&&
            d.contextDynamic||e.propDep)f=c;e=e.append(a,f)}else e=f.def(l,".","elements");e&&f("if("+e+")"+k+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),r=e("primitive"),y=e("offset"),t=function(){var e=m.count,f=b;if(e){if(e.contextDep&&d.contextDynamic||e.propDep)f=c;var g=e.append(a,f);u.optional(function(){e.MISSING&&a.assert(b,"false","missing vertex count");e.DYNAMIC&&a.assert(f,g+">=0","missing vertex count")})}else g=f.def(l,".","count"),u.optional(function(){a.assert(f,g+">=0","missing vertex count")});
            return g}();if("number"===typeof t){if(0===t)return}else c("if(",t,"){"),c.exit("}");if(O){var v=e("instances");var w=a.instancing}var T=p+".type",x=m.elements&&Ua(m.elements);O&&("number"!==typeof v||0<=v)?"string"===typeof v?(c("if(",v,">0){"),f(),c("}else if(",v,"<0){"),g(),c("}")):f():g()}function L(a,b,c,d,e){var f=va();e=f.proc("body",e);u.optional(function(){f.commandStr=b.commandStr;f.command=f.link(b.commandStr)});O&&(f.instancing=e.def(f.shared.extensions,".angle_instanced_arrays"));a(f,
            e,c,d);return f.compile().body}function yc(a,b,c,d){ka(a,b);H(a,b,c,d.attributes,function(){return!0});I(a,b,c,d.uniforms,function(){return!0});K(a,b,b,c)}function R(a,b){var c=a.proc("draw",1);ka(a,c);Ka(a,c,b.context);F(a,c,b.framebuffer);Ba(a,c,b);gb(a,c,b.state);Tb(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)yc(a,c,b,b.shader.program);else{var e=a.global.def("{}"),f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);").else(g,
            "=",e,"[",f,"]=",a.link(function(c){return L(yc,a,b,c,1)}),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Rb(a,b,c,d){function e(){return!0}a.batchId="a1";ka(a,b);H(a,b,c,d.attributes,e);I(a,b,c,d.uniforms,e);K(a,b,b,c)}function hb(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}ka(a,b);var g=c.contextDep,h=b.def(),k=b.def();a.shared.props=k;a.batchId=h;var l=a.scope(),m=a.scope();b(l.entry,"for(",h,"=0;",
            h,"<","a1",";++",h,"){",k,"=","a0","[",h,"];",m,"}",l.exit);c.needsContext&&Ka(a,m,c.context);c.needsFramebuffer&&F(a,m,c.framebuffer);gb(a,m,c.state,e);c.profile&&e(c.profile)&&Tb(a,m,c,!1,!0);d?(H(a,l,c,d.attributes,f),H(a,m,c,d.attributes,e),I(a,l,c,d.uniforms,f),I(a,m,c,d.uniforms,e),K(a,l,m,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,m),k=m.def(d,".id"),l=m.def(b,"[",k,"]"),m(a.shared.gl,".useProgram(",d,".program);","if(!",l,"){",l,"=",b,"[",k,"]=",a.link(function(b){return L(Rb,a,
            c,b,2)}),"(",d,");}",l,".call(this,a0[",h,"],",h,");"))}function tb(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0";ka(a,d);var e=!1,f=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(Ka(a,d,b.context),f=!1);var g=b.framebuffer,h=!1;g?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||F(a,d,g)):F(a,d,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);Ba(a,d,b);gb(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||
        Tb(a,d,b,!1,"a1");b.contextDep=e;b.needsContext=f;b.needsFramebuffer=h;f=b.shader.progVar;if(f.contextDep&&e||f.propDep)hb(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)hb(a,d,b,b.shader.program);else{g=a.global.def("{}");h=d.def(f,".id");var k=d.def(g,"[",h,"]");d(a.cond(k).then(k,".call(this,a0,a1);").else(k,"=",g,"[",h,"]=",a.link(function(c){return L(hb,a,b,c,2)}),"(",f,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,
            ".dirty=true;")}function U(a,c){function d(b){var d=c.shader[b];d&&e.set(f.shader,"."+b,d.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;Ka(a,e,c.context);c.framebuffer&&c.framebuffer.append(a,e);Ma(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,e);aa(d)?d.forEach(function(c,d){e.set(a.next[b],"["+d+"]",c)}):e.set(f.next,"."+b,d)});Tb(a,e,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&e.set(f.draw,
            "."+b,""+d.append(a,e))});Object.keys(c.uniforms).forEach(function(d){e.set(f.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,e))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new Q).forEach(function(a){e.set(f,"."+a,d[a])})});d("vert");d("frag");0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function gd(a){if("object"===("undefined"===typeof a?"undefined":
            W(a))&&!aa(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(Da.isDynamic(a[b[c]]))return!0;return!1}}function sb(a,b,c){var d=b.static[c];if(d&&gd(d)){var e=a.global,f=Object.keys(d),g=!1,h=!1,k=!1,l=a.global.def("{}");f.forEach(function(b){var c=d[b];if(Da.isDynamic(c))"function"===typeof c&&(c=d[b]=Da.unbox(c)),b=sa(c,null),g=g||b.thisDep,k=k||b.propDep,h=h||b.contextDep;else{e(l,".",b,"=");switch("undefined"===typeof c?"undefined":W(c)){case "number":e(c);break;case "string":e('"',c,'"');break;
            case "object":Array.isArray(c)&&e("[",c.join(),"]");break;default:e(a.link(c))}e(";")}});b.dynamic[c]=new Da.DynamicVariable(4,{thisDep:g,contextDep:h,propDep:k,ref:l,append:function(a,b){f.forEach(function(c){var e=d[c];Da.isDynamic(e)&&(e=a.invoke(b,e),b(l,".",c,"=",e,";"))})}});delete b.static[c]}}var Q=l.Record,P={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(P.min=32775,P.max=32776);var O=c.angle_instanced_arrays,M=c.webgl_draw_buffers,S={dirty:!0,profile:v.profile},
            Qb={},V=[],Ta={},La={};w("dither",3024);w("blend.enable",3042);x("blend.color","blendColor",[0,0,0,0]);x("blend.equation","blendEquationSeparate",[32774,32774]);x("blend.func","blendFuncSeparate",[1,0,1,0]);w("depth.enable",2929,!0);x("depth.func","depthFunc",513);x("depth.range","depthRange",[0,1]);x("depth.mask","depthMask",!0);x("colorMask","colorMask",[!0,!0,!0,!0]);w("cull.enable",2884);x("cull.face","cullFace",1029);x("frontFace","frontFace",2305);x("lineWidth","lineWidth",1);w("polygonOffset.enable",
            32823);x("polygonOffset.offset","polygonOffset",[0,0]);w("sample.alpha",32926);w("sample.enable",32928);x("sample.coverage","sampleCoverage",[1,!1]);w("stencil.enable",2960);x("stencil.mask","stencilMask",-1);x("stencil.func","stencilFunc",[519,0,-1]);x("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);x("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);w("scissor.enable",3089);x("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);x("viewport","viewport",
            [0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var Z={gl:a,context:r,strings:b,next:Qb,current:S,draw:p,elements:f,buffer:e,shader:m,attributes:l.state,uniforms:k,framebuffer:h,extensions:c,timer:t,isBufferArgs:Ea},ba={primTypes:vb,compareFuncs:Ab,blendFuncs:Ga,blendEquations:P,stencilOps:Va,glTypes:Pb,orientationType:fb};u.optional(function(){Z.isArrayLike=aa});M&&(ba.backBuffer=[1029],ba.drawBuffer=N(d.maxDrawbuffers,function(a){return 0===a?[0]:N(a,function(a){return 36064+a})}));var ca=0;return{next:Qb,
            current:S,procs:function(){var a=va(),b=a.proc("poll"),c=a.proc("refresh"),e=a.block();b(e);c(e);var f=a.shared,g=f.gl,h=f.next,k=f.current;e(k,".dirty=false;");F(a,b);F(a,c,null,!0);var l;O&&(l=a.link(O));for(var m=0;m<d.maxAttributes;++m){var p=c.def(f.attributes,"[",m,"]"),r=a.cond(p,".buffer");r.then(g,".enableVertexAttribArray(",m,");",g,".bindBuffer(",34962,",",p,".buffer.buffer);",g,".vertexAttribPointer(",m,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(g,".disableVertexAttribArray(",
                m,");",g,".vertexAttrib4f(",m,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;");c(r);O&&c(l,".vertexAttribDivisorANGLE(",m,",",p,".divisor);")}Object.keys(Ta).forEach(function(d){var f=Ta[d],l=e.def(h,".",d),m=a.block();m("if(",l,"){",g,".enable(",f,")}else{",g,".disable(",f,")}",k,".",d,"=",l,";");c(m);b("if(",l,"!==",k,".",d,"){",m,"}")});Object.keys(La).forEach(function(d){var f=La[d],l=S[d],m=a.block();m(g,".",f,"(");if(aa(l)){f=l.length;var p=a.global.def(h,".",d);var r=a.global.def(k,
                ".",d);m(N(f,function(a){return p+"["+a+"]"}),");",N(f,function(a){return r+"["+a+"]="+p+"["+a+"];"}).join(""));b("if(",N(f,function(a){return p+"["+a+"]!=="+r+"["+a+"]"}).join("||"),"){",m,"}")}else p=e.def(h,".",d),r=e.def(k,".",d),m(p,");",k,".",d,"=",p,";"),b("if(",p,"!==",r,"){",m,"}");c(m)});return a.compile()}(),compile:function(a,b,c,d,e){var f=va();f.stats=f.link(e);Object.keys(b.static).forEach(function(a){sb(f,b,a)});Nb.forEach(function(b){sb(f,a,b)});c=C(a,b,c,d,f);R(f,c);U(f,c);tb(f,
                c);return f.compile()}}}function Pa(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var ma=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},Z=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Qa="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),
        ra={};ra[5120]=ra[5121]=1;ra[5122]=ra[5123]=ra[36193]=ra[33635]=ra[32819]=ra[32820]=2;ra[5124]=ra[5125]=ra[5126]=ra[34042]=4;var u=Z(d,{optional:function(a){a()},raise:a,commandRaise:A,command:function(a,b,c){a||A(b,c||h())},parameter:function(b,c,d){b in c||a("unknown parameter ("+b+")"+k(d)+". possible values: "+Object.keys(c).join())},commandParameter:function(a,b,c,d){a in b||A("unknown parameter ("+a+")"+k(c)+". possible values: "+Object.keys(b).join(),d||h())},constructor:function(b){Object.keys(b).forEach(function(b){0>
        Qa.indexOf(b)&&a('invalid regl constructor argument "'+b+'". must be one of '+Qa)})},type:function(b,c,d){("undefined"===typeof b?"undefined":W(b))!==c&&a("invalid parameter type"+k(d)+". expected "+c+", got "+("undefined"===typeof b?"undefined":W(b)))},commandType:z,isTypedArray:function(b,c){ma(b)||a("invalid parameter type"+k(c)+". must be a typed array")},nni:function(b,c){0<=b&&(b|0)===b||a("invalid parameter type, ("+b+")"+k(c)+". must be a nonnegative integer")},oneOf:g,shaderError:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               b,c,f,g){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=f===a.FRAGMENT_SHADER?"fragment":"vertex";z(c,"string",a+" shader source must be a string",g);var h=p(c,g);c=v(b);w(h,c);Object.keys(h).forEach(function(a){function b(a,b){d.push(a);f.push(b||"")}var c=h[a];if(c.hasErrors){var d=[""],f=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(e(a.number,4)+"|  ","background-color:yellow; font-weight:bold");
            b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(d){d=d.message;var f=/^\s*'(.*)'\s*:\s*(.*)$/.exec(d);if(f){var g=f[1];d=f[2];switch(g){case "assign":g="="}c=Math.max(a.line.indexOf(g,c),0)}else c=0;b(e("| ",6));b(e("^^^",c+3)+"\n","font-weight:bold");b(e("| ",6));b(d+"\n","font-weight:bold")});b(e("| ",6)+"\n")}else b(e(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"===typeof document||window.chrome||(f[0]=d.join("%c"))}});d.raise("Error compiling "+
            a+" shader, "+h[0].name)}},linkError:function(a,b,c,e,f){a.getProgramParameter(b,a.LINK_STATUS)||(a.getProgramInfoLog(b),a=p(c,f),e='Error linking program with vertex shader, "'+p(e,f)[0].name+'", and fragment shader "'+a[0].name+'"',d.raise(e))},callSite:m,saveCommandRef:x,saveDrawInfo:function(a,b,c,d){function e(a){return a?d.id(a):0}function f(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=!0})}x(a);a._fragId=e(a.static.frag);a._vertId=e(a.static.vert);var g=a._uniformSet={};f(g,b.static);
            f(g,b.dynamic);b=a._attributeSet={};f(b,c.static);f(b,c.dynamic);a._hasCount="count"in a.static||"count"in a.dynamic||"elements"in a.static||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?g(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):g(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:h,texture2D:function(a,b,c){var e=b.width,f=b.height,g=b.channels;d(0<e&&e<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,
            "invalid texture shape");33071===a.wrapS&&33071===a.wrapT||d(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==f&&d(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(d(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),d(b.mipmask===(e<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&
        d(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),d(!a.genMipmaps,"mipmap generation not supported with float textures"));var h=b.images;for(c=0;16>c;++c)if(h[c]){var k=e>>c,l=f>>c;d(b.mipmask&1<<c,"missing mipmap data");var m=h[c];d(m.width===k&&m.height===l,"invalid shape for mip images");d(m.format===b.format&&m.internalformat===b.internalformat&&m.type===b.type,"incompatible type for mip image");!m.compressed&&m.data&&(k=Math.ceil(F(m.type,
            g)*k/m.unpackAlignment)*m.unpackAlignment,d(m.data.byteLength===k*l,"invalid data for image, buffer size is inconsistent with image format"))}else a.genMipmaps||d(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&d(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var f=a.width,g=a.height,h=a.channels;d(0<f&&f<=e.maxTextureSize&&0<g&&g<=e.maxTextureSize,"invalid texture shape");d(f===g,"cube map must be square");d(33071===b.wrapS&&33071===
            b.wrapT,"wrap mode not supported by cube map");for(e=0;e<c.length;++e){var k=c[e];d(k.width===f&&k.height===g,"inconsistent cube map face shape");b.genMipmaps&&(d(!k.compressed,"can not generate mipmap for compressed textures"),d(1===k.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=k.images,m=0;16>m;++m){var p=l[m];if(p){var r=f>>m,t=g>>m;d(k.mipmask&1<<m,"missing mipmap data");d(p.width===r&&p.height===t,"invalid shape for mip images");d(p.format===a.format&&p.internalformat===
            a.internalformat&&p.type===a.type,"incompatible type for mip image");p.compressed||p.data&&d(p.data.byteLength===r*t*Math.max(F(p.type,h),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),db=0,Da={DynamicVariable:D,define:function(a,b){return new D(a,E(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof D},unbox:function(a,b){return"function"===typeof a?new D(0,a):a},accessor:E},Ja={next:"function"===typeof requestAnimationFrame?
            function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Ya="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},V=M();V.zero=M();var ob=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var d=1,e=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),e=a.getParameter(36063));var f=
        !!b.oes_texture_float;if(f){f=a.createTexture();a.bindTexture(3553,f);a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var g=a.createFramebuffer();a.bindFramebuffer(36160,g);a.framebufferTexture2D(36160,36064,3553,f,0);a.bindTexture(3553,null);if(36053!==a.checkFramebufferStatus(36160))f=!1;else{a.viewport(0,0,1,1);a.clearColor(1,0,0,1);a.clear(16384);var h=V.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,h);a.getError()?f=!1:(a.deleteFramebuffer(g),a.deleteTexture(f),f=1===h[0]);V.freeType(h)}}h=
        !0;"undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(h=a.createTexture(),g=V.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,h),a.texImage2D(34069,0,6408,3,3,0,6408,5121,g),V.freeType(g),a.bindTexture(34067,null),a.deleteTexture(h),h=!a.getError());return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),
        subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:e,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),
        maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:f,npotTextureCube:h}},Ca=function(a){return Object.keys(a).map(function(b){return a[b]})},Ia={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var e=1;if(b.length)for(var f=0;f<b.length;++f)e*=b[f];else e=
            0;c=d||V.allocType(c,e);switch(b.length){case 0:break;case 1:d=b[0];for(b=0;b<d;++b)c[b]=a[b];break;case 2:d=b[0];b=b[1];for(f=e=0;f<d;++f)for(var g=a[f],h=0;h<b;++h)c[e++]=g[h];break;case 3:ca(a,b[0],b[1],b[2],c,0);break;default:fa(a,b,0,c,0)}return c}},Ub={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
        "[object ArrayBuffer]":5121},Pb={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Vb={dynamic:35048,stream:35040,"static":35044},Xa=Ia.flatten,ib=Ia.shape,Sa=[];Sa[5120]=1;Sa[5122]=2;Sa[5124]=4;Sa[5121]=1;Sa[5123]=2;Sa[5125]=4;Sa[5126]=4;var vb={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},jb=new Float32Array(1),Db=new Uint32Array(jb.buffer),kb=function(a){return!(a&a-1)&&!!a},Eb=
        [9984,9986,9985,9987],Wb=[0,6409,6410,6407,6408],wa={};wa[6409]=wa[6406]=wa[6402]=1;wa[34041]=wa[6410]=2;wa[6407]=wa[35904]=3;wa[6408]=wa[35906]=4;var $a=ja("HTMLCanvasElement"),lb=ja("CanvasRenderingContext2D"),mb=ja("ImageBitmap"),nb=ja("HTMLImageElement"),pb=ja("HTMLVideoElement"),Fb=Object.keys(Ub).concat([$a,lb,mb,nb,pb]),wb=[];wb[5121]=1;wb[5126]=4;wb[36193]=2;wb[5123]=2;wb[5125]=4;var ea=[];ea[32854]=2;ea[32855]=2;ea[36194]=2;ea[34041]=4;ea[33776]=.5;ea[33777]=.5;ea[33778]=1;ea[33779]=1;ea[35986]=
        .5;ea[35987]=1;ea[34798]=1;ea[35840]=.5;ea[35841]=.25;ea[35842]=.5;ea[35843]=.25;ea[36196]=.5;var za=[];za[32854]=2;za[32855]=2;za[36194]=2;za[33189]=2;za[36168]=1;za[34041]=4;za[35907]=4;za[34836]=16;za[34842]=8;za[34843]=6;var Gb=function(a,b,c,d,e){function f(a){this.id=l++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;e.profile&&(this.stats={size:0})}function g(b){var c=b.renderbuffer;u(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);
        b.renderbuffer=null;b.refCount=0;delete m[b.id];d.renderbufferCount--}var h={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(h.srgba=35907);b.ext_color_buffer_half_float&&(h.rgba16f=34842,h.rgb16f=34843);b.webgl_color_buffer_float&&(h.rgba32f=34836);var k=[];Object.keys(h).forEach(function(a){k[h[a]]=a});var l=0,m={};f.prototype.decRef=function(){0>=--this.refCount&&g(this)};e.profile&&(d.getTotalRenderbufferSize=function(){var a=0;Object.keys(m).forEach(function(b){a+=
        m[b].stats.size});return a});return{create:function(b,g){function l(b,d){var f=0,g=0,m=32854;"object"===("undefined"===typeof b?"undefined":W(b))&&b?("shape"in b?(d=b.shape,u(Array.isArray(d)&&2<=d.length,"invalid renderbuffer shape"),f=d[0]|0,g=d[1]|0):("radius"in b&&(f=g=b.radius|0),"width"in b&&(f=b.width|0),"height"in b&&(g=b.height|0)),"format"in b&&(u.parameter(b.format,h,"invalid renderbuffer format"),m=h[b.format])):"number"===typeof b?(f=b|0,g="number"===typeof d?d|0:f):b?u.raise("invalid arguments to renderbuffer constructor"):
            f=g=1;u(0<f&&0<g&&f<=c.maxRenderbufferSize&&g<=c.maxRenderbufferSize,"invalid renderbuffer size");if(f!==p.width||g!==p.height||m!==p.format)return l.width=p.width=f,l.height=p.height=g,p.format=m,a.bindRenderbuffer(36161,p.renderbuffer),a.renderbufferStorage(36161,m,f,g),u(0===a.getError(),"invalid render buffer format"),e.profile&&(p.stats.size=za[p.format]*p.width*p.height),l.format=k[p.format],l}var p=new f(a.createRenderbuffer());m[p.id]=p;d.renderbufferCount++;l(b,g);l.resize=function(b,d){b|=
            0;d=d|0||b;if(b===p.width&&d===p.height)return l;u(0<b&&0<d&&b<=c.maxRenderbufferSize&&d<=c.maxRenderbufferSize,"invalid renderbuffer size");l.width=p.width=b;l.height=p.height=d;a.bindRenderbuffer(36161,p.renderbuffer);a.renderbufferStorage(36161,p.format,b,d);u(0===a.getError(),"invalid render buffer format");e.profile&&(p.stats.size=za[p.format]*p.width*p.height);return l};l._reglType="renderbuffer";l._renderbuffer=p;e.profile&&(l.stats=p.stats);l.destroy=function(){p.decRef()};return l},clear:function(){Ca(m).forEach(g)},
        restore:function(){Ca(m).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)});a.bindRenderbuffer(36161,null)}}},Hb=[6407,6408],eb=[];eb[6408]=4;eb[6407]=3;var Yb=[];Yb[5121]=1;Yb[5126]=4;Yb[36193]=2;var Lb=[32854,32855,36194,35907,34842,34843,34836],Mb={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Bb=["x",
            "y","z","w"],Nb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ga={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},qb="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
        Ab={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Va={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rb={frag:35632,vert:35633},fb={cw:2304,ccw:2305},Cb=new ya(!1,!1,!1,function(){}),Sb=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function d(a,b,d){var e=
            g.pop()||new c;e.startQueryIndex=a;e.endQueryIndex=b;e.sum=0;e.stats=d;h.push(e)}if(!b.ext_disjoint_timer_query)return null;var e=[],f=[],g=[],h=[],k=[],l=[];return{beginQuery:function(a){var c=e.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c);f.push(c);d(f.length-1,f.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a;var c=f.length;if(0!==c){l.length=Math.max(l.length,c+1);k.length=
                Math.max(k.length,c+1);k[0]=0;var d=l[0]=0;for(a=c=0;a<f.length;++a){var m=f[a];b.ext_disjoint_timer_query.getQueryObjectEXT(m,34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(m,34918),e.push(m)):f[c++]=m;k[a+1]=d;l[a+1]=c}f.length=c;for(a=c=0;a<h.length;++a){d=h[a];var p=d.startQueryIndex;m=d.endQueryIndex;d.sum+=k[m]-k[p];p=l[p];m=l[m];m===p?(d.stats.gpuTime+=d.sum/1E6,g.push(d)):(d.startQueryIndex=p,d.endQueryIndex=m,h[c++]=d)}h.length=c}},getNumPendingQueries:function(){return f.length},
            clear:function(){e.push.apply(e,f);for(var a=0;a<e.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(e[a]);f.length=0;e.length=0},restore:function(){f.length=0;e.length=0}}};return function(a){function b(){if(0===M.length)A&&A.update(),Y=null;else{Y=Ja.next(b);m();for(var a=M.length-1;0<=a;--a){var c=M[a];c&&c(C,null,0)}t.flush();A&&A.update()}}function c(){!Y&&0<M.length&&(Y=Ja.next(b))}function d(){Y&&(Ja.cancel(b),Y=null)}function e(a){a.preventDefault();w=!0;d();V.forEach(function(a){a()})}
        function f(a){t.getError();w=!1;x.restore();L.restore();I.restore();J.restore();P.restore();O.restore();A&&A.restore();N.procs.refresh();c();ba.forEach(function(a){a()})}function g(a){function b(a){var b={},c={};Object.keys(a).forEach(function(d){var e=a[d];Da.isDynamic(e)?c[d]=Da.unbox(e,d):b[d]=e});return{dynamic:c,static:b}}function c(a){for(;m.length<a;)m.push(null);return m}u(!!a,"invalid args to regl({...})");u.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),e=b(a.uniforms||
            {}),f=b(a.attributes||{}),g=b(function(a){function b(a){if(a in c){var b=c[a];delete c[a];Object.keys(b).forEach(function(d){c[a+"."+d]=b[d]})}}var c=Z({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};d=N.compile(g,f,e,d,a);var h=d.draw,k=d.batch,l=d.scope,
            m=[];return Z(function(a,b){var d;w&&u.raise("context lost");if("function"===typeof a)return l.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)l.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)l.call(this,a[d],b,d);else return l.call(this,a,b,0);else if("number"===typeof a){if(0<a)return k.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return k.call(this,a,a.length)}else return h.call(this,a)},{stats:a})}function h(a,b){a=0;N.procs.poll();
            var c=b.color;c&&(t.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),a|=16384);"depth"in b&&(t.clearDepth(+b.depth),a|=256);"stencil"in b&&(t.clearStencil(b.stencil|0),a|=1024);u(!!a,"called regl.clear with no buffer specified");t.clear(a)}function k(a){u.type(a,"function","regl.frame() callback must be a function");M.push(a);c();return{cancel:function(){function b(){var a=Pa(M,b);M[a]=M[M.length-1];--M.length;0>=M.length&&d()}var c=Pa(M,a);u(0<=c,"cannot cancel a frame twice");M[c]=b}}}function l(){var a=
            S.viewport,b=S.scissor_box;a[0]=a[1]=b[0]=b[1]=0;C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=a[2]=b[2]=t.drawingBufferWidth;C.viewportHeight=C.framebufferHeight=C.drawingBufferHeight=a[3]=b[3]=t.drawingBufferHeight}function m(){C.tick+=1;C.time=r();l();N.procs.poll()}function p(){l();N.procs.refresh();A&&A.update()}function r(){return(Ya()-E)/1E3}a=R(a);if(!a)return null;var t=a.gl,v=t.getContextAttributes(),w=t.isContextLost(),x=U(t,a);if(!x)return null;var y=G(),z={bufferCount:0,elementsCount:0,
            framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},B=x.extensions,A=Sb(t,B),E=Ya(),D=t.drawingBufferWidth,F=t.drawingBufferHeight,C={tick:0,time:0,viewportWidth:D,viewportHeight:F,framebufferWidth:D,framebufferHeight:F,drawingBufferWidth:D,drawingBufferHeight:F,pixelRatio:a.pixelRatio},H=ob(t,B);D=Wa(t,B,H,y);var I=oa(t,z,a,D),K=pa(t,B,I,z),L=Za(t,y,z,a),J=Na(t,B,H,function(){N.procs.poll()},C,z,a),P=Gb(t,B,H,z,a),O=Oa(t,B,H,J,P,z),N=cb(t,y,B,H,I,K,
            J,O,{},D,L,{elements:null,primitive:4,count:-1,offset:0,instances:-1},C,A,a);y=ab(t,O,N.procs.poll,C,v,B,H);var S=N.next,Q=t.canvas,M=[],V=[],ba=[],aa=[a.onDestroy],Y=null;Q&&(Q.addEventListener("webglcontextlost",e,!1),Q.addEventListener("webglcontextrestored",f,!1));var ca=O.setFBO=g({framebuffer:Da.define.call(null,1,"framebuffer")});p();v=Z(g,{clear:function(a){u("object"===("undefined"===typeof a?"undefined":W(a))&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&
                "framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ca(Z({framebuffer:a.framebuffer.faces[b]},a),h);else ca(a,h);else h(null,a)},prop:Da.define.bind(null,1),context:Da.define.bind(null,2),this:Da.define.bind(null,3),draw:g({}),buffer:function(a){return I.create(a,34962,!1,!1)},elements:function(a){return K.create(a,!1)},texture:J.create2D,cube:J.createCube,renderbuffer:P.create,framebuffer:O.create,framebufferCube:O.createCube,attributes:v,frame:k,on:function(a,b){u.type(b,"function","listener callback must be a function");
                switch(a){case "frame":return k(b);case "lost":var c=V;break;case "restore":c=ba;break;case "destroy":c=aa;break;default:u.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:H,hasExtension:function(a){return 0<=H.extensions.indexOf(a.toLowerCase())},read:y,destroy:function(){M.length=0;d();Q&&(Q.removeEventListener("webglcontextlost",e),Q.removeEventListener("webglcontextrestored",
                f));L.clear();O.clear();P.clear();J.clear();K.clear();I.clear();A&&A.clear();aa.forEach(function(a){a()})},_gl:t,_refresh:p,poll:function(){m();A&&A.update()},now:r,stats:z});a.onDone(null,v);return v}})});var hd=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferData=[];return c}H(b,d);A(b,[{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);}",
            fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"getDefaultOptions",value:function(){return{blend:"lighter",color:"rgb(100,150,150)"}}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);var d=[];b=b.color;for(var g=0;g<a.length;g++){var e=a[g].geometry.coordinates,
        l=a[g].color||b;"[object Function]"===Object.prototype.toString.call(l)&&(l=l(a[g]));l=this.normizedColor(l);for(var t=0;t<e.length-1;t++){var r=this.normizedPoint(e[t]);d.push(r[0]);d.push(r[1]);d.push(Number(e[t][2]||0));d.push(l[0],l[1],l[2],l[3]);r=this.normizedPoint(e[t+1]);d.push(r[0]);d.push(r[1]);d.push(Number(e[t+1][2]||0));d.push(l[0],l[1],l[2],l[3])}}this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=
            b.gl,c=b.matrix;!this.bufferData||0>=this.bufferData.length||(b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*c,3*c),b=this.getOptions().blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),
            a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.LINES,0,this.bufferData.length/7),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST))}}]);return b}(ia),id=function(){function d(b,c){x(this,d);this.layer=b;this.gl=c;this.initData()}A(d,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",
        value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(b,c){this.initData();var a=b.color,d=b.height,k=b.gradient;b=this.gl;for(var g=0;g<c.length;g++){var e=c[g].geometry.coordinates,l=e.length;this.maxLength=l>this.maxLength?l:this.maxLength;for(var t=[],r=0;r<l;r++){var h=this.layer.normizedPoint(e[r]);t.push(h)}l=c[g].color||a;"properties"in c[g]&&"color"in c[g].properties&&(l=c[g].properties.color);k||"[object Function]"!==
        Object.prototype.toString.call(l)||(l=l(c[g]));e=this.layer.normizedColor(k?k[0]:l);l=this.layer.normizedColor(k?k[1]:l);r=c[g].height||d;"properties"in c[g]&&"height"in c[g].properties&&(r=c[g].properties.height);"[object Function]"===Object.prototype.toString.call(r)&&(r=r(c[g]));this.processData(this.outWall3d,t,e,l,r)}for(c=0;c<this.outWall3d.vertex.length;c++){a=[];d=this.outWall3d.vertex[c].length;for(k=0;k<d;k++)a.push.apply(a,db(this.outWall3d.vertex[c][k]));d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,
        d);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW);this.outWall3d.vertexBuffer[c]=d;b.bindBuffer(b.ARRAY_BUFFER,null);d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[c]),b.STATIC_DRAW);this.outWall3d.indexBuffer[c]=d;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(b,c,a,d,k){var f=b.vertex[b.vertex.length-1],e=b.index[b.index.length-1],l=c.length;if(!f||65536<=f.length+
        2*l+2)f=[],e=[],b.vertex.push(f),b.index.push(e);(b=f.length)&&e.push(b-1,b);for(var t=b=0;t<l;t++){var r=[],h=[],m=c[t];r.push(m[0],m[1]);r.push(m[2]?Number(m[2])+k:k);r.push(m[3]?Number(m[3]):t);r.push(b);r.push(a[0],a[1],a[2],a[3]);h.push(m[0],m[1]);h.push(m[2]?Number(m[2]):0);h.push(m[3]?Number(m[3]):t);h.push(b);h.push(d[0],d[1],d[2],d[3]);m=f.length;f.push(r,h);e.push(m,m+1);t<l-1&&(b+=this.getDistance(c[t],c[t+1]))}}},{key:"getDistance",value:function(b,c){return Math.sqrt(Math.pow(Math.abs(b[0]-
        c[0]),2)+Math.pow(Math.abs(b[1]-c[1]),2))}}]);return d}(),jd=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.startTime=c.options.startTime||0;c.endTime=c.options.endTime;c.time=c.startTime;c.autoUpdate=!0;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new id(this,this.gl);this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
            fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},
        {key:"onChanged",value:function(b,a){this.gl&&(this.dataMgr.onLayerChange(b,a),void 0===b.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),g=this.program;a.useProgram(g.program);a.enable(a.BLEND);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(g.attributes.aPos);
                a.enableVertexAttribArray(g.attributes.aDistance);a.enableVertexAttribArray(g.attributes.aColor);a.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);a.uniform1f(g.uniforms.currentTime,this.time);a.uniform1f(g.uniforms.trailLength,d.trailLength);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var e=b.vertex[c],l=(new Float32Array(e[0])).BYTES_PER_ELEMENT;e=l*e[0].length;a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer[c]);a.vertexAttribPointer(g.attributes.aPos,4,a.FLOAT,!1,e,0);a.vertexAttribPointer(g.attributes.aDistance,
                1,a.FLOAT,!1,e,4*l);a.vertexAttribPointer(g.attributes.aColor,4,a.FLOAT,!1,e,5*l);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=d.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}}]);return b}(ia),Ac={circle:1,square:2},Cb=function(d){function b(c){x(this,b);c=I(this,
    (b.__proto__||Object.getPrototypeOf(b)).call(this,c));c.bufferData=[];return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",shape:"circle",size:5}}},{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;}",
            fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;void main(void){if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vColor;}}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);var d=[],g=b.color;b=b.size;for(var e=
            0;e<a.length;e++){var l=a[e].geometry.coordinates,t=a[e].color||g;"properties"in a[e]&&"color"in a[e].properties&&(t=a[e].properties.color);"[object Function]"===Object.prototype.toString.call(t)&&(t=t(a[e]));t=this.normizedColor(t);l=this.normizedPoint(l);var r=b;r="[object Function]"===Object.prototype.toString.call(r)?r(a[e]):Number(r);d.push(l[0],l[1],Number(l[2]||0));d.push(t[0],t[1],t[2],t[3]);d.push(r*window.devicePixelRatio)}this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,
        this.f32BufferData,c.STATIC_DRAW)}}},{key:"destroy",value:function(){this.buffer=this.program=this.f32BufferData=this.bufferData=null}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;0>=this.bufferData.length||(b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,8*c,0),a.enableVertexAttribArray(b.attributes.aColor),
            a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,8*c,3*c),a.enableVertexAttribArray(b.attributes.aSize),a.vertexAttribPointer(b.attributes.aSize,1,a.FLOAT,!1,8*c,7*c),c=1,this.options.shape&&Ac[this.options.shape]&&(c=Ac[this.options.shape]),a.uniform1i(b.uniforms.uShape,c),b=this.options.blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.POINTS,
        0,this.bufferData.length/8),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST),a.useProgram(null))}}]);return b}(ia),kd=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.pointLayer=new Cb(c.getPointOptions());c.children=[c.pointLayer];c.autoUpdate=!0;c.indexArr=[];return c}H(b,d);A(b,[{key:"onDataChanged",value:function(b){this.indexArr=b.map(function(a,b){return 0})}},{key:"getPointOptions",value:function(){var b=this.getOptions();
            return{color:b.color,size:b.size}}},{key:"onOptionsChanged",value:function(b){this.pointLayer.setOptions(this.getPointOptions())}},{key:"getDefaultOptions",value:function(){return{size:5}}},{key:"render",value:function(c){var a=this,d=this.getData();this.indexArr=this.indexArr.map(function(a,b){a+=.5;a>=d[b].geometry.coordinates.length&&(a=0);return a});var k=d.map(function(b,c){return{geometry:{type:"Point",coordinates:b.geometry.coordinates[Math.floor(a.indexArr[c])]}}});this.pointLayer.setData(k,
        {autoRender:!1});Qa(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"render",this).call(this,c)}}]);return b}(fb),ld=function(){function d(b,c){x(this,d);this.layer=b;this.gl=c;this.initData()}A(d,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(b,c){this.initData();for(var a=b.color,d=b.height,k=b.gradient,g=b.enablePreciseMap,e=this.gl,l=0;l<
        c.length;l++){for(var t=c[l].geometry.coordinates,r=t.length,h=[],m=[],p=0,v=0;v<r;v++){var w=this.layer.normizedPoint(t[v]);if(0<v&&g){var x=this.layer.normizedPoint(t[v-1]);p+=Math.sqrt(Math.pow(w[0]-x[0],2),Math.pow(w[1]-x[1],2))}h.push(w);m.push(p)}r=c[l].color||a;"properties"in c[l]&&"color"in c[l].properties&&(r=c[l].properties.color);k||"[object Function]"!==Object.prototype.toString.call(r)||(r=r(c[l]));t=this.layer.normizedColor(k?k[0]:r);r=this.layer.normizedColor(k?k[1]:r);p=c[l].height||
        d;"properties"in c[l]&&"height"in c[l].properties&&(p=c[l].properties.height);"[object Function]"===Object.prototype.toString.call(p)&&(p=p(c[l]));this.processData(this.outWall3d,b,h,m,t,r,p)}for(b=0;b<this.outWall3d.vertex.length;b++){c=[];a=this.outWall3d.vertex[b].length;for(d=0;d<a;d++)c.push.apply(c,db(this.outWall3d.vertex[b][d]));a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a);e.bufferData(e.ARRAY_BUFFER,new Float32Array(c),e.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=a;e.bindBuffer(e.ARRAY_BUFFER,
        null);a=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),e.STATIC_DRAW);this.outWall3d.indexBuffer[b]=a;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(b,c,a,d,k,g,e){var f=d[d.length-1],t=b.vertex[b.vertex.length-1],r=b.index[b.index.length-1],h=a.length;if(!t||65536<=t.length+2*h+2)t=[],r=[],b.vertex.push(t),b.index.push(r);(b=t.length)&&r.push(b-1,b);for(b=0;b<h;b++){var m=[],p=[],
        v=a[b];m.push(v[0],v[1],e);m.push(k[0],k[1],k[2],k[3]);p.push(v[0],v[1],0);p.push(g[0],g[1],g[2],g[3]);c.texture&&(v=d[b],c.enablePreciseMap?(m.push(v/f,1),p.push(v/f,0)):(m.push(b/(h-1),1),p.push(b/(h-1),0)));v=t.length;t.push(m,p);r.push(v,v+1)}}}]);return d}(),md=function(d){function b(c,a){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a))}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",
        value:function(b){this.gl=b;this.dataMgr=new ld(this,this.gl);this.texture=null;this.isUseTexture=!1;this.vertexLength=10;this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",
            fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"});this.loadTexture()}},{key:"onChanged",value:function(b,a){var c=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){c.loadTexture(function(){c.dataMgr.onLayerChange(b,a);
            c.webglLayer.render()})},0))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),g=this.program;a.useProgram(g.program);a.enable(a.BLEND);a.enable(a.DEPTH_TEST);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);if(d.texture){if(!this.texture)return;a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniform1i(g.uniforms.uSampler,0);a.depthMask(!0);a.depthFunc(a.LESS)}else a.depthMask(!1),
            a.depthFunc(a.LEQUAL);d.texture?a.enableVertexAttribArray(g.attributes.aTextureCoords):a.disableVertexAttribArray(g.attributes.aTextureCoords);a.enableVertexAttribArray(g.attributes.aPos);a.enableVertexAttribArray(g.attributes.aColor);a.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);a.uniform1i(g.uniforms.uUseTexture,this.isUseTexture);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var e=b.vertex[c],l=(new Float32Array(e[0])).BYTES_PER_ELEMENT;e=l*e[0].length;a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer[c]);
            a.vertexAttribPointer(g.attributes.aPos,3,a.FLOAT,!1,e,0);a.vertexAttribPointer(g.attributes.aColor,4,a.FLOAT,!1,e,3*l);d.texture&&a.vertexAttribPointer(g.attributes.aTextureCoords,2,a.FLOAT,!1,e,7*l);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.useProgram(null)}}},{key:"loadTexture",value:function(b){var a=
            this,c=this.getOptions();c.texture?(this.isUseTexture=!0,$a(this.gl,c.texture,function(c,d){a.image=d;a.texture=c;b&&b();a.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,b&&b())}}]);return b}(ia),nd=function(){function d(b,c){x(this,d);this.layer=b;this.gl=c;this.initData()}A(d,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",
        value:function(){return this.maxLength}},{key:"onLayerChange",value:function(b,c){this.initData();var a=b.color,d=b.height,k=b.gradient;b=this.gl;for(var g=0;g<c.length;g++){var e=c[g].geometry.coordinates,l=e.length;this.maxLength=l>this.maxLength?l:this.maxLength;for(var t=[],r=0;r<l;r++){var h=this.layer.normizedPoint(e[r]);t.push(h)}l=c[g].color||a;"properties"in c[g]&&"color"in c[g].properties&&(l=c[g].properties.color);k||"[object Function]"!==Object.prototype.toString.call(l)||(l=l(c[g]));
            e=this.layer.normizedColor(k?k[0]:l);l=this.layer.normizedColor(k?k[1]:l);r=c[g].height||d;"properties"in c[g]&&"height"in c[g].properties&&(r=c[g].properties.height);"[object Function]"===Object.prototype.toString.call(r)&&(r=r(c[g]));this.processData(this.outWall3d,t,e,l,r)}for(c=0;c<this.outWall3d.vertex.length;c++){a=[];d=this.outWall3d.vertex[c].length;for(k=0;k<d;k++)a.push.apply(a,db(this.outWall3d.vertex[c][k]));d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,
        new Float32Array(a),b.STATIC_DRAW);this.outWall3d.vertexBuffer[c]=d;b.bindBuffer(b.ARRAY_BUFFER,null);d=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[c]),b.STATIC_DRAW);this.outWall3d.indexBuffer[c]=d;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(b,c,a,d,k){var f=b.vertex[b.vertex.length-1],e=b.index[b.index.length-1],l=c.length;if(!f||65536<=f.length+2*l+2)f=[],e=[],b.vertex.push(f),
            b.index.push(e);(b=f.length)&&e.push(b-1,b);for(b=0;b<l;b++){var t=[],r=[],h=c[b];t.push(h[0],h[1]);t.push(h[2]?Number(h[2])+k:k);t.push(h[3]?Number(h[3]):b);t.push(a[0],a[1],a[2],a[3]);r.push(h[0],h[1]);r.push(h[2]?Number(h[2]):0);r.push(h[3]?Number(h[3]):b);r.push(d[0],d[1],d[2],d[3]);h=f.length;f.push(t,r);e.push(h,h+1)}}}]);return d}(),od=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.startTime=c.options.startTime||0;c.endTime=c.options.endTime;
        c.time=c.startTime;c.autoUpdate=!0;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new nd(this,this.gl);this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
            fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(b,a){this.gl&&(this.dataMgr.onLayerChange(b,a),void 0===b.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),g=this.program;a.useProgram(g.program);a.enable(a.BLEND);
            a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(g.attributes.aPos);a.enableVertexAttribArray(g.attributes.aColor);a.uniformMatrix4fv(g.uniforms.u_matrix,!1,c);a.uniform1f(g.uniforms.currentTime,this.time);a.uniform1f(g.uniforms.trailLength,d.trailLength);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var e=b.vertex[c],l=(new Float32Array(e[0])).BYTES_PER_ELEMENT;e=l*e[0].length;a.bindBuffer(a.ARRAY_BUFFER,
            b.vertexBuffer[c]);a.vertexAttribPointer(g.attributes.aPos,4,a.FLOAT,!1,e,0);a.vertexAttribPointer(g.attributes.aColor,4,a.FLOAT,!1,e,4*l);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=d.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}}]);return b}(ia),pd=function(d){function b(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.simpleLineLayer=new xc(c.getHeatOptions());c.children=[c.simpleLineLayer];return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(b){this.simpleLineLayer.setData(b)}},{key:"onOptionsChanged",value:function(b){this.simpleLineLayer.setOptions(this.getHeatOptions())}},
        {key:"getHeatOptions",value:function(){var b=this.getOptions(),a=b.max,d=b.min;void 0===a&&(d=this.getDataRange(),a=d.max,d=d.min);var k=new fa({max:a,min:d,gradient:b.gradient});b.color=function(a){var b=~~a.count||1;"properties"in a&&"count"in a.properties&&(b=~~a.properties.count);a=k.getImageData(b);return[a[0]/255,a[1]/255,a[2]/255,a[3]/255]};return b}},{key:"getDataRange",value:function(){var b=this.getData(),a=0,d=0;b[0]&&(a=~~b[0].count||1,d=~~b[0].count||1);"properties"in b[0]&&"count"in
            b[0].properties&&(a=~~b[0].properties.count,d=~~b[0].properties.count);for(var k=b.length,g=0;g<k;g++){var e=~~b[g].count||1;"properties"in b[g]&&"count"in b[g].properties&&(e=~~b[g].properties.count);a=Math.max(e,a);d=Math.min(e,d)}return{max:a/2,min:d}}}]);return b}(fb),qd=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferDataArr=[];c.indexDataArr=[];c.vertexBuffer=[];c.indexBuffer=[];c.position=[];c.opacity=1;c.currentScale=1;c.autoUpdate=
        !0;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",
            fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c&&(this.currentScale=this.opacity=1,(this.data=a)&&a.length)){var d=b.color,g=b.segs;b=b.size;for(var e=360/g,l=0;l<a.length;l++){var t=[],r=[],h=this.normizedPoint(a[l].geometry.coordinates),m=a[l].color||d;"properties"in a[l]&&"color"in a[l].properties&&(m=a[l].properties.color);m=this.normizedColor(m);var p="[object Function]"===Object.prototype.toString.call(b)?
        b(a[l]):Number(b);var v=h[0],w=h[1];t.push(0,0,-.5);t.push(m[0],m[1],m[2],0);for(var x=1,A=0;x<=g;x++,A+=e)t.push(h[0]-v+Math.cos(Math.PI/180*A)*p,h[1]-w+Math.sin(Math.PI/180*A)*p,-.5),t.push(m[0],m[1],m[2],this.opacity),x===g?r.push(0,0+x,1):r.push(0,0+x,0+x+1);m=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,m);c.bufferData(c.ARRAY_BUFFER,new Float32Array(t),c.STATIC_DRAW);this.vertexBuffer[l]=m;this.bufferDataArr[l]=t;c.bindBuffer(c.ARRAY_BUFFER,null);t=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
        t);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),c.STATIC_DRAW);this.indexBuffer[l]=t;this.indexDataArr[l]=r;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null);this.position[l]=[h[0],h[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(b){var a=b.gl,c=b.projectionMatrix,d=b.viewMatrix;b=this.program;a.useProgram(b.program);a.enable(a.DEPTH_TEST);a.enable(a.POLYGON_OFFSET_FILL);a.polygonOffset(-1,-1);a.depthFunc(a.LEQUAL);a.uniformMatrix4fv(b.uniforms.u_projectionMatrix,
        !1,c);a.uniformMatrix4fv(b.uniforms.u_modelViewMatrix,!1,d);c=this.opacity;void 0!==this.options.opacity&&(c=this.options.opacity);a.uniform1f(b.uniforms.u_opacity,c);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.DST_ALPHA);a.blendEquation(a.FUNC_ADD);a.enableVertexAttribArray(b.attributes.aPos);a.enableVertexAttribArray(b.attributes.aColor);for(c=0;c<this.bufferDataArr.length;c++)if(!(0>=this.bufferDataArr[c].length)){d=(new Float32Array(this.bufferDataArr[c])).BYTES_PER_ELEMENT;a.bindBuffer(a.ARRAY_BUFFER,
        this.vertexBuffer[c]);a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*d,3*d);a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*d,0);d=this.position[c];var g=R.create(),e=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(e=this.map.getZoomUnits(),e=[this.currentScale*e,this.currentScale*e,this.currentScale]);R.identity(g);R.translate(g,g,[d[0],d[1],0]);R.scale(g,g,e);a.uniformMatrix4fv(b.uniforms.u_modelMatrix,!1,g);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
        this.indexBuffer[c]);a.drawElements(a.TRIANGLES,this.indexDataArr[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.disable(a.POLYGON_OFFSET_FILL);c=this.getOptions();b=c.scale;c=c.step;this.opacity-=c/10;this.currentScale+=b*c;0>this.opacity&&(this.currentScale=this.opacity=1);a.useProgram(null)}}]);return b}(ia),rd=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,
    c,a));c.bufferData=[];c.startTime=c.options.startTime||0;c.endTime=c.options.endTime;c.time=c.startTime;c.segs=c.options.segs||10;c.autoUpdate=!0;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(b){this.time=b}},{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",
            fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"});this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],g=b.height,e=0;e<a.length;e++){var l=a[e].geometry.coordinates;var t="[object Function]"===Object.prototype.toString.call(g)?
        g(a[e]):Number(g);for(var r=0,h=0;h<this.segs;h++){var m=this.normizedPoint(l);d.push(m[0],m[1],r);void 0===l[2]?d.push(h):d.push(Number(l[2]));r+=t/this.segs;d.push(m[0],m[1],r);void 0===l[2]?d.push(h+1):d.push(Number(l[2]))}}void 0===b.endTime&&(this.endTime=this.segs);this.bufferData=d;c.bufferData(c.ARRAY_BUFFER,new Float32Array(d),c.STATIC_DRAW);this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,
        !1,c);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.enableVertexAttribArray(b.attributes.aPos);a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,!1,0,0);c=this.normizedColor(this.options.color);a.uniform3f(b.uniforms.uFragColor,c[0],c[1],c[2]);a.uniform1f(b.uniforms.currentTime,this.time);a.uniform1f(b.uniforms.trailLength,this.options.trailLength);a.enable(a.BLEND);a.enable(a.POLYGON_OFFSET_FILL);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.polygonOffset(2,1);a.blendFunc(a.SRC_ALPHA,a.ONE);a.blendEquation(a.FUNC_ADD);
            a.drawArrays(a.LINES,0,this.bufferData.length/4);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.disable(a.POLYGON_OFFSET_FILL);this.time+=this.options.step;this.time>1.5*this.endTime&&(this.time=this.startTime);a.useProgram(null)}}]);return b}(ia),sd=function(d){function b(c,a){x(this,b);return I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a))}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)",
                "0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onChanged",value:function(c,a){this.gl&&(a=this.processData(a,c),Qa(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onChanged",this).call(this,c,a))}},{key:"generateGrid",value:function(b,a){var c=a.gridSize,d=[],g={};a=b.length;for(var e=this.getPointOffset(),l=0;l<a;l++){var t=this.normizedPoint(b[l].geometry.coordinates);t=~~((t[0]+e[0])/c)+"_"+~~((t[1]+e[1])/c);void 0===g[t]&&(g[t]=0);var r=~~b[l].count||
        1;"properties"in b[l]&&"count"in b[l].properties&&(r=~~b[l].properties.count);g[t]+=r}Object.keys(g).forEach(function(a){var b=a.split("_");d.push([b[0]*c+c/2,b[1]*c+c/2,g[a]])});return d}},{key:"processData",value:function(b,a){var c=[];if("normal"===a.style)for(var d=this.getPointOffset(),g=0;g<b.length;g++){var e=this.normizedPoint(b[g].geometry.coordinates);c.push([e[0]+d[0],e[1]+d[1],~~b[g].count||1])}else c=this.generateGrid(b,a);d=b=0;if(void 0!==a.max&&void 0!==a.min)b=a.max,d=a.min;else{c[0]&&
        (b=c[0][2],d=c[0][2]);g=c.length;for(e=0;e<g;e++){var l=c[e];b=Math.max(l[2],b);d=Math.min(l[2],d)}b/=2}a=new fa({max:~~b,min:d,gradient:a.gradient});b=[];for(d=0;d<c.length;d++)g=c[d],g[0]=g[0],g[1]=g[1],e=a.getImageData(g[2]),b.push({geometry:{type:"Point",coordinates:[g[0],g[1]]},color:[e[0]/255,e[1]/255,e[2]/255,e[3]/255]});return b}}]);return b}(Cb),td=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferData=[];return c}H(b,d);A(b,[{key:"getDefaultOptions",
        value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(b,a){if(b=this.gl){this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var c=[],d=0;20>d;d++)for(var g=5*d,e=0;e<a.length;e++)for(var l=a[e].geometry.coordinates,t=0;t<l.length-1;t++){var r=this.normizedPoint(l[t]);c.push(r[0]);c.push(r[1]);c.push(Number(g));r=this.normizedPoint(l[t+1]);c.push(r[0]);c.push(r[1]);c.push(Number(g))}b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW);this.bufferData=
            c;b.bindBuffer(b.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(b){this.gl=b;this.program=new Q(b,{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"});this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(b){var a=b.gl;b=b.matrix;var c=this.program;a.useProgram(c.program);
            var d=this.normizedColor(this.options.color);a.uniform4f(c.uniforms.uFragColor,d[0],d[1],d[2],d[3]);a.enable(a.DEPTH_TEST);a.uniformMatrix4fv(c.uniforms.uMatrix,!1,b);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);a.enable(a.BLEND);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ONE);a.drawArrays(a.LINES,0,this.bufferData.length/3);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.DEPTH_TEST)}}]);return b}(ia),
    Bc={circle:1,square:2},ud=function(d){function b(c,a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferData=[];c.startTime=c.options.startTime||0;c.endTime=c.options.endTime;c.time=c.startTime;c.autoUpdate=!0;return c}H(b,d);A(b,[{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
            fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();
            c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],g=b.color||[.1,.1,.9,1],e=b.size||5,l=0;l<a.length;l++){var t=a[l].geometry.coordinates,r=a[l].color||g;"[object Function]"===Object.prototype.toString.call(r)&&(r=r(a[l]));"properties"in a[l]&&"color"in a[l].properties&&(r=a[l].properties.color);r=this.normizedColor(r);var h=this.normizedPoint(t),m=e;m="[object Function]"===Object.prototype.toString.call(m)?m(a[l]):Number(m);var p=a[l].time||l;"properties"in a[l]&&"time"in a[l].properties&&(p=
                a[l].properties.time);d.push(h[0],h[1],Number(t[2]||0),p);d.push(r[0],r[1],r[2],r[3]);d.push(m*window.devicePixelRatio)}void 0===b.endTime&&(this.endTime=a.length);this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;0>=this.bufferData.length||(b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,
            a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,!1,9*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,9*c,4*c),a.enableVertexAttribArray(b.attributes.aSize),a.vertexAttribPointer(b.attributes.aSize,1,a.FLOAT,!1,9*c,8*c),a.uniform1f(b.uniforms.currentTime,this.time),a.uniform1f(b.uniforms.trailLength,this.options.trailLength||3),c=1,this.options.shape&&Bc[this.options.shape]&&(c=Bc[this.options.shape]),
            a.uniform1i(b.uniforms.uShape,c),b=this.options.blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.POINTS,0,this.bufferData.length/9),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST),a.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]);return b}(ia),vd=function(d){function b(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               a){x(this,b);c=I(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c,a));c.bufferData=[];c.startTime=c.options.startTime||0;c.endTime=c.options.endTime;c.time=c.startTime;c.autoUpdate=!0;return c}H(b,d);A(b,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.program=new Q(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
            fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"});this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(b){this.time=b}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],g=0,e=this.options.color,l=0;l<a.length;l++){var t=
            a[l].geometry.coordinates;a[l].color&&(e=a[l].color);"properties"in a[l]&&"color"in a[l].properties&&(e=a[l].properties.color);"[object Function]"===Object.prototype.toString.call(e)&&(e=e(a[l]));e=this.normizedColor(e);t.length>g&&(g=t.length);for(var r=0;r<t.length-1;r++){var h=this.normizedPoint(t[r]);d.push(h[0]);d.push(h[1]);d.push(h[2]);void 0===t[r][3]?d.push(r):d.push(Number(t[r][3]));d.push(e[0]);d.push(e[1]);d.push(e[2]);d.push(e[3]);h=this.normizedPoint(t[r+1]);d.push(h[0]);d.push(h[1]);
            d.push(h[2]);void 0===t[r+1][3]?d.push(r+1):d.push(Number(t[r+1][3]));d.push(e[0]);d.push(e[1]);d.push(e[2]);d.push(e[3])}}void 0===b.endTime&&(this.endTime=g);this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);c=this.f32BufferData.BYTES_PER_ELEMENT;a.enableVertexAttribArray(b.attributes.aPos);
            a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,!1,8*c,0);a.enableVertexAttribArray(b.attributes.aColor);a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,8*c,4*c);c=this.normizedColor(this.options.color);a.uniform3f(b.uniforms.uFragColor,c[0],c[1],c[2]);a.uniform1f(b.uniforms.currentTime,this.time);a.uniform1f(b.uniforms.trailLength,this.options.trailLength);a.enable(a.BLEND);a.enable(a.POLYGON_OFFSET_FILL);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.polygonOffset(2,1);"lighter"===this.options.blend?
                a.blendFunc(a.ONE,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE);a.blendEquation(a.FUNC_ADD);a.drawArrays(a.LINES,0,this.bufferData.length/8);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=this.options.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}]);return b}(ia),wd=function(){function d(b){var c=this;x(this,d);this.options={};Object.assign(this.options,b);this.layers=[];var a=b.pointOffset;this.webglLayer=b.webglLayer||new wc(b.map,this.options);
        this.effectManager=new mc(this.webglLayer.gl);this.webglRender={render:function(){}};this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects));this.webglLayer.onRender(function(a){c._render(a)});a||"cesium"===this.webglLayer.options.mapType||(b=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[b.lng,b.lat]);this.webglLayer.map.onResize(function(){c.effectManager.initFbo()})}A(d,[{key:"renderCanvas",value:function(b){for(var c=0;c<this.layers.length;c++)this.layers[c].render(b)}},
        {key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(b){var c=this,a=b.gl;a.enable(a.DEPTH_TEST);(a=this.options.effects)&&0<a.length?(this.webglRender.render=function(){c.renderCanvas(b)},this.effectManager.render()):this.renderCanvas(b)}},{key:"addLayer",value:function(b){for(var c=!1,a=0;a<this.layers.length;a++)if(this.layers[a]===b){c=!0;break}c||(b.map=this.webglLayer.map,"threeLayer"===b.layerType?(b.setWebglLayer(this.webglLayer),this.addLayer(b.getThreeLayer()),
            b.initialize&&b.initialize(b.getThreeLayer())):(b.setWebglLayer(this.webglLayer),b.initialize&&b.initialize(this.webglLayer.gl),b.onOptionsChanged(b.getOptions()),b.onDataChanged(b.getData()),b.onChanged(b.getOptions(),b.getData())),this.layers.push(b));this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation();this.webglLayer.render()}},{key:"removeLayer",value:function(b){for(var c=0;c<this.layers.length;c++)this.layers[c]===b&&(b.destroy&&b.destroy(),this.layers.splice(c,
                1));this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation();this.webglLayer.render()}},{key:"onRender",value:function(b){this.webglLayer.onRender(b)}},{key:"removeAllLayers",value:function(){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];c.destroy&&c.destroy();this.layers.splice(b,1)}this.webglLayer.render()}},{key:"destroy",value:function(){this.stopAnimation();this.removeAllLayers();this.webglLayer.destroy()}},{key:"isRequestAnimation",value:function(){for(var b=
                !1,c=0;c<this.layers.length;c++)if(this.layers[c].isRequestAnimation()){b=!0;break}return b}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}}]);return d}();window._hmt=window._hmt||[];(function(){var d=document.createElement("script");d.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(d,b)})();w.View=wd;w.GridLayer=
    vc;w.HeatGridLayer=Zc;w.HeatmapLayer=fd;w.ShapeLayer=uc;w.SimpleLineLayer=xc;w.LineLayer=hd;w.WallSpriteLayer=jd;w.LinePointLayer=kd;w.WallLayer=md;w.WallTripLayer=od;w.HeatLineLayer=pd;w.WebglLayer=wc;w.PointLayer=Cb;w.RippleLayer=qd;w.SparkLayer=rd;w.HeatPointLayer=sd;w.ShapeLineLayer=td;w.PointTripLayer=ud;w.LineTripLayer=vd;w.Layer=ia;w.BlurEffect=Nc;w.BloomEffect=Oc;w.DepthEffect=Pc;w.EffectManager=mc;w.getContext=dc;w.createProgram=ec;w.Program=Q;w.createTexture=Eb;w.loadTextureImage=$a;w.FrameBufferObject=
    Gb;w.CommonLayer=Fb;w.MercatorProjection=pa;w.toRadian=Za;w.Canvas=Db;w.Intensity=fa;w.BezierCurve=ha;w.__moduleExports=oa;w.vec4=Qc;w.vec3=Ia;w.vec2=Rc;w.quat2=Sc;w.quat=Tc;w.mat4=R;w.mat3=Uc;w.mat2d=Vc;w.mat2=Wc;w.glMatrix=Xc;Object.defineProperty(w,"__esModule",{value:!0})});